var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function a(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function o(t,e){t.appendChild(e)}function l(t,e,n){t.insertBefore(e,n||null)}function s(t){t.parentNode.removeChild(t)}function c(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function u(t){return document.createElement(t)}function h(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function d(t){return document.createTextNode(t)}function p(){return d(" ")}function f(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function y(t,e,n){e in t?t[e]=n:g(t,e,n)}function v(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function m(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}function w(t,e,n){t.classList[n?"add":"remove"](e)}let k;function x(t){k=t}function b(){if(!k)throw new Error("Function called outside component initialization");return k}function _(t){b().$$.on_mount.push(t)}function $(){const t=b();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const a=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);r.slice().forEach((e=>{e.call(t,a)}))}}}const M=[],A=[],N=[],E=[],T=Promise.resolve();let D=!1;function S(t){N.push(t)}let L=!1;const z=new Set;function H(){if(!L){L=!0;do{for(let t=0;t<M.length;t+=1){const e=M[t];x(e),j(e.$$)}for(x(null),M.length=0;A.length;)A.pop()();for(let t=0;t<N.length;t+=1){const e=N[t];z.has(e)||(z.add(e),e())}N.length=0}while(M.length);for(;E.length;)E.pop()();D=!1,L=!1,z.clear()}}function j(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(S)}}const q=new Set;function F(t,e){t&&t.i&&(q.delete(t),t.i(e))}function I(t,e,n,r){if(t&&t.o){if(q.has(t))return;q.add(t),undefined.c.push((()=>{q.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function P(t){t&&t.c()}function C(t,n,i){const{fragment:o,on_mount:l,on_destroy:s,after_update:c}=t.$$;o&&o.m(n,i),S((()=>{const n=l.map(e).filter(a);s?s.push(...n):r(n),t.$$.on_mount=[]})),c.forEach(S)}function B(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function W(t,e){-1===t.$$.dirty[0]&&(M.push(t),D||(D=!0,T.then(H)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function O(e,a,i,o,l,c,u=[-1]){const h=k;x(e);const d=a.props||{},p=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:n(),dirty:u,skip_bound:!1};let f=!1;if(p.ctx=i?i(e,d,((t,n,...r)=>{const a=r.length?r[0]:n;return p.ctx&&l(p.ctx[t],p.ctx[t]=a)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](a),f&&W(e,t)),n})):[],p.update(),f=!0,r(p.before_update),p.fragment=!!o&&o(p.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);p.fragment&&p.fragment.l(t),t.forEach(s)}else p.fragment&&p.fragment.c();a.intro&&F(e.$$.fragment),C(e,a.target,a.anchor),H()}x(h)}class R{$destroy(){B(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function X(e){let n;return{c(){n=u("div"),n.innerHTML='<div id="logo" class="svelte-1wqi70q"><div id="logo-icon" class="svelte-1wqi70q"><img src="/dodrio/figures/dodrio-logo.svg" alt="logo"/></div> \n    <div id="logo-text" class="svelte-1wqi70q">Dodrio</div> \n\n    <div id="logo-tagline" class="svelte-1wqi70q">Exploring transformer models in your browser!</div></div> \n\n  <div class="icons svelte-1wqi70q"><a class="icon-a svelte-1wqi70q" target="_blank" href="https://arxiv.org/abs/2103.14625"><div class="icon svelte-1wqi70q" title="Research paper"><i class="fas fa-file-pdf svelte-1wqi70q"></i></div></a> \n\n    <a target="_blank" href="https://youtu.be/uboTKqPNU5Y" class="svelte-1wqi70q"><div class="icon svelte-1wqi70q" title="Demo video"><i class="fab fa-youtube svelte-1wqi70q"></i></div></a> \n\n    <a target="_blank" href="https://github.com/poloclub/dodrio" class="svelte-1wqi70q"><div class="icon svelte-1wqi70q" title="Open-source code"><i class="fab fa-github svelte-1wqi70q"></i></div></a></div>',g(n,"id","header"),g(n,"class","svelte-1wqi70q")},m(t,e){l(t,n,e)},p:t,i:t,o:t,d(t){t&&s(n)}}}class Y extends R{constructor(t){super(),O(this,t,null,X,i,{})}}const V=[];function U(e,n=t){let r;const a=[];function o(t){if(i(e,t)&&(e=t,r)){const t=!V.length;for(let t=0;t<a.length;t+=1){const n=a[t];n[1](),V.push(n,e)}if(t){for(let t=0;t<V.length;t+=2)V[t][0](V[t+1]);V.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(i,l=t){const s=[i,l];return a.push(s),1===a.length&&(r=n(o)||t),i(e),()=>{const t=a.indexOf(s);-1!==t&&a.splice(t,1),0===a.length&&(r(),r=null)}}}}const G=U({}),Q=U({}),K=U({}),Z=U({}),J=U({}),tt=U({}),et=U({show:!1,html:"",left:0,top:0,width:0,maxWidth:0,fontSize:"1em"}),nt=U({inComparison:!1,height:0}),rt=U(1562),at=U(1562),it=U(),ot=U({}),lt=U({}),st=U({show:!1,attention:null,layer:null,head:null}),ct=U({show:!1,attention:null,layer:null,head:null}),ut=U({show:!1,attention:null,layer:null,head:null}),ht=U({layer:9,head:8});function dt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function pt(t){let e=t,n=t;function r(t,e,r,a){for(null==r&&(r=0),null==a&&(a=t.length);r<a;){const i=r+a>>>1;n(t[i],e)<0?r=i+1:a=i}return r}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>dt(t(e),n)}(t)),{left:r,center:function(t,n,a,i){null==a&&(a=0),null==i&&(i=t.length);const o=r(t,n,a,i-1);return o>a&&e(t[o-1],n)>-e(t[o],n)?o-1:o},right:function(t,e,r,a){for(null==r&&(r=0),null==a&&(a=t.length);r<a;){const i=r+a>>>1;n(t[i],e)>0?a=i:r=i+1}return r}}}const ft=pt(dt).right;pt((function(t){return null===t?NaN:+t})).center;function gt(t,e){let n,r;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=r=e):(n>e&&(n=e),r<e&&(r=e)));else{let a=-1;for(let i of t)null!=(i=e(i,++a,t))&&(void 0===n?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)))}return[n,r]}var yt=Math.sqrt(50),vt=Math.sqrt(10),mt=Math.sqrt(2);function wt(t,e,n){var r=(e-t)/Math.max(0,n),a=Math.floor(Math.log(r)/Math.LN10),i=r/Math.pow(10,a);return a>=0?(i>=yt?10:i>=vt?5:i>=mt?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(i>=yt?10:i>=vt?5:i>=mt?2:1)}function kt(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let a of t)null!=(a=e(a,++r,t))&&(n<a||void 0===n&&a>=a)&&(n=a)}return n}var xt=Array.prototype.slice;function bt(t){return t}var _t=1e-6;function $t(t){return"translate("+(t+.5)+",0)"}function Mt(t){return"translate(0,"+(t+.5)+")"}function At(t){return e=>+t(e)}function Nt(t){var e=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(e=Math.round(e)),function(n){return+t(n)+e}}function Et(){return!this.__axis}function Tt(t,e){var n=[],r=null,a=null,i=6,o=6,l=3,s=1===t||4===t?-1:1,c=4===t||2===t?"x":"y",u=1===t||3===t?$t:Mt;function h(h){var d=null==r?e.ticks?e.ticks.apply(e,n):e.domain():r,p=null==a?e.tickFormat?e.tickFormat.apply(e,n):bt:a,f=Math.max(i,0)+l,g=e.range(),y=+g[0]+.5,v=+g[g.length-1]+.5,m=(e.bandwidth?Nt:At)(e.copy()),w=h.selection?h.selection():h,k=w.selectAll(".domain").data([null]),x=w.selectAll(".tick").data(d,e).order(),b=x.exit(),_=x.enter().append("g").attr("class","tick"),$=x.select("line"),M=x.select("text");k=k.merge(k.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),x=x.merge(_),$=$.merge(_.append("line").attr("stroke","currentColor").attr(c+"2",s*i)),M=M.merge(_.append("text").attr("fill","currentColor").attr(c,s*f).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),h!==w&&(k=k.transition(h),x=x.transition(h),$=$.transition(h),M=M.transition(h),b=b.transition(h).attr("opacity",_t).attr("transform",(function(t){return isFinite(t=m(t))?u(t):this.getAttribute("transform")})),_.attr("opacity",_t).attr("transform",(function(t){var e=this.parentNode.__axis;return u(e&&isFinite(e=e(t))?e:m(t))}))),b.remove(),k.attr("d",4===t||2==t?o?"M"+s*o+","+y+"H0.5V"+v+"H"+s*o:"M0.5,"+y+"V"+v:o?"M"+y+","+s*o+"V0.5H"+v+"V"+s*o:"M"+y+",0.5H"+v),x.attr("opacity",1).attr("transform",(function(t){return u(m(t))})),$.attr(c+"2",s*i),M.attr(c,s*f).text(p),w.filter(Et).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),w.each((function(){this.__axis=m}))}return h.scale=function(t){return arguments.length?(e=t,h):e},h.ticks=function(){return n=xt.call(arguments),h},h.tickArguments=function(t){return arguments.length?(n=null==t?[]:xt.call(t),h):n.slice()},h.tickValues=function(t){return arguments.length?(r=null==t?null:xt.call(t),h):r&&r.slice()},h.tickFormat=function(t){return arguments.length?(a=t,h):a},h.tickSize=function(t){return arguments.length?(i=o=+t,h):i},h.tickSizeInner=function(t){return arguments.length?(i=+t,h):i},h.tickSizeOuter=function(t){return arguments.length?(o=+t,h):o},h.tickPadding=function(t){return arguments.length?(l=+t,h):l},h}function Dt(t){return Tt(2,t)}var St={value:()=>{}};function Lt(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new zt(r)}function zt(t){this._=t}function Ht(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function jt(t,e){for(var n,r=0,a=t.length;r<a;++r)if((n=t[r]).name===e)return n.value}function qt(t,e,n){for(var r=0,a=t.length;r<a;++r)if(t[r].name===e){t[r]=St,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}zt.prototype=Lt.prototype={constructor:zt,on:function(t,e){var n,r=this._,a=Ht(t+"",r),i=-1,o=a.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++i<o;)if(n=(t=a[i]).type)r[n]=qt(r[n],t.name,e);else if(null==e)for(n in r)r[n]=qt(r[n],t.name,null);return this}for(;++i<o;)if((n=(t=a[i]).type)&&(n=jt(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new zt(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,a=new Array(n),i=0;i<n;++i)a[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=0,n=(r=this._[t]).length;i<n;++i)r[i].value.apply(e,a)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],a=0,i=r.length;a<i;++a)r[a].value.apply(e,n)}};var Ft="http://www.w3.org/1999/xhtml",It={svg:"http://www.w3.org/2000/svg",xhtml:Ft,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Pt(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),It.hasOwnProperty(e)?{space:It[e],local:t}:t}function Ct(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Ft&&e.documentElement.namespaceURI===Ft?e.createElement(t):e.createElementNS(n,t)}}function Bt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Wt(t){var e=Pt(t);return(e.local?Bt:Ct)(e)}function Ot(){}function Rt(t){return null==t?Ot:function(){return this.querySelector(t)}}function Xt(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Yt(){return[]}function Vt(t){return null==t?Yt:function(){return this.querySelectorAll(t)}}function Ut(t){return function(){return this.matches(t)}}function Gt(t){return function(e){return e.matches(t)}}var Qt=Array.prototype.find;function Kt(){return this.firstElementChild}var Zt=Array.prototype.filter;function Jt(){return this.children}function te(t){return new Array(t.length)}function ee(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function ne(t){return function(){return t}}function re(t,e,n,r,a,i){for(var o,l=0,s=e.length,c=i.length;l<c;++l)(o=e[l])?(o.__data__=i[l],r[l]=o):n[l]=new ee(t,i[l]);for(;l<s;++l)(o=e[l])&&(a[l]=o)}function ae(t,e,n,r,a,i,o){var l,s,c,u=new Map,h=e.length,d=i.length,p=new Array(h);for(l=0;l<h;++l)(s=e[l])&&(p[l]=c=o.call(s,s.__data__,l,e)+"",u.has(c)?a[l]=s:u.set(c,s));for(l=0;l<d;++l)c=o.call(t,i[l],l,i)+"",(s=u.get(c))?(r[l]=s,s.__data__=i[l],u.delete(c)):n[l]=new ee(t,i[l]);for(l=0;l<h;++l)(s=e[l])&&u.get(p[l])===s&&(a[l]=s)}function ie(t){return t.__data__}function oe(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function le(t){return function(){this.removeAttribute(t)}}function se(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ce(t,e){return function(){this.setAttribute(t,e)}}function ue(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function he(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function de(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function pe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function fe(t){return function(){this.style.removeProperty(t)}}function ge(t,e,n){return function(){this.style.setProperty(t,e,n)}}function ye(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function ve(t,e){return t.style.getPropertyValue(e)||pe(t).getComputedStyle(t,null).getPropertyValue(e)}function me(t){return function(){delete this[t]}}function we(t,e){return function(){this[t]=e}}function ke(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function xe(t){return t.trim().split(/^|\s+/)}function be(t){return t.classList||new _e(t)}function _e(t){this._node=t,this._names=xe(t.getAttribute("class")||"")}function $e(t,e){for(var n=be(t),r=-1,a=e.length;++r<a;)n.add(e[r])}function Me(t,e){for(var n=be(t),r=-1,a=e.length;++r<a;)n.remove(e[r])}function Ae(t){return function(){$e(this,t)}}function Ne(t){return function(){Me(this,t)}}function Ee(t,e){return function(){(e.apply(this,arguments)?$e:Me)(this,t)}}function Te(){this.textContent=""}function De(t){return function(){this.textContent=t}}function Se(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Le(){this.innerHTML=""}function ze(t){return function(){this.innerHTML=t}}function He(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function je(){this.nextSibling&&this.parentNode.appendChild(this)}function qe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Fe(){return null}function Ie(){var t=this.parentNode;t&&t.removeChild(this)}function Pe(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ce(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Be(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function We(t){return function(){var e=this.__on;if(e){for(var n,r=0,a=-1,i=e.length;r<i;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++a]=n:this.removeEventListener(n.type,n.listener,n.options);++a?e.length=a:delete this.__on}}}function Oe(t,e,n){return function(){var r,a=this.__on,i=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(a)for(var o=0,l=a.length;o<l;++o)if((r=a[o]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),void(r.value=e);this.addEventListener(t.type,i,n),r={type:t.type,name:t.name,value:e,listener:i,options:n},a?a.push(r):this.__on=[r]}}function Re(t,e,n){var r=pe(t),a=r.CustomEvent;"function"==typeof a?a=new a(e,n):(a=r.document.createEvent("Event"),n?(a.initEvent(e,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(e,!1,!1)),t.dispatchEvent(a)}function Xe(t,e){return function(){return Re(this,t,e)}}function Ye(t,e){return function(){return Re(this,t,e.apply(this,arguments))}}ee.prototype={constructor:ee,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},_e.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Ve=[null];function Ue(t,e){this._groups=t,this._parents=e}function Ge(){return new Ue([[document.documentElement]],Ve)}function Qe(t){return"string"==typeof t?new Ue([[document.querySelector(t)]],[document.documentElement]):new Ue([[t]],Ve)}function Ke(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}function Ze(t){return"string"==typeof t?new Ue([document.querySelectorAll(t)],[document.documentElement]):new Ue([null==t?[]:Xt(t)],Ve)}function Je(t){t.stopImmediatePropagation()}function tn(t){t.preventDefault(),t.stopImmediatePropagation()}function en(t){var e=t.document.documentElement,n=Qe(t).on("dragstart.drag",tn,!0);"onselectstart"in e?n.on("selectstart.drag",tn,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function nn(t,e){var n=t.document.documentElement,r=Qe(t).on("dragstart.drag",null);e&&(r.on("click.drag",tn,!0),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}Ue.prototype=Ge.prototype={constructor:Ue,select:function(t){"function"!=typeof t&&(t=Rt(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i,o,l=e[a],s=l.length,c=r[a]=new Array(s),u=0;u<s;++u)(i=l[u])&&(o=t.call(i,i.__data__,u,l))&&("__data__"in i&&(o.__data__=i.__data__),c[u]=o);return new Ue(r,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);return null==e?[]:Xt(e)}}(t):Vt(t);for(var e=this._groups,n=e.length,r=[],a=[],i=0;i<n;++i)for(var o,l=e[i],s=l.length,c=0;c<s;++c)(o=l[c])&&(r.push(t.call(o,o.__data__,c,l)),a.push(o));return new Ue(r,a)},selectChild:function(t){return this.select(null==t?Kt:function(t){return function(){return Qt.call(this.children,t)}}("function"==typeof t?t:Gt(t)))},selectChildren:function(t){return this.selectAll(null==t?Jt:function(t){return function(){return Zt.call(this.children,t)}}("function"==typeof t?t:Gt(t)))},filter:function(t){"function"!=typeof t&&(t=Ut(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i,o=e[a],l=o.length,s=r[a]=[],c=0;c<l;++c)(i=o[c])&&t.call(i,i.__data__,c,o)&&s.push(i);return new Ue(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,ie);var n=e?ae:re,r=this._parents,a=this._groups;"function"!=typeof t&&(t=ne(t));for(var i=a.length,o=new Array(i),l=new Array(i),s=new Array(i),c=0;c<i;++c){var u=r[c],h=a[c],d=h.length,p=Xt(t.call(u,u&&u.__data__,c,r)),f=p.length,g=l[c]=new Array(f),y=o[c]=new Array(f),v=s[c]=new Array(d);n(u,h,g,y,v,p,e);for(var m,w,k=0,x=0;k<f;++k)if(m=g[k]){for(k>=x&&(x=k+1);!(w=y[x])&&++x<f;);m._next=w||null}}return(o=new Ue(o,r))._enter=l,o._exit=s,o},enter:function(){return new Ue(this._enter||this._groups.map(te),this._parents)},exit:function(){return new Ue(this._exit||this._groups.map(te),this._parents)},join:function(t,e,n){var r=this.enter(),a=this,i=this.exit();return r="function"==typeof t?t(r):r.append(t+""),null!=e&&(a=e(a)),null==n?i.remove():n(i),r&&a?r.merge(a).order():a},merge:function(t){if(!(t instanceof Ue))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,r=e.length,a=n.length,i=Math.min(r,a),o=new Array(r),l=0;l<i;++l)for(var s,c=e[l],u=n[l],h=c.length,d=o[l]=new Array(h),p=0;p<h;++p)(s=c[p]||u[p])&&(d[p]=s);for(;l<r;++l)o[l]=e[l];return new Ue(o,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,a=t[e],i=a.length-1,o=a[i];--i>=0;)(r=a[i])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=oe);for(var n=this._groups,r=n.length,a=new Array(r),i=0;i<r;++i){for(var o,l=n[i],s=l.length,c=a[i]=new Array(s),u=0;u<s;++u)(o=l[u])&&(c[u]=o);c.sort(e)}return new Ue(a,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,i=r.length;a<i;++a){var o=r[a];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var a,i=e[n],o=0,l=i.length;o<l;++o)(a=i[o])&&t.call(a,a.__data__,o,i);return this},attr:function(t,e){var n=Pt(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?se:le:"function"==typeof e?n.local?de:he:n.local?ue:ce)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?fe:"function"==typeof e?ye:ge)(t,e,null==n?"":n)):ve(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?me:"function"==typeof e?ke:we)(t,e)):this.node()[t]},classed:function(t,e){var n=xe(t+"");if(arguments.length<2){for(var r=be(this.node()),a=-1,i=n.length;++a<i;)if(!r.contains(n[a]))return!1;return!0}return this.each(("function"==typeof e?Ee:e?Ae:Ne)(n,e))},text:function(t){return arguments.length?this.each(null==t?Te:("function"==typeof t?Se:De)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Le:("function"==typeof t?He:ze)(t)):this.node().innerHTML},raise:function(){return this.each(je)},lower:function(){return this.each(qe)},append:function(t){var e="function"==typeof t?t:Wt(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:Wt(t),r=null==e?Fe:"function"==typeof e?e:Rt(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Ie)},clone:function(t){return this.select(t?Ce:Pe)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,a,i=Be(t+""),o=i.length;if(!(arguments.length<2)){for(l=e?Oe:We,r=0;r<o;++r)this.each(l(i[r],e,n));return this}var l=this.node().__on;if(l)for(var s,c=0,u=l.length;c<u;++c)for(r=0,s=l[c];r<o;++r)if((a=i[r]).type===s.type&&a.name===s.name)return s.value},dispatch:function(t,e){return this.each(("function"==typeof e?Ye:Xe)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,a=t[e],i=0,o=a.length;i<o;++i)(r=a[i])&&(yield r)}};var rn=t=>()=>t;function an(t,{sourceEvent:e,subject:n,target:r,identifier:a,active:i,x:o,y:l,dx:s,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:s,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}function on(t){return!t.ctrlKey&&!t.button}function ln(){return this.parentNode}function sn(t,e){return null==e?{x:t.x,y:t.y}:e}function cn(){return navigator.maxTouchPoints||"ontouchstart"in this}function un(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function hn(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function dn(){}an.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var pn=.7,fn=1/pn,gn="\\s*([+-]?\\d+)\\s*",yn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",vn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",mn=/^#([0-9a-f]{3,8})$/,wn=new RegExp("^rgb\\("+[gn,gn,gn]+"\\)$"),kn=new RegExp("^rgb\\("+[vn,vn,vn]+"\\)$"),xn=new RegExp("^rgba\\("+[gn,gn,gn,yn]+"\\)$"),bn=new RegExp("^rgba\\("+[vn,vn,vn,yn]+"\\)$"),_n=new RegExp("^hsl\\("+[yn,vn,vn]+"\\)$"),$n=new RegExp("^hsla\\("+[yn,vn,vn,yn]+"\\)$"),Mn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function An(){return this.rgb().formatHex()}function Nn(){return this.rgb().formatRgb()}function En(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=mn.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Tn(e):3===n?new zn(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Dn(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Dn(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=wn.exec(t))?new zn(e[1],e[2],e[3],1):(e=kn.exec(t))?new zn(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=xn.exec(t))?Dn(e[1],e[2],e[3],e[4]):(e=bn.exec(t))?Dn(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=_n.exec(t))?Fn(e[1],e[2]/100,e[3]/100,1):(e=$n.exec(t))?Fn(e[1],e[2]/100,e[3]/100,e[4]):Mn.hasOwnProperty(t)?Tn(Mn[t]):"transparent"===t?new zn(NaN,NaN,NaN,0):null}function Tn(t){return new zn(t>>16&255,t>>8&255,255&t,1)}function Dn(t,e,n,r){return r<=0&&(t=e=n=NaN),new zn(t,e,n,r)}function Sn(t){return t instanceof dn||(t=En(t)),t?new zn((t=t.rgb()).r,t.g,t.b,t.opacity):new zn}function Ln(t,e,n,r){return 1===arguments.length?Sn(t):new zn(t,e,n,null==r?1:r)}function zn(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Hn(){return"#"+qn(this.r)+qn(this.g)+qn(this.b)}function jn(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function qn(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Fn(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Pn(t,e,n,r)}function In(t){if(t instanceof Pn)return new Pn(t.h,t.s,t.l,t.opacity);if(t instanceof dn||(t=En(t)),!t)return new Pn;if(t instanceof Pn)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),i=Math.max(e,n,r),o=NaN,l=i-a,s=(i+a)/2;return l?(o=e===i?(n-r)/l+6*(n<r):n===i?(r-e)/l+2:(e-n)/l+4,l/=s<.5?i+a:2-i-a,o*=60):l=s>0&&s<1?0:o,new Pn(o,l,s,t.opacity)}function Pn(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Cn(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}un(dn,En,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:An,formatHex:An,formatHsl:function(){return In(this).formatHsl()},formatRgb:Nn,toString:Nn}),un(zn,Ln,hn(dn,{brighter:function(t){return t=null==t?fn:Math.pow(fn,t),new zn(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?pn:Math.pow(pn,t),new zn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Hn,formatHex:Hn,formatRgb:jn,toString:jn})),un(Pn,(function(t,e,n,r){return 1===arguments.length?In(t):new Pn(t,e,n,null==r?1:r)}),hn(dn,{brighter:function(t){return t=null==t?fn:Math.pow(fn,t),new Pn(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?pn:Math.pow(pn,t),new Pn(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new zn(Cn(t>=240?t-240:t+120,a,r),Cn(t,a,r),Cn(t<120?t+240:t-120,a,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));const Bn=Math.PI/180,Wn=180/Math.PI,On=.96422,Rn=.82521,Xn=4/29,Yn=6/29,Vn=3*Yn*Yn;function Un(t){if(t instanceof Gn)return new Gn(t.l,t.a,t.b,t.opacity);if(t instanceof nr)return rr(t);t instanceof zn||(t=Sn(t));var e,n,r=Jn(t.r),a=Jn(t.g),i=Jn(t.b),o=Qn((.2225045*r+.7168786*a+.0606169*i)/1);return r===a&&a===i?e=n=o:(e=Qn((.4360747*r+.3850649*a+.1430804*i)/On),n=Qn((.0139322*r+.0971045*a+.7141733*i)/Rn)),new Gn(116*o-16,500*(e-o),200*(o-n),t.opacity)}function Gn(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function Qn(t){return t>.008856451679035631?Math.pow(t,1/3):t/Vn+Xn}function Kn(t){return t>Yn?t*t*t:Vn*(t-Xn)}function Zn(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Jn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function tr(t){if(t instanceof nr)return new nr(t.h,t.c,t.l,t.opacity);if(t instanceof Gn||(t=Un(t)),0===t.a&&0===t.b)return new nr(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*Wn;return new nr(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function er(t,e,n,r){return 1===arguments.length?tr(t):new nr(t,e,n,null==r?1:r)}function nr(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function rr(t){if(isNaN(t.h))return new Gn(t.l,0,0,t.opacity);var e=t.h*Bn;return new Gn(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}un(Gn,(function(t,e,n,r){return 1===arguments.length?Un(t):new Gn(t,e,n,null==r?1:r)}),hn(dn,{brighter:function(t){return new Gn(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Gn(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new zn(Zn(3.1338561*(e=On*Kn(e))-1.6168667*(t=1*Kn(t))-.4906146*(n=Rn*Kn(n))),Zn(-.9787684*e+1.9161415*t+.033454*n),Zn(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),un(nr,er,hn(dn,{brighter:function(t){return new nr(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new nr(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return rr(this).rgb()}}));var ar=t=>()=>t;function ir(t){return 1==(t=+t)?or:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):ar(isNaN(e)?n:e)}}function or(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):ar(isNaN(t)?e:t)}var lr=function t(e){var n=ir(e);function r(t,e){var r=n((t=Ln(t)).r,(e=Ln(e)).r),a=n(t.g,e.g),i=n(t.b,e.b),o=or(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=a(e),t.b=i(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function sr(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,a=e.slice();return function(i){for(n=0;n<r;++n)a[n]=t[n]*(1-i)+e[n]*i;return a}}function cr(t,e){var n,r=e?e.length:0,a=t?Math.min(r,t.length):0,i=new Array(a),o=new Array(r);for(n=0;n<a;++n)i[n]=yr(t[n],e[n]);for(;n<r;++n)o[n]=e[n];return function(t){for(n=0;n<a;++n)o[n]=i[n](t);return o}}function ur(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function hr(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function dr(t,e){var n,r={},a={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=yr(t[n],e[n]):a[n]=e[n];return function(t){for(n in r)a[n]=r[n](t);return a}}var pr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,fr=new RegExp(pr.source,"g");function gr(t,e){var n,r,a,i=pr.lastIndex=fr.lastIndex=0,o=-1,l=[],s=[];for(t+="",e+="";(n=pr.exec(t))&&(r=fr.exec(e));)(a=r.index)>i&&(a=e.slice(i,a),l[o]?l[o]+=a:l[++o]=a),(n=n[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,s.push({i:o,x:hr(n,r)})),i=fr.lastIndex;return i<e.length&&(a=e.slice(i),l[o]?l[o]+=a:l[++o]=a),l.length<2?s[0]?function(t){return function(e){return t(e)+""}}(s[0].x):function(t){return function(){return t}}(e):(e=s.length,function(t){for(var n,r=0;r<e;++r)l[(n=s[r]).i]=n.x(t);return l.join("")})}function yr(t,e){var n,r=typeof e;return null==e||"boolean"===r?ar(e):("number"===r?hr:"string"===r?(n=En(e))?(e=n,lr):gr:e instanceof En?lr:e instanceof Date?ur:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}(e)?sr:Array.isArray(e)?cr:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?dr:hr)(t,e)}function vr(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var mr,wr=180/Math.PI,kr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function xr(t,e,n,r,a,i){var o,l,s;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(s=t*n+e*r)&&(n-=t*s,r-=e*s),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,s/=l),t*r<e*n&&(t=-t,e=-e,s=-s,o=-o),{translateX:a,translateY:i,rotate:Math.atan2(e,t)*wr,skewX:Math.atan(s)*wr,scaleX:o,scaleY:l}}function br(t,e,n,r){function a(t){return t.length?t.pop()+" ":""}return function(i,o){var l=[],s=[];return i=t(i),o=t(o),function(t,r,a,i,o,l){if(t!==a||r!==i){var s=o.push("translate(",null,e,null,n);l.push({i:s-4,x:hr(t,a)},{i:s-2,x:hr(r,i)})}else(a||i)&&o.push("translate("+a+e+i+n)}(i.translateX,i.translateY,o.translateX,o.translateY,l,s),function(t,e,n,i){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),i.push({i:n.push(a(n)+"rotate(",null,r)-2,x:hr(t,e)})):e&&n.push(a(n)+"rotate("+e+r)}(i.rotate,o.rotate,l,s),function(t,e,n,i){t!==e?i.push({i:n.push(a(n)+"skewX(",null,r)-2,x:hr(t,e)}):e&&n.push(a(n)+"skewX("+e+r)}(i.skewX,o.skewX,l,s),function(t,e,n,r,i,o){if(t!==n||e!==r){var l=i.push(a(i)+"scale(",null,",",null,")");o.push({i:l-4,x:hr(t,n)},{i:l-2,x:hr(e,r)})}else 1===n&&1===r||i.push(a(i)+"scale("+n+","+r+")")}(i.scaleX,i.scaleY,o.scaleX,o.scaleY,l,s),i=o=null,function(t){for(var e,n=-1,r=s.length;++n<r;)l[(e=s[n]).i]=e.x(t);return l.join("")}}}var _r=br((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?kr:xr(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),$r=br((function(t){return null==t?kr:(mr||(mr=document.createElementNS("http://www.w3.org/2000/svg","g")),mr.setAttribute("transform",t),(t=mr.transform.baseVal.consolidate())?xr((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):kr)}),", ",")",")");function Mr(t){return((t=Math.exp(t))+1/t)/2}var Ar,Nr,Er=function t(e,n,r){function a(t,a){var i,o,l=t[0],s=t[1],c=t[2],u=a[0],h=a[1],d=a[2],p=u-l,f=h-s,g=p*p+f*f;if(g<1e-12)o=Math.log(d/c)/e,i=function(t){return[l+t*p,s+t*f,c*Math.exp(e*t*o)]};else{var y=Math.sqrt(g),v=(d*d-c*c+r*g)/(2*c*n*y),m=(d*d-c*c-r*g)/(2*d*n*y),w=Math.log(Math.sqrt(v*v+1)-v),k=Math.log(Math.sqrt(m*m+1)-m);o=(k-w)/e,i=function(t){var r=t*o,a=Mr(w),i=c/(n*y)*(a*function(t){return((t=Math.exp(2*t))-1)/(t+1)}(e*r+w)-function(t){return((t=Math.exp(t))-1/t)/2}(w));return[l+i*p,s+i*f,c*a/Mr(e*r+w)]}}return i.duration=1e3*o*e/Math.SQRT2,i}return a.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},a}(Math.SQRT2,2,4),Tr=0,Dr=0,Sr=0,Lr=0,zr=0,Hr=0,jr="object"==typeof performance&&performance.now?performance:Date,qr="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Fr(){return zr||(qr(Ir),zr=jr.now()+Hr)}function Ir(){zr=0}function Pr(){this._call=this._time=this._next=null}function Cr(t,e,n){var r=new Pr;return r.restart(t,e,n),r}function Br(){zr=(Lr=jr.now())+Hr,Tr=Dr=0;try{!function(){Fr(),++Tr;for(var t,e=Ar;e;)(t=zr-e._time)>=0&&e._call.call(null,t),e=e._next;--Tr}()}finally{Tr=0,function(){var t,e,n=Ar,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Ar=e);Nr=t,Or(r)}(),zr=0}}function Wr(){var t=jr.now(),e=t-Lr;e>1e3&&(Hr-=e,Lr=t)}function Or(t){Tr||(Dr&&(Dr=clearTimeout(Dr)),t-zr>24?(t<1/0&&(Dr=setTimeout(Br,t-jr.now()-Hr)),Sr&&(Sr=clearInterval(Sr))):(Sr||(Lr=jr.now(),Sr=setInterval(Wr,1e3)),Tr=1,qr(Br)))}function Rr(t,e,n){var r=new Pr;return e=null==e?0:+e,r.restart((n=>{r.stop(),t(n+e)}),e,n),r}Pr.prototype=Cr.prototype={constructor:Pr,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Fr():+n)+(null==e?0:+e),this._next||Nr===this||(Nr?Nr._next=this:Ar=this,Nr=this),this._call=t,this._time=n,Or()},stop:function(){this._call&&(this._call=null,this._time=1/0,Or())}};var Xr=Lt("start","end","cancel","interrupt"),Yr=[];function Vr(t,e,n,r,a,i){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var r,a=t.__transition;function i(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)}function o(i){var c,u,h,d;if(1!==n.state)return s();for(c in a)if((d=a[c]).name===n.name){if(3===d.state)return Rr(o);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete a[c]):+c<e&&(d.state=6,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete a[c])}if(Rr((function(){3===n.state&&(n.state=4,n.timer.restart(l,n.delay,n.time),l(i))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(d=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(r[++u]=d);r.length=u+1}}function l(e){for(var a=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=5,1),i=-1,o=r.length;++i<o;)r[i].call(t,a);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var r in n.state=6,n.timer.stop(),delete a[e],a)return;delete t.__transition}a[e]=n,n.timer=Cr(i,0,n.time)}(t,n,{name:e,index:r,group:a,on:Xr,tween:Yr,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:0})}function Ur(t,e){var n=Qr(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Gr(t,e){var n=Qr(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Qr(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Kr(t,e){var n,r,a,i=t.__transition,o=!0;if(i){for(a in e=null==e?null:e+"",i)(n=i[a]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[a]):o=!1;o&&delete t.__transition}}function Zr(t,e){var n,r;return function(){var a=Gr(this,t),i=a.tween;if(i!==n)for(var o=0,l=(r=n=i).length;o<l;++o)if(r[o].name===e){(r=r.slice()).splice(o,1);break}a.tween=r}}function Jr(t,e,n){var r,a;if("function"!=typeof n)throw new Error;return function(){var i=Gr(this,t),o=i.tween;if(o!==r){a=(r=o).slice();for(var l={name:e,value:n},s=0,c=a.length;s<c;++s)if(a[s].name===e){a[s]=l;break}s===c&&a.push(l)}i.tween=a}}function ta(t,e,n){var r=t._id;return t.each((function(){var t=Gr(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return Qr(t,r).value[e]}}function ea(t,e){var n;return("number"==typeof e?hr:e instanceof En?lr:(n=En(e))?(e=n,lr):gr)(t,e)}function na(t){return function(){this.removeAttribute(t)}}function ra(t){return function(){this.removeAttributeNS(t.space,t.local)}}function aa(t,e,n){var r,a,i=n+"";return function(){var o=this.getAttribute(t);return o===i?null:o===r?a:a=e(r=o,n)}}function ia(t,e,n){var r,a,i=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?a:a=e(r=o,n)}}function oa(t,e,n){var r,a,i;return function(){var o,l,s=n(this);if(null!=s)return(o=this.getAttribute(t))===(l=s+"")?null:o===r&&l===a?i:(a=l,i=e(r=o,s));this.removeAttribute(t)}}function la(t,e,n){var r,a,i;return function(){var o,l,s=n(this);if(null!=s)return(o=this.getAttributeNS(t.space,t.local))===(l=s+"")?null:o===r&&l===a?i:(a=l,i=e(r=o,s));this.removeAttributeNS(t.space,t.local)}}function sa(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function ca(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function ua(t,e){var n,r;function a(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&ca(t,a)),n}return a._value=e,a}function ha(t,e){var n,r;function a(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&sa(t,a)),n}return a._value=e,a}function da(t,e){return function(){Ur(this,t).delay=+e.apply(this,arguments)}}function pa(t,e){return e=+e,function(){Ur(this,t).delay=e}}function fa(t,e){return function(){Gr(this,t).duration=+e.apply(this,arguments)}}function ga(t,e){return e=+e,function(){Gr(this,t).duration=e}}function ya(t,e){if("function"!=typeof e)throw new Error;return function(){Gr(this,t).ease=e}}function va(t,e,n){var r,a,i=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Ur:Gr;return function(){var o=i(this,t),l=o.on;l!==r&&(a=(r=l).copy()).on(e,n),o.on=a}}var ma=Ge.prototype.constructor;function wa(t){return function(){this.style.removeProperty(t)}}function ka(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function xa(t,e,n){var r,a;function i(){var i=e.apply(this,arguments);return i!==a&&(r=(a=i)&&ka(t,i,n)),r}return i._value=e,i}function ba(t){return function(e){this.textContent=t.call(this,e)}}function _a(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&ba(r)),e}return r._value=t,r}var $a=0;function Ma(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Aa(){return++$a}var Na=Ge.prototype;function Ea(t){return((t*=2)<=1?t*t:--t*(2-t)+1)/2}function Ta(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}Ma.prototype=function(t){return Ge().transition(t)}.prototype={constructor:Ma,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Rt(t));for(var r=this._groups,a=r.length,i=new Array(a),o=0;o<a;++o)for(var l,s,c=r[o],u=c.length,h=i[o]=new Array(u),d=0;d<u;++d)(l=c[d])&&(s=t.call(l,l.__data__,d,c))&&("__data__"in l&&(s.__data__=l.__data__),h[d]=s,Vr(h[d],e,n,d,h,Qr(l,n)));return new Ma(i,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Vt(t));for(var r=this._groups,a=r.length,i=[],o=[],l=0;l<a;++l)for(var s,c=r[l],u=c.length,h=0;h<u;++h)if(s=c[h]){for(var d,p=t.call(s,s.__data__,h,c),f=Qr(s,n),g=0,y=p.length;g<y;++g)(d=p[g])&&Vr(d,e,n,g,p,f);i.push(p),o.push(s)}return new Ma(i,o,e,n)},filter:function(t){"function"!=typeof t&&(t=Ut(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i,o=e[a],l=o.length,s=r[a]=[],c=0;c<l;++c)(i=o[c])&&t.call(i,i.__data__,c,o)&&s.push(i);return new Ma(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,a=n.length,i=Math.min(r,a),o=new Array(r),l=0;l<i;++l)for(var s,c=e[l],u=n[l],h=c.length,d=o[l]=new Array(h),p=0;p<h;++p)(s=c[p]||u[p])&&(d[p]=s);for(;l<r;++l)o[l]=e[l];return new Ma(o,this._parents,this._name,this._id)},selection:function(){return new ma(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Aa(),r=this._groups,a=r.length,i=0;i<a;++i)for(var o,l=r[i],s=l.length,c=0;c<s;++c)if(o=l[c]){var u=Qr(o,e);Vr(o,t,n,c,l,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Ma(r,this._parents,t,n)},call:Na.call,nodes:Na.nodes,node:Na.node,size:Na.size,empty:Na.empty,each:Na.each,on:function(t,e){var n=this._id;return arguments.length<2?Qr(this.node(),n).on.on(t):this.each(va(n,t,e))},attr:function(t,e){var n=Pt(t),r="transform"===n?$r:ea;return this.attrTween(t,"function"==typeof e?(n.local?la:oa)(n,r,ta(this,"attr."+t,e)):null==e?(n.local?ra:na)(n):(n.local?ia:aa)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=Pt(t);return this.tween(n,(r.local?ua:ha)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?_r:ea;return null==e?this.styleTween(t,function(t,e){var n,r,a;return function(){var i=ve(this,t),o=(this.style.removeProperty(t),ve(this,t));return i===o?null:i===n&&o===r?a:a=e(n=i,r=o)}}(t,r)).on("end.style."+t,wa(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,a,i;return function(){var o=ve(this,t),l=n(this),s=l+"";return null==l&&(this.style.removeProperty(t),s=l=ve(this,t)),o===s?null:o===r&&s===a?i:(a=s,i=e(r=o,l))}}(t,r,ta(this,"style."+t,e))).each(function(t,e){var n,r,a,i,o="style."+e,l="end."+o;return function(){var s=Gr(this,t),c=s.on,u=null==s.value[o]?i||(i=wa(e)):void 0;c===n&&a===u||(r=(n=c).copy()).on(l,a=u),s.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,a,i=n+"";return function(){var o=ve(this,t);return o===i?null:o===r?a:a=e(r=o,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,xa(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(ta(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,_a(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,a=Qr(this.node(),n).tween,i=0,o=a.length;i<o;++i)if((r=a[i]).name===t)return r.value;return null}return this.each((null==e?Zr:Jr)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?da:pa)(e,t)):Qr(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?fa:ga)(e,t)):Qr(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(ya(e,t)):Qr(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Gr(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,a=n.size();return new Promise((function(i,o){var l={value:o},s={value:function(){0==--a&&i()}};n.each((function(){var n=Gr(this,r),a=n.on;a!==t&&((e=(t=a).copy())._.cancel.push(l),e._.interrupt.push(l),e._.end.push(s)),n.on=e})),0===a&&i()}))},[Symbol.iterator]:Na[Symbol.iterator]};var Da={time:null,delay:0,duration:250,ease:Ta};function Sa(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}Ge.prototype.interrupt=function(t){return this.each((function(){Kr(this,t)}))},Ge.prototype.transition=function(t){var e,n;t instanceof Ma?(e=t._id,t=t._name):(e=Aa(),(n=Da).time=Fr(),t=null==t?null:t+"");for(var r=this._groups,a=r.length,i=0;i<a;++i)for(var o,l=r[i],s=l.length,c=0;c<s;++c)(o=l[c])&&Vr(o,t,e,c,l,n||Sa(o,e));return new Ma(r,this._parents,t,e)};const La=Math.PI,za=2*La,Ha=1e-6,ja=za-Ha;function qa(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Fa(){return new qa}function Ia(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}function Pa(t,e){return fetch(t,e).then(Ia)}function Ca(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var a,i,o,l,s,c,u,h,d,p=t._root,f={data:r},g=t._x0,y=t._y0,v=t._x1,m=t._y1;if(!p)return t._root=f,t;for(;p.length;)if((c=e>=(i=(g+v)/2))?g=i:v=i,(u=n>=(o=(y+m)/2))?y=o:m=o,a=p,!(p=p[h=u<<1|c]))return a[h]=f,t;if(l=+t._x.call(null,p.data),s=+t._y.call(null,p.data),e===l&&n===s)return f.next=p,a?a[h]=f:t._root=f,t;do{a=a?a[h]=new Array(4):t._root=new Array(4),(c=e>=(i=(g+v)/2))?g=i:v=i,(u=n>=(o=(y+m)/2))?y=o:m=o}while((h=u<<1|c)==(d=(s>=o)<<1|l>=i));return a[d]=p,a[h]=f,t}function Ba(t,e,n,r,a){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=a}function Wa(t){return t[0]}function Oa(t){return t[1]}function Ra(t,e,n){var r=new Xa(null==e?Wa:e,null==n?Oa:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function Xa(t,e,n,r,a,i){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=a,this._y1=i,this._root=void 0}function Ya(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}qa.prototype=Fa.prototype={constructor:qa,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,a,i){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+a)+","+(this._y1=+i)},arcTo:function(t,e,n,r,a){t=+t,e=+e,n=+n,r=+r,a=+a;var i=this._x1,o=this._y1,l=n-t,s=r-e,c=i-t,u=o-e,h=c*c+u*u;if(a<0)throw new Error("negative radius: "+a);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(h>Ha)if(Math.abs(u*l-s*c)>Ha&&a){var d=n-i,p=r-o,f=l*l+s*s,g=d*d+p*p,y=Math.sqrt(f),v=Math.sqrt(h),m=a*Math.tan((La-Math.acos((f+h-g)/(2*y*v)))/2),w=m/v,k=m/y;Math.abs(w-1)>Ha&&(this._+="L"+(t+w*c)+","+(e+w*u)),this._+="A"+a+","+a+",0,0,"+ +(u*d>c*p)+","+(this._x1=t+k*l)+","+(this._y1=e+k*s)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,r,a,i){t=+t,e=+e,i=!!i;var o=(n=+n)*Math.cos(r),l=n*Math.sin(r),s=t+o,c=e+l,u=1^i,h=i?r-a:a-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+s+","+c:(Math.abs(this._x1-s)>Ha||Math.abs(this._y1-c)>Ha)&&(this._+="L"+s+","+c),n&&(h<0&&(h=h%za+za),h>ja?this._+="A"+n+","+n+",0,1,"+u+","+(t-o)+","+(e-l)+"A"+n+","+n+",0,1,"+u+","+(this._x1=s)+","+(this._y1=c):h>Ha&&(this._+="A"+n+","+n+",0,"+ +(h>=La)+","+u+","+(this._x1=t+n*Math.cos(a))+","+(this._y1=e+n*Math.sin(a))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var Va=Ra.prototype=Xa.prototype;function Ua(t){return function(){return t}}function Ga(t){return 1e-6*(t()-.5)}function Qa(t){return t.x+t.vx}function Ka(t){return t.y+t.vy}function Za(t){return t.index}function Ja(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function ti(t){var e,n,r,a,i,o,l=Za,s=function(t){return 1/Math.min(a[t.source.index],a[t.target.index])},c=Ua(30),u=1;function h(r){for(var a=0,l=t.length;a<u;++a)for(var s,c,h,d,p,f,g,y=0;y<l;++y)c=(s=t[y]).source,d=(h=s.target).x+h.vx-c.x-c.vx||Ga(o),p=h.y+h.vy-c.y-c.vy||Ga(o),d*=f=((f=Math.sqrt(d*d+p*p))-n[y])/f*r*e[y],p*=f,h.vx-=d*(g=i[y]),h.vy-=p*g,c.vx+=d*(g=1-g),c.vy+=p*g}function d(){if(r){var o,s,c=r.length,u=t.length,h=new Map(r.map(((t,e)=>[l(t,e,r),t])));for(o=0,a=new Array(c);o<u;++o)(s=t[o]).index=o,"object"!=typeof s.source&&(s.source=Ja(h,s.source)),"object"!=typeof s.target&&(s.target=Ja(h,s.target)),a[s.source.index]=(a[s.source.index]||0)+1,a[s.target.index]=(a[s.target.index]||0)+1;for(o=0,i=new Array(u);o<u;++o)s=t[o],i[o]=a[s.source.index]/(a[s.source.index]+a[s.target.index]);e=new Array(u),p(),n=new Array(u),f()}}function p(){if(r)for(var n=0,a=t.length;n<a;++n)e[n]=+s(t[n],n,t)}function f(){if(r)for(var e=0,a=t.length;e<a;++e)n[e]=+c(t[e],e,t)}return null==t&&(t=[]),h.initialize=function(t,e){r=t,o=e,d()},h.links=function(e){return arguments.length?(t=e,d(),h):t},h.id=function(t){return arguments.length?(l=t,h):l},h.iterations=function(t){return arguments.length?(u=+t,h):u},h.strength=function(t){return arguments.length?(s="function"==typeof t?t:Ua(+t),p(),h):s},h.distance=function(t){return arguments.length?(c="function"==typeof t?t:Ua(+t),f(),h):c},h}Va.copy=function(){var t,e,n=new Xa(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=Ya(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var a=0;a<4;++a)(e=r.source[a])&&(e.length?t.push({source:e,target:r.target[a]=new Array(4)}):r.target[a]=Ya(e));return n},Va.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Ca(this.cover(e,n),e,n,t)},Va.addAll=function(t){var e,n,r,a,i=t.length,o=new Array(i),l=new Array(i),s=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(a=+this._y.call(null,e))||(o[n]=r,l[n]=a,r<s&&(s=r),r>u&&(u=r),a<c&&(c=a),a>h&&(h=a));if(s>u||c>h)return this;for(this.cover(s,c).cover(u,h),n=0;n<i;++n)Ca(this,o[n],l[n],t[n]);return this},Va.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,a=this._x1,i=this._y1;if(isNaN(n))a=(n=Math.floor(t))+1,i=(r=Math.floor(e))+1;else{for(var o,l,s=a-n||1,c=this._root;n>t||t>=a||r>e||e>=i;)switch(l=(e<r)<<1|t<n,(o=new Array(4))[l]=c,c=o,s*=2,l){case 0:a=n+s,i=r+s;break;case 1:n=a-s,i=r+s;break;case 2:a=n+s,r=i-s;break;case 3:n=a-s,r=i-s}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=r,this._x1=a,this._y1=i,this},Va.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Va.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Va.find=function(t,e,n){var r,a,i,o,l,s,c,u=this._x0,h=this._y0,d=this._x1,p=this._y1,f=[],g=this._root;for(g&&f.push(new Ba(g,u,h,d,p)),null==n?n=1/0:(u=t-n,h=e-n,d=t+n,p=e+n,n*=n);s=f.pop();)if(!(!(g=s.node)||(a=s.x0)>d||(i=s.y0)>p||(o=s.x1)<u||(l=s.y1)<h))if(g.length){var y=(a+o)/2,v=(i+l)/2;f.push(new Ba(g[3],y,v,o,l),new Ba(g[2],a,v,y,l),new Ba(g[1],y,i,o,v),new Ba(g[0],a,i,y,v)),(c=(e>=v)<<1|t>=y)&&(s=f[f.length-1],f[f.length-1]=f[f.length-1-c],f[f.length-1-c]=s)}else{var m=t-+this._x.call(null,g.data),w=e-+this._y.call(null,g.data),k=m*m+w*w;if(k<n){var x=Math.sqrt(n=k);u=t-x,h=e-x,d=t+x,p=e+x,r=g.data}}return r},Va.remove=function(t){if(isNaN(i=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,r,a,i,o,l,s,c,u,h,d,p=this._root,f=this._x0,g=this._y0,y=this._x1,v=this._y1;if(!p)return this;if(p.length)for(;;){if((c=i>=(l=(f+y)/2))?f=l:y=l,(u=o>=(s=(g+v)/2))?g=s:v=s,e=p,!(p=p[h=u<<1|c]))return this;if(!p.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,d=h)}for(;p.data!==t;)if(r=p,!(p=p.next))return this;return(a=p.next)&&delete p.next,r?(a?r.next=a:delete r.next,this):e?(a?e[h]=a:delete e[h],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(n?n[d]=p:this._root=p),this):(this._root=a,this)},Va.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Va.root=function(){return this._root},Va.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Va.visit=function(t){var e,n,r,a,i,o,l=[],s=this._root;for(s&&l.push(new Ba(s,this._x0,this._y0,this._x1,this._y1));e=l.pop();)if(!t(s=e.node,r=e.x0,a=e.y0,i=e.x1,o=e.y1)&&s.length){var c=(r+i)/2,u=(a+o)/2;(n=s[3])&&l.push(new Ba(n,c,u,i,o)),(n=s[2])&&l.push(new Ba(n,r,u,c,o)),(n=s[1])&&l.push(new Ba(n,c,a,i,u)),(n=s[0])&&l.push(new Ba(n,r,a,c,u))}return this},Va.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Ba(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var a=e.node;if(a.length){var i,o=e.x0,l=e.y0,s=e.x1,c=e.y1,u=(o+s)/2,h=(l+c)/2;(i=a[0])&&n.push(new Ba(i,o,l,u,h)),(i=a[1])&&n.push(new Ba(i,u,l,s,h)),(i=a[2])&&n.push(new Ba(i,o,h,u,c)),(i=a[3])&&n.push(new Ba(i,u,h,s,c))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},Va.x=function(t){return arguments.length?(this._x=t,this):this._x},Va.y=function(t){return arguments.length?(this._y=t,this):this._y};const ei=4294967296;function ni(t){return t.x}function ri(t){return t.y}var ai=Math.PI*(3-Math.sqrt(5));function ii(t){var e,n=1,r=.001,a=1-Math.pow(r,1/300),i=0,o=.6,l=new Map,s=Cr(h),c=Lt("tick","end"),u=function(){let t=1;return()=>(t=(1664525*t+1013904223)%ei)/ei}();function h(){d(),c.call("tick",e),n<r&&(s.stop(),c.call("end",e))}function d(r){var s,c,u=t.length;void 0===r&&(r=1);for(var h=0;h<r;++h)for(n+=(i-n)*a,l.forEach((function(t){t(n)})),s=0;s<u;++s)null==(c=t[s]).fx?c.x+=c.vx*=o:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=o:(c.y=c.fy,c.vy=0);return e}function p(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var a=10*Math.sqrt(.5+n),i=n*ai;e.x=a*Math.cos(i),e.y=a*Math.sin(i)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function f(e){return e.initialize&&e.initialize(t,u),e}return null==t&&(t=[]),p(),e={tick:d,restart:function(){return s.restart(h),e},stop:function(){return s.stop(),e},nodes:function(n){return arguments.length?(t=n,p(),l.forEach(f),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(a=+t,e):+a},alphaTarget:function(t){return arguments.length?(i=+t,e):i},velocityDecay:function(t){return arguments.length?(o=1-t,e):1-o},randomSource:function(t){return arguments.length?(u=t,l.forEach(f),e):u},force:function(t,n){return arguments.length>1?(null==n?l.delete(t):l.set(t,f(n)),e):l.get(t)},find:function(e,n,r){var a,i,o,l,s,c=0,u=t.length;for(null==r?r=1/0:r*=r,c=0;c<u;++c)(o=(a=e-(l=t[c]).x)*a+(i=n-l.y)*i)<r&&(s=l,r=o);return s},on:function(t,n){return arguments.length>1?(c.on(t,n),e):c.on(t)}}}function oi(t){var e,n,r,a=Ua(.1);function i(t){for(var a,i=0,o=e.length;i<o;++i)(a=e[i]).vx+=(r[i]-a.x)*n[i]*t}function o(){if(e){var i,o=e.length;for(n=new Array(o),r=new Array(o),i=0;i<o;++i)n[i]=isNaN(r[i]=+t(e[i],i,e))?0:+a(e[i],i,e)}}return"function"!=typeof t&&(t=Ua(null==t?0:+t)),i.initialize=function(t){e=t,o()},i.strength=function(t){return arguments.length?(a="function"==typeof t?t:Ua(+t),o(),i):a},i.x=function(e){return arguments.length?(t="function"==typeof e?e:Ua(+e),o(),i):t},i}function li(t){var e,n,r,a=Ua(.1);function i(t){for(var a,i=0,o=e.length;i<o;++i)(a=e[i]).vy+=(r[i]-a.y)*n[i]*t}function o(){if(e){var i,o=e.length;for(n=new Array(o),r=new Array(o),i=0;i<o;++i)n[i]=isNaN(r[i]=+t(e[i],i,e))?0:+a(e[i],i,e)}}return"function"!=typeof t&&(t=Ua(null==t?0:+t)),i.initialize=function(t){e=t,o()},i.strength=function(t){return arguments.length?(a="function"==typeof t?t:Ua(+t),o(),i):a},i.y=function(e){return arguments.length?(t="function"==typeof e?e:Ua(+e),o(),i):t},i}function si(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function ci(t){return(t=si(Math.abs(t)))?t[1]:NaN}var ui,hi=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function di(t){if(!(e=hi.exec(t)))throw new Error("invalid format: "+t);var e;return new pi({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function pi(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function fi(t,e){var n=si(t,e);if(!n)return t+"";var r=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}di.prototype=pi.prototype,pi.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var gi={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>fi(100*t,e),r:fi,s:function(t,e){var n=si(t,e);if(!n)return t+"";var r=n[0],a=n[1],i=a-(ui=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,o=r.length;return i===o?r:i>o?r+new Array(i-o+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+si(t,Math.max(0,e+i-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function yi(t){return t}var vi,mi,wi,ki=Array.prototype.map,xi=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function bi(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?yi:(e=ki.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var a=t.length,i=[],o=0,l=e[0],s=0;a>0&&l>0&&(s+l+1>r&&(l=Math.max(1,r-s)),i.push(t.substring(a-=l,a+l)),!((s+=l+1)>r));)l=e[o=(o+1)%e.length];return i.reverse().join(n)}),a=void 0===t.currency?"":t.currency[0]+"",i=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",l=void 0===t.numerals?yi:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(ki.call(t.numerals,String)),s=void 0===t.percent?"%":t.percent+"",c=void 0===t.minus?"−":t.minus+"",u=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=di(t)).fill,n=t.align,h=t.sign,d=t.symbol,p=t.zero,f=t.width,g=t.comma,y=t.precision,v=t.trim,m=t.type;"n"===m?(g=!0,m="g"):gi[m]||(void 0===y&&(y=12),v=!0,m="g"),(p||"0"===e&&"="===n)&&(p=!0,e="0",n="=");var w="$"===d?a:"#"===d&&/[boxX]/.test(m)?"0"+m.toLowerCase():"",k="$"===d?i:/[%p]/.test(m)?s:"",x=gi[m],b=/[defgprs%]/.test(m);function _(t){var a,i,s,d=w,_=k;if("c"===m)_=x(t)+_,t="";else{var $=(t=+t)<0||1/t<0;if(t=isNaN(t)?u:x(Math.abs(t),y),v&&(t=function(t){t:for(var e,n=t.length,r=1,a=-1;r<n;++r)switch(t[r]){case".":a=e=r;break;case"0":0===a&&(a=r),e=r;break;default:if(!+t[r])break t;a>0&&(a=0)}return a>0?t.slice(0,a)+t.slice(e+1):t}(t)),$&&0==+t&&"+"!==h&&($=!1),d=($?"("===h?h:c:"-"===h||"("===h?"":h)+d,_=("s"===m?xi[8+ui/3]:"")+_+($&&"("===h?")":""),b)for(a=-1,i=t.length;++a<i;)if(48>(s=t.charCodeAt(a))||s>57){_=(46===s?o+t.slice(a+1):t.slice(a))+_,t=t.slice(0,a);break}}g&&!p&&(t=r(t,1/0));var M=d.length+t.length+_.length,A=M<f?new Array(f-M+1).join(e):"";switch(g&&p&&(t=r(A+t,A.length?f-_.length:1/0),A=""),n){case"<":t=d+t+_+A;break;case"=":t=d+A+t+_;break;case"^":t=A.slice(0,M=A.length>>1)+d+t+_+A.slice(M);break;default:t=A+d+t+_}return l(t)}return y=void 0===y?6:/[gprs]/.test(m)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),_.toString=function(){return t+""},_}return{format:h,formatPrefix:function(t,e){var n=h(((t=di(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(ci(e)/3))),a=Math.pow(10,-r),i=xi[8+r/3];return function(t){return n(a*t)+i}}}}function _i(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function $i(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=Ai)):void 0===e&&(e=Mi);for(var n,r,a,i,o,l=new Ti(t),s=[l];n=s.pop();)if((a=e(n.data))&&(o=(a=Array.from(a)).length))for(n.children=a,i=o-1;i>=0;--i)s.push(r=a[i]=new Ti(a[i])),r.parent=n,r.depth=n.depth+1;return l.eachBefore(Ei)}function Mi(t){return t.children}function Ai(t){return Array.isArray(t)?t[1]:null}function Ni(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function Ei(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function Ti(t){this.data=t,this.depth=this.height=0,this.parent=null}function Di(t){if("function"!=typeof t)throw new Error;return t}vi=bi({thousands:",",grouping:[3],currency:["$",""]}),mi=vi.format,wi=vi.formatPrefix,Ti.prototype=$i.prototype={constructor:Ti,count:function(){return this.eachAfter(_i)},each:function(t,e){let n=-1;for(const r of this)t.call(e,r,++n,this);return this},eachAfter:function(t,e){for(var n,r,a,i=this,o=[i],l=[],s=-1;i=o.pop();)if(l.push(i),n=i.children)for(r=0,a=n.length;r<a;++r)o.push(n[r]);for(;i=l.pop();)t.call(e,i,++s,this);return this},eachBefore:function(t,e){for(var n,r,a=this,i=[a],o=-1;a=i.pop();)if(t.call(e,a,++o,this),n=a.children)for(r=n.length-1;r>=0;--r)i.push(n[r]);return this},find:function(t,e){let n=-1;for(const r of this)if(t.call(e,r,++n,this))return r},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,a=r&&r.length;--a>=0;)n+=r[a].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),a=null;t=n.pop(),e=r.pop();for(;t===e;)a=t,t=n.pop(),e=r.pop();return a}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var a=r.length;t!==n;)r.splice(a,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return $i(this).eachBefore(Ni)},[Symbol.iterator]:function*(){var t,e,n,r,a=this,i=[a];do{for(t=i.reverse(),i=[];a=t.pop();)if(yield a,e=a.children)for(n=0,r=e.length;n<r;++n)i.push(e[n])}while(i.length)}};var Si={depth:-1},Li={};function zi(t){return t.id}function Hi(t){return t.parentId}function ji(t,e){return t.parent===e.parent?1:2}function qi(t){var e=t.children;return e?e[0]:t.t}function Fi(t){var e=t.children;return e?e[e.length-1]:t.t}function Ii(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function Pi(t,e,n){return t.a.parent===e.parent?t.a:n}function Ci(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}function Bi(){var t=ji,e=1,n=1,r=null;function a(a){var s=function(t){for(var e,n,r,a,i,o=new Ci(t,0),l=[o];e=l.pop();)if(r=e._.children)for(e.children=new Array(i=r.length),a=i-1;a>=0;--a)l.push(n=e.children[a]=new Ci(r[a],a)),n.parent=e;return(o.parent=new Ci(null,0)).children=[o],o}(a);if(s.eachAfter(i),s.parent.m=-s.z,s.eachBefore(o),r)a.eachBefore(l);else{var c=a,u=a,h=a;a.eachBefore((function(t){t.x<c.x&&(c=t),t.x>u.x&&(u=t),t.depth>h.depth&&(h=t)}));var d=c===u?1:t(c,u)/2,p=d-c.x,f=e/(u.x+d+p),g=n/(h.depth||1);a.eachBefore((function(t){t.x=(t.x+p)*f,t.y=t.depth*g}))}return a}function i(e){var n=e.children,r=e.parent.children,a=e.i?r[e.i-1]:null;if(n){!function(t){for(var e,n=0,r=0,a=t.children,i=a.length;--i>=0;)(e=a[i]).z+=n,e.m+=n,n+=e.s+(r+=e.c)}(e);var i=(n[0].z+n[n.length-1].z)/2;a?(e.z=a.z+t(e._,a._),e.m=e.z-i):e.z=i}else a&&(e.z=a.z+t(e._,a._));e.parent.A=function(e,n,r){if(n){for(var a,i=e,o=e,l=n,s=i.parent.children[0],c=i.m,u=o.m,h=l.m,d=s.m;l=Fi(l),i=qi(i),l&&i;)s=qi(s),(o=Fi(o)).a=e,(a=l.z+h-i.z-c+t(l._,i._))>0&&(Ii(Pi(l,e,r),e,a),c+=a,u+=a),h+=l.m,c+=i.m,d+=s.m,u+=o.m;l&&!Fi(o)&&(o.t=l,o.m+=h-u),i&&!qi(s)&&(s.t=i,s.m+=c-d,r=e)}return r}(e,a,e.parent.A||r[0])}function o(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function l(t){t.x*=e,t.y=t.depth*n}return a.separation=function(e){return arguments.length?(t=e,a):t},a.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],a):r?null:[e,n]},a.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],a):r?[e,n]:null},a}function Wi(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function Oi(t){return+t}Ci.prototype=Object.create(Ti.prototype);var Ri=[0,1];function Xi(t){return t}function Yi(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:function(t){return function(){return t}}(isNaN(e)?NaN:.5)}function Vi(t,e,n){var r=t[0],a=t[1],i=e[0],o=e[1];return a<r?(r=Yi(a,r),i=n(o,i)):(r=Yi(r,a),i=n(i,o)),function(t){return i(r(t))}}function Ui(t,e,n){var r=Math.min(t.length,e.length)-1,a=new Array(r),i=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)a[o]=Yi(t[o],t[o+1]),i[o]=n(e[o],e[o+1]);return function(e){var n=ft(t,e,1,r)-1;return i[n](a[n](e))}}function Gi(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Qi(){var t,e,n,r,a,i,o=Ri,l=Ri,s=yr,c=Xi;function u(){var t=Math.min(o.length,l.length);return c!==Xi&&(c=function(t,e){var n;return t>e&&(n=t,t=e,e=n),function(n){return Math.max(t,Math.min(e,n))}}(o[0],o[t-1])),r=t>2?Ui:Vi,a=i=null,h}function h(e){return isNaN(e=+e)?n:(a||(a=r(o.map(t),l,s)))(t(c(e)))}return h.invert=function(n){return c(e((i||(i=r(l,o.map(t),hr)))(n)))},h.domain=function(t){return arguments.length?(o=Array.from(t,Oi),u()):o.slice()},h.range=function(t){return arguments.length?(l=Array.from(t),u()):l.slice()},h.rangeRound=function(t){return l=Array.from(t),s=vr,u()},h.clamp=function(t){return arguments.length?(c=!!t||Xi,u()):c!==Xi},h.interpolate=function(t){return arguments.length?(s=t,u()):s},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,r){return t=n,e=r,u()}}function Ki(){return Qi()(Xi,Xi)}function Zi(t,e,n,r){var a,i=function(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),a=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),i=r/a;return i>=yt?a*=10:i>=vt?a*=5:i>=mt&&(a*=2),e<t?-a:a}(t,e,n);switch((r=di(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(a=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(ci(e)/3)))-ci(Math.abs(t)))}(i,o))||(r.precision=a),wi(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(a=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,ci(e)-ci(t))+1}(i,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=a-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(a=function(t){return Math.max(0,-ci(Math.abs(t)))}(i))||(r.precision=a-2*("%"===r.type))}return mi(r)}function Ji(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){var r,a,i,o,l=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(a=t,t=e,e=a),0===(o=wt(t,e,n))||!isFinite(o))return[];if(o>0)for(t=Math.ceil(t/o),e=Math.floor(e/o),i=new Array(a=Math.ceil(e-t+1));++l<a;)i[l]=(t+l)*o;else for(o=-o,t=Math.ceil(t*o),e=Math.floor(e*o),i=new Array(a=Math.ceil(e-t+1));++l<a;)i[l]=(t+l)/o;return r&&i.reverse(),i}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return Zi(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,a,i=e(),o=0,l=i.length-1,s=i[o],c=i[l],u=10;for(c<s&&(a=s,s=c,c=a,a=o,o=l,l=a);u-- >0;){if((a=wt(s,c,n))===r)return i[o]=s,i[l]=c,e(i);if(a>0)s=Math.floor(s/a)*a,c=Math.ceil(c/a)*a;else{if(!(a<0))break;s=Math.ceil(s*a)/a,c=Math.floor(c*a)/a}r=a}return t},t}function to(){var t=Ki();return t.copy=function(){return Gi(t,to())},Wi.apply(t,arguments),Ji(t)}function eo(t){return function(){return t}}var no=Math.abs,ro=Math.atan2,ao=Math.cos,io=Math.max,oo=Math.min,lo=Math.sin,so=Math.sqrt,co=1e-12,uo=Math.PI,ho=uo/2,po=2*uo;function fo(t){return t>1?0:t<-1?uo:Math.acos(t)}function go(t){return t>=1?ho:t<=-1?-ho:Math.asin(t)}function yo(t){return t.innerRadius}function vo(t){return t.outerRadius}function mo(t){return t.startAngle}function wo(t){return t.endAngle}function ko(t){return t&&t.padAngle}function xo(t,e,n,r,a,i,o,l){var s=n-t,c=r-e,u=o-a,h=l-i,d=h*s-u*c;if(!(d*d<co))return[t+(d=(u*(e-i)-h*(t-a))/d)*s,e+d*c]}function bo(t,e,n,r,a,i,o){var l=t-n,s=e-r,c=(o?i:-i)/so(l*l+s*s),u=c*s,h=-c*l,d=t+u,p=e+h,f=n+u,g=r+h,y=(d+f)/2,v=(p+g)/2,m=f-d,w=g-p,k=m*m+w*w,x=a-i,b=d*g-f*p,_=(w<0?-1:1)*so(io(0,x*x*k-b*b)),$=(b*w-m*_)/k,M=(-b*m-w*_)/k,A=(b*w+m*_)/k,N=(-b*m+w*_)/k,E=$-y,T=M-v,D=A-y,S=N-v;return E*E+T*T>D*D+S*S&&($=A,M=N),{cx:$,cy:M,x01:-u,y01:-h,x11:$*(a/x-1),y11:M*(a/x-1)}}function _o(){var t=yo,e=vo,n=eo(0),r=null,a=mo,i=wo,o=ko,l=null;function s(){var s,c,u=+t.apply(this,arguments),h=+e.apply(this,arguments),d=a.apply(this,arguments)-ho,p=i.apply(this,arguments)-ho,f=no(p-d),g=p>d;if(l||(l=s=Fa()),h<u&&(c=h,h=u,u=c),h>co)if(f>po-co)l.moveTo(h*ao(d),h*lo(d)),l.arc(0,0,h,d,p,!g),u>co&&(l.moveTo(u*ao(p),u*lo(p)),l.arc(0,0,u,p,d,g));else{var y,v,m=d,w=p,k=d,x=p,b=f,_=f,$=o.apply(this,arguments)/2,M=$>co&&(r?+r.apply(this,arguments):so(u*u+h*h)),A=oo(no(h-u)/2,+n.apply(this,arguments)),N=A,E=A;if(M>co){var T=go(M/u*lo($)),D=go(M/h*lo($));(b-=2*T)>co?(k+=T*=g?1:-1,x-=T):(b=0,k=x=(d+p)/2),(_-=2*D)>co?(m+=D*=g?1:-1,w-=D):(_=0,m=w=(d+p)/2)}var S=h*ao(m),L=h*lo(m),z=u*ao(x),H=u*lo(x);if(A>co){var j,q=h*ao(w),F=h*lo(w),I=u*ao(k),P=u*lo(k);if(f<uo&&(j=xo(S,L,I,P,q,F,z,H))){var C=S-j[0],B=L-j[1],W=q-j[0],O=F-j[1],R=1/lo(fo((C*W+B*O)/(so(C*C+B*B)*so(W*W+O*O)))/2),X=so(j[0]*j[0]+j[1]*j[1]);N=oo(A,(u-X)/(R-1)),E=oo(A,(h-X)/(R+1))}}_>co?E>co?(y=bo(I,P,S,L,h,E,g),v=bo(q,F,z,H,h,E,g),l.moveTo(y.cx+y.x01,y.cy+y.y01),E<A?l.arc(y.cx,y.cy,E,ro(y.y01,y.x01),ro(v.y01,v.x01),!g):(l.arc(y.cx,y.cy,E,ro(y.y01,y.x01),ro(y.y11,y.x11),!g),l.arc(0,0,h,ro(y.cy+y.y11,y.cx+y.x11),ro(v.cy+v.y11,v.cx+v.x11),!g),l.arc(v.cx,v.cy,E,ro(v.y11,v.x11),ro(v.y01,v.x01),!g))):(l.moveTo(S,L),l.arc(0,0,h,m,w,!g)):l.moveTo(S,L),u>co&&b>co?N>co?(y=bo(z,H,q,F,u,-N,g),v=bo(S,L,I,P,u,-N,g),l.lineTo(y.cx+y.x01,y.cy+y.y01),N<A?l.arc(y.cx,y.cy,N,ro(y.y01,y.x01),ro(v.y01,v.x01),!g):(l.arc(y.cx,y.cy,N,ro(y.y01,y.x01),ro(y.y11,y.x11),!g),l.arc(0,0,u,ro(y.cy+y.y11,y.cx+y.x11),ro(v.cy+v.y11,v.cx+v.x11),g),l.arc(v.cx,v.cy,N,ro(v.y11,v.x11),ro(v.y01,v.x01),!g))):l.arc(0,0,u,x,k,g):l.lineTo(z,H)}else l.moveTo(0,0);if(l.closePath(),s)return l=null,s+""||null}return s.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,r=(+a.apply(this,arguments)+ +i.apply(this,arguments))/2-uo/2;return[ao(r)*n,lo(r)*n]},s.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:eo(+e),s):t},s.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:eo(+t),s):e},s.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:eo(+t),s):n},s.padRadius=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:eo(+t),s):r},s.startAngle=function(t){return arguments.length?(a="function"==typeof t?t:eo(+t),s):a},s.endAngle=function(t){return arguments.length?(i="function"==typeof t?t:eo(+t),s):i},s.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:eo(+t),s):o},s.context=function(t){return arguments.length?(l=null==t?null:t,s):l},s}var $o=Array.prototype.slice;function Mo(t){return t[0]}function Ao(t){return t[1]}function No(t){return t.source}function Eo(t){return t.target}function To(t,e,n,r,a){t.moveTo(e,n),t.bezierCurveTo(e,n=(n+a)/2,r,n,r,a)}function Do(){return function(t){var e=No,n=Eo,r=Mo,a=Ao,i=null;function o(){var o,l=$o.call(arguments),s=e.apply(this,l),c=n.apply(this,l);if(i||(i=o=Fa()),t(i,+r.apply(this,(l[0]=s,l)),+a.apply(this,l),+r.apply(this,(l[0]=c,l)),+a.apply(this,l)),o)return i=null,o+""||null}return o.source=function(t){return arguments.length?(e=t,o):e},o.target=function(t){return arguments.length?(n=t,o):n},o.x=function(t){return arguments.length?(r="function"==typeof t?t:eo(+t),o):r},o.y=function(t){return arguments.length?(a="function"==typeof t?t:eo(+t),o):a},o.context=function(t){return arguments.length?(i=null==t?null:t,o):i},o}(To)}var So=t=>()=>t;function Lo(t,{sourceEvent:e,target:n,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function zo(t,e,n){this.k=t,this.x=e,this.y=n}zo.prototype={constructor:zo,scale:function(t){return 1===t?this:new zo(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new zo(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ho=new zo(1,0,0);function jo(t){t.stopImmediatePropagation()}function qo(t){t.preventDefault(),t.stopImmediatePropagation()}function Fo(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function Io(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function Po(){return this.__zoom||Ho}function Co(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Bo(){return navigator.maxTouchPoints||"ontouchstart"in this}function Wo(t,e,n){var r=t.invertX(e[0][0])-n[0][0],a=t.invertX(e[1][0])-n[1][0],i=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function Oo(t,e,n){const r=t.slice();return r[65]=e[n],r}function Ro(t,e,n){const r=t.slice();return r[68]=e[n],r}function Xo(t,e,n){const r=t.slice();return r[68]=e[n],r}function Yo(e){let n,r,a,i=e[68]+1+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[68],n.value=n.__value},m(t,e){l(t,n,e),o(n,r)},p:t,d(t){t&&s(n)}}}function Vo(e){let n,r,a,i=e[68]+1+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[68],n.value=n.__value},m(t,e){l(t,n,e),o(n,r)},p:t,d(t){t&&s(n)}}}function Uo(e){let n,r,a,i=e[65].name+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[65].value,n.value=n.__value},m(t,e){l(t,n,e),o(n,r)},p:t,d(t){t&&s(n)}}}function Go(e){let n,r,a,i,y,m,k,x,b,_,$,M,A,N,E,T,D,S,L,z,H,j,q,F,I,P,C,B,W,O,R,X,Y,V,U,G,Q,K,Z,J,tt,et,nt,rt,at,it,ot,lt,st,ct,ut,ht,dt,pt,ft,gt,yt,vt,mt,wt,kt,xt,bt,_t,$t,Mt,At,Nt,Et,Tt,Dt,St,Lt,zt,Ht,jt,qt,Ft,It,Pt,Ct,Bt,Wt,Ot,Rt,Xt=(e[3].autoAttention?"auto":e[6](e[4].force.attention,2))+"",Yt=e[6](e[4].force.textOrder,2)+"",Vt=e[6](e[4].force.manyBody,2)+"",Ut=e[6](e[4].force.collideRadius,2)+"",Gt=e[6](e[1],2)+"",Qt=[...Array(12).keys()],Kt=[];for(let t=0;t<Qt.length;t+=1)Kt[t]=Yo(Xo(e,Qt,t));let Zt=[...Array(12).keys()],Jt=[];for(let t=0;t<Zt.length;t+=1)Jt[t]=Vo(Ro(e,Zt,t));let te=Object.values(e[5]),ee=[];for(let t=0;t<te.length;t+=1)ee[t]=Uo(Oo(e,te,t));return{c(){n=u("div"),r=u("div"),a=u("div"),a.textContent="Semantic Attention Graph",i=p(),y=u("div"),m=u("div"),k=u("div"),x=d("Layer\n          "),b=u("div"),_=u("select");for(let t=0;t<Kt.length;t+=1)Kt[t].c();$=p(),M=u("div"),A=d("Head\n          "),N=u("div"),E=u("select");for(let t=0;t<Jt.length;t+=1)Jt[t].c();T=p(),D=u("div"),S=p(),L=u("div"),z=u("div"),z.innerHTML='<i class="fas fa-sliders-h"></i>',H=p(),j=u("div"),q=p(),F=u("div"),I=u("select");for(let t=0;t<ee.length;t+=1)ee[t].c();P=p(),C=u("div"),B=u("div"),W=p(),O=u("div"),O.textContent="Edge Force",R=p(),X=u("div"),Y=p(),V=u("div"),U=u("div"),G=u("label"),G.textContent="Attention",Q=p(),K=u("div"),Z=d(Xt),J=p(),tt=u("input"),et=p(),nt=u("div"),rt=u("div"),at=u("label"),at.textContent="Text Order",it=p(),ot=u("div"),lt=d(Yt),st=p(),ct=u("input"),ut=p(),ht=u("div"),dt=u("div"),pt=u("label"),pt.textContent="ManyBody",ft=p(),gt=u("div"),yt=d(Vt),vt=p(),mt=u("input"),wt=p(),kt=u("div"),xt=u("div"),bt=u("label"),bt.textContent="Node Distance",_t=p(),$t=u("div"),Mt=d(Ut),At=p(),Nt=u("input"),Et=p(),Tt=u("div"),Tt.textContent="Edge Threshold",Dt=p(),St=u("div"),Lt=p(),zt=u("div"),Ht=u("div"),jt=u("label"),jt.textContent="Attention >",qt=p(),Ft=u("div"),It=d(Gt),Pt=p(),Ct=u("input"),Bt=p(),Wt=h("svg"),g(a,"class","graph-label svelte-fod5ym"),g(_,"name","layer"),g(_,"class","select-num svelte-fod5ym"),g(_,"id","select-layer"),g(b,"class","select select-num-div svelte-fod5ym"),g(E,"name","layer"),g(E,"class","select-num svelte-fod5ym"),g(E,"id","select-head"),g(N,"class","select select-num-div svelte-fod5ym"),g(m,"class","name svelte-fod5ym"),g(D,"class","sep-line-horizontal svelte-fod5ym"),g(z,"class","setting-icon svelte-fod5ym"),w(z,"active",e[2]),g(j,"class","sep-line-vertical svelte-fod5ym"),g(I,"name","layout"),g(I,"id","select-layout"),g(I,"class","svelte-fod5ym"),g(F,"class","select svelte-fod5ym"),g(L,"class","select-row svelte-fod5ym"),g(B,"class","sep-line-horizontal longer-line svelte-fod5ym"),g(O,"class","slider-title svelte-fod5ym"),g(X,"class","sep-line-horizontal svelte-fod5ym"),g(G,"for","attention"),g(G,"class","svelte-fod5ym"),g(K,"class","slider-value svelte-fod5ym"),g(U,"class","slider-text svelte-fod5ym"),g(tt,"type","range"),g(tt,"min","0"),g(tt,"max","1000"),tt.value="500",g(tt,"class","slider svelte-fod5ym"),g(tt,"id","attention"),g(V,"class","slider svelte-fod5ym"),g(at,"for","textOrder"),g(at,"class","svelte-fod5ym"),g(ot,"class","slider-value svelte-fod5ym"),g(rt,"class","slider-text svelte-fod5ym"),g(ct,"type","range"),g(ct,"min","0"),g(ct,"max","1000"),ct.value="500",g(ct,"class","slider svelte-fod5ym"),g(ct,"id","textOrder"),g(nt,"class","slider svelte-fod5ym"),g(pt,"for","manyBody"),g(pt,"class","svelte-fod5ym"),g(gt,"class","slider-value svelte-fod5ym"),g(dt,"class","slider-text svelte-fod5ym"),g(mt,"type","range"),g(mt,"min","0"),g(mt,"max","1000"),mt.value="500",g(mt,"class","slider svelte-fod5ym"),g(mt,"id","manyBody"),g(ht,"class","slider svelte-fod5ym"),g(bt,"for","collide"),g(bt,"class","svelte-fod5ym"),g($t,"class","slider-value svelte-fod5ym"),g(xt,"class","slider-text svelte-fod5ym"),g(Nt,"type","range"),g(Nt,"min","0"),g(Nt,"max","1000"),Nt.value="500",g(Nt,"class","slider svelte-fod5ym"),g(Nt,"id","collideRadius"),g(kt,"class","slider svelte-fod5ym"),g(Tt,"class","slider-title svelte-fod5ym"),g(St,"class","sep-line-horizontal svelte-fod5ym"),g(jt,"for","threshold"),g(jt,"class","svelte-fod5ym"),g(Ft,"class","slider-value svelte-fod5ym"),g(Ht,"class","slider-text svelte-fod5ym"),g(Ct,"type","range"),g(Ct,"min","0"),g(Ct,"max","1000"),Ct.value="500",g(Ct,"step","200"),g(Ct,"class","slider svelte-fod5ym"),g(Ct,"id","threshold"),g(zt,"class","slider svelte-fod5ym"),g(C,"class","slider-container svelte-fod5ym"),w(C,"active",e[2]),g(y,"class","svg-control-panel svelte-fod5ym"),g(Wt,"class","graph-svg"),g(r,"class","svg-container svelte-fod5ym"),g(n,"class","graph-view svelte-fod5ym")},m(t,s){l(t,n,s),o(n,r),o(r,a),o(r,i),o(r,y),o(y,m),o(m,k),o(k,x),o(k,b),o(b,_);for(let t=0;t<Kt.length;t+=1)Kt[t].m(_,null);o(m,$),o(m,M),o(M,A),o(M,N),o(N,E);for(let t=0;t<Jt.length;t+=1)Jt[t].m(E,null);o(y,T),o(y,D),o(y,S),o(y,L),o(L,z),o(L,H),o(L,j),o(L,q),o(L,F),o(F,I);for(let t=0;t<ee.length;t+=1)ee[t].m(I,null);o(y,P),o(y,C),o(C,B),o(C,W),o(C,O),o(C,R),o(C,X),o(C,Y),o(C,V),o(V,U),o(U,G),o(U,Q),o(U,K),o(K,Z),o(V,J),o(V,tt),o(C,et),o(C,nt),o(nt,rt),o(rt,at),o(rt,it),o(rt,ot),o(ot,lt),o(nt,st),o(nt,ct),o(C,ut),o(C,ht),o(ht,dt),o(dt,pt),o(dt,ft),o(dt,gt),o(gt,yt),o(ht,vt),o(ht,mt),o(C,wt),o(C,kt),o(kt,xt),o(xt,bt),o(xt,_t),o(xt,$t),o($t,Mt),o(kt,At),o(kt,Nt),o(C,Et),o(C,Tt),o(C,Dt),o(C,St),o(C,Lt),o(C,zt),o(zt,Ht),o(Ht,jt),o(Ht,qt),o(Ht,Ft),o(Ft,It),o(zt,Pt),o(zt,Ct),o(r,Bt),o(r,Wt),e[10](Wt),Ot||(Rt=f(z,"click",e[7]),Ot=!0)},p(t,e){if(0&e){let n;for(Qt=[...Array(12).keys()],n=0;n<Qt.length;n+=1){const r=Xo(t,Qt,n);Kt[n]?Kt[n].p(r,e):(Kt[n]=Yo(r),Kt[n].c(),Kt[n].m(_,null))}for(;n<Kt.length;n+=1)Kt[n].d(1);Kt.length=Qt.length}if(0&e){let n;for(Zt=[...Array(12).keys()],n=0;n<Zt.length;n+=1){const r=Ro(t,Zt,n);Jt[n]?Jt[n].p(r,e):(Jt[n]=Vo(r),Jt[n].c(),Jt[n].m(E,null))}for(;n<Jt.length;n+=1)Jt[n].d(1);Jt.length=Zt.length}if(4&e[0]&&w(z,"active",t[2]),32&e[0]){let n;for(te=Object.values(t[5]),n=0;n<te.length;n+=1){const r=Oo(t,te,n);ee[n]?ee[n].p(r,e):(ee[n]=Uo(r),ee[n].c(),ee[n].m(I,null))}for(;n<ee.length;n+=1)ee[n].d(1);ee.length=te.length}24&e[0]&&Xt!==(Xt=(t[3].autoAttention?"auto":t[6](t[4].force.attention,2))+"")&&v(Z,Xt),16&e[0]&&Yt!==(Yt=t[6](t[4].force.textOrder,2)+"")&&v(lt,Yt),16&e[0]&&Vt!==(Vt=t[6](t[4].force.manyBody,2)+"")&&v(yt,Vt),16&e[0]&&Ut!==(Ut=t[6](t[4].force.collideRadius,2)+"")&&v(Mt,Ut),2&e[0]&&Gt!==(Gt=t[6](t[1],2)+"")&&v(It,Gt),4&e[0]&&w(C,"active",t[2])},i:t,o:t,d(t){t&&s(n),c(Kt,t),c(Jt,t),c(ee,t),e[10](null),Ot=!1,Rt()}}}const Qo=19,Ko=.3;let Zo=.02,Jo="hsl(0, 0%, 76%)",tl="hsl(36, 100%, 55%)";function el(t,e,n){let{attentionDataDir:r}=e,{saliencyDataFilepath:a}=e,i=void 0,o=1562,l=9,s=8,c={layer:9,head:8},u=null,h=null,d=null,p=null,f=void 0,g=void 0,y=null;const v=3,m=3,w=3,k=3;let x=null,b=null,$=1,M=.016,N=Zo+M*$,E={},T=null,D=new Map,S=null,L=null,z=!1,H=null;const j=Ta,q={force:{value:"force",name:"Force Layout"},radial:{value:"radial",name:"Radial Layout"},grid:{value:"grid",name:"Grid Layout"}};let F={borderConstraint:!0,showHiddenLink:!1,showHiddenNode:!1,autoAttention:!0,defaultLayout:q.radial},I={force:{manyBody:-840,attention:.5,textOrder:1.6,collideRadius:1},radial:{textOrder:.5,radial:1},grid:{collideRadius:7}},P=F.defaultLayout;const C=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e,B=(t,e)=>Array(Math.max(e-String(t).length+1,0)).join(0)+t,W=()=>function(){var t,e,n,r,a=on,i=ln,o=sn,l=cn,s={},c=Lt("start","drag","end"),u=0,h=0;function d(t){t.on("mousedown.drag",p).filter(l).on("touchstart.drag",y).on("touchmove.drag",v).on("touchend.drag touchcancel.drag",m).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(o,l){if(!r&&a.call(this,o,l)){var s=w(this,i.call(this,o,l),o,l,"mouse");s&&(Qe(o.view).on("mousemove.drag",f,!0).on("mouseup.drag",g,!0),en(o.view),Je(o),n=!1,t=o.clientX,e=o.clientY,s("start",o))}}function f(r){if(tn(r),!n){var a=r.clientX-t,i=r.clientY-e;n=a*a+i*i>h}s.mouse("drag",r)}function g(t){Qe(t.view).on("mousemove.drag mouseup.drag",null),nn(t.view,n),tn(t),s.mouse("end",t)}function y(t,e){if(a.call(this,t,e)){var n,r,o=t.changedTouches,l=i.call(this,t,e),s=o.length;for(n=0;n<s;++n)(r=w(this,l,t,e,o[n].identifier,o[n]))&&(Je(t),r("start",t,o[n]))}}function v(t){var e,n,r=t.changedTouches,a=r.length;for(e=0;e<a;++e)(n=s[r[e].identifier])&&(tn(t),n("drag",t,r[e]))}function m(t){var e,n,a=t.changedTouches,i=a.length;for(r&&clearTimeout(r),r=setTimeout((function(){r=null}),500),e=0;e<i;++e)(n=s[a[e].identifier])&&(Je(t),n("end",t,a[e]))}function w(t,e,n,r,a,i){var l,h,p,f=c.copy(),g=Ke(i||n,e);if(null!=(p=o.call(t,new an("beforestart",{sourceEvent:n,target:d,identifier:a,active:u,x:g[0],y:g[1],dx:0,dy:0,dispatch:f}),r)))return l=p.x-g[0]||0,h=p.y-g[1]||0,function n(i,o,c){var y,v=g;switch(i){case"start":s[a]=n,y=u++;break;case"end":delete s[a],--u;case"drag":g=Ke(c||o,e),y=u}f.call(i,t,new an(i,{sourceEvent:o,subject:p,target:d,identifier:a,active:y,x:g[0]+l,y:g[1]+h,dx:g[0]-v[0],dy:g[1]-v[1],dispatch:f}),r)}}return d.filter=function(t){return arguments.length?(a="function"==typeof t?t:rn(!!t),d):a},d.container=function(t){return arguments.length?(i="function"==typeof t?t:rn(t),d):i},d.subject=function(t){return arguments.length?(o="function"==typeof t?t:rn(t),d):o},d.touchable=function(t){return arguments.length?(l="function"==typeof t?t:rn(!!t),d):l},d.on=function(){var t=c.on.apply(c,arguments);return t===c?d:t},d.clickDistance=function(t){return arguments.length?(h=(t=+t)*t,d):Math.sqrt(h)},d}().on("start",(t=>{t.active||T.alphaTarget(.3).restart(),t.subject.fx=t.subject.x,t.subject.fy=t.subject.y,Qe(t.sourceEvent.originalTarget.parentNode).append("rect").attr("class","fixed-marker").attr("x",-3).attr("y",6).attr("width",6).attr("height",5).style("fill","white")})).on("drag",(t=>{t.subject.fx=t.x,t.subject.fy=t.y})).on("end",(t=>{t.active||T.alphaTarget(0)})),O=(t,e)=>{let n=Qo;t.hidden||(n=e(+t.saliency));let r=f-m-w,a=g-v-k;const i=Math.max(m+n,Math.min(r-n,t.x)),o=Math.max(v+n,Math.min(a-n,t.y));return F.borderConstraint?{top:o,left:i}:{top:t.y,left:t.x}},R=(t,e,r,a,i=null)=>{let o=Qe("#"+t).property("value",(a-e)/(r-e)*1e3);o.on("input",(()=>{let a=+o.property("value"),l=a/1e3*(r-e)+e,s=a/200;switch(n(4,I.force[t]=l,I),t){case"attention":T.force("attentionLink").strength(l),Qe("#checkbox-auto-attention").property("checked",!1),n(3,F.autoAttention=!1,F);break;case"textOrder":T.force("textLink").strength((t=>0===t.target.index?0:l));break;case"manyBody":T.force("charge").strength(l);break;case"collideRadius":T.force("collide").radius((t=>i(t.saliency)+l));break;case"threshold":n(1,N=Zo+s*M),K(s)}T.restart()})),o.on("mousedown",(t=>{t.active||T.alphaTarget(.2).restart()})),o.on("mouseup",(t=>{t.active||T.alphaTarget(0)}))},X=t=>{P=F.defaultLayout;let e=Qe("#select-layout").property("value",F.defaultLayout.value);e.on("change",(()=>{let n=e.property("value");if(n!==P.value){switch(T.force("collide",null),T.force("attentionLink",null),T.force("charge",null),T.force("center",null),T.force("textLink",null),T.force("hiddenTextLink",null),T.force("posX",null),T.force("posY",null),T.force("grid",null),n){case"force":P=q.force,V(t),T.alpha(1).restart();break;case"radial":P=q.radial,U(),T.alpha(1).restart();break;case"grid":P=q.grid,Q(),T.alpha(1).restart()}Y(t)}T.alpha(1).restart()}))};ht.subscribe((t=>{c=t,c.layer===l&&c.head===s||(Qe("#select-layer").property("value",c.layer),Qe("#select-head").property("value",c.head),l=c.layer,s=c.head,rt())}));const Y=t=>{Qe(u).select("g.node-group").selectAll("circle").transition("node-radius").duration(300).ease(j).attr("r",(e=>"force"===P.value?t(+e.saliency):Qo))},V=t=>{T.force("charge",function(){var t,e,n,r,a,i=Ua(-30),o=1,l=1/0,s=.81;function c(n){var a,i=t.length,o=Ra(t,ni,ri).visitAfter(h);for(r=n,a=0;a<i;++a)e=t[a],o.visit(d)}function u(){if(t){var e,n,r=t.length;for(a=new Array(r),e=0;e<r;++e)n=t[e],a[n.index]=+i(n,e,t)}}function h(t){var e,n,r,i,o,l=0,s=0;if(t.length){for(r=i=o=0;o<4;++o)(e=t[o])&&(n=Math.abs(e.value))&&(l+=e.value,s+=n,r+=n*e.x,i+=n*e.y);t.x=r/s,t.y=i/s}else{(e=t).x=e.data.x,e.y=e.data.y;do{l+=a[e.data.index]}while(e=e.next)}t.value=l}function d(t,i,c,u){if(!t.value)return!0;var h=t.x-e.x,d=t.y-e.y,p=u-i,f=h*h+d*d;if(p*p/s<f)return f<l&&(0===h&&(f+=(h=Ga(n))*h),0===d&&(f+=(d=Ga(n))*d),f<o&&(f=Math.sqrt(o*f)),e.vx+=h*t.value*r/f,e.vy+=d*t.value*r/f),!0;if(!(t.length||f>=l)){(t.data!==e||t.next)&&(0===h&&(f+=(h=Ga(n))*h),0===d&&(f+=(d=Ga(n))*d),f<o&&(f=Math.sqrt(o*f)));do{t.data!==e&&(p=a[t.data.index]*r/f,e.vx+=h*p,e.vy+=d*p)}while(t=t.next)}}return c.initialize=function(e,r){t=e,n=r,u()},c.strength=function(t){return arguments.length?(i="function"==typeof t?t:Ua(+t),u(),c):i},c.distanceMin=function(t){return arguments.length?(o=t*t,c):Math.sqrt(o)},c.distanceMax=function(t){return arguments.length?(l=t*t,c):Math.sqrt(l)},c.theta=function(t){return arguments.length?(s=t*t,c):Math.sqrt(s)},c}().strength(I.force.manyBody)),T.force("center",function(t,e){var n,r=1;function a(){var a,i,o=n.length,l=0,s=0;for(a=0;a<o;++a)l+=(i=n[a]).x,s+=i.y;for(l=(l/o-t)*r,s=(s/o-e)*r,a=0;a<o;++a)(i=n[a]).x-=l,i.y-=s}return null==t&&(t=0),null==e&&(e=0),a.initialize=function(t){n=t},a.x=function(e){return arguments.length?(t=+e,a):t},a.y=function(t){return arguments.length?(e=+t,a):e},a.strength=function(t){return arguments.length?(r=+t,a):r},a}(f/2,g/2)),T.force("attentionLink",ti(E[$].links).id((t=>t.id))),T.force("textLink",ti(E[$].hiddenLinks).id((t=>t.id)).strength((t=>0===t.target.index?0:I.force.textOrder))),T.force("collide",function(t){var e,n,r,a=1,i=1;function o(){for(var t,o,s,c,u,h,d,p=e.length,f=0;f<i;++f)for(o=Ra(e,Qa,Ka).visitAfter(l),t=0;t<p;++t)s=e[t],h=n[s.index],d=h*h,c=s.x+s.vx,u=s.y+s.vy,o.visit(g);function g(t,e,n,i,o){var l=t.data,p=t.r,f=h+p;if(!l)return e>c+f||i<c-f||n>u+f||o<u-f;if(l.index>s.index){var g=c-l.x-l.vx,y=u-l.y-l.vy,v=g*g+y*y;v<f*f&&(0===g&&(v+=(g=Ga(r))*g),0===y&&(v+=(y=Ga(r))*y),v=(f-(v=Math.sqrt(v)))/v*a,s.vx+=(g*=v)*(f=(p*=p)/(d+p)),s.vy+=(y*=v)*f,l.vx-=g*(f=1-f),l.vy-=y*f)}}}function l(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function s(){if(e){var r,a,i=e.length;for(n=new Array(i),r=0;r<i;++r)a=e[r],n[a.index]=+t(a,r,e)}}return"function"!=typeof t&&(t=Ua(null==t?1:+t)),o.initialize=function(t,n){e=t,r=n,s()},o.iterations=function(t){return arguments.length?(i=+t,o):i},o.strength=function(t){return arguments.length?(a=+t,o):a},o.radius=function(e){return arguments.length?(t="function"==typeof e?e:Ua(+e),s(),o):t},o}().radius((e=>t(e.saliency)+I.force.collideRadius)))},U=()=>{T.force("textLink",ti(E[$].hiddenLinks).id((t=>t.id)).strength(I.radial.textOrder)),T.force("posY",li().y(((t,e)=>{let n=b.filter((t=>!t.hidden)).length,r=-Math.PI/2+e*(2*Math.PI/n);return g/2+225*Math.sin(r)})).strength(I.radial.radial)),T.force("posX",oi().x(((t,e)=>{let n=b.filter((t=>!t.hidden)).length,r=-Math.PI/2+e*(2*Math.PI/n);return f/2+225*Math.cos(r)})).strength(I.radial.radial))},Q=()=>{let t=8,e=Math.ceil(x/t),n=549,r=2*e*Qo+35*(e-1);for(;r>g;)if(t=9,n=549,r=2*e*Qo+35*(e-1),n>f){console.log("Failed to initialize grid layout");break}let a=Math.floor((f-n)/2),i=Math.floor((g-r)/2);T.force("grid",ti(E[$].gridLinks).iterations(80).distance(50).id((t=>t.id))),T.force("posX",oi().x(((t,e)=>a+e%8*73+Qo)).strength((t=>void 0===t.id?0:1))),T.force("posY",li().y(((t,e)=>i+73*Math.floor(e/8)+Qo)).strength((t=>void 0===t.id?0:1)))},K=t=>{$=t;let e=Qe(u).select("g.attention-link-group").selectAll("path.link").data(E[$].biLinks,(t=>`${t[0].id}-${t[1].id}`));e.enter().append("path").attr("marker-end","url(#arrow)").attr("class","link").attr("id",(t=>`link-${t[0].id}-${t[1].id}`)).style("stroke","hsl(150, 74%, 51%)").style("stroke-width",(t=>S(t.attention))).transition().duration(900).ease(j).style("stroke",Jo),e.exit().style("stroke","hsl(349, 81%, 57%)").transition().duration(900).ease(j).style("opacity",0).on("end",((t,e,n)=>{Qe(n[e]).remove()})),T.nodes(E[$].nodes),T.alpha(1).restart()},Z=(t,e,n)=>{t=t.map((t=>Object.create(t)));let r=b.slice(),a=[];for(let t=0;t<r.length-1;t++){let e={source:+r[t].id,target:+r[t+1].id};a.push(e)}a.push({source:+r[r.length-1].id,target:r[0].id}),a=a.map((t=>Object.create(t)));let i=[];t.forEach((n=>{let a=e.get(n.source),o=e.get(n.target),l=[a,o];if(l.selfLoop=!1,l.attention=+n.weight,a===o){l.selfLoop=!0;let e={hidden:!0};D.has(a)?e=D.get(a):D.set(a,e),l.push(e),r.push(e),t.push({source:e,target:a})}i.push(l)}));let o=[];n.sort(((t,e)=>+t-+e));for(let t=0;t<r.length;t++)t%8!=7&e.has(t+1)&&o.push({source:e.get(t),target:e.get(t+1)}),e.has(t+8)&&o.push({source:e.get(t),target:e.get(t+8)});return{links:t,hiddenLinks:a,biLinks:i,gridLinks:o,nodes:r}},J=(t,e,n,r,a,i,o,l)=>{let s=Qe(t.target).data()[0].id;for(let t=E[$].nodes.length-1;t>=0;t--)E[$].nodes[t].id===s&&E[$].nodes.splice(t,1);e.selectAll("g.node").data(E[$].nodes.filter((t=>void 0!==t.id)),(t=>t.id)).exit().remove();for(let t=E[$].biLinks.length-1;t>=0;t--)E[$].biLinks[t][0].id===s|E[$].biLinks[t][1].id===s&&E[$].biLinks.splice(t,1);for(let t=E[$].links.length-1;t>=0;t--)E[$].links[t].source.id===s|E[$].links[t].target.id===s&&E[$].links.splice(t,1);for(let t=E[$].hiddenLinks.length-1;t>=0;t--)E[$].hiddenLinks[t].source.id===s?E[$].hiddenLinks.splice(t,1):E[$].hiddenLinks[t].target.id===s&&(t+1<E[$].hiddenLinks.length?E[$].hiddenLinks[t].target=E[$].hiddenLinks[t+1].source:E[$].hiddenLinks[t].target=E[$].hiddenLinks[0].source);E[$].gridLinks=[],a=new Set,E[$].nodes.forEach((t=>{void 0!==t.id&&a.add(+t.id)})),(r=Array.from(a)).sort(((t,e)=>+t-+e));for(let t=0;t<r.length-1;t++){let e=r[t];t%8!=7&o.has(r[t+1])&&E[$].gridLinks.push({source:o.get(e),target:o.get(r[t+1])}),o.has(r[t+8])&&E[$].gridLinks.push({source:o.get(e),target:o.get(r[t+8])})}n.selectAll("path.link").data(E[$].biLinks,(t=>`${t[0].id}-${t[1].id}`)).exit().remove(),(t=>{switch(P.value){case"force":V(t);break;case"radial":U();break;case"grid":Q()}})(i),l.alpha(.3).restart()},tt=t=>{let e=Qe(u).select("g.attention-link-group").selectAll("path.link");switch(P.value){case"force":e.attr("d",(e=>((t,e)=>{const n=O(t[0],e),r=O(t[1],e);if(t.selfLoop){const a=O(t[2],e);let i=Math.sqrt((r.left-a.left)**2+(r.top-a.top)**2)-e(t[0].saliency);a.left=r.left+(a.left-r.left)/i*80,a.top=r.top+(a.top-r.top)/i*80;const o=[a.left-n.left,a.top-n.top],l=Math.sqrt(o[0]**2+o[1]**2),s=50,c=[-o[1]/l*s,o[0]/l*s],u=[o[1]/l*s,-o[0]/l*s],h=[n.left+o[0]+c[0],n.top+o[1]+c[1]],d=[n.left+o[0]+u[0],n.top+o[1]+u[1]];let p=Math.sqrt((r.left-d[0])**2+(r.top-d[1])**2),f=(e(t[0].saliency)+10)/p,g={left:r.left+(d[0]-r.left)*f,top:r.top+(d[1]-r.top)*f};return"M"+n.left+","+n.top+"C"+h[0]+","+h[1]+" "+d[0]+","+d[1]+" "+g.left+","+g.top}{let a=Math.sqrt((r.left-n.left)**2+(r.top-n.top)**2),i=(e(t[1].saliency)+10)/a,o={left:r.left+(n.left-r.left)*i,top:r.top+(n.top-r.top)*i};return"M"+n.left+","+n.top+"L"+o.left+","+o.top}})(e,t)));break;case"radial":e.attr("d",(e=>((t,e)=>{const n=O(t[0],e),r=O(t[1],e);let a=n.left,i=n.top,o=r.left,l=r.top,s=f/2,c=g/2+40,u=1-29/225,h=s+(o-s)*u,d=c+(l-c)*u,p=s+(a-s)*u,y=c+(i-c)*u;return`M ${p},${y} C${s+(p-s)*Ko}, ${c+(y-s)*Ko},\n      ${s+(h-s)*Ko}, ${c+(d-s)*Ko}, ${h},${d}`})(e,t)));break;case"grid":e.attr("d",(e=>((t,e)=>{const n=O(t[0],e),r=O(t[1],e);let a=29/Math.sqrt((r.left-n.left)**2+(r.top-n.top)**2),i=r.left+(n.left-r.left)*a,o=r.top+(n.top-r.top)*a;return"M"+n.left+","+n.top+"L"+i+","+o})(e,t)));break;default:console.log("Unexpected case.")}Qe(u).select("g.node-group").selectAll("g.node").attr("transform",(e=>((t,e)=>{const n=O(t,e);return`translate(${n.left}, ${n.top})`})(e,t)))},et=()=>{let t=Qe(u),e=h.nodes.map((t=>Object.create(t)));e.sort(((t,e)=>+t.id-+e.id));let n={};e.forEach((t=>{let e=0;void 0===n[t.token]?n[t.token]=e+1:(e=n[t.token],n[t.token]+=1),t.name=`${lt(t.token)}-${e}`})),b=e.slice();let r=new Set;h.nodes.forEach((t=>r.add(+t.id)));let a=Array.from(r),i=new Map(e.map((t=>[t.id,t])));E={};for(let t=0;t<6;t++){let e=C(Zo+t*M,2),n=h.links.filter((t=>t.weight>e)),r=Z(n,i,a);E[t]={links:r.links.slice(),hiddenLinks:r.hiddenLinks.slice(),biLinks:r.biLinks.slice(),gridLinks:r.gridLinks.slice(),nodes:r.nodes.slice()}}let o=e.map((t=>+t.saliency));L=to().domain(gt(o)).range([Qo,40]).unknown(0).nice();let l=kt(o.map(Math.abs)),s="#E50035",c="#ffffff",d=to().domain([0,l]).range([Ln(c),Ln(s)]).unknown(Ln("white")),p=E[0].links.map((t=>+t.weight));S=to().domain(gt(p)).range([.5,3]).nice();let v=t.append("g").attr("class","attention-link-group").attr("stroke",Jo);v.selectAll("path.link").data(E[$].biLinks,(t=>`${t[0].id}-${t[1].id}`)).join("path").attr("class","link").attr("id",(t=>`link-${t[0].name}-${t[1].name}`)).attr("marker-end","url(#arrow)").style("stroke-width",(t=>S(t.attention)));let w=t.append("g").attr("class","node-group"),k=w.selectAll("g.node").data(E[$].nodes.filter((t=>void 0!==t.id)),(t=>t.id)).join("g").attr("class","node").attr("id",(t=>"node-"+t.name)).attr("transform",`translate(${f/2}, ${g/2})`).call(W()).on("mouseover",((t,e)=>{y=e.name,it.set(y),st(y)})).on("mouseleave",(()=>{ct(y),y=null,it.set(y)})).on("click",((t,e)=>{null!==e.fx&&null!==e.fy&&(delete e.fx,delete e.fy,Qe(t.target.parentNode).selectAll("rect.fixed-marker").remove(),T.alpha(.2).restart())})).on("dblclick",(t=>J(t,w,v,a,r,L,i,T)));to().domain(gt(r)).range([Ln("#D4E5F4"),Ln("#1E6CB0")]);k.append("circle").attr("class","node-circle").attr("r",(t=>"force"===P.value?L(+t.saliency):Qo)).style("fill",(t=>d(+t.saliency))).style("opacity",1).clone(!0).attr("r",(t=>"force"===P.value?L(+t.saliency):Qo)).style("fill",tl).attr("class","shadow-circle");switch(((t,e,n,r="#eb2f06",a="#4690C2")=>{let i=t.append("defs").append("linearGradient").attr("x1",0).attr("y1",1).attr("x2",0).attr("y2",0).attr("id","legend-gradient-graph");i.append("stop").attr("stop-color",r).attr("offset",0),i.append("stop").attr("stop-color",a).attr("offset",1),t.append("rect").attr("x",0).attr("y",0).attr("width",e.width).attr("height",e.height).style("fill","url(#legend-gradient-graph)").style("stroke","black");let o=to().domain([0,n]).range([e.height,0]).nice();t.append("g").attr("transform",`translate(${e.width}, 0)`).call(Dt(o).ticks(5)),t.append("text").attr("x",0).attr("y",e.height+8).style("font-size","12px").style("fill","hsl(0, 0%, 40%)").style("dominant-baseline","hanging").style("text-anchor","left").text("Semantic Saliency Score")})(t.append("g").attr("class","legend-group").attr("transform",`translate(${m+3}, ${g-130})`),{width:10,height:100},l,c,s),k.append("text").attr("class","node-text").style("font-weight",600).text((t=>t.token)).filter((t=>er(d(+t.saliency)).l<66)).clone(!0).lower().style("stroke-linejoin","round").attr("stroke-width",4).attr("stroke","white"),k.selectAll("circle").lower(),k.append("title").text((t=>t.token)),null==T?T=ii(E[$].nodes):(T.nodes(E[$].nodes),T.alpha(1).restart()),P.value){case"force":V(L);break;case"radial":U();break;case"grid":Q()}return T.on("tick",(()=>tt(L))),L},nt=()=>{let t=Qe(u).attr("width",f).attr("height",g);t.append("rect").attr("class","border-rect").attr("width",f).attr("height",g).style("stroke","black").style("fill","none"),t.append("defs").append("marker").attr("id","arrow").attr("viewBox",[0,0,10,10]).attr("refX",0).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke",Jo).attr("fill",Jo),t.append("defs").append("marker").attr("id","arrow-hover").attr("viewBox",[0,0,10,10]).attr("refX",0).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke",tl).attr("fill",tl),L=et(),R("attention",0,10,I.force.attention),R("textOrder",0,10,I.force.textOrder),R("manyBody",-2e3,0,I.force.manyBody),R("collideRadius",0,20,I.force.collideRadius,L),R("threshold",Zo,.1,N,L),X(L),(()=>{let t=Qe("#select-layer").property("value",l),e=Qe("#select-head").property("value",s);t.on("change",(()=>{let e=t.property("value");e!==l&&(l=e,rt(),c.layer=+l,c.head=+s,ht.set(c))})),e.on("change",(()=>{let t=e.property("value");t!==s&&(s=t,rt(),c.layer=+l,c.head=+s,ht.set(c))}))})()},rt=()=>{Qe(u).select("g.node-group").remove(),Qe(u).select("g.attention-link-group").remove(),Qe(u).select("g.legend-group").remove(),h=ut(l,s),et()},lt=t=>null==t?null:t.replace(/\./g,"\\.").replace(/,/g,"\\,").replace(/#/g,"").replace(/\[/g,"\\[").replace(/\]/g,"\\]"),st=t=>{Qe(u).select(".attention-link-group").selectAll("path.link").style("opacity",.2),Qe(u).select(".attention-link-group").selectAll("path.link").filter(((e,n,r)=>Qe(r[n]).attr("id").includes("-"+t))).attr("marker-end","url(#arrow-hover)").classed("highlighted",!0).style("stroke",null).style("stroke-width",2).style("opacity",.8).raise(),Qe(u).select(".node-group").selectAll(".node").filter(((e,n,r)=>Qe(r[n]).attr("id").includes("-"+t))).raise().select(".shadow-circle").attr("r",(t=>"force"===P.value?L(+t.saliency)+5:24)).style("stroke","white").style("stroke-width",1.5)},ct=t=>{Qe(u).select(".attention-link-group").selectAll("path.link").style("opacity",null),Qe(u).select(".attention-link-group").selectAll("path.link").filter(((e,n,r)=>Qe(r[n]).attr("id").includes("-"+t))).classed("highlighted",!1).attr("marker-end","url(#arrow)").style("stroke",Jo).style("stroke-width",(t=>S(t.attention))).style("opacity",null),Qe(u).select(".node-group").selectAll(".node").filter(((e,n,r)=>Qe(r[n]).attr("id").includes("-"+t))).select(".shadow-circle").attr("r",(t=>"force"===P.value?L(+t.saliency):Qo)).style("stroke",null).style("stroke-width",null).lower()},ut=(t,e)=>{let n=H[t][e],r={nodes:[],links:[]},a=d[String(o)].meta.predicted_label;d[String(o)].tokens.forEach(((t,e)=>{r.nodes.push({token:t.token,saliency:t[a],id:e})}));for(let t=0;t<r.nodes.length;t++)for(let e=0;e<r.nodes.length;e++)r.links.push({source:t,target:e,weight:n[t][e]});return r};it.subscribe((t=>{null!=t?(y=t,void 0!==p[y.replace(/(.*)-\d*/,"$1")]?p[y.replace(/(.*)-\d*/,"$1")].forEach((t=>{st(t)})):st(y)):(null!=y&&(void 0!==p[y.replace(/(.*)-\d*/,"$1")]?p[y.replace(/(.*)-\d*/,"$1")].forEach((t=>{ct(t)})):ct(y)),y=t)}));const dt=async()=>{null==H&&(H=await Pa(r+`attention-${B(o,4)}.json`)),null==d&&(d=await Pa(a),x=d[o].tokens.length),h=ut(l,s),nt()};return _((async()=>{null==H&&(H=await Pa(r+`attention-${B(o,4)}.json`)),null==d&&(d=await Pa(a),x=d[o].tokens.length)})),G.subscribe((t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===i||i.compHeight!==t.compHeight&&i.compWidth!==t.compWidth)&&(i=t,g=i.compHeight,f=i.compWidth,dt())})),ot.subscribe((t=>{p=t})),at.subscribe((t=>{t!==o&&(Qe(u).selectAll("*").remove(),H=null,d=null,o=t,dt())})),t.$$set=t=>{"attentionDataDir"in t&&n(8,r=t.attentionDataDir),"saliencyDataFilepath"in t&&n(9,a=t.saliencyDataFilepath)},[u,N,z,F,I,q,C,()=>{n(2,z=!z)},r,a,function(t){A[t?"unshift":"push"]((()=>{u=t,n(0,u)}))}]}class nl extends R{constructor(t){super(),O(this,t,el,Go,i,{attentionDataDir:8,saliencyDataFilepath:9},[-1,-1,-1])}}const rl=(t,e,n="1em")=>{let r={},a=null,i=e.append("g").attr("class","hidden-text").style("opacity",0),o=i.selectAll(".text-token").data(t).join("text").attr("class","text-token").style("font-size",n).text((t=>t));return o.each((function(t,e){let n=this.getBBox();r[e]=+Number(n.width).toFixed(2),null==a&&(a=n.height)})),i.remove(),o.remove(),{textTokenWidths:r,textTokenHeight:a}},al=t=>null==t?null:t.replace(/\./g,"\\.").replace(/,/g,"\\,").replace(/#/g,"").replace(/\[/g,"\\[").replace(/\]/g,"\\]"),il=t=>"[CLS]"===t||"[SEP]"===t||"[PAD]"===t,ol=(t,e)=>{t.attr("width",e).select("rect.border-rect").attr("width",e),Qe(".instance-container").select(".panel-container").style("width",e+"px")},ll=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e,sl=(t,e,n,r,a,i,o,l)=>{if(void 0!==t.tokens[0].id){let e={};t.tokens.forEach((t=>{let n=0;void 0===e[t.token]?e[t.token]=n+1:(n=e[t.token],e[t.token]+=1),t.id=`${al(t.token)}-${n}`}))}let s=t.tokens,c=t.meta.predicted_label,u=kt(t.tokens.map((t=>Math.abs(t[c])))),h=to().domain([0,u]).range([Ln("#ffffff"),Ln("#E50035")]),d=rl(s.map((t=>t.token)),e),p=d.textTokenWidths,f=d.textTokenHeight,g=.8*n;const y=f+a.top+a.bottom+10;let v=e.append("g").attr("class","token-group-saliency").attr("transform",`translate(${r.left+n*(1-.8)/2},\n      ${r.top+70})`).append("g").attr("class","node-group").selectAll("g").data(s,(t=>t.id)).join("g").attr("class",(t=>{let e="node node-"+t.id;return void 0!==i[t.token]&&i[t.token].forEach((t=>{e+=" node-"+t})),e})).attr("id",(t=>"node-"+t.id)).on("mouseover",o).on("mouseleave",l),m={x:0,y:0},w=Object.keys(p).length;v.each((function(t,e){Qe(this).attr("transform",`translate(${m.x}, ${m.y})`);let n=m.x+p[e]+a.left+a.right+5;e+1<w&&(n+=p[e+1]),n>g?(m.y+=y,m.x=0):m.x=m.x+p[e]+a.left+a.right+5})),v.append("rect").attr("width",((t,e)=>p[e]+a.left+a.right)).attr("height",f+a.top+a.bottom).attr("rx",5).style("fill",(t=>h(+t[c]))).style("stroke","hsl(180, 1%, 80%)"),v.append("text").attr("class","text-token-arc").attr("x",a.left).attr("y",a.top+2).style("pointer-events","none").text((t=>t.token));let k=e.append("g").attr("class","legend-group").attr("transform",`translate(${r.left+10+.9*n},\n      ${r.top+50})`);cl(k,{width:10,height:150},u)},cl=(t,e,n)=>{let r=t.append("defs").append("linearGradient").attr("x1",0).attr("y1",1).attr("x2",0).attr("y2",0).attr("id","legend-gradient");r.append("stop").attr("stop-color","#FFFFFF").attr("offset",0),r.append("stop").attr("stop-color","#E50035").attr("offset",1),t.append("rect").attr("x",0).attr("y",0).attr("width",e.width).attr("height",e.height).style("fill","url(#legend-gradient)").style("stroke","black");let a=to().domain([0,n]).range([e.height,0]).nice();t.append("g").attr("transform",`translate(${e.width}, 0)`).call(Dt(a).ticks(10)),t.append("text").attr("x",5).attr("y",-15).style("font-size","12px").style("dominant-baseline","end").style("text-anchor","middle").text("Saliency Score")},ul=(t,e,n,r,a,i,o,l,s,c,u)=>{const h=t.list;let d=t.words.map((t=>({token:t})));if(void 0===e.tokens[0].id){let t={};e.tokens.forEach((e=>{let n=0;void 0===t[e.token]?t[e.token]=n+1:(n=t[e.token],t[e.token]+=1),e.id=`${al(e.token)}-${n}`}))}console.log(e,d),null==n&&(n=u(d,e)),console.log(n);let p={};d.forEach((t=>{let e=0;void 0===p[t.token]?p[t.token]=e+1:(e=p[t.token],p[t.token]+=1),t.id=`${al(t.token)}-${e}`}));let f=rl(d.map((t=>t.token)),r),g=f.textTokenWidths,y=f.textTokenHeight;a={};let v=0;d.forEach(((t,e)=>{a[e]=v,v+=g[e]+5+i.left+i.right}));let m=v+o.left+o.right-5;ol(r,m);let w=r.append("g").attr("class","token-group").attr("transform",`translate(${o.left}, ${o.top})`),k=w.append("g").attr("class","node-group").selectAll("g").data(d).join("g").attr("class",(t=>{let e="node node-"+t.id;return void 0!==n[t.token]&&n[t.token].forEach((t=>{e+=" node-"+t})),e})).attr("id",(t=>"node-"+t.id)).attr("data-id",(t=>t.id)).attr("transform",((t,e)=>`translate(${a[e]}, 0)`)).on("mouseover",s).on("mouseleave",c);k.append("rect").attr("width",((t,e)=>g[e]+i.left+i.right)).attr("height",y+i.top+i.bottom).attr("rx",5),k.append("text").attr("class","text-token-arc").attr("x",i.left).attr("y",i.top+2).style("pointer-events","none").text((t=>t.token));let x=[];h.forEach((t=>{let e=Math.abs(t.child-t.parent),n=void 0,r=void 0,o=void 0;t.parent<t.child?(r=a[t.parent]+i.left+i.right+g[t.parent]-5,o=a[t.child]+5,n=r+(o-r)/2):(r=a[t.parent]+5,o=a[t.child]+i.left+i.right+g[t.child]-5,n=o+(r-o)/2),t.sourceX=r,t.targetX=o,t.middleX=Number.isNaN(n)?0:n,t.gap=e,x.push(t)})),x.sort(((t,e)=>t.gap-e.gap));let b=Array(d.length).fill(1),_={};x.forEach((t=>{if("root"!==t.relation){let e=Math.min(t.child,t.parent),n=Math.max(t.child,t.parent),r=b.slice(e,n+1).reduce(((t,e)=>Math.max(t,e)));b[Math.min(t.child,t.parent)]=r+1,void 0===_[r]&&(_[r]=[]),_[r].push(t)}}));let $=w.append("g").attr("class","arc-group").attr("transform",`translate(0, ${y+i.top+i.bottom})`);return console.log(_),Object.keys(_).forEach(((t,e)=>{$.append("g").attr("class","arc-group-path").selectAll("path.arc-path-"+e).data(_[t],(t=>`${t.parent}-${t.child}`)).join("path").attr("class",(t=>{let r=`arc-path arc-path-${e} arc-path-${d[t.parent].id}-${d[t.child].id}`;return void 0!==n[d[t.parent].token]&&n[d[t.parent].token].forEach((e=>{r+=` arc-path-${e}-${d[t.child].id}`})),void 0!==n[d[t.child].token]&&n[d[t.child].token].forEach((e=>{r+=` arc-path-${d[t.parent].id}-${e}`})),r})).classed("arc-path--lr",(t=>t.parent<t.child)).classed("arc-path--rl",(t=>t.parent>t.child)).attr("id",(t=>`arc-path-${d[t.parent].id}-${d[t.child].id}`)).attr("d",(t=>{let n=t.sourceX,r=t.targetX,a=15*(e+1),i=0===e?5:15;return`M${n} 0\n            L${n} ${a-i}\n            Q${n<r?n+0:n-0} ${a}, ${n<r?n+i:n-i} ${a}\n            L${n<r?r-i:r+i} ${a}\n            Q${n<r?r-0:r+0} ${a}, ${r} ${a-i}\n            L${r} 3`})),$.append("g").attr("class","arc-group-text").selectAll("text.arc-path-text-"+e).data(_[t],(t=>`${t.parent}-${t.child}`)).join("text").attr("class",(t=>{let r=`arc-text arc-path-text-${e} arc-path-text-${d[t.parent].id}-${d[t.child].id}`;return void 0!==n[d[t.parent].token]&&n[d[t.parent].token].forEach((e=>{r+=` arc-path-text-${e}-${d[t.child].id}`})),void 0!==n[d[t.child].token]&&n[d[t.child].token].forEach((e=>{r+=` arc-path-text-${d[t.parent].id}-${e}`})),r})).attr("x",(t=>t.middleX)).attr("y",15*(e+1)-1).text((t=>"root"===t.relation?"":t.relation)).clone(!0).lower().attr("class",`arc-text arc-path-text-${e} shadow`).attr("stroke-width",5).attr("stroke","white"),$.selectAll(".arc-group-path").lower()})),{tokenXs:a,textTokenWidths:g}};let hl={},dl={};st.subscribe((t=>{dl=t}));let pl=new Map;lt.subscribe((t=>{pl=t}));const fl=(t,e,n,r,a,i=.02)=>{let o=n[t][e],l=new Map,s=new Map,c=r.words.map((t=>({token:t}))),u=0;for(;il(a.tokens[u].token);)u+=1;for(let t=0;t<c.length;t++){if(c[t].token!==a.tokens[u].token){let e=[],n=t+1<c.length?c[t+1].token:null;for(;a.tokens[u].token!==n;)e.push(u),s.set(u,t),u+=1;l.set(e[0],e)}else s.set(u,t),u+=1}let h=[];for(let t=0;t<a.tokens.length;t++){if(il(a.tokens[t].token))continue;let e=null,n=-1,r=o[t];if(l.has(t)){let e=l.get(t);for(let t=0;t<r.length;t++){let n=0;for(let r=0;r<e.length;r++)n+=o[r][t];r[t]=n/e.length}t=e[e.length-1]}for(let t=0;t<a.tokens.length;t++){if(il(a.tokens[t].token))continue;let i=0;l.has(t)?l.get(t).forEach((e=>{t=e,i+=r[t]})):i=r[t],i>n&&(e=s.get(t),n=i)}n>i&&h.push({parent:s.get(t),child:e})}return h},gl=(t,e,n,r)=>{let a=[];t.forEach((t=>{let i=Math.abs(t.child-t.parent),o=void 0,l=void 0,s=void 0;t.parent<t.child?(l=e[t.parent]+n.left+n.right+r[t.parent]-5,s=e[t.child]+5,o=l+(s-l)/2):(l=e[t.parent]+5,s=e[t.child]+n.left+n.right+r[t.child]-5,o=s+(l-s)/2),t.sourceX=ll(l,3),t.targetX=ll(s,3),t.middleX=Number.isNaN(o)?0:o,t.gap=i,a.push(t)})),a.sort(((t,e)=>t.gap-e.gap));let i=Array(Object.keys(e).length).fill(1),o={};return a.forEach((t=>{let e=Math.min(t.child,t.parent),n=Math.max(t.child,t.parent);if(e!==n){let r=i.slice(e,n).reduce(((t,e)=>Math.max(t,e)));for(let t=e;t<n;t++)i[t]=r+1;void 0===o[r]&&(o[r]=[]),o[r].push(t)}})),o},yl=(t,e,n,r,a,i,o)=>{Object.keys(t).forEach(((l,s)=>{e.append("g").attr("class","attention-group-path").selectAll("path.attention-path-"+s).data(t[l],(t=>`${t.parent}-${t.child}`)).join("path").attr("class",(t=>{let e=`attention-path attention-path-${s} attention-path-${o[t.parent].id}-${o[t.child].id}`;return void 0!==i[o[t.parent].token]&&i[o[t.parent].token].forEach((n=>{e+=` attention-path-${n}-${o[t.child].id}`})),void 0!==i[o[t.child].token]&&i[o[t.child].token].forEach((n=>{e+=` attention-path-${o[t.parent].id}-${n}`})),a.has(String([t.parent,t.child]))&&(e+=" matched-attention-path\n            matched-attention-path-"+a.get(String([t.parent,t.child]))),e})).classed("attention-path--lr",(t=>t.parent<t.child)).classed("attention-path--rl",(t=>t.parent>t.child)).style("width",.5).attr("d",(t=>{let e=t.sourceX,a=t.targetX,i=r?0:n,o=5*(s+1),l=0===s?4:7;return`M${e} ${i}\n            L${e} ${i+o-l}\n            Q${e<a?e+0:e-0} ${i+o}, ${e<a?e+l:e-l} ${i+o}\n            L${e<a?a-l:a+l} ${i+o}\n            Q${e<a?a-0:a+0} ${i+o}, ${a} ${i+o-l}\n            L${a} ${i}`}))}))},vl=(t,e,n,r,a,i=.02)=>{let o=n[t][e],l=new Map,s=new Map,c=r.words.map((t=>({token:t}))),u=0;for(;il(a.tokens[u].token);)u+=1;for(let t=0;t<c.length;t++){if(c[t].token!==a.tokens[u].token){let e=[],n=t+1<c.length?c[t+1].token:null;for(;a.tokens[u].token!==n;)e.push(u),s.set(u,t),u+=1;l.set(e[0],e)}else s.set(u,t),u+=1}let h=[];for(let t=0;t<a.tokens.length;t++){if(il(a.tokens[t].token))continue;let e=o[t];if(l.has(t)){let n=l.get(t);for(let t=0;t<e.length;t++){let r=0;for(let e=0;e<n.length;e++)r+=o[e][t];e[t]=r/n.length}t=n[n.length-1]}for(let n=0;n<a.tokens.length;n++){if(il(a.tokens[n].token))continue;let r=0;if(l.has(n)?l.get(n).forEach((t=>{n=t,r+=e[n]})):r=e[n],r>i){let e=s.get(n);h.push({parent:s.get(t),child:e,attention:r})}}}return h},ml=(t,e,n,r)=>{let a=[];return t.forEach((t=>{let i=Math.abs(t.child-t.parent),o=e[t.parent]+n.left+r[t.parent]/2,l=e[t.child]+n.left+r[t.child]/2;t.sourceX=ll(o,3),t.targetX=ll(l,3),t.gap=i,a.push(t)})),a},wl=(t,e,n,r,a,i=5,o=70)=>{let l=to().domain(gt(t.map((t=>Math.abs(t.parent-t.child))))).range([i,o]),s=(to().domain(gt(t.map((t=>t.attention)))).range([.1,.6]),to().domain(gt(t.map((t=>t.attention)))).range([.2,2]));e.append("g").attr("class","attention-group-arc attention-group-arc-"+n).style("opacity",0).style("display","none").style("pointer-events","none").selectAll("path.attention-arc-"+n).data(t,(t=>`${t.parent}-${t.child}`)).join("path").attr("class","attention-arc attention-arc-"+n).attr("class",(t=>{let e=`attention-arc attention-arc-${a[t.parent].id}-${a[t.child].id}`;return void 0!==r[a[t.parent].token]&&r[a[t.parent].token].forEach((n=>{e+=` attention-arc-${n}-${a[t.child].id}`})),void 0!==r[a[t.child].token]&&r[a[t.child].token].forEach((n=>{e+=` attention-arc-${a[t.parent].id}-${n}`})),e})).classed("attention-arc--lr",(t=>t.parent<=t.child)).classed("attention-arc--rl",(t=>t.parent>t.child)).style("width",(t=>s(t.attention))).style("opacity",.5).attr("d",(t=>{let e=t.sourceX,n=t.targetX,r=Math.abs((n-e)/2),a=l(Math.abs(t.parent-t.child));if(a=Math.min(a,r),t.parent==t.child){let t=5,n=10;return`M ${e} 0\n            C ${e} 0, ${e-t} ${-n}, ${e} ${-n}\n            C ${e+t} ${-n}, ${e} 0, ${e} -1\n            L ${e} 0`}return`M ${e} 0\n            A ${r} ${a}, 0, 0, ${e<n?1:0} ${n}, 0`}))},kl=t=>{let e=Qe(t.target.parentNode.parentNode.parentNode),n=Ze(".attention-group").size(),r=+e.attr("class").replace(/.*name-group-(\d*).*/,"$1");const a=(t,e,n,r)=>{let a=Qe(n[e]);return`translate(${+a.attr("transform").replace(/translate\((.*),\s.*\)/,"$1")}, ${+a.attr("transform").replace(/translate\(.*,\s(.*)\)/,"$1")+r})`};Qe(".blocker").raise(),Qe(".original-node-group").raise(),Qe(".arc-group").raise(),Qe(t.target).classed("symbol-highlight",null==hl[r]),null==hl[r]?(r<Math.floor(n/2)?(Ze(".attention-group").filter((t=>t>=r)).transition("moveY").duration(500).ease(Ta).attr("transform",((t,e,n)=>a(0,e,n,70))),Ze(".name-group").filter((t=>t>=r)).transition("moveY").duration(500).ease(Ta).attr("transform",((t,e,n)=>a(0,e,n,70))),hl[r]="down"):(Ze(".attention-group").filter((t=>t<r)).transition("moveY").duration(500).ease(Ta).attr("transform",((t,e,n)=>a(0,e,n,-70))),Ze(".name-group").filter((t=>t<r)).transition("moveY").duration(500).ease(Ta).attr("transform",((t,e,n)=>a(0,e,n,-70))),hl[r]="up"),e.append("text").attr("class","arc-label name").attr("x",-8).attr("y",-15).style("fill","hsl(0, 0%, 60%)").text("Attention Weights"),Qe(".attention-group-arc-"+r).style("display",null).transition("opacity").delay(200).duration(300).ease(Ta).style("opacity",1)):(Qe(".attention-group-arc-"+r).transition("opacity").duration(500).ease(Ta).style("opacity",0).on("end",((t,n,r)=>{Qe(r[n]).style("display","none"),e.select(".arc-label").remove()})),"down"===hl[r]?(Ze(".attention-group").filter((t=>t>=r)).transition("moveY").duration(500).ease(Ta).attr("transform",((t,e,n)=>a(0,e,n,-70))),Ze(".name-group").filter((t=>t>=r)).transition("moveY").duration(500).ease(Ta).attr("transform",((t,e,n)=>a(0,e,n,-70))),hl[r]=null):"up"===hl[r]?(Ze(".attention-group").filter((t=>t<r)).transition("moveY").duration(500).ease(Ta).attr("transform",((t,e,n)=>a(0,e,n,70))),Ze(".name-group").filter((t=>t<r)).transition("moveY").duration(500).ease(Ta).attr("transform",((t,e,n)=>a(0,e,n,70))),hl[r]=null):console.error("Unknown case!"))},xl=(t,e,n,r,a)=>{const i=t=>{Qe(t.target).classed("disabled")||Qe(t.target).style("fill","hsla(0, 0%, 0%, 0.2)").style("stroke","hsl(28, 7%, 20%)")},o=t=>{Qe(t.target).classed("symbol-highlight")||Qe(t.target).style("fill","white").style("stroke","hsl(28, 7%, 60%)")};let l=t.append("g").attr("class","symbol-group").attr("transform","translate(16, 19)").append("g").attr("class","radial-symbol").attr("transform","translate(0, 0)");l.append("rect").attr("class","comparison-svg-button").attr("width",20).attr("height",20).attr("rx",3).style("fill","white").style("stroke","hsl(28, 7%, 60%)").style("stroke-width",1).on("mouseover",i).on("mouseleave",o).on("click",(t=>((t,e,n,r,a)=>{dl.show||(dl.show=!0,dl.attention=e[r][a],dl.tokens=n,dl.layer=r,dl.head=a,st.set(dl),Ze(".radial-symbol").select("rect").classed("disabled",!0),Qe(t.target).classed("disabled",!1).classed("symbol-highlight",!0))})(t,e,n,r,a))),l.append("image").attr("href","/dodrio/figures/radial-symbol.svg").attr("x",2).attr("y",2).attr("height",16).attr("width",16).style("pointer-events","none");let s=l.clone(!0).attr("class","arc-symbol").attr("transform","translate(30, 0)");s.select("rect").on("mouseover",i).on("mouseleave",o).on("click",kl),s.select("image").attr("href","/dodrio/figures/arc-symbol.svg")},bl=(t,e,n,r,a,i,o,l,s,c,u,h,d)=>{let p=i.tokens.map((t=>({token:t.token}))),f=r.words.map((t=>({token:t}))),g=Qe("#head-select"),y=t[g.property("value")];if(void 0===i.tokens[0].id){let t={};i.tokens.forEach((e=>{let n=0;void 0===t[e.token]?t[e.token]=n+1:(n=t[e.token],t[e.token]+=1),e.id=`${al(e.token)}-${n}`}))}null==h&&(h=d(f,i));let v={};f.forEach((t=>{let e=0;void 0===v[t.token]?v[t.token]=e+1:(e=v[t.token],v[t.token]+=1),t.id=`${al(t.token)}-${e}`}));let m=e.select(".token-group").attr("transform"),w=+m.replace(/translate\((.*),\s.*\)/,"$1"),k=+m.replace(/translate\(.*,\s(.*)\)/,"$1"),x=100;ol(e,+e.attr("width")+x);let b=e.append("g").attr("class","comparison-head-name-group").attr("transform",`translate(${n.left},\n      ${n.top+c.top+4})`).style("opacity",0);b.transition("").duration(500).ease(Ta).style("opacity",1);let _=e.select(".token-group").transition("move-x").duration(500).ease(Ta).attr("transform",`translate(${w+x}, ${k})`).on("end",(()=>{_=e.select(".token-group"),_.append("rect").attr("class","blocker").attr("id","top-blocker").attr("x",0).attr("y",0).attr("width",+e.attr("width")).attr("height",N-5).style("fill","url(#top-opacity-gradient)"),e.append("rect").attr("class","blocker").attr("id","top-left-blocker").attr("x",0).attr("y",0).attr("width",x).attr("height",N+5).style("fill","url(#top-opacity-gradient)"),_.append("rect").attr("class","blocker").attr("id","bottom-blocker").attr("x",0).attr("y",o-10).attr("width",+e.attr("width")).attr("height",10).style("fill","url(#bottom-opacity-gradient)"),e.append("rect").attr("class","blocker").attr("id","bottom-left-blocker").attr("x",0).attr("y",o-10).attr("width",x).attr("height",10).style("fill","url(#bottom-opacity-gradient)"),_.select(".node-group").raise(),_.select(".arc-group").raise()})),$=_.select(".node").node().getBBox().height,M=e.select(".node-group").node().getBBox().height,A=e.select(".arc-group").node().getBBox().height,N=+Qe(".graph-view .svg-container").style("top").replace(/(.*)px/,"$1");N+=A+M+n.top+10,Qe(".comparison-panel-container").style("top",N+"px").classed("hide",!1),g.on("change",(()=>{switch(g.property("value")){case"semantic":e.select(".token-group").selectAll(".attention-group").remove(),e.select(".comparison-head-name-group").selectAll(".name-group").remove(),_l(t.semantic,a,r,i,A,M,e,$,10,s,c,u,l,h,f,b,p,n,o);break;case"syntactic":e.select(".token-group").selectAll(".attention-group").remove(),e.select(".comparison-head-name-group").selectAll(".name-group").remove(),_l(t.syntactic,a,r,i,A,M,e,$,10,s,c,u,l,h,f,b,p,n,o);break;case"important":console.log("wow"),e.select(".token-group").selectAll(".attention-group").remove(),e.select(".comparison-head-name-group").selectAll(".name-group").remove(),_l(t.important,a,r,i,A,M,e,$,10,s,c,u,l,h,f,b,p,n,o)}})),_l(y,a,r,i,A,M,e,$,10,s,c,u,l,h,f,b,p,n,o)},_l=(t,e,n,r,a,i,o,l,s,c,u,h,d,p,f,g,y,v,m)=>{let w=0,k=fl(t[0].id.layer,t[0].id.head,e,n,r),x=0,b=null;for(;w<t.length;){let _=0,$=0;0===w?x=a+i+50:(_=+o.select("#attention-group-"+(w-1)).attr("transform").replace(/translate\(.*,\s(.*)\)/,"$1"),$=o.select("#attention-group-"+(w-1)).node().getBBox().height,x=_+$+l+s),b=o.select(".token-group").append("g").datum(w).attr("class","attention-group").attr("id","attention-group-"+w).attr("transform",`translate(0, ${x})`).style("visibility","hidden"),hl[w]=null;let M=o.select(".token-group").select(".node-group").classed("original-node-group",!0).clone(!0).classed("original-node-group",!1).classed("node-group-attention",!0);M.selectAll("g.node").classed("node",!1).classed("node-clone",!0).on("mouseover",(t=>{let e=t.target.parentNode.dataset.id;it.set(e)})).on("mouseleave",(()=>{it.set(null)})),M.selectAll("rect").style("stroke","none"),b.append((()=>M.node())),k=fl(t[w].id.layer,t[w].id.head,e,n,r);let A=gl(k,c,u,h);yl(A,b,l,!1,d,p,f);let N=g.append("g").datum(w).attr("class","name-group name-group-"+w).attr("transform",`translate(0, ${x})`).style("visibility","hidden"),E=pl.get([t[w].id.layer,t[w].id.head].toString());N.append("text").attr("class","name").style("fill",E).text(`layer ${t[w].id.layer}\n          head ${t[w].id.head}`),xl(N,e,y,t[w].id.layer,t[w].id.head);let T=x+o.select("#attention-group-"+w).node().getBBox().height,D=vl(t[0].id.layer,t[0].id.head,e,n,r),S=ml(D,c,u,h);if(wl(S,b,w,p,f),T+v.bottom>m){b.remove(),N.remove(),Qe("#comparison-label-top").text(`Dependencies predicted by top-${w} attention heads with the highest `);break}b.style("visibility","visible"),N.style("visibility","visible"),w+=1}};function $l(e){let n,r,a,i,c,h,y,m,k,x,b,_,$,M,A,N,E,T=e[1].layer+"",D=e[1].head+"";return{c(){n=u("div"),r=u("div"),a=u("div"),i=u("header"),c=u("div"),h=d("Layer "),y=d(T),m=d(" Head "),k=d(D),x=d(" Attention Wights"),_=p(),$=u("button"),M=p(),A=u("section"),A.innerHTML='<svg class="modal-svg"></svg>',g(c,"class","modal-card-title svelte-hancuc"),g(c,"style",b="color: "+e[3](e[1].layer,e[1].head)),g($,"class","delete"),g($,"aria-label","close"),g(i,"class","modal-card-head svelte-hancuc"),g(A,"class","modal-card-body svelte-hancuc"),g(a,"class","modal-card svelte-hancuc"),g(r,"class","modal svelte-hancuc"),w(r,"is-active",e[1].show),g(n,"class","modal-component")},m(t,s){l(t,n,s),o(n,r),o(r,a),o(a,i),o(i,c),o(c,h),o(c,y),o(c,m),o(c,k),o(c,x),o(i,_),o(i,$),o(a,M),o(a,A),e[4](n),N||(E=f($,"click",e[2]),N=!0)},p(t,[e]){2&e&&T!==(T=t[1].layer+"")&&v(y,T),2&e&&D!==(D=t[1].head+"")&&v(k,D),2&e&&b!==(b="color: "+t[3](t[1].layer,t[1].head))&&g(c,"style",b),2&e&&w(r,"is-active",t[1].show)},i:t,o:t,d(t){t&&s(n),e[4](null),N=!1,E()}}}let Ml=500;function Al(t,e,n){let r=null,a=null,i=null,o={},l=null,s=new Map;lt.subscribe((t=>{s=t})),st.set(o),st.subscribe((t=>{n(1,o=t),null!=o.attention&&c(i)}));const c=t=>{if(void 0!==o.top)Qe(r).select(".modal-card").style("top",o.top+"px").style("left",o.top+"px").style("width",o.width+"px").style("height",o.height+"px");else{let t=+Qe(".dependency-svg").attr("height"),e=window.innerWidth;Qe(r).select(".modal-card").style("top",(t-420)/2+"px").style("left",(e-380)/2+"px")}let e=s.get([o.layer,o.head].toString());a.select("#atlas-arrow").select("path").attr("fill",e).attr("stroke",e);let n=Qe(document.body).append("svg").attr("height",200).attr("width",200).style("visibility","hidden");const i=rl(o.tokens.map((t=>t.token)),n,"0.9em");let l=250-kt(Object.entries(i.textTokenWidths).map((t=>t[1])));n.remove();let c=[];for(let t=0;t<o.tokens.length;t++){let e=-Math.PI/2+t*(2*Math.PI/o.tokens.length);c.push({x:Math.cos(e)*l,y:Math.sin(e)*l,angle:e,token:o.tokens[t].token,id:t})}let u=[];for(let t=0;t<o.tokens.length;t++)for(let e=0;e<o.tokens.length;e++){let n=o.attention[t][e];n>0&&u.push({source:t,target:e,attention:n,id:`${t}-${e}`})}u=u.sort(((t,e)=>e.attention-t.attention)).slice(0,150);let h=to().domain(gt(u.map((t=>t.attention)))).range([.2,.7]),d=to().domain([0,1]).range([.1,1]),p=t.append("g").attr("class","token-text-group").style("font-size","0.9em").style("cursor","default");p.selectAll("text").data(c,(t=>t.id)).join("text").attr("data-angle",(t=>t.angle)).attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${l}, 0)\n          rotate(${t.angle>=Math.PI/2?180:0})\n        `)).attr("dominant-baseline","middle").attr("x",(t=>t.angle<Math.PI/2?6:-6)).attr("text-anchor",(t=>t.angle<Math.PI/2?"start":"end")).text((t=>t.token));let f=t.select(".token-text-group").clone(!0).remove();n=Qe(document.body).append("svg").attr("viewBox","0 0 500 500").attr("width",480).attr("height",480).style("visibility","hidden"),n.append((()=>f.node()));let g=n.select(".token-text-group").node().getBBox();n.remove();let y=250+g.y,v=Ml-y-g.height,m=250+g.x,w=Ml-m-g.width,k=Math.min(y,v,m,w);l+=Math.floor(k),c=[];for(let t=0;t<o.tokens.length;t++){let e=-Math.PI/2+t*(2*Math.PI/o.tokens.length);c.push({x:Math.cos(e)*l,y:Math.sin(e)*l,angle:e,token:o.tokens[t].token,id:t})}p.selectAll("rect").data(c,(t=>t.id)).join("rect").attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${l}, 0)\n        `)).attr("x",0).attr("y",-5).attr("width",50).attr("height",15).style("fill","white").style("opacity",0).on("mouseover",((e,n)=>{a.select("#atlas-arrow").select("path").attr("opacity",.1),t.select(".path-group").selectAll("path.donut-link").style("opacity",.5),t.select(".path-group").selectAll("path.donut-link").filter((t=>t.source===n.id||t.target===n.id)).attr("marker-end","url(#atlas-arrow-hover)").style("stroke","hsl(36, 100%, 55%)").style("stroke-width",3).style("opacity",1).raise()})).on("mouseleave",(()=>{a.select("#atlas-arrow").select("path").attr("opacity",null),t.select(".path-group").selectAll("path.donut-link").attr("marker-end","url(#atlas-arrow)").style("stroke",e).style("stroke-width",(t=>h(t.attention))).style("opacity",1)})),p.selectAll("text").data(c,(t=>t.id)).join("text").attr("data-angle",(t=>t.angle)).attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${l}, 0)\n          rotate(${t.angle>=Math.PI/2?180:0})\n        `)).attr("dominant-baseline","middle").attr("x",(t=>t.angle<Math.PI/2?6:-6)).attr("text-anchor",(t=>t.angle<Math.PI/2?"start":"end")).text((t=>t.token)).on("mouseover",((e,n)=>{a.select("#atlas-arrow").select("path").style("opacity",.5),t.select(".path-group").selectAll("path.donut-link").style("opacity",.1),t.select(".path-group").selectAll("path.donut-link").filter((t=>t.source===n.id||t.target===n.id)).attr("marker-end","url(#atlas-arrow-hover)").style("stroke","hsl(24, 95%, 59%)").style("opacity",1).style("stroke-width",3).raise()})).on("mouseleave",(()=>{a.select("#atlas-arrow").select("path").attr("opacity",null),t.select(".path-group").selectAll("path.donut-link").attr("marker-end","url(#atlas-arrow)").style("stroke",e).style("stroke-width",(t=>h(t.attention))).style("opacity",1)})),t.append("g").attr("class","path-group").selectAll("path.donut-link").data(u,(t=>t.id)).join("path").attr("class","donut-link").attr("marker-end","url(#atlas-arrow)").attr("d",(t=>{let e=c[t.source],n=c[t.target];const r=0,a=0,i=.4;let o=r+(e.x-r)*i,l=a+(e.y-r)*i,s=r+(n.x-r)*i,u=a+(n.y-r)*i;return`M ${e.x},${e.y} C${o}, ${l},\n          ${s}, ${u}, ${n.x},${n.y}`})).style("fill","none").style("stroke",e).style("stroke-width",(t=>h(t.attention))).style("opacity",(t=>d(t.attention))),t.append("g").attr("class","token-dot-group").selectAll("circle.token-dot").data(c,(t=>t.id)).join("circle").attr("class","token-dot").attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("r",1)};_((()=>{let t=Qe(r).select(".modal-card");(t=>{let e=0,r=0,a=0,i=0;const l=n=>{e=a-n.clientX,r=i-n.clientY,a=n.clientX,i=n.clientY,t.style.top=t.offsetTop-r+"px",t.style.left=t.offsetLeft-e+"px"},s=()=>{document.onmouseup=null,document.onmousemove=null,n(1,o.top=t.style.top,o),n(1,o.left=t.style.left,o),n(1,o.width=t.style.width,o),n(1,o.height=t.style.height,o)};document.querySelector(".modal-card-head").onmousedown=t=>{a=t.clientX,i=t.clientY,document.onmouseup=s,document.onmousemove=l}})(t.node()),a=t.select("svg.modal-svg").attr("viewBox","0 0 500 500").attr("width","100%").attr("height","100%"),a.append("rect").attr("width",Ml).attr("height",Ml).style("fill","hsla(0, 0%, 100%, 0)"),i=a.append("g").attr("class","donut").attr("transform","translate(250, 250)"),l=a.append("defs").attr("id","atlas-arrow-def").append("marker").attr("id","atlas-arrow").attr("viewBox",[0,0,10,10]).attr("refX",10).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke","gray").attr("fill","gray"),l=a.append("defs").attr("id","atlas-arrow-def-hover").append("marker").attr("id","atlas-arrow-hover").attr("viewBox",[0,0,10,10]).attr("refX",10).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke","hsl(24, 95%, 59%)").attr("fill","hsl(24, 95%, 59%)")}));return[r,o,()=>{n(1,o.show=!1,o),st.set(o),a.select(".donut").selectAll("*").remove(),Ze(".radial-symbol").select("rect").classed("disabled",!1).classed("symbol-highlight",!1).style("fill","white").style("stroke","hsl(28, 7%, 60%)")},(t,e)=>null!=s&&void 0!==s.has&&s.has([t,e].toString())?s.get([t,e].toString()):"black",function(t){A[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class Nl extends R{constructor(t){super(),O(this,t,Al,$l,i,{})}}const El=(t,e,n,r,a,i,o,l,s,c,u)=>{const h=t.list;let d=t.words.map((t=>({token:t})));if(void 0===e.tokens[0].id){let t={};e.tokens.forEach((e=>{let n=0;void 0===t[e.token]?t[e.token]=n+1:(n=t[e.token],t[e.token]+=1),e.id=`${al(e.token)}-${n}`}))}null==c&&u(d,e);let p={};d.forEach((t=>{let e=0;void 0===p[t.token]?p[t.token]=e+1:(e=p[t.token],p[t.token]+=1),t.id=`${al(t.token)}-${e}`}));let f=rl(d.map((t=>t.token)),n),g=f.textTokenWidths,y=f.textTokenHeight,v=function(){var t=zi,e=Hi;function n(n){var r,a,i,o,l,s,c,u=Array.from(n),h=u.length,d=new Map;for(a=0;a<h;++a)r=u[a],l=u[a]=new Ti(r),null!=(s=t(r,a,n))&&(s+="")&&(c=l.id=s,d.set(c,d.has(c)?Li:l)),null!=(s=e(r,a,n))&&(s+="")&&(l.parent=s);for(a=0;a<h;++a)if(s=(l=u[a]).parent){if(!(o=d.get(s)))throw new Error("missing: "+s);if(o===Li)throw new Error("ambiguous: "+s);o.children?o.children.push(l):o.children=[l],l.parent=o}else{if(i)throw new Error("multiple roots");i=l}if(!i)throw new Error("no root");if(i.parent=Si,i.eachBefore((function(t){t.depth=t.parent.depth+1,--h})).eachBefore(Ei),i.parent=null,h>0)throw new Error("cycle");return i}return n.id=function(e){return arguments.length?(t=Di(e),n):t},n.parentId=function(t){return arguments.length?(e=Di(t),n):e},n}().id((t=>t.child)).parentId((t=>t.parent))(h),m=Bi().separation(((t,e)=>Math.max(g[t.id],g[e.id]))).size([r-i.left-i.right,a-i.top-i.bottom-2*y])(v),w=n.append("g").attr("class","tree-group").attr("transform",`translate(${i.left}, ${i.top+y})`),k=m.links();for(let t=0;t<k.length;t++)k[t].left=+k[t].target.x>+k[t].source.x,k[t].vertical=Math.abs(+k[t].target.x-+k[t].source.x)<5;w.append("g").attr("class","link-group").selectAll("path").data(k,(t=>`${t.source.id}-${t.target.id}`)).join("path").attr("id",(t=>`link-${t.source.id}-${t.target.id}`)).attr("data-left",(t=>`${t.left} ${t.source.x} ${t.target.x}`)).attr("d",Do().x((t=>t.x)).y((t=>t.y)));let x=w.append("g").attr("class","link-text-group").selectAll("text.text-link").data(k,(t=>`${t.source.id}-${t.target.id}`)).join("text").attr("class","text-link");x.append("textPath").attr("href",(t=>`#link-${t.source.id}-${t.target.id}`)).attr("startOffset","50%").attr("side",(t=>t.left?"left":"right")).style("text-anchor","middle").style("dominant-baseline","end").text((t=>t.target.data.relation)),x.clone(!0).lower().attr("stroke-width",2).attr("stroke","white");let b=w.append("g").attr("class","node-group").selectAll("g").data(v.descendants()).join("g").attr("class",(t=>{let e=d[Number(t.id)],n="node node-"+e.id;return void 0!==c[e.token]&&c[e.token].forEach((t=>{n+=" node-"+t})),n})).attr("transform",(t=>`translate(${t.x}, ${t.y})`)).on("mouseover",(t=>o(d,t))).on("mouseleave",l);b.append("rect").attr("x",(t=>-(g[t.id]+s.left+s.right)/2)).attr("y",-(y+s.top+s.bottom)/2).attr("width",(t=>g[t.id]+s.left+s.right)).attr("height",y+s.top+s.bottom).attr("rx",5).style("fill","hsl(210, 25%, 98%)").style("stroke","hsl(180, 1%, 80%)"),b.append("text").attr("class","text-token").attr("y",1).text((t=>d[t.id].token))};function Tl(t,e,n){const r=t.slice();return r[56]=e[n],r}function Dl(t,e,n){const r=t.slice();return r[59]=e[n],r[60]=e,r[61]=n,r}function Sl(t,e,n){const r=t.slice();return r[56]=e[n],r}function Ll(e){let n,r,a,i=e[56].name+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[56].value,n.value=n.__value},m(t,e){l(t,n,e),o(n,r)},p:t,d(t){t&&s(n)}}}function zl(t){let e,n,a,i,c,h,y,m,w,k,x,b,_,$=t[59][0]+"",M=t[59][1]+"";function A(){t[16].call(n,t[59])}return{c(){e=u("label"),n=u("input"),i=p(),c=d($),h=p(),y=u("span"),m=d("("),w=d(M),k=d(")"),x=p(),g(n,"type","checkbox"),g(n,"data-rel",a=t[59][0]),g(n,"class","svelte-twbny"),g(y,"class","light-gray svelte-twbny"),g(e,"class","checkbox check-box-wrapper svelte-twbny")},m(r,a){l(r,e,a),o(e,n),n.checked=t[1][t[59][0]],o(e,i),o(e,c),o(e,h),o(e,y),o(y,m),o(y,w),o(y,k),o(e,x),b||(_=[f(n,"change",t[8]),f(n,"change",A)],b=!0)},p(e,r){t=e,1&r[0]&&a!==(a=t[59][0])&&g(n,"data-rel",a),3&r[0]&&(n.checked=t[1][t[59][0]]),1&r[0]&&$!==($=t[59][0]+"")&&v(c,$),1&r[0]&&M!==(M=t[59][1]+"")&&v(w,M)},d(t){t&&s(e),b=!1,r(_)}}}function Hl(e){let n,r,a,i=e[56].name+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[56].value,n.value=n.__value},m(t,e){l(t,n,e),o(n,r)},p:t,d(t){t&&s(n)}}}function jl(t){let e,n,a,i,h,d,y,v,m,k,x,b,_,$,M,A,N,E,T,D,S,L,z,H,j,q,W,O,R,X,Y,V,U,G,Q,K=Object.values(t[4]),Z=[];for(let e=0;e<K.length;e+=1)Z[e]=Ll(Sl(t,K,e));let J=t[0],tt=[];for(let e=0;e<J.length;e+=1)tt[e]=zl(Dl(t,J,e));let et=Object.values(t[5]),nt=[];for(let e=0;e<et.length;e+=1)nt[e]=Hl(Tl(t,et,e));return V=new Nl({}),{c(){e=u("div"),n=u("div"),a=u("div"),i=u("div"),i.textContent="Current Sentence",h=p(),d=u("div"),y=u("div"),y.innerHTML='<div class="comparison-button svelte-twbny"><div class="icon-wrapper svelte-twbny"><img src="/dodrio/figures/edit.svg" alt="editing icon" class="svelte-twbny"/></div></div>',v=p(),m=u("div"),k=u("div"),x=u("select");for(let t=0;t<Z.length;t+=1)Z[t].c();b=p(),_=u("div"),$=u("div"),$.innerHTML='<div class="comparison-button svelte-twbny">Show Comparison</div>',M=p(),A=u("div"),N=u("div"),N.innerHTML='<div class="relation svelte-twbny">Syntactic Relations</div>',E=p(),T=u("div"),T.innerHTML='<img src="/dodrio/figures/gradient.png" alt="gradient guide" class="svelte-twbny"/>',D=p(),S=u("div");for(let t=0;t<tt.length;t+=1)tt[t].c();L=p(),z=u("div"),H=u("div"),j=u("div"),j.textContent="Dependencies predicted by attention heads with top",q=p(),W=u("div"),O=u("select");for(let t=0;t<nt.length;t+=1)nt[t].c();R=p(),X=u("div"),X.innerHTML='<svg class="dependency-svg"></svg>',Y=p(),P(V.$$.fragment),g(i,"class","dependency-label svelte-twbny"),g(y,"class","relation-container svelte-twbny"),g(d,"class","select-row select-row--edit svelte-twbny"),g(x,"name","instance-layout"),g(x,"id","instance-select"),g(x,"class","svelte-twbny"),g(k,"class","select svelte-twbny"),g(m,"class","select-row svelte-twbny"),g($,"class","relation-container svelte-twbny"),g(_,"class","select-row svelte-twbny"),w(_,"select-row--highlight",t[2]),g(N,"class","relation-container svelte-twbny"),g(A,"class","select-row svelte-twbny"),w(A,"select-row--highlight",t[3]),g(T,"class","gradient-guide svelte-twbny"),g(S,"class","relation-checkboxes svelte-twbny"),w(S,"hide",!t[3]),g(a,"class","svg-control-panel svelte-twbny"),g(n,"class","panel-container svelte-twbny"),g(j,"class","comparison-label svelte-twbny"),g(j,"id","comparison-label-top"),g(O,"name","head-list"),g(O,"id","head-select"),g(O,"class","svelte-twbny"),g(W,"class","select comparison-select svelte-twbny"),g(H,"class","comparison-control-panel svelte-twbny"),g(z,"class","comparison-panel-container hide svelte-twbny"),g(X,"class","svg-container svelte-twbny"),g(e,"class","graph-view svelte-twbny")},m(r,s){l(r,e,s),o(e,n),o(n,a),o(a,i),o(a,h),o(a,d),o(d,y),o(a,v),o(a,m),o(m,k),o(k,x);for(let t=0;t<Z.length;t+=1)Z[t].m(x,null);o(a,b),o(a,_),o(_,$),o(a,M),o(a,A),o(A,N),o(a,E),o(a,T),o(a,D),o(a,S);for(let t=0;t<tt.length;t+=1)tt[t].m(S,null);o(e,L),o(e,z),o(z,H),o(H,j),o(H,q),o(H,W),o(W,O);for(let t=0;t<nt.length;t+=1)nt[t].m(O,null);o(e,R),o(e,X),l(r,Y,s),C(V,r,s),U=!0,G||(Q=[f(y,"click",t[7]),f($,"click",t[6]),f(N,"click",t[15])],G=!0)},p(t,e){if(16&e[0]){let n;for(K=Object.values(t[4]),n=0;n<K.length;n+=1){const r=Sl(t,K,n);Z[n]?Z[n].p(r,e):(Z[n]=Ll(r),Z[n].c(),Z[n].m(x,null))}for(;n<Z.length;n+=1)Z[n].d(1);Z.length=K.length}if(4&e[0]&&w(_,"select-row--highlight",t[2]),8&e[0]&&w(A,"select-row--highlight",t[3]),259&e[0]){let n;for(J=t[0],n=0;n<J.length;n+=1){const r=Dl(t,J,n);tt[n]?tt[n].p(r,e):(tt[n]=zl(r),tt[n].c(),tt[n].m(S,null))}for(;n<tt.length;n+=1)tt[n].d(1);tt.length=J.length}if(8&e[0]&&w(S,"hide",!t[3]),32&e[0]){let n;for(et=Object.values(t[5]),n=0;n<et.length;n+=1){const r=Tl(t,et,n);nt[n]?nt[n].p(r,e):(nt[n]=Hl(r),nt[n].c(),nt[n].m(O,null))}for(;n<nt.length;n+=1)nt[n].d(1);nt.length=et.length}},i(t){U||(F(V.$$.fragment,t),U=!0)},o(t){I(V.$$.fragment,t),U=!1},d(t){t&&s(e),c(Z,t),c(tt,t),c(nt,t),t&&s(Y),B(V,t),G=!1,r(Q)}}}let ql="hsl(0, 0%, 80%)",Fl="hsl(36, 100%, 90%)",Il="hsl(36, 100%, 80%)",Pl="hsl(36, 100%, 55%)";function Cl(t,e,n){let{attentionDataDir:r}=e,{saliencyDataFilepath:a}=e,{dependencyDataFilepath:i}=e,{syntacticHeadDataFilepath:o}=e,{semanticHeadDataFilepath:l}=e,{importantHeadDataFilepath:s}=e;const c=$();let u=null,h=null,d=null,p=null,f=null,g={},y=null,v=[],m={},w=1562,k={},x=[],b=800,M=800,A=void 0,N=!1,E=!1,T={};nt.subscribe((t=>{T=t,M=T.height-41,(T.inComparison&&!E||!T.inComparison&&E)&&Y()}));let D=null;ct.subscribe((t=>{D=t}));const S={top:10,left:15,right:15,bottom:10},L={top:3,left:3,right:3,bottom:3};let z=null;const H={saliency:{value:"saliency",name:"Saliency View"},dependency:{value:"dependency",name:"Dependency List"},tree:{value:"tree",name:"Dependency Tree"}};let j=!1,q=!1,F=!1,I=H.dependency,P="hsl(42, 95%, 58%)";P="hsl(36, 100%, 55%)";let C=!1;const B=()=>{u=Qe("svg.dependency-svg").attr("width",b).attr("height",M),u.append("rect").attr("class","border-rect").attr("width",b).attr("height",M).style("stroke","black").style("fill","none");let t=u.append("defs");t.append("marker").attr("id","dep-arrow").attr("viewBox",[0,0,10,10]).attr("refX",0).attr("refY",5).attr("markerWidth",10).attr("markerHeight",5).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke",ql).attr("fill",ql),t.clone(!0).select("marker").attr("id","dep-arrow-hover").select("path").attr("stroke",P).attr("fill",P),t.clone(!0).select("marker").attr("id","dep-attention-arc-arrow").select("path").attr("stroke","none").attr("refX",2).attr("fill","hsl(0, 0%, 10%)"),t.clone(!0).select("marker").attr("id","dep-attention-arrow").select("path").attr("stroke","none").attr("refX",2).attr("fill","hsl(0, 0%, 80%)");let e=u.append("defs").append("linearGradient").attr("id","top-opacity-gradient").attr("x2","0%").attr("y2","100%");e.append("stop").style("stop-opacity",1).style("stop-color","white").attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color","white").attr("offset","0.9"),e.append("stop").style("stop-opacity",0).style("stop-color","white").attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","bottom-opacity-gradient").attr("x2","0%").attr("y2","100%"),e.append("stop").style("stop-opacity",0).style("stop-color","white").attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color","white").attr("offset","0.5"),e.append("stop").style("stop-opacity",1).style("stop-color","white").attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","link-opacity-gradient-rl"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 90%)").attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 70%)").attr("offset","0.6"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 20%)").attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","link-opacity-gradient-lr"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 20%)").attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 70%)").attr("offset","0.4"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 90%)").attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","matched-link-opacity-gradient-rl"),e.append("stop").style("stop-opacity",1).style("stop-color",Fl).attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color",Il).attr("offset","0.6"),e.append("stop").style("stop-opacity",1).style("stop-color",Pl).attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","matched-link-opacity-gradient-lr"),e.append("stop").style("stop-opacity",1).style("stop-color",Pl).attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color",Il).attr("offset","0.4"),e.append("stop").style("stop-opacity",1).style("stop-color",Fl).attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","top-link-opacity-gradient-rl"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 20%)").attr("offset","0"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 70%)").attr("offset","0.3"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 90%)").attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","top-link-opacity-gradient-lr"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 90%)").attr("offset","0"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 70%)").attr("offset","0.7"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 20%)").attr("offset","1"),N=!0},W=t=>{let e=Qe(t.target).data()[0].id;it.set(e)},O=()=>{it.set(null)},R=(t,e)=>{let n=t[Qe(e.target).data()[0].id].id;it.set(n)},X=(t,e)=>{y={};let n=0;for(;il(e.tokens[n].token);)n+=1;for(let r=0;r<t.length&&!(n>=e.tokens.length);r++){let a=t[r].token;if(a!==e.tokens[n].token){let i=r+1<t.length?t[r+1].token:null;for(y[a]=[];e.tokens[n].token!==i&&(y[a].push(e.tokens[n].id),n+=1,!(n>=e.tokens.length)););}else n+=1}return ot.set(y),y},Y=()=>{u.attr("height",M);let t=V();var e,r;E?(n(2,E=!1),(t=>{let e=t.select(".token-group").attr("transform"),n=+e.replace(/translate\((.*),\s.*\)/,"$1"),r=+e.replace(/translate\(.*,\s(.*)\)/,"$1");ol(t,+t.attr("width")-100),t.selectAll(".blocker").remove(),t.select(".token-group").transition("move-x").duration(500).ease(Ta).attr("transform",`translate(${n-100}, ${r})`),t.select(".comparison-head-name-group").remove(),t.selectAll(".attention-group").remove(),Qe(".comparison-panel-container").classed("hide",!0)})(u)):(n(2,E=!0),null==f?G(`/dodrio/data/sst2-attention-data/attention-${e=w,r=4,Array(Math.max(r-String(e).length+1,0)).join(0)+e}.json`).then((()=>bl(t,u,S,h,f,p,M,d,x,L,k,y,X))):bl(t,u,S,h,f,p,M,d,x,L,k,y,X))},V=()=>{let t={},e=new Map,n=g.syntactic;for(let t in m){if(!m[t]||void 0===n[t])continue;n[t].top_heads.forEach((t=>{e.has(t.head)?e.set(t.head,Math.max(t.acc,e.get(t.head))):e.set(t.head,t.acc)}))}let r=[...e.entries()].sort(((t,e)=>e[1]-t[1])).map((t=>({id:{layer:t[0][0],head:t[0][1]},acc:t[1]})));return t.syntactic=r,n=g.semantic,r=n.map((t=>({id:{layer:t[1][0],head:t[1][1]},score:t[0]}))),t.semantic=r,n=g.important,r=n.map((t=>({id:{layer:t[1][0],head:t[1][1]},score:t[0]}))),t.important=r,t},U=async(t,e,r,a,i)=>{h=await Pa(t),h=h[w];let o=new Map;n(1,m={}),d=new Map,h.list.forEach((t=>{d.set(String([t.parent,t.child]),t.relation),o.has(t.relation)?o.set(t.relation,o.get(t.relation)+1):(o.set(t.relation,1),n(1,m[t.relation]=!0,m))})),o=new Map([...o.entries()].sort(((t,e)=>e[1]-t[1]))),n(0,v=[...o.entries()]),p=await Pa(e),p=p[w],g.syntactic=await Pa(r),g.semantic=await Pa(a),g.semantic=g.semantic[w],g.important=await Pa(i),g.important=g.important[w]},G=async t=>{f=await Pa(t)};_((async()=>{null!=h&&null!=p||U(i,a,o,l,s),(()=>{let t=Qe("#instance-select").property("value",I.value);t.on("change",(()=>{let e=t.property("value");if(e!==I.value)switch(e){case"saliency":"dependency"===I.value&&j&&u.select("g.token-group").style("display","none"),"tree"===I.value&&F&&u.select("g.tree-group").style("display","none"),q?(u.select("g.token-group-saliency").style("display",null),u.select("g.legend-group").style("display",null)):(N||B(),sl(p,u,b,S,L,y,W,O),q=!0),I=H[e];break;case"dependency":if(console.log("change to dependency view"),"tree"===I.value&&F&&u.select("g.tree-group").style("display","none"),"saliency"===I.value&&q&&(u.select("g.token-group-saliency").style("display","none"),u.select("g.legend-group").style("display","none")),j)u.select("g.token-group").style("display",null);else{N||B();let t=ul(h,p,y,u,x,L,S,0,W,O,X);x=t.tokenXs,k=t.textTokenWidths,j=!0}I=H[e];break;case"tree":console.log("change to tree view"),"dependency"===I.value&&j&&u.select("g.token-group").style("display","none"),"saliency"===I.value&&q&&(u.select("g.token-group-saliency").style("display","none"),u.select("g.legend-group").style("display","none")),F?u.select("g.tree-group").style("display",null):(N||B(),El(h,p,u,b,M,S,R,O,L,y,X),F=!0),I=H[e]}}))})()}));const Q=()=>{let t=null;switch(I.value){case"saliency":N||B(),sl(p,u,b,S,L,y,W,O),q=!0;break;case"dependency":N||B(),t=ul(h,p,y,u,x,L,S,0,W,O,X),x=t.tokenXs,k=t.textTokenWidths,j=!0;break;case"tree":N||B(),El(h,p,u,b,M,S,R,O,L,y,X),F=!0}};Z.subscribe((async t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===A||A.compHeight!==t.compHeight&&A.compWidth!==t.compWidth)&&(A=t,b=A.compWidth,M=A.compHeight-41,null==h||null==p?U(i,a,o,l,s).then(Q):Q())})),at.subscribe((t=>{t!==w&&(u.selectAll("*").remove(),N=!1,f=null,h=null,d=null,p=null,f=null,g={},y=null,j=!1,q=!1,F=!1,w=t,U(i,a,o,l,s).then(Q))})),it.subscribe((t=>{null!=u&&(null!=t?(z=t,u.selectAll(".node").filter(((t,e,n)=>Qe(n[e]).attr("class").includes("-"+z))).select("rect").style("stroke",P).style("stroke-width",2),u.selectAll(".arc-path").style("opacity",.8),u.selectAll(".arc-path").filter(((t,e,n)=>Qe(n[e]).attr("class").includes("-"+z))).classed("highlighted",!0).style("opacity",1).raise(),u.selectAll(".node-clone").filter(((t,e,n)=>Qe(n[e]).attr("class").includes("-"+z))).select("rect").style("stroke",P).style("opacity",1).style("stroke-width",2),u.selectAll(".matched-attention-path").classed("de-highlighted",!0),u.selectAll(".attention-path").style("opacity",.2),u.selectAll(".attention-path").filter(((t,e,n)=>Qe(n[e]).attr("class").includes("-"+z))).classed("highlighted",!0).style("opacity",1).raise(),u.selectAll(".attention-arc").style("opacity",.2),u.selectAll(".attention-arc").filter(((t,e,n)=>Qe(n[e]).attr("class").includes("-"+z))).classed("highlighted",!0).style("opacity",.9).raise()):(u.selectAll(".node").filter(((t,e,n)=>Qe(n[e]).attr("class").includes("-"+z))).select("rect").style("stroke","hsl(180, 1%, 80%)").style("stroke-width",1),u.selectAll(".arc-path").style("opacity",null),u.selectAll(".arc-path").filter(((t,e,n)=>Qe(n[e]).attr("class").includes("-"+z))).classed("highlighted",!1),u.selectAll(".node-clone").filter(((t,e,n)=>Qe(n[e]).attr("class").includes("-"+z))).select("rect").style("opacity",null).style("stroke","none"),u.selectAll(".matched-attention-path").classed("de-highlighted",!1),u.selectAll(".attention-path").style("opacity",null),u.selectAll(".attention-path").filter(((t,e,n)=>Qe(n[e]).attr("class").includes("-"+z))).classed("highlighted",!1).raise(),u.selectAll(".attention-arc").style("opacity",.5),u.selectAll(".attention-arc").filter(((t,e,n)=>Qe(n[e]).attr("class").includes("-"+z))).classed("highlighted",!1).raise(),z=t))}));return t.$$set=t=>{"attentionDataDir"in t&&n(9,r=t.attentionDataDir),"saliencyDataFilepath"in t&&n(10,a=t.saliencyDataFilepath),"dependencyDataFilepath"in t&&n(11,i=t.dependencyDataFilepath),"syntacticHeadDataFilepath"in t&&n(12,o=t.syntacticHeadDataFilepath),"semanticHeadDataFilepath"in t&&n(13,l=t.semanticHeadDataFilepath),"importantHeadDataFilepath"in t&&n(14,s=t.importantHeadDataFilepath)},[v,m,E,C,H,{syntactic:{value:"syntactic",name:"syntactic correlations"},semantic:{value:"semantic",name:"semantic correlations "},importance:{value:"important",name:"importance scores"}},()=>{c(E?"close":"open")},()=>{D.show=!0,ct.set(D)},t=>{let e=t.target.dataset.rel;n(1,m[e]=t.target.checked,m),u.selectAll(".arc-path").filter((t=>t.relation===e)).style("visibility",m[e]?"visible":"hidden"),u.selectAll(".matched-attention-path-"+e).classed("matched-attention-path",m[e])},r,a,i,o,l,s,()=>{n(3,C=!C)},function(t){m[t[0]]=this.checked,n(1,m),n(0,v)}]}class Bl extends R{constructor(t){super(),O(this,t,Cl,jl,i,{attentionDataDir:9,saliencyDataFilepath:10,dependencyDataFilepath:11,syntacticHeadDataFilepath:12,semanticHeadDataFilepath:13,importantHeadDataFilepath:14},[-1,-1,-1])}}function Wl(e){let n,r,a,i,c,h,y,v,m,k,x,b;return{c(){n=u("div"),r=u("div"),a=p(),i=u("div"),c=u("div"),h=u("div"),y=u("div"),y.innerHTML='<div class="expand-button svelte-1kp0yq1"><div class="icon-wrapper svelte-1kp0yq1"><img src="/dodrio/figures/arrow-forward-outline.svg" alt="expanding icon" class="svelte-1kp0yq1"/></div></div>',v=d("\n\n      Attention Head Overview"),m=p(),k=u("div"),k.innerHTML='<div class="atlas-svg-container svelte-1kp0yq1"><svg class="atlas-svg-full svelte-1kp0yq1"></svg></div> \n\n    <div class="legend-container svelte-1kp0yq1"><div class="svelte-1kp0yq1"><img src="/dodrio/figures/click.png" width="180px" alt="click guide" class="svelte-1kp0yq1"/></div> \n      <div class="bottom-images svelte-1kp0yq1"><img src="/dodrio/figures/size-legend.png" width="160px" alt="size legend" class="svelte-1kp0yq1"/> \n        <img src="/dodrio/figures/legend.png" width="200px" alt="color legend" class="svelte-1kp0yq1"/></div></div>',g(r,"class","triangle svelte-1kp0yq1"),w(r,"hidden",!e[0].show),g(y,"class","relation-container"),g(h,"class","select-row svelte-1kp0yq1"),g(c,"class","lower-atlas-label svelte-1kp0yq1"),g(i,"class","control-row svelte-1kp0yq1"),g(k,"class","svg-container svelte-1kp0yq1"),g(n,"class","atlas-view svelte-1kp0yq1")},m(t,s){l(t,n,s),o(n,r),o(n,a),o(n,i),o(i,c),o(c,h),o(h,y),o(c,v),o(n,m),o(n,k),e[6](n),x||(b=f(y,"click",e[2]),x=!0)},p(t,e){1&e[0]&&w(r,"hidden",!t[0].show)},i:t,o:t,d(t){t&&s(n),e[6](null),x=!1,b()}}}function Ol(t,e,n){let{attentionDataDir:r}=e,{saliencyDataFilepath:a}=e,{atlasDataFilepath:i}=e,o=null,l=null,s=null,c=null,u=null,h=null;et.subscribe((t=>{h=t}));let d=null,p=null,f={layer:9,head:8},g=9,y=8;const v=er(23,85,56),m=er(328,85,56),w=er(274,85,56);let k=1562;const x=$();let b=800,M=800,N=void 0;const E=40,T=10,D=10,S=3,L=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e,z=(t,e)=>Array(Math.max(e-String(t).length+1,0)).join(0)+t,H=()=>{const t=s.length,e=s[0].length,r=47;let a=b-210-r-T-D,i=M-E-S-20,u=Math.min(i,a);const k=Math.floor((i-8*(t-1))/t),x=k/2;let _=Math.floor((a-x-e*k)/(t-1)),$=Math.floor((i-t*k)/(t-1));o=Qe(".atlas-svg-full").attr("viewbox",`0 0 ${a+r} ${i}`).attr("width",a+r).attr("height",i+20),o.append("rect").attr("class","border-rect").attr("width",u).attr("height",u).style("stroke","black").style("fill","none");let A=o.append("g").attr("class","donut-group").attr("transform",`translate(${T+x+r},\n        ${x+20})`),N={hueScale:to().domain([-1,0,1]).range([v,m,w]),lightnessScale:to().domain([0,1]).range([130,40]),outRadiusScale:to().domain([0,1]).range([10,x]),ringRadiusScale:to().domain([0,1]).range([4,7])},z=A.selectAll("g.donut").data(l).join("g").attr("class","donut").attr("transform",(e=>`translate(${e.head*(2*x+_)},\n        ${(t-e.layer-1)*(2*x+$)})`)).style("pointer-events","fill").style("cursor","pointer");z.each(((t,e,n)=>j(t,e,n,N))),z.on("mouseover",((t,e)=>{let n=t.currentTarget.getBoundingClientRect(),r=n.right-n.left,a=n.x+r/2,i=n.y-90;h.html=`\n        <div class='tooltip-tb' style='display: flex; flex-direction: column;\n          justify-content: center; font-weight: 600;'>\n          <div> Layer ${e.layer+1} Head ${e.head+1} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Semantic: ${L(e.semantic,2)} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Syntactic ${L(e.syntactic,2)} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Importance: ${L(e.confidence,2)} </div>\n        </div>\n        `,h.width=130,h.maxWidth=130,h.left=a-h.width/2,h.top=i,h.fontSize="0.8em",h.show=!0,et.set(h);let o=Qe(t.currentTarget);o.classed("selected")||o.select(".donut-rect").style("opacity",1)})).on("mouseleave",(t=>{h.show=!1,et.set(h);let e=Qe(t.currentTarget);e.classed("selected")||e.select(".donut-rect").style("opacity",0)})).on("click",((t,e)=>{n(0,d.show=!0,d),n(0,d.attention=s[e.layer][e.head],d),n(0,d.tokens=c.tokens.map((t=>({token:t.token}))),d),n(0,d.layer=e.layer,d),n(0,d.head=e.head,d),ut.set(d)})).on("dblclick",(t=>{let e=Qe(t.currentTarget);if(e.classed("selected"));else{let t=Qe(A.select(`#donut-rect-${g}-${y}`).node().parentNode);t.select(".donut-rect").style("fill","hsl(0, 0%, 80%)").style("opacity",0),t.classed("selected",!1),e.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),e.classed("selected",!0),g=+e.data()[0].layer,y=+e.data()[0].head,f.layer=g,f.head=y,ht.set(f)}})),A.selectAll("g.row-line-group").data(Array(t-1).fill(0).map(((t,e)=>e))).join("g").attr("class","row-line-group").append("path").attr("d",(n=>`M${-x}\n        ${(t-n-1-.5)*(2*x+$)}\n        L${e*(2*x+_)-x}\n        ${(t-n-1-.5)*(2*x+$)}`)).style("stroke","hsla(0, 0%, 0%, 0.1)"),o.append("g").attr("class","name-group").attr("transform",`translate(${T}, ${x+20})`).selectAll("g.layer-name-group").data(Array(t).fill(0).map(((t,e)=>e))).join("g").attr("class","layer-name-group").attr("transform",(e=>`translate(37,\n        ${(t-e-1)*(2*x+$)})`)).append("text").text((t=>t>0?t+1:"Layer "+(t+1))),o.append("g").attr("class","name-group").attr("transform",`translate(${T+r+x},\n        9)`).selectAll("g.head-name-group").data(Array(t).fill(0).map(((t,e)=>e))).join("g").attr("class","head-name-group").attr("transform",(t=>`translate(${t*(2*x+_)},\n        0)`)).append("text").text((t=>t>0?t+1:"Head "+(t+1))),Qe(p).select(".head-arrow").style("top","30px").style("left",a-170+"px"),Qe(p).select(".layer-arrow").style("top","70px").style("left",a+10+"px");let H=Qe(A.select(`#donut-rect-${g}-${y}`).node().parentNode);H.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),H.classed("selected",!0)},j=(t,e,n,r)=>{let a=Qe(n[e]),i=r.outRadiusScale(t.confidence),o=r.ringRadiusScale(t.confidence),l=Math.max(0,i-o),c=2*r.outRadiusScale.range()[1];a.append("rect").attr("class","donut-rect").attr("id",`donut-rect-${t.layer}-${t.head}`).attr("x",-c/2).attr("y",-c/2).attr("rx",5).attr("width",c).attr("height",c).style("fill","hsl(0, 0%, 80%)").style("opacity",0),a.append("circle").attr("cx",0).attr("cy",0).attr("r",i).style("fill","#FDFCFC").style("opacity",1);let h=_o().outerRadius(i).innerRadius(l).startAngle(0).endAngle(2*Math.PI),d=er(r.hueScale(t.syntactic-t.semantic));d.l=r.lightnessScale(Math.max(t.semantic,t.syntactic)),a.append("path").attr("class","donut-chart").attr("d",h).style("fill",d);let p=[];for(let e=0;e<u;e++){let n=-Math.PI/2+e*(2*Math.PI/u);p.push({x:Math.cos(n)*l,y:Math.sin(n)*l,token:t.token,id:e})}let f=[];for(let e=0;e<u;e++)for(let n=0;n<u;n++){let r=s[t.layer][t.head][e][n];r>0&&f.push({source:e,target:n,attention:r,id:`${e}-${n}`})}f=f.sort(((t,e)=>e.attention-t.attention)).slice(0,150);let g=to().domain(gt(f.map((t=>t.attention)))).range([.2,.7]),y=to().domain([0,1]).range([.1,1]);a.selectAll("path.donut-link").data(f,(t=>t.id)).join("path").attr("class","donut-link").attr("d",(t=>{let e=p[t.source],n=p[t.target];const r=0,a=0,i=.4;let o=r+(e.x-r)*i,l=a+(e.y-r)*i,s=r+(n.x-r)*i,c=a+(n.y-r)*i;return`M ${e.x},${e.y} C${o}, ${l},\n          ${s}, ${c}, ${n.x},${n.y}`})).style("fill","none").style("stroke",d).style("pointer-events","none").style("stroke-width",(t=>g(t.attention))).style("opacity",(t=>y(t.attention)))},q=async(t,e,n)=>{s=await Pa(t),l=await Pa(n),c=await Pa(e),c=c[k],u=c.tokens.length};return _((async()=>{null!=s&&null!=l&&null!=c||q(r+`attention-${z(k,4)}.json`,a,i)})),at.subscribe((async t=>{t!==k&&(k=t,c=await Pa(a),c=c[k],u=c.tokens.length,o.select("*").remove(),H())})),ut.subscribe((t=>{n(0,d=t)})),J.subscribe((async t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===N||N.compHeight!==t.compHeight&&N.compWidth!==t.compWidth)&&(N=t,b=N.compWidth,M=N.compHeight,null==s||null==l||null==c?q(r+`attention-${z(k,4)}.json`,a,i).then(H):H())})),t.$$set=t=>{"attentionDataDir"in t&&n(3,r=t.attentionDataDir),"saliencyDataFilepath"in t&&n(4,a=t.saliencyDataFilepath),"atlasDataFilepath"in t&&n(5,i=t.atlasDataFilepath)},[d,p,()=>{n(0,d.show=!1,d),ut.set(d),x("close")},r,a,i,function(t){A[t?"unshift":"push"]((()=>{p=t,n(1,p)}))}]}class Rl extends R{constructor(t){super(),O(this,t,Ol,Wl,i,{attentionDataDir:3,saliencyDataFilepath:4,atlasDataFilepath:5},[-1,-1])}}function Xl(e){let n,r,a,i,c,h,f,y,m,w=e[1].layer+1+"",k=e[1].head+1+"";return{c(){n=u("div"),r=u("div"),a=d("Layer "),i=d(w),c=d(" Head "),h=d(k),y=p(),m=u("div"),m.innerHTML='<svg class="side-svg svelte-18n2a3m"></svg>',g(r,"class","side-title svelte-18n2a3m"),g(r,"style",f="color: "+e[2](e[1].layer,e[1].head)),g(m,"class","svg-container"),g(n,"class","atlas-side svelte-18n2a3m")},m(t,s){l(t,n,s),o(n,r),o(r,a),o(r,i),o(r,c),o(r,h),o(n,y),o(n,m),e[3](n)},p(t,[e]){2&e&&w!==(w=t[1].layer+1+"")&&v(i,w),2&e&&k!==(k=t[1].head+1+"")&&v(h,k),2&e&&f!==(f="color: "+t[2](t[1].layer,t[1].head))&&g(r,"style",f)},i:t,o:t,d(t){t&&s(n),e[3](null)}}}let Yl=500;function Vl(t,e,n){let r=null,a=null,i=null,o=null,l=new Map;lt.subscribe((t=>{l=t}));let s={};ut.subscribe((t=>{n(1,s=t),null!=s.attention&&(i.selectAll("*").remove(),c(i))}));const c=t=>{let e=l.get([s.layer,s.head].toString());a.select("#atlas-side-arrow").select("path").attr("fill",e).attr("stroke",e);let n=Qe(document.body).append("svg").attr("height",200).attr("width",200).style("visibility","hidden");const r=rl(s.tokens.map((t=>t.token)),n,"0.9em");let i=250-kt(Object.entries(r.textTokenWidths).map((t=>t[1])));n.remove();let o=[];for(let t=0;t<s.tokens.length;t++){let e=-Math.PI/2+t*(2*Math.PI/s.tokens.length);o.push({x:Math.cos(e)*i,y:Math.sin(e)*i,angle:e,token:s.tokens[t].token,id:t})}let c=[];for(let t=0;t<s.tokens.length;t++)for(let e=0;e<s.tokens.length;e++){let n=s.attention[t][e];n>0&&c.push({source:t,target:e,attention:n,id:`${t}-${e}`})}c=c.sort(((t,e)=>e.attention-t.attention)).slice(0,150);let u=to().domain(gt(c.map((t=>t.attention)))).range([.5,2]),h=to().domain([0,1]).range([.1,1]),d=t.append("g").attr("class","token-text-group").style("font-size","0.9em").style("cursor","default");d.selectAll("text").data(o,(t=>t.id)).join("text").attr("data-angle",(t=>t.angle)).attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${i}, 0)\n          rotate(${t.angle>=Math.PI/2?180:0})\n        `)).attr("dominant-baseline","middle").attr("x",(t=>t.angle<Math.PI/2?6:-6)).attr("text-anchor",(t=>t.angle<Math.PI/2?"start":"end")).text((t=>t.token));let p=t.select(".token-text-group").clone(!0).remove();n=Qe(document.body).append("svg").attr("viewBox","0 0 500 500").attr("width",480).attr("height",480).style("visibility","hidden"),n.append((()=>p.node()));let f=n.select(".token-text-group").node().getBBox();n.remove();let g=250+f.y,y=Yl-g-f.height,v=250+f.x,m=Yl-v-f.width,w=Math.min(g,y,v,m);i+=Math.floor(w),o=[];for(let t=0;t<s.tokens.length;t++){let e=-Math.PI/2+t*(2*Math.PI/s.tokens.length);o.push({x:Math.cos(e)*i,y:Math.sin(e)*i,angle:e,token:s.tokens[t].token,id:t})}d.selectAll("rect").data(o,(t=>t.id)).join("rect").attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${i}, 0)\n        `)).attr("x",0).attr("y",-5).attr("width",50).attr("height",15).style("fill","white").style("opacity",0).on("mouseover",((e,n)=>{a.select("#atlas-side-arrow").select("path").attr("opacity",.1),t.select(".path-group").selectAll("path.donut-link").style("opacity",.1),t.select(".path-group").selectAll("path.donut-link").filter((t=>t.source===n.id||t.target===n.id)).attr("marker-end","url(#atlas-side-arrow-hover)").style("stroke","hsl(36, 100%, 55%)").style("stroke-width",3).style("opacity",1).raise()})).on("mouseleave",(()=>{a.select("#atlas-side-arrow").select("path").attr("opacity",null),t.select(".path-group").selectAll("path.donut-link").attr("marker-end","url(#atlas-side-arrow)").style("stroke",e).style("stroke-width",(t=>u(t.attention))).style("opacity",1)})),d.selectAll("text").data(o,(t=>t.id)).join("text").attr("data-angle",(t=>t.angle)).attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${i}, 0)\n          rotate(${t.angle>=Math.PI/2?180:0})\n        `)).attr("dominant-baseline","middle").attr("x",(t=>t.angle<Math.PI/2?6:-6)).attr("text-anchor",(t=>t.angle<Math.PI/2?"start":"end")).text((t=>t.token)).on("mouseover",((e,n)=>{a.select("#atlas-side-arrow").select("path").attr("opacity",.1),t.select(".path-group").selectAll("path.donut-link").style("opacity",.1),t.select(".path-group").selectAll("path.donut-link").filter((t=>t.source===n.id||t.target===n.id)).attr("marker-end","url(#atlas-side-arrow-hover)").style("stroke","hsl(36, 100%, 55%)").style("stroke-width",3).style("opacity",1).raise()})).on("mouseleave",(()=>{a.select("#atlas-side-arrow").select("path").attr("opacity",null),t.select(".path-group").selectAll("path.donut-link").attr("marker-end","url(#atlas-side-arrow)").style("stroke",e).style("stroke-width",(t=>u(t.attention))).style("opacity",1)})),t.append("g").attr("class","path-group").selectAll("path.donut-link").data(c,(t=>t.id)).join("path").attr("class","donut-link").attr("marker-end","url(#atlas-side-arrow)").attr("d",(t=>{let e=o[t.source],n=o[t.target];const r=0,a=0,i=.4;let l=r+(e.x-r)*i,s=a+(e.y-r)*i,c=r+(n.x-r)*i,u=a+(n.y-r)*i;return`M ${e.x},${e.y} C${l}, ${s},\n          ${c}, ${u}, ${n.x},${n.y}`})).style("fill","none").style("stroke",e).style("stroke-width",(t=>u(t.attention))).style("opacity",(t=>h(t.attention))),t.append("g").attr("class","token-dot-group").selectAll("circle.token-dot").data(o,(t=>t.id)).join("circle").attr("class","token-dot").attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("r",1)};_((()=>{let t=Qe(r).select(".svg-container");a=t.select("svg.side-svg").attr("viewBox","0 0 500 500").attr("width","100%").attr("height","100%"),a.append("rect").attr("width",Yl).attr("height",Yl).style("fill","hsla(0, 0%, 100%, 0)"),i=a.append("g").attr("class","donut").attr("transform","translate(250, 250)"),o=a.append("defs").attr("id","atlas-side-arrow-def").append("marker").attr("id","atlas-side-arrow").attr("viewBox",[0,0,10,10]).attr("refX",10).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke","gray").attr("fill","gray"),o=a.append("defs").attr("id","atlas-side-arrow-def-hover").append("marker").attr("id","atlas-side-arrow-hover").attr("viewBox",[0,0,10,10]).attr("refX",10).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke","hsl(24, 95%, 59%)").attr("fill","hsl(24, 95%, 59%)")}));return[r,s,(t,e)=>null!=l&&void 0!==l.has&&l.has([t,e].toString())?l.get([t,e].toString()):"black",function(t){A[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class Ul extends R{constructor(t){super(),O(this,t,Vl,Xl,i,{})}}function Gl(e){let n,r=e[0].html+"";return{c(){n=u("div"),g(n,"class","tooltip svelte-1q7x51h"),g(n,"style",e[2])},m(t,a){l(t,n,a),n.innerHTML=r,e[3](n)},p(t,[e]){1&e&&r!==(r=t[0].html+"")&&(n.innerHTML=r),4&e&&g(n,"style",t[2])},i:t,o:t,d(t){t&&s(n),e[3](null)}}}function Ql(t,e,n){let r,a={show:!1,html:"null",left:0,top:0,width:80,maxWidth:80,fontSize:"1em"},i=null;return et.subscribe((t=>{let e=Qe(i);t.show?(e.style("visibility","visible"),Qe(i).transition().duration(100).ease(Ea).style("opacity",1)):Qe(i).transition().delay(100).duration(200).ease(Ea).style("opacity",0).on("end",(function(){Qe(this).style("visibility","hidden")})),n(0,a=t)})),_((()=>{Qe(i).style("visibility","hidden"),et.set(a)})),t.$$.update=()=>{1&t.$$.dirty&&n(2,r=`left: ${a.left}px; top: ${a.top}px;\n    width: ${a.width}px; max-width: ${a.maxWidth}px;\n    font-size: ${a.fontSize}`)},[a,i,r,function(t){A[t?"unshift":"push"]((()=>{i=t,n(1,i)}))}]}class Kl extends R{constructor(t){super(),O(this,t,Ql,Gl,i,{})}}function Zl(e){let n,r,a,i,c,d,y,v,m,w,k,x,b,_;return{c(){n=u("div"),r=u("div"),a=u("div"),a.textContent="Attention Head Overview",i=p(),c=u("div"),d=u("div"),d.innerHTML='<div class="expand-button svelte-1gxmc0v"><div class="icon-wrapper svelte-1gxmc0v"><img src="/dodrio/figures/expand-outline.svg" alt="expanding icon" class="svelte-1gxmc0v"/></div>\n          Show Detail</div>',y=p(),v=u("div"),v.innerHTML='<img src="/dodrio/figures/color-legend.png" alt="expanding icon" class="svelte-1gxmc0v"/>',m=p(),w=u("div"),k=u("div"),x=h("svg"),g(a,"class","lower-atlas-label svelte-1gxmc0v"),g(d,"class","relation-container"),g(c,"class","select-row svelte-1gxmc0v"),g(v,"class","color-legend svelte-1gxmc0v"),g(r,"class","control-row svelte-1gxmc0v"),g(x,"class","atlas-svg"),g(k,"class","atlas-svg-container svelte-1gxmc0v"),g(w,"class","svg-container svelte-1gxmc0v"),g(n,"class","atlas-view svelte-1gxmc0v")},m(t,s){l(t,n,s),o(n,r),o(r,a),o(r,i),o(r,c),o(c,d),o(r,y),o(r,v),o(n,m),o(n,w),o(w,k),o(k,x),e[7](x),e[8](n),b||(_=f(d,"click",e[6]),b=!0)},p:t,i:t,o:t,d(t){t&&s(n),e[7](null),e[8](null),b=!1,_()}}}let Jl=1562;function ts(t,e,n){let{attentionDataDir:r}=e,{saliencyDataFilepath:a}=e,{atlasDataFilepath:i}=e,o=null,l=null,s=null,c=null,u=null,h=null;et.subscribe((t=>{h=t}));let d=null,p={layer:9,head:8},f=9,g=8,y=new Map;const v=er(23,85,56),m=er(328,85,56),w=er(274,85,56),k=$();let x=800,b=800,M=void 0;const N=40,E=10,T=10,D=3,S=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e,L=(t,e)=>Array(Math.max(e-String(t).length+1,0)).join(0)+t,z=()=>{const t=s.length,e=s[0].length;let r=x-35-E-T,a=b-N-D-17,i=Math.min(a,r);const c=Math.floor((a-8*(t-1))/t),u=c/2;let k=Math.floor((r-u-e*c)/(t-1)),_=Math.floor((a-t*c)/(t-1));n(0,o=Qe(o).attr("width",r+35).attr("height",a+17)),o.append("rect").attr("class","border-rect").attr("width",i).attr("height",i).style("stroke","black").style("fill","none");let $=o.append("g").attr("class","donut-group").attr("transform",`translate(${E+u+35},\n        ${u+17})`),M={hueScale:to().domain([-1,0,1]).range([v,m,w]),lightnessScale:to().domain([0,1]).range([130,40]),outRadiusScale:to().domain([0,1]).range([3,u]),ringRadiusScale:to().domain([0,1]).range([4,7])},A=$.selectAll("g.donut").data(l).join("g").attr("class","donut").style("cursor","pointer").attr("transform",(e=>`translate(${e.head*(2*u+k)},\n        ${(t-e.layer-1)*(2*u+_)})`));A.each(((t,e,n)=>H(t,e,n,M))),lt.set(y),A.on("mouseover",((t,e)=>{let n=t.currentTarget.getBoundingClientRect(),r=n.right-n.left,a=n.x+r/2,i=n.y-90;h.html=`\n        <div class='tooltip-tb' style='display: flex; flex-direction: column;\n          justify-content: center; font-weight: 800;'>\n          <div> Layer ${e.layer+1} Head ${e.head+1} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Semantic: ${S(e.semantic,2)} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Syntactic ${S(e.syntactic,2)} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Importance: ${S(e.confidence,2)} </div>\n        </div>\n        `,h.width=130,h.maxWidth=130,h.left=a-h.width/2,h.top=i,h.fontSize="0.8em",h.show=!0,et.set(h);let o=Qe(t.currentTarget);o.classed("selected")||o.select(".donut-rect").style("opacity",1)})).on("mouseleave",(t=>{h.show=!1,et.set(h);let e=Qe(t.currentTarget);e.classed("selected")||e.select(".donut-rect").style("opacity",0)})).on("click",(t=>{let e=Qe(t.currentTarget);if(e.classed("selected"));else{let t=Qe($.select(`#donut-rect-${f}-${g}`).node().parentNode);t.select(".donut-rect").style("fill","hsl(0, 0%, 80%)").style("opacity",0),t.classed("selected",!1),e.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),e.classed("selected",!0),f=+e.data()[0].layer,g=+e.data()[0].head,p.layer=f,p.head=g,ht.set(p)}})),$.selectAll("g.row-line-group").data(Array(t-1).fill(0).map(((t,e)=>e))).join("g").attr("class","row-line-group").append("path").attr("d",(n=>`M${-u}\n        ${(t-n-1-.5)*(2*u+_)}\n        L${e*(2*u+k)-u}\n        ${(t-n-1-.5)*(2*u+_)}`)).style("stroke","hsla(0, 0%, 0%, 0.1)"),o.append("g").attr("class","name-group").attr("transform",`translate(${E}, ${u+17})`).selectAll("g.layer-name-group").data(Array(t).fill(0).map(((t,e)=>e))).join("g").attr("class","layer-name-group").attr("transform",(e=>`translate(30,\n        ${(t-e-1)*(2*u+_)})`)).append("text").text((t=>t>0?t+1:"Layer "+(t+1))),o.append("g").attr("class","name-group").attr("transform",`translate(${E+35+u},\n        5)`).selectAll("g.head-name-group").data(Array(t).fill(0).map(((t,e)=>e))).join("g").attr("class","head-name-group").attr("transform",(t=>`translate(${t*(2*u+k)},\n        0)`)).append("text").text((t=>t>0?t+1:"Head "+(t+1))),Qe(d).select(".head-arrow").style("top","30px").style("left",r-170+"px"),Qe(d).select(".layer-arrow").style("top","70px").style("left",r+10+"px");let L=Qe($.select(`#donut-rect-${f}-${g}`).node().parentNode);L.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),L.classed("selected",!0)};ht.subscribe((t=>{if(p=t,p.layer!==f||p.head!==g){let t=o.select("g.donut-group"),e=Qe(t.select(`#donut-rect-${f}-${g}`).node().parentNode);e.select(".donut-rect").style("fill","hsl(0, 0%, 80%)").style("opacity",0),e.classed("selected",!1),f=p.layer,g=p.head;let n=Qe(t.select(`#donut-rect-${f}-${g}`).node().parentNode);n.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),n.classed("selected",!0)}}));const H=(t,e,n,r)=>{let a=Qe(n[e]),i=r.outRadiusScale(t.confidence),o=r.ringRadiusScale(t.confidence),l=Math.max(0,i-o),s=2*r.outRadiusScale.range()[1];a.append("rect").attr("class","donut-rect").attr("id",`donut-rect-${t.layer}-${t.head}`).attr("x",-s/2).attr("y",-s/2).attr("rx",5).attr("width",s).attr("height",s).style("fill","hsl(0, 0%, 80%)").style("opacity",0);let c=_o().outerRadius(i).innerRadius(0).startAngle(0).endAngle(2*Math.PI),h=er(r.hueScale(t.syntactic-t.semantic));h.l=r.lightnessScale(Math.max(t.semantic,t.syntactic)),y.set([t.layer,t.head].toString(),h.formatHex()),a.append("path").attr("class","donut-chart").attr("d",c).style("fill",h);let d=[];for(let e=0;e<u;e++){let n=-Math.PI/2+e*(2*Math.PI/u);d.push({x:Math.cos(n)*l,y:Math.sin(n)*l,token:t.token,id:e})}},j=async(t,e,n)=>{s=await Pa(t),l=await Pa(n),c=await Pa(e),c=c[1562],u=c.tokens.length};_((async()=>{null!=s&&null!=l&&null!=c||j(r+`attention-${L(Jl,4)}.json`,a,i)})),tt.subscribe((async t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===M||M.compHeight!==t.compHeight&&M.compWidth!==t.compWidth)&&(M=t,x=M.compWidth,b=M.compHeight,null==s||null==l||null==c?j(r+`attention-${L(Jl,4)}.json`,a,i).then(z):z())}));return t.$$set=t=>{"attentionDataDir"in t&&n(3,r=t.attentionDataDir),"saliencyDataFilepath"in t&&n(4,a=t.saliencyDataFilepath),"atlasDataFilepath"in t&&n(5,i=t.atlasDataFilepath)},[o,d,k,r,a,i,()=>k("open"),function(t){A[t?"unshift":"push"]((()=>{o=t,n(0,o)}))},function(t){A[t?"unshift":"push"]((()=>{d=t,n(1,d)}))}]}class es extends R{constructor(t){super(),O(this,t,ts,Zl,i,{attentionDataDir:3,saliencyDataFilepath:4,atlasDataFilepath:5})}}function ns(e){let n;return{c(){n=u("div"),g(n,"class","tooltip svelte-1tyk1ci"),g(n,"style",e[2])},m(t,r){l(t,n,r),n.innerHTML=e[0],e[9](n)},p(t,[e]){1&e&&(n.innerHTML=t[0]),4&e&&g(n,"style",t[2])},i:t,o:t,d(t){t&&s(n),e[9](null)}}}function rs(t,e,n){let r,{tooltipShow:a=!1}=e,{tooltipHtml:i="1.23"}=e,{left:o=0}=e,{top:l=0}=e,{width:s=80}=e,{maxWidth:c=80}=e,{fontSize:u="1em"}=e,h=null;return t.$$set=t=>{"tooltipShow"in t&&n(3,a=t.tooltipShow),"tooltipHtml"in t&&n(0,i=t.tooltipHtml),"left"in t&&n(4,o=t.left),"top"in t&&n(5,l=t.top),"width"in t&&n(6,s=t.width),"maxWidth"in t&&n(7,c=t.maxWidth),"fontSize"in t&&n(8,u=t.fontSize)},t.$$.update=()=>{496&t.$$.dirty&&n(2,r=`left: ${o}px; top: ${l}px; width: ${s}px; max-width: \n              ${c}px; font-size: ${u}`),10&t.$$.dirty&&function(){if(null===h)return;let t=Qe(h);a?(t.style("visibility","visible"),Qe(h).transition().duration(200).ease(Ea).style("opacity",1)):Qe(h).transition().duration(200).ease(Ea).style("opacity",0).on("end",(function(){Qe(this).style("visibility","hidden")}))}()},[i,h,r,a,o,l,s,c,u,function(t){A[t?"unshift":"push"]((()=>{h=t,n(1,h)}))}]}class as extends R{constructor(t){super(),O(this,t,rs,ns,i,{tooltipShow:3,tooltipHtml:0,left:4,top:5,width:6,maxWidth:7,fontSize:8})}}function is(t){let e,n,r,a,i,c,d={left:t[2],top:t[3],tooltipHtml:t[4],width:os,tooltipShow:t[5],fontSize:ss,maxWidth:ls};return r=new as({props:d}),t[7](r),{c(){e=u("div"),n=u("div"),P(r.$$.fragment),a=p(),i=h("svg"),g(i,"class","embedding-svg"),g(n,"class","svg-container"),g(e,"class","embedding-view")},m(s,u){l(s,e,u),o(e,n),C(r,n,null),o(n,a),o(n,i),t[8](i),c=!0},p(t,[e]){const n={};4&e&&(n.left=t[2]),8&e&&(n.top=t[3]),16&e&&(n.tooltipHtml=t[4]),32&e&&(n.tooltipShow=t[5]),r.$set(n)},i(t){c||(F(r.$$.fragment,t),c=!0)},o(t){I(r.$$.fragment,t),c=!1},d(n){n&&s(e),t[7](null),B(r),t[8](null)}}}let os=150,ls=200,ss="0.65em",cs="rgb(100, 149, 237)",us=.3;function hs(t,e,n){let{embeddingDataFilepath:r}=e,a=void 0,i=null,o=null,l=23,s=-1,c=null,u=null,h=null,d=0,p=0,f="tooltip",g=!1,y={0:"red",1:"skyblue"},v=["negative","positive"];const m=()=>{const t=function(){var t,e,n,r=Fo,a=Io,i=Wo,o=Co,l=Bo,s=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,h=Er,d=Lt("start","zoom","end"),p=500,f=0,g=10;function y(t){t.property("__zoom",Po).on("wheel.zoom",_).on("mousedown.zoom",$).on("dblclick.zoom",M).filter(l).on("touchstart.zoom",A).on("touchmove.zoom",N).on("touchend.zoom touchcancel.zoom",E).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(t,e){return(e=Math.max(s[0],Math.min(s[1],e)))===t.k?t:new zo(e,t.x,t.y)}function m(t,e,n){var r=e[0]-n[0]*t.k,a=e[1]-n[1]*t.k;return r===t.x&&a===t.y?t:new zo(t.k,r,a)}function w(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function k(t,e,n,r){t.on("start.zoom",(function(){x(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){x(this,arguments).event(r).end()})).tween("zoom",(function(){var t=this,i=arguments,o=x(t,i).event(r),l=a.apply(t,i),s=null==n?w(l):"function"==typeof n?n.apply(t,i):n,c=Math.max(l[1][0]-l[0][0],l[1][1]-l[0][1]),u=t.__zoom,d="function"==typeof e?e.apply(t,i):e,p=h(u.invert(s).concat(c/u.k),d.invert(s).concat(c/d.k));return function(t){if(1===t)t=d;else{var e=p(t),n=c/e[2];t=new zo(n,s[0]-e[0]*n,s[1]-e[1]*n)}o.zoom(null,t)}}))}function x(t,e,n){return!n&&t.__zooming||new b(t,e)}function b(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=a.apply(t,e),this.taps=0}function _(t,...e){if(r.apply(this,arguments)){var n=x(this,e).event(t),a=this.__zoom,l=Math.max(s[0],Math.min(s[1],a.k*Math.pow(2,o.apply(this,arguments)))),u=Ke(t);if(n.wheel)n.mouse[0][0]===u[0]&&n.mouse[0][1]===u[1]||(n.mouse[1]=a.invert(n.mouse[0]=u)),clearTimeout(n.wheel);else{if(a.k===l)return;n.mouse=[u,a.invert(u)],Kr(this),n.start()}qo(t),n.wheel=setTimeout(h,150),n.zoom("mouse",i(m(v(a,l),n.mouse[0],n.mouse[1]),n.extent,c))}function h(){n.wheel=null,n.end()}}function $(t,...e){if(!n&&r.apply(this,arguments)){var a=x(this,e,!0).event(t),o=Qe(t.view).on("mousemove.zoom",d,!0).on("mouseup.zoom",p,!0),l=Ke(t,s),s=t.currentTarget,u=t.clientX,h=t.clientY;en(t.view),jo(t),a.mouse=[l,this.__zoom.invert(l)],Kr(this),a.start()}function d(t){if(qo(t),!a.moved){var e=t.clientX-u,n=t.clientY-h;a.moved=e*e+n*n>f}a.event(t).zoom("mouse",i(m(a.that.__zoom,a.mouse[0]=Ke(t,s),a.mouse[1]),a.extent,c))}function p(t){o.on("mousemove.zoom mouseup.zoom",null),nn(t.view,a.moved),qo(t),a.event(t).end()}}function M(t,...e){if(r.apply(this,arguments)){var n=this.__zoom,o=Ke(t.changedTouches?t.changedTouches[0]:t,this),l=n.invert(o),s=n.k*(t.shiftKey?.5:2),h=i(m(v(n,s),o,l),a.apply(this,e),c);qo(t),u>0?Qe(this).transition().duration(u).call(k,h,o,t):Qe(this).call(y.transform,h,o,t)}}function A(n,...a){if(r.apply(this,arguments)){var i,o,l,s,c=n.touches,u=c.length,h=x(this,a,n.changedTouches.length===u).event(n);for(jo(n),o=0;o<u;++o)s=[s=Ke(l=c[o],this),this.__zoom.invert(s),l.identifier],h.touch0?h.touch1||h.touch0[2]===s[2]||(h.touch1=s,h.taps=0):(h.touch0=s,i=!0,h.taps=1+!!t);t&&(t=clearTimeout(t)),i&&(h.taps<2&&(e=s[0],t=setTimeout((function(){t=null}),p)),Kr(this),h.start())}}function N(t,...e){if(this.__zooming){var n,r,a,o,l=x(this,e).event(t),s=t.changedTouches,u=s.length;for(qo(t),n=0;n<u;++n)a=Ke(r=s[n],this),l.touch0&&l.touch0[2]===r.identifier?l.touch0[0]=a:l.touch1&&l.touch1[2]===r.identifier&&(l.touch1[0]=a);if(r=l.that.__zoom,l.touch1){var h=l.touch0[0],d=l.touch0[1],p=l.touch1[0],f=l.touch1[1],g=(g=p[0]-h[0])*g+(g=p[1]-h[1])*g,y=(y=f[0]-d[0])*y+(y=f[1]-d[1])*y;r=v(r,Math.sqrt(g/y)),a=[(h[0]+p[0])/2,(h[1]+p[1])/2],o=[(d[0]+f[0])/2,(d[1]+f[1])/2]}else{if(!l.touch0)return;a=l.touch0[0],o=l.touch0[1]}l.zoom("touch",i(m(r,a,o),l.extent,c))}}function E(t,...r){if(this.__zooming){var a,i,o=x(this,r).event(t),l=t.changedTouches,s=l.length;for(jo(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),p),a=0;a<s;++a)i=l[a],o.touch0&&o.touch0[2]===i.identifier?delete o.touch0:o.touch1&&o.touch1[2]===i.identifier&&delete o.touch1;if(o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0)o.touch0[1]=this.__zoom.invert(o.touch0[0]);else if(o.end(),2===o.taps&&(i=Ke(i,this),Math.hypot(e[0]-i[0],e[1]-i[1])<g)){var c=Qe(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return y.transform=function(t,e,n,r){var a=t.selection?t.selection():t;a.property("__zoom",Po),t!==a?k(t,e,n,r):a.interrupt().each((function(){x(this,arguments).event(r).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},y.scaleBy=function(t,e,n,r){y.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}),n,r)},y.scaleTo=function(t,e,n,r){y.transform(t,(function(){var t=a.apply(this,arguments),r=this.__zoom,o=null==n?w(t):"function"==typeof n?n.apply(this,arguments):n,l=r.invert(o),s="function"==typeof e?e.apply(this,arguments):e;return i(m(v(r,s),o,l),t,c)}),n,r)},y.translateBy=function(t,e,n,r){y.transform(t,(function(){return i(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),a.apply(this,arguments),c)}),null,r)},y.translateTo=function(t,e,n,r,o){y.transform(t,(function(){var t=a.apply(this,arguments),o=this.__zoom,l=null==r?w(t):"function"==typeof r?r.apply(this,arguments):r;return i(Ho.translate(l[0],l[1]).scale(o.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,c)}),r,o)},b.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=Qe(this.that).datum();d.call(t,this.that,new Lo(t,{sourceEvent:this.sourceEvent,target:y,type:t,transform:this.that.__zoom,dispatch:d}),e)}},y.wheelDelta=function(t){return arguments.length?(o="function"==typeof t?t:So(+t),y):o},y.filter=function(t){return arguments.length?(r="function"==typeof t?t:So(!!t),y):r},y.touchable=function(t){return arguments.length?(l="function"==typeof t?t:So(!!t),y):l},y.extent=function(t){return arguments.length?(a="function"==typeof t?t:So([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),y):a},y.scaleExtent=function(t){return arguments.length?(s[0]=+t[0],s[1]=+t[1],y):[s[0],s[1]]},y.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],y):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},y.constrain=function(t){return arguments.length?(i=t,y):i},y.duration=function(t){return arguments.length?(u=+t,y):u},y.interpolate=function(t){return arguments.length?(h=t,y):h},y.on=function(){var t=d.on.apply(d,arguments);return t===d?y:t},y.clickDistance=function(t){return arguments.length?(f=(t=+t)*t,y):Math.sqrt(f)},y.tapDistance=function(t){return arguments.length?(g=+t,y):g},y}().on("zoom",(t=>{e.select("g").attr("transform",t.transform)})).scaleExtent([.5,10]);let e=Qe(i).attr("width",c).attr("height",u).attr("viewBox",[0,0,c,u]).style("fill","#eee").call(t),r=to().domain([Math.min(...o.map((({coords:t})=>t[0]))),Math.max(...o.map((({coords:t})=>t[0])))]).range([0,c]),a=to().domain([Math.min(...o.map((({coords:t})=>t[1]))),Math.max(...o.map((({coords:t})=>t[1])))]).range([u,0]);e.append("g").selectAll("dot").data(o).enter().append("circle").attr("id",(function(t){return"circle-"+t.id})).attr("cx",(function(t){return r(t.coords[0])})).attr("cy",(function(t){return a(t.coords[1])})).attr("r",(function(t){return t.id==l?7:5})).style("fill",(function(t){return y[t.label]})).style("opacity",(function(t){return t.id==l?1:us})).style("stroke",(function(t){return t.id==l?cs:"white"})).style("stroke-width","2px").on("click",w).on("mouseover",(function(t,e){!function(t,e){let r=t.currentTarget.getBoundingClientRect(),a=r.right-r.left,i=r.x+a/2,o=r.y-40+window.scrollY;n(5,g=!0),n(4,f=e.sentence.substring(0,40)+"..."),n(2,d=i-os/2),n(3,p=o)}(t,e),function(t){Qe(i).selectAll("circle").filter((function(){return this.id!="circle-"+l&&this.id!="circle-"+t.id})).style("opacity",.2),t.id!=l&&(Qe(i).select("#circle-"+t.id).attr("r",7).style("opacity",1),Qe(i).select("#circle-"+t.id).raise())}(e)})).on("mouseleave",(function(t,e){n(5,g=!1),function(t){Qe(i).selectAll("circle").filter((function(){return this.id!="circle-"+l&&this.id!="circle-"+t.id})).style("opacity",us),t.id!=l&&Qe(i).select("#circle-"+t.id).attr("r",5).style("opacity",us)}(e)})),e.select("#circle-"+l).raise();let s=[...o.map((({label:t})=>t))].filter(((t,e,n)=>n.indexOf(t)===e)),h=12,m=e.selectAll(".legend").data(s).enter().append("g").attr("class","legend").attr("transform",(function(t,e){return"translate(0,"+14*e+")"}));m.append("rect").attr("x",c-100).attr("y",u-h*(s.length+1)).attr("width",h).attr("height",h).style("fill",(function(t){return y[t]})),m.append("text").attr("x",c-95+h).attr("y",u-h*s.length).style("text-anchor","start").style("dominant-baseline","text-after-edge").style("fill","black").style("font-size","0.7em").text((function(t){return t+" ("+v[t]+")"}))};function w(t,e){Qe(i).select("#circle-"+l).attr("r",5).style("opacity",us).style("stroke","white"),rt.set(e.id),Qe(this).attr("r",7).style("opacity",1).style("stroke",cs).raise()}const k=async()=>{o=await Pa(r),m()};return Q.subscribe((t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===a||a.compHeight!==t.compHeight&&a.compWidth!==t.compWidth)&&(a=t,c=a.compWidth,u=a.compHeight,c=300,u=300,k())})),_((()=>{c=350,u=300,k()})),rt.subscribe((t=>{n(11,l=t)})),t.$$set=t=>{"embeddingDataFilepath"in t&&n(6,r=t.embeddingDataFilepath)},t.$$.update=()=>{6145&t.$$.dirty&&(Qe(i).select("#circle-"+s).attr("r",5).style("opacity",us).style("stroke","white"),Qe(i).select("#circle-"+l).attr("r",7).style("opacity",1).style("stroke",cs).raise(),n(12,s=l))},[i,h,d,p,f,g,r,function(t){A[t?"unshift":"push"]((()=>{h=t,n(1,h)}))},function(t){A[t?"unshift":"push"]((()=>{i=t,n(0,i)}))}]}class ds extends R{constructor(t){super(),O(this,t,hs,is,i,{embeddingDataFilepath:6})}}function ps(t,e,n){const r=t.slice();return r[11]=e[n],r}function fs(t){let e,n,r,i,c,h,y,w,k,x,b,_,$,M,A,N,E,T,D=t[11].id+"",S=t[11].sentence+"",L=t[11].true_label+"",z=t[11].predicted_label+"",H=Number(t[11].logit_distance.toFixed(2))+"";return{c(){e=u("tr"),n=u("td"),r=d(D),i=p(),c=u("td"),h=d(S),y=p(),w=u("td"),k=d(L),x=p(),b=u("td"),_=d(z),$=p(),M=u("td"),A=d(H),N=p(),m(n,"display","none"),g(n,"class","svelte-iuu5ve"),g(c,"class","text-row svelte-iuu5ve"),g(w,"class","number-row svelte-iuu5ve"),g(b,"class","number-row svelte-iuu5ve"),g(M,"class","number-row svelte-iuu5ve"),g(e,"class","svelte-iuu5ve")},m(s,u){l(s,e,u),o(e,n),o(n,r),o(e,i),o(e,c),o(c,h),o(e,y),o(e,w),o(w,k),o(e,x),o(e,b),o(b,_),o(e,$),o(e,M),o(M,A),o(e,N),E||(T=f(e,"click",(function(){a(t[3](this))&&t[3](this).apply(this,arguments)})),E=!0)},p(e,n){t=e,1&n&&D!==(D=t[11].id+"")&&v(r,D),1&n&&S!==(S=t[11].sentence+"")&&v(h,S),1&n&&L!==(L=t[11].true_label+"")&&v(k,L),1&n&&z!==(z=t[11].predicted_label+"")&&v(_,z),1&n&&H!==(H=Number(t[11].logit_distance.toFixed(2))+"")&&v(A,H)},d(t){t&&s(e),E=!1,T()}}}function gs(e){let n,i,h,y,v,k,x,b,_,$,M,A,N,E,T,D,S,L,z,H,j,q,F,I,P,C,B,W,O,R,X,Y,V,U=e[0],G=[];for(let t=0;t<U.length;t+=1)G[t]=fs(ps(e,U,t));return{c(){n=u("div"),i=u("table"),h=u("thead"),y=u("tr"),v=u("th"),v.textContent="id",k=p(),x=u("th"),b=u("div"),_=d("Sentence\n            "),$=u("img"),A=p(),N=u("th"),E=u("div"),T=d("True\n            "),D=u("img"),L=p(),z=u("th"),H=u("div"),j=d("Predicted\n            "),q=u("img"),I=p(),P=u("th"),C=u("div"),B=d("Error\n            "),W=u("img"),R=p(),X=u("tbody");for(let t=0;t<G.length;t+=1)G[t].c();m(v,"display","none"),g(v,"class","svelte-iuu5ve"),$.src!==(M=e[1].sentence.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g($,"src",M),g($,"alt","sort logo"),g($,"class","svelte-iuu5ve"),w($,"selected",e[1].sentence.selected),g(b,"class","sentence-div svelte-iuu5ve"),g(x,"class","sentence svelte-iuu5ve"),D.src!==(S=e[1].true_label.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(D,"src",S),g(D,"alt","sort logo"),g(D,"class","svelte-iuu5ve"),w(D,"selected",e[1].true_label.selected),g(E,"class","true-div svelte-iuu5ve"),g(N,"class","true svelte-iuu5ve"),q.src!==(F=e[1].predicted_label.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(q,"src",F),g(q,"alt","sort logo"),g(q,"class","svelte-iuu5ve"),w(q,"selected",e[1].predicted_label.selected),g(H,"class","predicted-div svelte-iuu5ve"),g(z,"class","predicted svelte-iuu5ve"),W.src!==(O=e[1].logit_distance.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(W,"src",O),g(W,"alt","sort logo"),g(W,"class","svelte-iuu5ve"),w(W,"selected",e[1].logit_distance.selected),g(C,"class","error-div svelte-iuu5ve"),g(P,"class","error svelte-iuu5ve"),g(y,"class","svelte-iuu5ve"),g(i,"class","svelte-iuu5ve"),g(n,"class","table-view")},m(t,r){l(t,n,r),o(n,i),o(i,h),o(h,y),o(y,v),o(y,k),o(y,x),o(x,b),o(b,_),o(b,$),o(y,A),o(y,N),o(N,E),o(E,T),o(E,D),o(y,L),o(y,z),o(z,H),o(H,j),o(H,q),o(y,I),o(y,P),o(P,C),o(C,B),o(C,W),o(i,R),o(i,X);for(let t=0;t<G.length;t+=1)G[t].m(X,null);Y||(V=[f(v,"click",(function(){a(e[2]("id"))&&e[2]("id").apply(this,arguments)})),f(x,"click",(function(){a(e[2]("sentence"))&&e[2]("sentence").apply(this,arguments)})),f(N,"click",(function(){a(e[2]("true_label"))&&e[2]("true_label").apply(this,arguments)})),f(z,"click",(function(){a(e[2]("predicted_label"))&&e[2]("predicted_label").apply(this,arguments)})),f(P,"click",(function(){a(e[2]("logit_distance"))&&e[2]("logit_distance").apply(this,arguments)}))],Y=!0)},p(t,[n]){if(e=t,2&n&&$.src!==(M=e[1].sentence.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g($,"src",M),2&n&&w($,"selected",e[1].sentence.selected),2&n&&D.src!==(S=e[1].true_label.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(D,"src",S),2&n&&w(D,"selected",e[1].true_label.selected),2&n&&q.src!==(F=e[1].predicted_label.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(q,"src",F),2&n&&w(q,"selected",e[1].predicted_label.selected),2&n&&W.src!==(O=e[1].logit_distance.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(W,"src",O),2&n&&w(W,"selected",e[1].logit_distance.selected),9&n){let t;for(U=e[0],t=0;t<U.length;t+=1){const r=ps(e,U,t);G[t]?G[t].p(r,n):(G[t]=fs(r),G[t].c(),G[t].m(X,null))}for(;t<G.length;t+=1)G[t].d(1);G.length=U.length}},i:t,o:t,d(t){t&&s(n),c(G,t),Y=!1,r(V)}}}let ys="hsla(0, 0%, 0%, 0.1)";function vs(t,e,n){let r,a,{tableDataFilepath:i}=e,o=void 0,l=[],s=23,c=0,u="true_label",h=!1,d={sentence:{selected:!1,up:!1},true_label:{selected:!1,up:!1},predicted_label:{selected:!1,up:!1},logit_distance:{selected:!1,up:!1}},p={col:"id",ascending:!0};return K.subscribe((t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===o||o.compHeight!==t.compHeight&&o.compWidth!==t.compWidth)&&(o=t)})),rt.subscribe((t=>{n(6,s=t)})),_((async()=>{n(0,l=await Pa(i))})),t.$$set=t=>{"tableDataFilepath"in t&&n(4,i=t.tableDataFilepath)},t.$$.update=()=>{1219&t.$$.dirty&&n(2,r=t=>{n(8,u=t),p.col==t?(n(10,p.ascending=!p.ascending,p),n(1,d[t].up=p.ascending,d),n(1,d),n(10,p),n(0,l),n(6,s),n(7,c)):(void 0!==d[p.col]&&n(1,d[p.col].selected=!1,d),n(10,p.col=t,p),n(10,p.ascending=!0,p),n(1,d[t].selected=!0,d),n(1,d[t].up=!0,d),n(1,d),n(10,p),n(0,l),n(6,s),n(7,c));let e=p.ascending?1:-1;n(0,l=l.sort(((n,r)=>n[t]<r[t]?-1*e:n[t]>r[t]?1*e:0))),l.forEach((function(t,e){t.id==s&&(l.splice(e,1),l.unshift(t))})),document.getElementsByTagName("table")[0].children[1].children[c].style="background-color: inherit;",document.getElementsByTagName("table")[0].children[1].children[0].style="background-color: "+ys,n(7,c=0),n(9,h=!1)}),128&t.$$.dirty&&n(3,a=t=>{rt.set(t.cells[0].innerText),n(9,h=!1),document.getElementsByTagName("table")[0].children[1].children[c].style="background-color: inherit;",t.style="background-color: "+ys,n(7,c=t.rowIndex-1)}),964&t.$$.dirty&&(document.getElementsByTagName("table")[0]&&document.getElementsByTagName("table")[0].children[1].children[c]&&h&&r(u),n(9,h=!0))},[l,d,r,a,i]}class ms extends R{constructor(t){super(),O(this,t,vs,gs,i,{tableDataFilepath:4})}}function ws(t){let e,n,a,i,c,h,d,y,v,m,k,x,b,_,$,M,A,N,E,T,D,S,L,z,H,j,q;return b=new ms({props:{tableDataFilepath:t[0]}}),z=new ds({props:{embeddingDataFilepath:t[1]}}),{c(){e=u("div"),n=u("div"),a=u("div"),i=p(),c=u("div"),h=u("div"),d=u("header"),y=u("p"),y.textContent="Select Input Sentence",v=p(),m=u("button"),k=p(),x=u("section"),P(b.$$.fragment),_=p(),$=u("footer"),M=u("div"),A=u("button"),A.textContent="Cancel",N=p(),E=u("button"),E.textContent="Add",T=p(),D=u("div"),S=u("header"),S.innerHTML='<p class="modal-card-title center svelte-14c981o">Instance Embedding</p>',L=p(),P(z.$$.fragment),g(a,"class","modal-background"),g(y,"class","modal-card-title svelte-14c981o"),g(m,"class","delete"),g(m,"aria-label","close"),g(d,"class","modal-card-head svelte-14c981o"),g(x,"class","modal-card-body svelte-14c981o"),g(A,"class","button is-smaller svelte-14c981o"),g(E,"class","button is-success is-smaller svelte-14c981o"),g(M,"class","button-container"),g($,"class","modal-card-foot svelte-14c981o"),g(h,"class","modal-card svelte-14c981o"),g(S,"class","modal-card-head svelte-14c981o"),g(D,"class","embedding-div svelte-14c981o"),g(c,"class","modal-container svelte-14c981o"),g(n,"class","modal"),g(n,"id","input-modal"),w(n,"is-active",t[3].show),g(e,"class","modal-component")},m(r,s){l(r,e,s),o(e,n),o(n,a),o(n,i),o(n,c),o(c,h),o(h,d),o(d,y),o(d,v),o(d,m),o(h,k),o(h,x),C(b,x,null),o(h,_),o(h,$),o($,M),o(M,A),o(M,N),o(M,E),o(c,T),o(c,D),o(D,S),o(D,L),C(z,D,null),t[6](e),H=!0,j||(q=[f(a,"click",t[4]),f(m,"click",t[4]),f(A,"click",t[4]),f(E,"click",t[5])],j=!0)},p(t,[e]){const r={};1&e&&(r.tableDataFilepath=t[0]),b.$set(r);const a={};2&e&&(a.embeddingDataFilepath=t[1]),z.$set(a),8&e&&w(n,"is-active",t[3].show)},i(t){H||(F(b.$$.fragment,t),F(z.$$.fragment,t),H=!0)},o(t){I(b.$$.fragment,t),I(z.$$.fragment,t),H=!1},d(n){n&&s(e),B(b),B(z),t[6](null),j=!1,r(q)}}}function ks(t,e,n){let r,{tableDataFilepath:a}=e,{embeddingDataFilepath:i}=e;const o=$();let l={show:!1},s=null;rt.subscribe((t=>{s=t})),ct.set(l),ct.subscribe((t=>{n(3,l=t)}));return _((()=>{})),t.$$set=t=>{"tableDataFilepath"in t&&n(0,a=t.tableDataFilepath),"embeddingDataFilepath"in t&&n(1,i=t.embeddingDataFilepath)},[a,i,r,l,()=>{n(3,l.show=!1,l),ct.set(l),o("xClicked",{preImage:l.preImage})},()=>{n(3,l.show=!1,l),at.set(s),o("xClicked",{preImage:l.preImage})},function(t){A[t?"unshift":"push"]((()=>{r=t,n(2,r)}))}]}class xs extends R{constructor(t){super(),O(this,t,ks,ws,i,{tableDataFilepath:0,embeddingDataFilepath:1})}}function bs(e){let n;return{c(){n=u("div"),g(n,"id",e[0])},m(t,e){l(t,n,e)},p(t,[e]){1&e&&g(n,"id",t[0])},i:t,o:t,d(t){t&&s(n)}}}var _s=document.createElement("script");_s.src="https://www.youtube.com/iframe_api";var $s=document.getElementsByTagName("script")[0];function Ms(t,e,n){let r,{videoId:a}=e,{playerId:i="player"}=e;$();function o(t){r.mute()}return window.addEventListener("iframeApiReady",(function(t){r=new YT.Player(i,{videoId:a,events:{onReady:o}})})),t.$$set=t=>{"videoId"in t&&n(1,a=t.videoId),"playerId"in t&&n(0,i=t.playerId)},[i,a,function(t=0){r.seekTo(t),r.playVideo()}]}$s.parentNode.insertBefore(_s,$s),window.onYouTubeIframeAPIReady=()=>window.dispatchEvent(new Event("iframeApiReady"));class As extends R{constructor(t){super(),O(this,t,Ms,bs,i,{videoId:1,playerId:0,play:2})}get play(){return this.$$.ctx[2]}}function Ns(t){let e,n,i,c,h,d,y,v,m,w,k,x,b,_,$,M,A,N,E,T,D,S,L,z,H,j,q,W,O,R,X,Y,V,U,G,Q,K,Z,J,tt,et,nt,rt,at,it,ot,lt,st;return G=new As({props:{videoId:"qB-T9j7UTgE",playerId:"demo_video"}}),t[1](G),{c(){e=u("body"),n=u("div"),i=u("h2"),i.innerHTML='What is <span class="dodrio-text svelte-16cr2hk"><img class="icon is-rounded svelte-16cr2hk" src="/dodrio/figures/dodrio-logo.svg" style="height: 30px; width: 30px;" alt="Dodrio logo"/> Dodrio</span>?',c=p(),h=u("p"),h.innerHTML='<a href="https://arxiv.org/pdf/1706.03762.pdf" title="Attention Is All You Need" class="svelte-16cr2hk">Transformers</a>\n      are sequence transduction models that excel at modeling long-term dependencies\n      with non-sequential processing. These attributes have made Transformers pervasive\n      in the NLP domain as natural language tasks benefit from the multi-headed attention\n      mechanism to more effectively model longer text, and non-sequential computations\n      no longer inhibit parallelization. Transformers now replace\n      <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.676.4320&amp;rep=rep1&amp;type=pdf" title="Long Short-Term Memory" class="svelte-16cr2hk">LSTMs</a>\n      as the state-of-the-art model architecture for\n      <a href="https://www.aclweb.org/anthology/W18-5446.pdf" title="GLUE NLP Benchmarks" class="svelte-16cr2hk">NLP tasks</a>.',d=p(),y=u("p"),y.innerHTML='We present <span class="dodrio-text svelte-16cr2hk">Dodrio</span>, an interactive\n      visualization tool to help NLP researchers and practitioners analyze and\n      compare attention mechanisms with linguistic knowledge.',v=p(),m=u("h2"),m.innerHTML='Why is <span class="dodrio-text svelte-16cr2hk">Dodrio</span> useful?',w=p(),k=u("p"),k.innerHTML='In a large, pre-trained, high-performing model like <a href="https://www.aclweb.org/anthology/N19-1423.pdf" title="BERT" class="svelte-16cr2hk">BERT</a>, there are 12 layers each with 12 distinct self-attention heads.\n      Attention heads in Transformers are comprised of weights incurred from\n      tokens when calculating the next representation of the current token.\n      These attention weights then make up an attention map at every attention\n      head (a detailed explanation of this matrix calculation is available\n      <a href="http://jalammar.github.io/illustrated-transformer/" title="Self-attention Calculation" class="svelte-16cr2hk">here</a>). As every token in a sentence attends to every other token, we have 12\n      × 12 × number of tokens × number of tokens attention\n      weights in BERT per text instance! In addition, researchers find some\n      attention heads are correlated to linguistic knowledge such as word\n      semantics and text syntactic dependencies. Therefore, to more easily\n      analyze attention weights, researchers need (1) <em>abstractions</em> and\n      (2) <em>linguistic knowledge contexts</em>.',x=p(),b=u("p"),b.innerHTML='<span class="dodrio-text svelte-16cr2hk">Dodrio</span> addresses the challenges of\n      interpreting attention weights through an interactive visualization system\n      that provides <em>attention head summarization</em> and\n      <em>semantic and syntractic knowledge contexts</em>. By identifying the\n      linguistic properties that an attention head attends to in the\n      <em>Attention Head Overview</em>\n      (bottom right), you can click the attention head to explore the semantic\n      and syntactic significance of the sentence at the selected attention head.\n      If you are interested in the lexical dependencies in a sentence, you can\n      explore a syntactically important head in the <em>Dependency View</em> and\n      accompanying <em>Comparison View</em> (top), while semantically important\n      heads can be investigated in the <em>Semantic Attention Graph</em> view\n      (bottom left). We encourage you to further investigate the multi-headed\n      attention mechanism across various text instances with interesting\n      linguistic features (eg. coreferences, word sense, etc.) in the\n      <em>Instance Selection View</em>\n      by clicking the\n      <img class="icon is-rounded svelte-16cr2hk" src="/dodrio/figures/edit.svg" alt="edit icon"/> icon in the toolbar at the top of the interface.',_=p(),$=u("h2"),$.textContent="Interactive features",M=p(),A=u("ol"),A.innerHTML='<li class="svelte-16cr2hk"><strong>Explore sentences with interesting lexical features</strong> by\n        changing the active instance being visualized\n        <img class="icon is-rounded svelte-16cr2hk" src="/dodrio/figures/edit.svg" alt="edit sentence icon"/> to understand how a Transformer attends to tokens in a sentence when solving\n        language tasks.</li> \n      <li class="svelte-16cr2hk"><strong>Open the expanded <em>Attention Head Overview</em></strong> by\n        clicking the\n        <img class="is-rounded svelte-16cr2hk" style="height: 26px;" src="/dodrio/figures/article-overview-detail.png" alt="detail icon"/> button to see an detailed overview of attention heads.</li> \n      <li class="svelte-16cr2hk"><strong>Edit the <em>Semantic Attention Graph</em> visualization parameters</strong>\n        to more easily identify strong attention weights and customize the graph\n        representation by adjusting the parameters in\n        <i class="fas fa-sliders-h"></i>.</li> \n      <li class="svelte-16cr2hk"><strong>Filter dependency relations</strong> visualized by selecting the\n        <img class="is-rounded svelte-16cr2hk" style="height: 26px;" src="/dodrio/figures/article-syntactic-rel-selection.png" alt="filter relations icon"/> icon in the upper toolbar.</li>',N=p(),E=u("h2"),E.textContent="Video Tutorial",T=p(),D=u("ul"),S=u("li"),S.innerHTML='Dodrio Introduction\n        <small class="svelte-16cr2hk">(0:00-0:08)</small>',L=p(),z=u("li"),z.innerHTML='<em>Attention Head Overview</em> \n        <small class="svelte-16cr2hk">(0:08-0:36)</small>',H=p(),j=u("li"),j.innerHTML='<em>Semantic Attention Graph</em> \n        <small class="svelte-16cr2hk">(0:36-1:19)</small>',q=p(),W=u("li"),W.innerHTML='<em>Dependency View</em> and <em>Dependency Comparison View</em> \n        <small class="svelte-16cr2hk">(1:19-1:49)</small>',O=p(),R=u("li"),R.innerHTML='<em>Instance Selection View</em> \n        <small class="svelte-16cr2hk">(1:49-1:53)</small>',X=p(),Y=u("li"),Y.innerHTML='Credits\n        <small class="svelte-16cr2hk">(1:57-1:59)</small>',V=p(),U=u("div"),P(G.$$.fragment),Q=p(),K=u("h2"),K.innerHTML='How is <span class="dodrio-text svelte-16cr2hk">Dodrio</span> implemented?',Z=p(),J=u("p"),J.innerHTML='<span class="dodrio-text svelte-16cr2hk">Dodrio</span> visualizes Transformer data\n      generated offline as detailed\n      <a href="https://github.com/poloclub/dodrio/tree/master/data-generation" class="svelte-16cr2hk">here</a>. Try visualizing your own model/dataset! The entire interactive system\n      is written in Javascript using\n      <a href="https://svelte.dev/" class="svelte-16cr2hk"><em>Svelte</em></a>\n      framework and <a href="https://d3js.org/" class="svelte-16cr2hk"><em>D3.js</em></a> for\n      visualizations. You only need a web browser to start exploring the\n      attention mechanism in complex Transformers today!\n\n      <span class="dodrio-text svelte-16cr2hk">Dodrio</span> is an\n      <a href="https://github.com/poloclub/dodrio" class="svelte-16cr2hk">open-source project</a>; if\n      you have any questions, feel free to open an issue\n      <a href="https://github.com/poloclub/dodrio/issues" class="svelte-16cr2hk">here</a>. To learn\n      more about <span class="dodrio-text svelte-16cr2hk">Dodrio</span>, please check out our\n      pre-print paper\n      <a href="https://arxiv.org/abs/2103.14625" class="svelte-16cr2hk">&quot;Dodrio: Exploring Transformer Models with Interactive Visualization.&quot;</a>',tt=p(),et=u("div"),et.innerHTML='<div class="paper-image svelte-16cr2hk"><a href="https://arxiv.org/abs/2103.14625" class="svelte-16cr2hk"><img src="https://i.imgur.com/PE4GN50.png" alt="paper" class="svelte-16cr2hk"/></a></div> \n\n      <div class="paper-info svelte-16cr2hk"><div class="paper-info__title svelte-16cr2hk"><a href="https://arxiv.org/abs/2103.14625" class="svelte-16cr2hk">Dodrio: Exploring Transformer Models with Interactive Visualization</a></div> \n        <div class="paper-info__author svelte-16cr2hk"><a href="https://zijie.wang/" class="svelte-16cr2hk">Zijie J. Wang</a>,\n          <a href="https://www.linkedin.com/in/robert-turko/" class="svelte-16cr2hk">Robert Turko</a>,\n          and\n          <a href="https://www.cc.gatech.edu/~dchau/" class="svelte-16cr2hk">Duen Horng (Polo) Chau</a>.</div> \n        <div class="paper-info__venue svelte-16cr2hk"><em>arXiv preprint arXiv:2103.14625. 2021.</em></div></div>',nt=p(),rt=u("h2"),rt.innerHTML='Who developed <span class="dodrio-text svelte-16cr2hk">Dodrio</span>?',at=p(),it=u("p"),it.innerHTML='<span class="dodrio-text svelte-16cr2hk">Dodrio</span> was created by\n      <a href="https://zijie.wang/" class="svelte-16cr2hk">Jay Wang</a>,\n      <a href="https://www.linkedin.com/in/robert-turko/" class="svelte-16cr2hk">Robert Turko</a>, and\n      <a href="https://www.cc.gatech.edu/~dchau/" class="svelte-16cr2hk">Polo Chau</a> in the College of\n      Computing at Georgia Tech. This work was supported in part by NSF grants IIS-1563816,\n      CNS-1704701, NASA NSTRF, DARPA GARD, gifts from Bosch, Intel, NVIDIA, Google,\n      Amazon.',g(i,"class","svelte-16cr2hk"),g(h,"class","svelte-16cr2hk"),g(y,"class","svelte-16cr2hk"),g(m,"class","svelte-16cr2hk"),g(k,"class","svelte-16cr2hk"),g(b,"class","svelte-16cr2hk"),g($,"class","svelte-16cr2hk"),g(A,"class","svelte-16cr2hk"),g(E,"class","svelte-16cr2hk"),g(S,"class","video-link svelte-16cr2hk"),g(z,"class","video-link svelte-16cr2hk"),g(j,"class","video-link svelte-16cr2hk"),g(W,"class","video-link svelte-16cr2hk"),g(R,"class","video-link svelte-16cr2hk"),g(Y,"class","video-link svelte-16cr2hk"),g(D,"class","svelte-16cr2hk"),g(U,"class","video svelte-16cr2hk"),g(K,"class","svelte-16cr2hk"),g(J,"class","svelte-16cr2hk"),g(et,"class","paper svelte-16cr2hk"),g(rt,"class","svelte-16cr2hk"),g(it,"class","svelte-16cr2hk"),g(n,"id","description"),g(n,"class","svelte-16cr2hk")},m(r,s){l(r,e,s),o(e,n),o(n,i),o(n,c),o(n,h),o(n,d),o(n,y),o(n,v),o(n,m),o(n,w),o(n,k),o(n,x),o(n,b),o(n,_),o(n,$),o(n,M),o(n,A),o(n,N),o(n,E),o(n,T),o(n,D),o(D,S),o(D,L),o(D,z),o(D,H),o(D,j),o(D,q),o(D,W),o(D,O),o(D,R),o(D,X),o(D,Y),o(n,V),o(n,U),C(G,U,null),o(n,Q),o(n,K),o(n,Z),o(n,J),o(n,tt),o(n,et),o(n,nt),o(n,rt),o(n,at),o(n,it),ot=!0,lt||(st=[f(S,"click",(function(){a(t[0].play(0))&&t[0].play(0).apply(this,arguments)})),f(z,"click",(function(){a(t[0].play(8))&&t[0].play(8).apply(this,arguments)})),f(j,"click",(function(){a(t[0].play(36))&&t[0].play(36).apply(this,arguments)})),f(W,"click",(function(){a(t[0].play(79))&&t[0].play(79).apply(this,arguments)})),f(R,"click",(function(){a(t[0].play(109))&&t[0].play(109).apply(this,arguments)})),f(Y,"click",(function(){a(t[0].play(117))&&t[0].play(117).apply(this,arguments)}))],lt=!0)},p(e,[n]){t=e;G.$set({})},i(t){ot||(F(G.$$.fragment,t),ot=!0)},o(t){I(G.$$.fragment,t),ot=!1},d(n){n&&s(e),t[1](null),B(G),lt=!1,r(st)}}}function Es(t,e,n){let r;return[r,function(t){A[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class Ts extends R{constructor(t){super(),O(this,t,Es,Ns,i,{})}}function Ds(t){let e,n,r,a,i,c,d,y,v,m,k,x,b,_,$,M,A,N,E,T,D,S,L,z,H,j,q,W,O,R,X,V,U,G,Q,K,Z;r=new Y({});return i=new Kl({props:{}}),t[14](i),x=new Bl({props:{dependencyDataFilepath:Ls,saliencyDataFilepath:qs,attentionDataDir:Ss,syntacticHeadDataFilepath:zs,semanticHeadDataFilepath:Hs,importantHeadDataFilepath:js}}),x.$on("close",t[13]),x.$on("open",t[12]),M=new nl({props:{attentionDataDir:Ss,saliencyDataFilepath:qs}}),E=new es({props:{attentionDataDir:Ss,saliencyDataFilepath:qs,atlasDataFilepath:Fs}}),E.$on("open",t[9]),S=new Rl({props:{attentionDataDir:Ss,saliencyDataFilepath:qs,atlasDataFilepath:Fs}}),S.$on("close",t[10]),H=new Ul({}),q=new xs({props:{tableDataFilepath:Ps,embeddingDataFilepath:Is}}),q.$on("xClicked",Cs),q.$on("urlTyped",Bs),G=new Ts({}),{c(){e=u("div"),n=u("div"),P(r.$$.fragment),a=p(),P(i.$$.fragment),c=p(),d=u("div"),y=u("div"),v=p(),m=u("div"),k=u("div"),P(x.$$.fragment),b=p(),_=u("div"),$=u("div"),P(M.$$.fragment),A=p(),N=u("div"),P(E.$$.fragment),T=p(),D=u("div"),P(S.$$.fragment),L=p(),z=u("div"),P(H.$$.fragment),j=p(),P(q.$$.fragment),W=p(),O=u("div"),R=u("div"),X=h("svg"),V=h("path"),U=p(),P(G.$$.fragment),g(y,"class","select-container svelte-gjd059"),g(k,"class","instance-container svelte-gjd059"),g($,"class","graph-container svelte-gjd059"),g(N,"class","lower-atlas-container svelte-gjd059"),g(_,"class","lower-container svelte-gjd059"),g(D,"class","atlas-container svelte-gjd059"),g(D,"style","visibility=hidden"),g(z,"class","atlas-sidebar svelte-gjd059"),w(z,"hidden",!t[3].show),g(m,"class","attention-container svelte-gjd059"),g(V,"fill","none"),g(V,"stroke","currentColor"),g(V,"stroke-linecap","round"),g(V,"stroke-linejoin","round"),g(V,"stroke-width","80"),g(V,"d","M112 184l144 144 144-144"),g(X,"class","icon-down svelte-gjd059"),g(X,"viewBox","0 0 512 512"),w(X,"up-down",!t[2]),g(R,"class","icon-wrapper svelte-gjd059"),g(O,"class","down-button svelte-gjd059"),g(d,"class","main-content svelte-gjd059"),g(n,"class","dodrio-vis svelte-gjd059"),g(e,"class","main")},m(s,u){l(s,e,u),o(e,n),C(r,n,null),o(n,a),C(i,n,null),o(n,c),o(n,d),o(d,y),o(d,v),o(d,m),o(m,k),C(x,k,null),t[15](k),o(m,b),o(m,_),o(_,$),C(M,$,null),t[16]($),o(_,A),o(_,N),C(E,N,null),t[17](N),t[18](_),o(m,T),o(m,D),C(S,D,null),t[19](D),o(m,L),o(m,z),C(H,z,null),o(d,j),C(q,d,null),o(d,W),o(d,O),o(O,R),o(R,X),o(X,V),t[20](O),o(e,U),C(G,e,null),Q=!0,K||(Z=f(R,"click",t[11]),K=!0)},p(t,[e]){i.$set({}),8&e&&w(z,"hidden",!t[3].show),4&e&&w(X,"up-down",!t[2])},i(t){Q||(F(r.$$.fragment,t),F(i.$$.fragment,t),F(x.$$.fragment,t),F(M.$$.fragment,t),F(E.$$.fragment,t),F(S.$$.fragment,t),F(H.$$.fragment,t),F(q.$$.fragment,t),F(G.$$.fragment,t),Q=!0)},o(t){I(r.$$.fragment,t),I(i.$$.fragment,t),I(x.$$.fragment,t),I(M.$$.fragment,t),I(E.$$.fragment,t),I(S.$$.fragment,t),I(H.$$.fragment,t),I(q.$$.fragment,t),I(G.$$.fragment,t),Q=!1},d(n){n&&s(e),B(r),t[14](null),B(i),B(x),t[15](null),B(M),t[16](null),B(E),t[17](null),t[18](null),B(S),t[19](null),B(H),B(q),t[20](null),B(G),K=!1,Z()}}}const Ss="/dodrio/data/sst2-attention-data/",Ls="/dodrio/data/sst2-dependencies.json",zs="/dodrio/data/sst2-sorted-syntactic-heads.json",Hs="/dodrio/data/sst2-sorted-saliency-heads.json",js="/dodrio/data/sst2-sorted-confidence-heads.json",qs="/dodrio/data/sst2-saliency-list-grad-l1.json",Fs="/dodrio/data/sst2-atlas.json",Is="/dodrio/data/embedding-list-sst2.json",Ps="/dodrio/data/table-list-sst2.json",Cs=()=>{},Bs=()=>{};function Ws(t,e,n){let r,a=null,i=null,o=null,l=!0,s=50,c=20;et.subscribe((t=>{}));let u={};ut.subscribe((t=>{n(3,u=t)}));let h=null,d=null,p={compWidth:null,compHeight:null},f=null,g=null,y={compWidth:null,compHeight:null},v={};nt.subscribe((t=>{v=t}));let m=null,w={compWidth:null,compHeight:null},k=null,x={compWidth:null,compHeight:null};const b=()=>{Qe(m).select(".legend-container").style("display","none");let t=Qe(m).select(".atlas-svg-container").style("width","100%").style("height","100%").select(".atlas-svg-full");i=t.attr("width"),o=t.attr("height"),t.attr("width",null).attr("height",null).style("padding-top","36px").style("padding-left","8px").style("width","100%").style("height","100%"),n(7,m.style.width=x.compWidth+"px",m),n(7,m.style.height=x.compHeight+"px",m),n(7,m.style.opacity=0,m);const e=()=>{n(7,m.style.display="none",m),n(7,m.style.visibility="",m),n(7,m.style.width="1000px",m),n(7,m.style.height="100%",m),Qe(m).select(".legend-container").style("display",null),Qe(m).select(".atlas-svg-container").style("width",null).style("height",null).select(".atlas-svg-full").style("padding-top",null).style("padding-left",null).style("width",null).style("height",null).attr("width",i).attr("height",o),m.removeEventListener("transitionend",e)};m.addEventListener("transitionend",e)};return _((()=>{p.compWidth=Math.floor(d.clientWidth),p.compHeight=Math.floor(d.clientHeight),G.set(p),y.compWidth=Math.floor(g.clientWidth),y.compHeight=Math.floor(g.clientHeight)-5,Z.set(y),f=Math.floor(g.clientHeight),x.compWidth=Math.floor(k.clientWidth),x.compHeight=Math.floor(k.clientHeight),tt.set(x),w.compWidth=Math.floor(m.clientWidth-10),w.compHeight=Math.floor(m.clientHeight-10),J.set(w),n(7,m.style.opacity="0",m),n(7,m.style.visibility="hidden",m),b(),n(1,r.style.top=Math.floor(g.clientHeight)+50-c/2+"px",r),n(1,r.style.left=p.compWidth-s/2+"px",r),n(1,r.style.width=s+"px",r),n(1,r.style.height=c+"px",r),n(1,r.style.visibility="visible",r)})),[a,r,l,u,h,d,g,m,k,()=>{n(7,m.style.display="",m),n(7,m.style.opacity="1",m)},b,()=>{l?(n(6,g.style.height="100%",g),n(4,h.style.bottom=`-${p.compHeight-10}px`,h),n(1,r.style.top=f+50-c/2+p.compHeight-10+"px",r),v.height=Math.floor(g.clientHeight)-5,v.inComparison=!0,nt.set(v)):(n(6,g.style.height="34%",g),n(4,h.style.bottom="0px",h),n(1,r.style.top=f+50-c/2+"px",r),v.height=f-5,v.inComparison=!1,nt.set(v)),n(2,l=!l)},()=>{n(6,g.style.height="100%",g),n(4,h.style.bottom=`-${p.compHeight-10}px`,h),n(1,r.style.top=f+50-c/2+p.compHeight-10+"px",r),n(2,l=!1),v.height=Math.floor(g.clientHeight)-5,v.inComparison=!0,nt.set(v)},()=>{n(6,g.style.height="34%",g),n(4,h.style.bottom="0px",h),n(1,r.style.top=f+50-c/2+"px",r),n(2,l=!0),v.height=f-5,v.inComparison=!1,nt.set(v)},function(t){A[t?"unshift":"push"]((()=>{a=t,n(0,a)}))},function(t){A[t?"unshift":"push"]((()=>{g=t,n(6,g)}))},function(t){A[t?"unshift":"push"]((()=>{d=t,n(5,d)}))},function(t){A[t?"unshift":"push"]((()=>{k=t,n(8,k)}))},function(t){A[t?"unshift":"push"]((()=>{h=t,n(4,h)}))},function(t){A[t?"unshift":"push"]((()=>{m=t,n(7,m)}))},function(t){A[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class Os extends R{constructor(t){super(),O(this,t,Ws,Ds,i,{})}}function Rs(e){let n,r,a,i,c,h,d,f;return d=new Os({}),{c(){n=u("script"),a=p(),i=u("div"),c=u("recommender-overlay"),h=p(),P(d.$$.fragment),g(n,"type","module"),n.src!==(r="https://unpkg.com/recommender-overlay/dist/recommender-overlay.es.js")&&g(n,"src","https://unpkg.com/recommender-overlay/dist/recommender-overlay.es.js"),y(c,"my-brand","Dodrio"),y(c,"position-left","20"),y(c,"display-delay","20000"),g(i,"class","app-page")},m(t,e){o(document.head,n),l(t,a,e),l(t,i,e),o(i,c),o(i,h),C(d,i,null),f=!0},p:t,i(t){f||(F(d.$$.fragment,t),f=!0)},o(t){I(d.$$.fragment,t),f=!1},d(t){s(n),t&&s(a),t&&s(i),B(d)}}}return new class extends R{constructor(t){super(),O(this,t,null,Rs,i,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
