var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function a(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,e){t.appendChild(e)}function o(t,e,n){t.insertBefore(e,n||null)}function s(t){t.parentNode.removeChild(t)}function c(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function u(t){return document.createElement(t)}function h(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function d(t){return document.createTextNode(t)}function p(){return d(" ")}function f(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function y(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function m(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}function v(t,e,n){t.classList[n?"add":"remove"](e)}let w;function k(t){w=t}function x(){if(!w)throw new Error("Function called outside component initialization");return w}function b(t){x().$$.on_mount.push(t)}function _(){const t=x();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const a=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);r.slice().forEach((e=>{e.call(t,a)}))}}}const $=[],M=[],A=[],N=[],E=Promise.resolve();let T=!1;function D(t){A.push(t)}let S=!1;const q=new Set;function L(){if(!S){S=!0;do{for(let t=0;t<$.length;t+=1){const e=$[t];k(e),z(e.$$)}for(k(null),$.length=0;M.length;)M.pop()();for(let t=0;t<A.length;t+=1){const e=A[t];q.has(e)||(q.add(e),e())}A.length=0}while($.length);for(;N.length;)N.pop()();T=!1,S=!1,q.clear()}}function z(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(D)}}const H=new Set;function j(t,e){t&&t.i&&(H.delete(t),t.i(e))}function F(t,e,n,r){if(t&&t.o){if(H.has(t))return;H.add(t),undefined.c.push((()=>{H.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function I(t){t&&t.c()}function P(t,n,i){const{fragment:l,on_mount:o,on_destroy:s,after_update:c}=t.$$;l&&l.m(n,i),D((()=>{const n=o.map(e).filter(a);s?s.push(...n):r(n),t.$$.on_mount=[]})),c.forEach(D)}function C(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function B(t,e){-1===t.$$.dirty[0]&&($.push(t),T||(T=!0,E.then(L)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function W(e,a,i,l,o,c,u=[-1]){const h=w;k(e);const d=a.props||{},p=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:o,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:n(),dirty:u,skip_bound:!1};let f=!1;if(p.ctx=i?i(e,d,((t,n,...r)=>{const a=r.length?r[0]:n;return p.ctx&&o(p.ctx[t],p.ctx[t]=a)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](a),f&&B(e,t)),n})):[],p.update(),f=!0,r(p.before_update),p.fragment=!!l&&l(p.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);p.fragment&&p.fragment.l(t),t.forEach(s)}else p.fragment&&p.fragment.c();a.intro&&j(e.$$.fragment),P(e,a.target,a.anchor),L()}k(h)}class O{$destroy(){C(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function R(e){let n;return{c(){n=u("div"),n.innerHTML='<div id="logo" class="svelte-1wqi70q"><div id="logo-icon" class="svelte-1wqi70q"><img src="/dodrio/figures/dodrio-logo.svg" alt="logo"/></div> \n    <div id="logo-text" class="svelte-1wqi70q">Dodrio</div> \n    \n    <div id="logo-tagline" class="svelte-1wqi70q">Exploring transformer models in your browser!</div></div> \n\n  <div class="icons svelte-1wqi70q"><a class="icon-a svelte-1wqi70q" target="_blank" href="https://arxiv.org/abs/2103.14625"><div class="icon svelte-1wqi70q" title="Research paper"><i class="fas fa-file-pdf svelte-1wqi70q"></i></div></a> \n\n    <a target="_blank" href="https://youtu.be/uboTKqPNU5Y" class="svelte-1wqi70q"><div class="icon svelte-1wqi70q" title="Demo video"><i class="fab fa-youtube svelte-1wqi70q"></i></div></a> \n\n    <a target="_blank" href="https://github.com/poloclub/dodrio" class="svelte-1wqi70q"><div class="icon svelte-1wqi70q" title="Open-source code"><i class="fab fa-github svelte-1wqi70q"></i></div></a></div>',g(n,"id","header"),g(n,"class","svelte-1wqi70q")},m(t,e){o(t,n,e)},p:t,i:t,o:t,d(t){t&&s(n)}}}class X extends O{constructor(t){super(),W(this,t,null,R,i,{})}}const Y=[];function V(e,n=t){let r;const a=[];function l(t){if(i(e,t)&&(e=t,r)){const t=!Y.length;for(let t=0;t<a.length;t+=1){const n=a[t];n[1](),Y.push(n,e)}if(t){for(let t=0;t<Y.length;t+=2)Y[t][0](Y[t+1]);Y.length=0}}}return{set:l,update:function(t){l(t(e))},subscribe:function(i,o=t){const s=[i,o];return a.push(s),1===a.length&&(r=n(l)||t),i(e),()=>{const t=a.indexOf(s);-1!==t&&a.splice(t,1),0===a.length&&(r(),r=null)}}}}const U=V({}),G=V({}),K=V({}),Q=V({}),Z=V({}),J=V({}),tt=V({show:!1,html:"",left:0,top:0,width:0,maxWidth:0,fontSize:"1em"}),et=V({inComparison:!1,height:0}),nt=V(1562),rt=V(1562),at=V(),it=V({}),lt=V({}),ot=V({show:!1,attention:null,layer:null,head:null}),st=V({show:!1,attention:null,layer:null,head:null}),ct=V({show:!1,attention:null,layer:null,head:null}),ut=V({layer:9,head:8});function ht(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function dt(t){let e=t,n=t;function r(t,e,r,a){for(null==r&&(r=0),null==a&&(a=t.length);r<a;){const i=r+a>>>1;n(t[i],e)<0?r=i+1:a=i}return r}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>ht(t(e),n)}(t)),{left:r,center:function(t,n,a,i){null==a&&(a=0),null==i&&(i=t.length);const l=r(t,n,a,i-1);return l>a&&e(t[l-1],n)>-e(t[l],n)?l-1:l},right:function(t,e,r,a){for(null==r&&(r=0),null==a&&(a=t.length);r<a;){const i=r+a>>>1;n(t[i],e)>0?a=i:r=i+1}return r}}}const pt=dt(ht).right;dt((function(t){return null===t?NaN:+t})).center;function ft(t,e){let n,r;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=r=e):(n>e&&(n=e),r<e&&(r=e)));else{let a=-1;for(let i of t)null!=(i=e(i,++a,t))&&(void 0===n?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)))}return[n,r]}var gt=Math.sqrt(50),yt=Math.sqrt(10),mt=Math.sqrt(2);function vt(t,e,n){var r=(e-t)/Math.max(0,n),a=Math.floor(Math.log(r)/Math.LN10),i=r/Math.pow(10,a);return a>=0?(i>=gt?10:i>=yt?5:i>=mt?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(i>=gt?10:i>=yt?5:i>=mt?2:1)}function wt(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let a of t)null!=(a=e(a,++r,t))&&(n<a||void 0===n&&a>=a)&&(n=a)}return n}var kt=Array.prototype.slice;function xt(t){return t}var bt=1e-6;function _t(t){return"translate("+(t+.5)+",0)"}function $t(t){return"translate(0,"+(t+.5)+")"}function Mt(t){return e=>+t(e)}function At(t){var e=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(e=Math.round(e)),function(n){return+t(n)+e}}function Nt(){return!this.__axis}function Et(t,e){var n=[],r=null,a=null,i=6,l=6,o=3,s=1===t||4===t?-1:1,c=4===t||2===t?"x":"y",u=1===t||3===t?_t:$t;function h(h){var d=null==r?e.ticks?e.ticks.apply(e,n):e.domain():r,p=null==a?e.tickFormat?e.tickFormat.apply(e,n):xt:a,f=Math.max(i,0)+o,g=e.range(),y=+g[0]+.5,m=+g[g.length-1]+.5,v=(e.bandwidth?At:Mt)(e.copy()),w=h.selection?h.selection():h,k=w.selectAll(".domain").data([null]),x=w.selectAll(".tick").data(d,e).order(),b=x.exit(),_=x.enter().append("g").attr("class","tick"),$=x.select("line"),M=x.select("text");k=k.merge(k.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),x=x.merge(_),$=$.merge(_.append("line").attr("stroke","currentColor").attr(c+"2",s*i)),M=M.merge(_.append("text").attr("fill","currentColor").attr(c,s*f).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),h!==w&&(k=k.transition(h),x=x.transition(h),$=$.transition(h),M=M.transition(h),b=b.transition(h).attr("opacity",bt).attr("transform",(function(t){return isFinite(t=v(t))?u(t):this.getAttribute("transform")})),_.attr("opacity",bt).attr("transform",(function(t){var e=this.parentNode.__axis;return u(e&&isFinite(e=e(t))?e:v(t))}))),b.remove(),k.attr("d",4===t||2==t?l?"M"+s*l+","+y+"H0.5V"+m+"H"+s*l:"M0.5,"+y+"V"+m:l?"M"+y+","+s*l+"V0.5H"+m+"V"+s*l:"M"+y+",0.5H"+m),x.attr("opacity",1).attr("transform",(function(t){return u(v(t))})),$.attr(c+"2",s*i),M.attr(c,s*f).text(p),w.filter(Nt).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),w.each((function(){this.__axis=v}))}return h.scale=function(t){return arguments.length?(e=t,h):e},h.ticks=function(){return n=kt.call(arguments),h},h.tickArguments=function(t){return arguments.length?(n=null==t?[]:kt.call(t),h):n.slice()},h.tickValues=function(t){return arguments.length?(r=null==t?null:kt.call(t),h):r&&r.slice()},h.tickFormat=function(t){return arguments.length?(a=t,h):a},h.tickSize=function(t){return arguments.length?(i=l=+t,h):i},h.tickSizeInner=function(t){return arguments.length?(i=+t,h):i},h.tickSizeOuter=function(t){return arguments.length?(l=+t,h):l},h.tickPadding=function(t){return arguments.length?(o=+t,h):o},h}function Tt(t){return Et(2,t)}var Dt={value:()=>{}};function St(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new qt(r)}function qt(t){this._=t}function Lt(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function zt(t,e){for(var n,r=0,a=t.length;r<a;++r)if((n=t[r]).name===e)return n.value}function Ht(t,e,n){for(var r=0,a=t.length;r<a;++r)if(t[r].name===e){t[r]=Dt,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}qt.prototype=St.prototype={constructor:qt,on:function(t,e){var n,r=this._,a=Lt(t+"",r),i=-1,l=a.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++i<l;)if(n=(t=a[i]).type)r[n]=Ht(r[n],t.name,e);else if(null==e)for(n in r)r[n]=Ht(r[n],t.name,null);return this}for(;++i<l;)if((n=(t=a[i]).type)&&(n=zt(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new qt(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,a=new Array(n),i=0;i<n;++i)a[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=0,n=(r=this._[t]).length;i<n;++i)r[i].value.apply(e,a)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],a=0,i=r.length;a<i;++a)r[a].value.apply(e,n)}};var jt="http://www.w3.org/1999/xhtml",Ft={svg:"http://www.w3.org/2000/svg",xhtml:jt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function It(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),Ft.hasOwnProperty(e)?{space:Ft[e],local:t}:t}function Pt(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===jt&&e.documentElement.namespaceURI===jt?e.createElement(t):e.createElementNS(n,t)}}function Ct(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Bt(t){var e=It(t);return(e.local?Ct:Pt)(e)}function Wt(){}function Ot(t){return null==t?Wt:function(){return this.querySelector(t)}}function Rt(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Xt(){return[]}function Yt(t){return null==t?Xt:function(){return this.querySelectorAll(t)}}function Vt(t){return function(){return this.matches(t)}}function Ut(t){return function(e){return e.matches(t)}}var Gt=Array.prototype.find;function Kt(){return this.firstElementChild}var Qt=Array.prototype.filter;function Zt(){return this.children}function Jt(t){return new Array(t.length)}function te(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function ee(t){return function(){return t}}function ne(t,e,n,r,a,i){for(var l,o=0,s=e.length,c=i.length;o<c;++o)(l=e[o])?(l.__data__=i[o],r[o]=l):n[o]=new te(t,i[o]);for(;o<s;++o)(l=e[o])&&(a[o]=l)}function re(t,e,n,r,a,i,l){var o,s,c,u=new Map,h=e.length,d=i.length,p=new Array(h);for(o=0;o<h;++o)(s=e[o])&&(p[o]=c=l.call(s,s.__data__,o,e)+"",u.has(c)?a[o]=s:u.set(c,s));for(o=0;o<d;++o)c=l.call(t,i[o],o,i)+"",(s=u.get(c))?(r[o]=s,s.__data__=i[o],u.delete(c)):n[o]=new te(t,i[o]);for(o=0;o<h;++o)(s=e[o])&&u.get(p[o])===s&&(a[o]=s)}function ae(t){return t.__data__}function ie(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function le(t){return function(){this.removeAttribute(t)}}function oe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function se(t,e){return function(){this.setAttribute(t,e)}}function ce(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ue(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function he(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function de(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function pe(t){return function(){this.style.removeProperty(t)}}function fe(t,e,n){return function(){this.style.setProperty(t,e,n)}}function ge(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function ye(t,e){return t.style.getPropertyValue(e)||de(t).getComputedStyle(t,null).getPropertyValue(e)}function me(t){return function(){delete this[t]}}function ve(t,e){return function(){this[t]=e}}function we(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function ke(t){return t.trim().split(/^|\s+/)}function xe(t){return t.classList||new be(t)}function be(t){this._node=t,this._names=ke(t.getAttribute("class")||"")}function _e(t,e){for(var n=xe(t),r=-1,a=e.length;++r<a;)n.add(e[r])}function $e(t,e){for(var n=xe(t),r=-1,a=e.length;++r<a;)n.remove(e[r])}function Me(t){return function(){_e(this,t)}}function Ae(t){return function(){$e(this,t)}}function Ne(t,e){return function(){(e.apply(this,arguments)?_e:$e)(this,t)}}function Ee(){this.textContent=""}function Te(t){return function(){this.textContent=t}}function De(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Se(){this.innerHTML=""}function qe(t){return function(){this.innerHTML=t}}function Le(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function ze(){this.nextSibling&&this.parentNode.appendChild(this)}function He(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function je(){return null}function Fe(){var t=this.parentNode;t&&t.removeChild(this)}function Ie(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Pe(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ce(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function Be(t){return function(){var e=this.__on;if(e){for(var n,r=0,a=-1,i=e.length;r<i;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++a]=n:this.removeEventListener(n.type,n.listener,n.options);++a?e.length=a:delete this.__on}}}function We(t,e,n){return function(){var r,a=this.__on,i=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(a)for(var l=0,o=a.length;l<o;++l)if((r=a[l]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),void(r.value=e);this.addEventListener(t.type,i,n),r={type:t.type,name:t.name,value:e,listener:i,options:n},a?a.push(r):this.__on=[r]}}function Oe(t,e,n){var r=de(t),a=r.CustomEvent;"function"==typeof a?a=new a(e,n):(a=r.document.createEvent("Event"),n?(a.initEvent(e,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(e,!1,!1)),t.dispatchEvent(a)}function Re(t,e){return function(){return Oe(this,t,e)}}function Xe(t,e){return function(){return Oe(this,t,e.apply(this,arguments))}}te.prototype={constructor:te,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},be.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Ye=[null];function Ve(t,e){this._groups=t,this._parents=e}function Ue(){return new Ve([[document.documentElement]],Ye)}function Ge(t){return"string"==typeof t?new Ve([[document.querySelector(t)]],[document.documentElement]):new Ve([[t]],Ye)}function Ke(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}function Qe(t){return"string"==typeof t?new Ve([document.querySelectorAll(t)],[document.documentElement]):new Ve([null==t?[]:Rt(t)],Ye)}function Ze(t){t.stopImmediatePropagation()}function Je(t){t.preventDefault(),t.stopImmediatePropagation()}function tn(t){var e=t.document.documentElement,n=Ge(t).on("dragstart.drag",Je,!0);"onselectstart"in e?n.on("selectstart.drag",Je,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function en(t,e){var n=t.document.documentElement,r=Ge(t).on("dragstart.drag",null);e&&(r.on("click.drag",Je,!0),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}Ve.prototype=Ue.prototype={constructor:Ve,select:function(t){"function"!=typeof t&&(t=Ot(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i,l,o=e[a],s=o.length,c=r[a]=new Array(s),u=0;u<s;++u)(i=o[u])&&(l=t.call(i,i.__data__,u,o))&&("__data__"in i&&(l.__data__=i.__data__),c[u]=l);return new Ve(r,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);return null==e?[]:Rt(e)}}(t):Yt(t);for(var e=this._groups,n=e.length,r=[],a=[],i=0;i<n;++i)for(var l,o=e[i],s=o.length,c=0;c<s;++c)(l=o[c])&&(r.push(t.call(l,l.__data__,c,o)),a.push(l));return new Ve(r,a)},selectChild:function(t){return this.select(null==t?Kt:function(t){return function(){return Gt.call(this.children,t)}}("function"==typeof t?t:Ut(t)))},selectChildren:function(t){return this.selectAll(null==t?Zt:function(t){return function(){return Qt.call(this.children,t)}}("function"==typeof t?t:Ut(t)))},filter:function(t){"function"!=typeof t&&(t=Vt(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i,l=e[a],o=l.length,s=r[a]=[],c=0;c<o;++c)(i=l[c])&&t.call(i,i.__data__,c,l)&&s.push(i);return new Ve(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,ae);var n=e?re:ne,r=this._parents,a=this._groups;"function"!=typeof t&&(t=ee(t));for(var i=a.length,l=new Array(i),o=new Array(i),s=new Array(i),c=0;c<i;++c){var u=r[c],h=a[c],d=h.length,p=Rt(t.call(u,u&&u.__data__,c,r)),f=p.length,g=o[c]=new Array(f),y=l[c]=new Array(f),m=s[c]=new Array(d);n(u,h,g,y,m,p,e);for(var v,w,k=0,x=0;k<f;++k)if(v=g[k]){for(k>=x&&(x=k+1);!(w=y[x])&&++x<f;);v._next=w||null}}return(l=new Ve(l,r))._enter=o,l._exit=s,l},enter:function(){return new Ve(this._enter||this._groups.map(Jt),this._parents)},exit:function(){return new Ve(this._exit||this._groups.map(Jt),this._parents)},join:function(t,e,n){var r=this.enter(),a=this,i=this.exit();return r="function"==typeof t?t(r):r.append(t+""),null!=e&&(a=e(a)),null==n?i.remove():n(i),r&&a?r.merge(a).order():a},merge:function(t){if(!(t instanceof Ve))throw new Error("invalid merge");for(var e=this._groups,n=t._groups,r=e.length,a=n.length,i=Math.min(r,a),l=new Array(r),o=0;o<i;++o)for(var s,c=e[o],u=n[o],h=c.length,d=l[o]=new Array(h),p=0;p<h;++p)(s=c[p]||u[p])&&(d[p]=s);for(;o<r;++o)l[o]=e[o];return new Ve(l,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,a=t[e],i=a.length-1,l=a[i];--i>=0;)(r=a[i])&&(l&&4^r.compareDocumentPosition(l)&&l.parentNode.insertBefore(r,l),l=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=ie);for(var n=this._groups,r=n.length,a=new Array(r),i=0;i<r;++i){for(var l,o=n[i],s=o.length,c=a[i]=new Array(s),u=0;u<s;++u)(l=o[u])&&(c[u]=l);c.sort(e)}return new Ve(a,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,i=r.length;a<i;++a){var l=r[a];if(l)return l}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var a,i=e[n],l=0,o=i.length;l<o;++l)(a=i[l])&&t.call(a,a.__data__,l,i);return this},attr:function(t,e){var n=It(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?oe:le:"function"==typeof e?n.local?he:ue:n.local?ce:se)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?pe:"function"==typeof e?ge:fe)(t,e,null==n?"":n)):ye(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?me:"function"==typeof e?we:ve)(t,e)):this.node()[t]},classed:function(t,e){var n=ke(t+"");if(arguments.length<2){for(var r=xe(this.node()),a=-1,i=n.length;++a<i;)if(!r.contains(n[a]))return!1;return!0}return this.each(("function"==typeof e?Ne:e?Me:Ae)(n,e))},text:function(t){return arguments.length?this.each(null==t?Ee:("function"==typeof t?De:Te)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Se:("function"==typeof t?Le:qe)(t)):this.node().innerHTML},raise:function(){return this.each(ze)},lower:function(){return this.each(He)},append:function(t){var e="function"==typeof t?t:Bt(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:Bt(t),r=null==e?je:"function"==typeof e?e:Ot(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Fe)},clone:function(t){return this.select(t?Pe:Ie)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,a,i=Ce(t+""),l=i.length;if(!(arguments.length<2)){for(o=e?We:Be,r=0;r<l;++r)this.each(o(i[r],e,n));return this}var o=this.node().__on;if(o)for(var s,c=0,u=o.length;c<u;++c)for(r=0,s=o[c];r<l;++r)if((a=i[r]).type===s.type&&a.name===s.name)return s.value},dispatch:function(t,e){return this.each(("function"==typeof e?Xe:Re)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,a=t[e],i=0,l=a.length;i<l;++i)(r=a[i])&&(yield r)}};var nn=t=>()=>t;function rn(t,{sourceEvent:e,subject:n,target:r,identifier:a,active:i,x:l,y:o,dx:s,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:l,enumerable:!0,configurable:!0},y:{value:o,enumerable:!0,configurable:!0},dx:{value:s,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}function an(t){return!t.ctrlKey&&!t.button}function ln(){return this.parentNode}function on(t,e){return null==e?{x:t.x,y:t.y}:e}function sn(){return navigator.maxTouchPoints||"ontouchstart"in this}function cn(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function un(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function hn(){}rn.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var dn=.7,pn=1/dn,fn="\\s*([+-]?\\d+)\\s*",gn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",yn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",mn=/^#([0-9a-f]{3,8})$/,vn=new RegExp("^rgb\\("+[fn,fn,fn]+"\\)$"),wn=new RegExp("^rgb\\("+[yn,yn,yn]+"\\)$"),kn=new RegExp("^rgba\\("+[fn,fn,fn,gn]+"\\)$"),xn=new RegExp("^rgba\\("+[yn,yn,yn,gn]+"\\)$"),bn=new RegExp("^hsl\\("+[gn,yn,yn]+"\\)$"),_n=new RegExp("^hsla\\("+[gn,yn,yn,gn]+"\\)$"),$n={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Mn(){return this.rgb().formatHex()}function An(){return this.rgb().formatRgb()}function Nn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=mn.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?En(e):3===n?new qn(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Tn(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Tn(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=vn.exec(t))?new qn(e[1],e[2],e[3],1):(e=wn.exec(t))?new qn(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=kn.exec(t))?Tn(e[1],e[2],e[3],e[4]):(e=xn.exec(t))?Tn(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=bn.exec(t))?jn(e[1],e[2]/100,e[3]/100,1):(e=_n.exec(t))?jn(e[1],e[2]/100,e[3]/100,e[4]):$n.hasOwnProperty(t)?En($n[t]):"transparent"===t?new qn(NaN,NaN,NaN,0):null}function En(t){return new qn(t>>16&255,t>>8&255,255&t,1)}function Tn(t,e,n,r){return r<=0&&(t=e=n=NaN),new qn(t,e,n,r)}function Dn(t){return t instanceof hn||(t=Nn(t)),t?new qn((t=t.rgb()).r,t.g,t.b,t.opacity):new qn}function Sn(t,e,n,r){return 1===arguments.length?Dn(t):new qn(t,e,n,null==r?1:r)}function qn(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Ln(){return"#"+Hn(this.r)+Hn(this.g)+Hn(this.b)}function zn(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Hn(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function jn(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new In(t,e,n,r)}function Fn(t){if(t instanceof In)return new In(t.h,t.s,t.l,t.opacity);if(t instanceof hn||(t=Nn(t)),!t)return new In;if(t instanceof In)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),i=Math.max(e,n,r),l=NaN,o=i-a,s=(i+a)/2;return o?(l=e===i?(n-r)/o+6*(n<r):n===i?(r-e)/o+2:(e-n)/o+4,o/=s<.5?i+a:2-i-a,l*=60):o=s>0&&s<1?0:l,new In(l,o,s,t.opacity)}function In(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Pn(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}cn(hn,Nn,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Mn,formatHex:Mn,formatHsl:function(){return Fn(this).formatHsl()},formatRgb:An,toString:An}),cn(qn,Sn,un(hn,{brighter:function(t){return t=null==t?pn:Math.pow(pn,t),new qn(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?dn:Math.pow(dn,t),new qn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ln,formatHex:Ln,formatRgb:zn,toString:zn})),cn(In,(function(t,e,n,r){return 1===arguments.length?Fn(t):new In(t,e,n,null==r?1:r)}),un(hn,{brighter:function(t){return t=null==t?pn:Math.pow(pn,t),new In(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?dn:Math.pow(dn,t),new In(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new qn(Pn(t>=240?t-240:t+120,a,r),Pn(t,a,r),Pn(t<120?t+240:t-120,a,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));const Cn=Math.PI/180,Bn=180/Math.PI,Wn=.96422,On=.82521,Rn=4/29,Xn=6/29,Yn=3*Xn*Xn;function Vn(t){if(t instanceof Un)return new Un(t.l,t.a,t.b,t.opacity);if(t instanceof er)return nr(t);t instanceof qn||(t=Dn(t));var e,n,r=Zn(t.r),a=Zn(t.g),i=Zn(t.b),l=Gn((.2225045*r+.7168786*a+.0606169*i)/1);return r===a&&a===i?e=n=l:(e=Gn((.4360747*r+.3850649*a+.1430804*i)/Wn),n=Gn((.0139322*r+.0971045*a+.7141733*i)/On)),new Un(116*l-16,500*(e-l),200*(l-n),t.opacity)}function Un(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function Gn(t){return t>.008856451679035631?Math.pow(t,1/3):t/Yn+Rn}function Kn(t){return t>Xn?t*t*t:Yn*(t-Rn)}function Qn(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Zn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Jn(t){if(t instanceof er)return new er(t.h,t.c,t.l,t.opacity);if(t instanceof Un||(t=Vn(t)),0===t.a&&0===t.b)return new er(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*Bn;return new er(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function tr(t,e,n,r){return 1===arguments.length?Jn(t):new er(t,e,n,null==r?1:r)}function er(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function nr(t){if(isNaN(t.h))return new Un(t.l,0,0,t.opacity);var e=t.h*Cn;return new Un(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}cn(Un,(function(t,e,n,r){return 1===arguments.length?Vn(t):new Un(t,e,n,null==r?1:r)}),un(hn,{brighter:function(t){return new Un(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Un(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new qn(Qn(3.1338561*(e=Wn*Kn(e))-1.6168667*(t=1*Kn(t))-.4906146*(n=On*Kn(n))),Qn(-.9787684*e+1.9161415*t+.033454*n),Qn(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),cn(er,tr,un(hn,{brighter:function(t){return new er(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new er(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return nr(this).rgb()}}));var rr=t=>()=>t;function ar(t){return 1==(t=+t)?ir:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):rr(isNaN(e)?n:e)}}function ir(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):rr(isNaN(t)?e:t)}var lr=function t(e){var n=ar(e);function r(t,e){var r=n((t=Sn(t)).r,(e=Sn(e)).r),a=n(t.g,e.g),i=n(t.b,e.b),l=ir(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=a(e),t.b=i(e),t.opacity=l(e),t+""}}return r.gamma=t,r}(1);function or(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,a=e.slice();return function(i){for(n=0;n<r;++n)a[n]=t[n]*(1-i)+e[n]*i;return a}}function sr(t,e){var n,r=e?e.length:0,a=t?Math.min(r,t.length):0,i=new Array(a),l=new Array(r);for(n=0;n<a;++n)i[n]=gr(t[n],e[n]);for(;n<r;++n)l[n]=e[n];return function(t){for(n=0;n<a;++n)l[n]=i[n](t);return l}}function cr(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function ur(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function hr(t,e){var n,r={},a={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=gr(t[n],e[n]):a[n]=e[n];return function(t){for(n in r)a[n]=r[n](t);return a}}var dr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,pr=new RegExp(dr.source,"g");function fr(t,e){var n,r,a,i=dr.lastIndex=pr.lastIndex=0,l=-1,o=[],s=[];for(t+="",e+="";(n=dr.exec(t))&&(r=pr.exec(e));)(a=r.index)>i&&(a=e.slice(i,a),o[l]?o[l]+=a:o[++l]=a),(n=n[0])===(r=r[0])?o[l]?o[l]+=r:o[++l]=r:(o[++l]=null,s.push({i:l,x:ur(n,r)})),i=pr.lastIndex;return i<e.length&&(a=e.slice(i),o[l]?o[l]+=a:o[++l]=a),o.length<2?s[0]?function(t){return function(e){return t(e)+""}}(s[0].x):function(t){return function(){return t}}(e):(e=s.length,function(t){for(var n,r=0;r<e;++r)o[(n=s[r]).i]=n.x(t);return o.join("")})}function gr(t,e){var n,r=typeof e;return null==e||"boolean"===r?rr(e):("number"===r?ur:"string"===r?(n=Nn(e))?(e=n,lr):fr:e instanceof Nn?lr:e instanceof Date?cr:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}(e)?or:Array.isArray(e)?sr:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?hr:ur)(t,e)}function yr(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var mr,vr=180/Math.PI,wr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function kr(t,e,n,r,a,i){var l,o,s;return(l=Math.sqrt(t*t+e*e))&&(t/=l,e/=l),(s=t*n+e*r)&&(n-=t*s,r-=e*s),(o=Math.sqrt(n*n+r*r))&&(n/=o,r/=o,s/=o),t*r<e*n&&(t=-t,e=-e,s=-s,l=-l),{translateX:a,translateY:i,rotate:Math.atan2(e,t)*vr,skewX:Math.atan(s)*vr,scaleX:l,scaleY:o}}function xr(t,e,n,r){function a(t){return t.length?t.pop()+" ":""}return function(i,l){var o=[],s=[];return i=t(i),l=t(l),function(t,r,a,i,l,o){if(t!==a||r!==i){var s=l.push("translate(",null,e,null,n);o.push({i:s-4,x:ur(t,a)},{i:s-2,x:ur(r,i)})}else(a||i)&&l.push("translate("+a+e+i+n)}(i.translateX,i.translateY,l.translateX,l.translateY,o,s),function(t,e,n,i){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),i.push({i:n.push(a(n)+"rotate(",null,r)-2,x:ur(t,e)})):e&&n.push(a(n)+"rotate("+e+r)}(i.rotate,l.rotate,o,s),function(t,e,n,i){t!==e?i.push({i:n.push(a(n)+"skewX(",null,r)-2,x:ur(t,e)}):e&&n.push(a(n)+"skewX("+e+r)}(i.skewX,l.skewX,o,s),function(t,e,n,r,i,l){if(t!==n||e!==r){var o=i.push(a(i)+"scale(",null,",",null,")");l.push({i:o-4,x:ur(t,n)},{i:o-2,x:ur(e,r)})}else 1===n&&1===r||i.push(a(i)+"scale("+n+","+r+")")}(i.scaleX,i.scaleY,l.scaleX,l.scaleY,o,s),i=l=null,function(t){for(var e,n=-1,r=s.length;++n<r;)o[(e=s[n]).i]=e.x(t);return o.join("")}}}var br=xr((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?wr:kr(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),_r=xr((function(t){return null==t?wr:(mr||(mr=document.createElementNS("http://www.w3.org/2000/svg","g")),mr.setAttribute("transform",t),(t=mr.transform.baseVal.consolidate())?kr((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):wr)}),", ",")",")");function $r(t){return((t=Math.exp(t))+1/t)/2}var Mr,Ar,Nr=function t(e,n,r){function a(t,a){var i,l,o=t[0],s=t[1],c=t[2],u=a[0],h=a[1],d=a[2],p=u-o,f=h-s,g=p*p+f*f;if(g<1e-12)l=Math.log(d/c)/e,i=function(t){return[o+t*p,s+t*f,c*Math.exp(e*t*l)]};else{var y=Math.sqrt(g),m=(d*d-c*c+r*g)/(2*c*n*y),v=(d*d-c*c-r*g)/(2*d*n*y),w=Math.log(Math.sqrt(m*m+1)-m),k=Math.log(Math.sqrt(v*v+1)-v);l=(k-w)/e,i=function(t){var r=t*l,a=$r(w),i=c/(n*y)*(a*function(t){return((t=Math.exp(2*t))-1)/(t+1)}(e*r+w)-function(t){return((t=Math.exp(t))-1/t)/2}(w));return[o+i*p,s+i*f,c*a/$r(e*r+w)]}}return i.duration=1e3*l*e/Math.SQRT2,i}return a.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},a}(Math.SQRT2,2,4),Er=0,Tr=0,Dr=0,Sr=0,qr=0,Lr=0,zr="object"==typeof performance&&performance.now?performance:Date,Hr="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function jr(){return qr||(Hr(Fr),qr=zr.now()+Lr)}function Fr(){qr=0}function Ir(){this._call=this._time=this._next=null}function Pr(t,e,n){var r=new Ir;return r.restart(t,e,n),r}function Cr(){qr=(Sr=zr.now())+Lr,Er=Tr=0;try{!function(){jr(),++Er;for(var t,e=Mr;e;)(t=qr-e._time)>=0&&e._call.call(null,t),e=e._next;--Er}()}finally{Er=0,function(){var t,e,n=Mr,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Mr=e);Ar=t,Wr(r)}(),qr=0}}function Br(){var t=zr.now(),e=t-Sr;e>1e3&&(Lr-=e,Sr=t)}function Wr(t){Er||(Tr&&(Tr=clearTimeout(Tr)),t-qr>24?(t<1/0&&(Tr=setTimeout(Cr,t-zr.now()-Lr)),Dr&&(Dr=clearInterval(Dr))):(Dr||(Sr=zr.now(),Dr=setInterval(Br,1e3)),Er=1,Hr(Cr)))}function Or(t,e,n){var r=new Ir;return e=null==e?0:+e,r.restart((n=>{r.stop(),t(n+e)}),e,n),r}Ir.prototype=Pr.prototype={constructor:Ir,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?jr():+n)+(null==e?0:+e),this._next||Ar===this||(Ar?Ar._next=this:Mr=this,Ar=this),this._call=t,this._time=n,Wr()},stop:function(){this._call&&(this._call=null,this._time=1/0,Wr())}};var Rr=St("start","end","cancel","interrupt"),Xr=[];function Yr(t,e,n,r,a,i){var l=t.__transition;if(l){if(n in l)return}else t.__transition={};!function(t,e,n){var r,a=t.__transition;function i(t){n.state=1,n.timer.restart(l,n.delay,n.time),n.delay<=t&&l(t-n.delay)}function l(i){var c,u,h,d;if(1!==n.state)return s();for(c in a)if((d=a[c]).name===n.name){if(3===d.state)return Or(l);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete a[c]):+c<e&&(d.state=6,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete a[c])}if(Or((function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(i))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(d=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(r[++u]=d);r.length=u+1}}function o(e){for(var a=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=5,1),i=-1,l=r.length;++i<l;)r[i].call(t,a);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var r in n.state=6,n.timer.stop(),delete a[e],a)return;delete t.__transition}a[e]=n,n.timer=Pr(i,0,n.time)}(t,n,{name:e,index:r,group:a,on:Rr,tween:Xr,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:0})}function Vr(t,e){var n=Gr(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Ur(t,e){var n=Gr(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Gr(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Kr(t,e){var n,r,a,i=t.__transition,l=!0;if(i){for(a in e=null==e?null:e+"",i)(n=i[a]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[a]):l=!1;l&&delete t.__transition}}function Qr(t,e){var n,r;return function(){var a=Ur(this,t),i=a.tween;if(i!==n)for(var l=0,o=(r=n=i).length;l<o;++l)if(r[l].name===e){(r=r.slice()).splice(l,1);break}a.tween=r}}function Zr(t,e,n){var r,a;if("function"!=typeof n)throw new Error;return function(){var i=Ur(this,t),l=i.tween;if(l!==r){a=(r=l).slice();for(var o={name:e,value:n},s=0,c=a.length;s<c;++s)if(a[s].name===e){a[s]=o;break}s===c&&a.push(o)}i.tween=a}}function Jr(t,e,n){var r=t._id;return t.each((function(){var t=Ur(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return Gr(t,r).value[e]}}function ta(t,e){var n;return("number"==typeof e?ur:e instanceof Nn?lr:(n=Nn(e))?(e=n,lr):fr)(t,e)}function ea(t){return function(){this.removeAttribute(t)}}function na(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ra(t,e,n){var r,a,i=n+"";return function(){var l=this.getAttribute(t);return l===i?null:l===r?a:a=e(r=l,n)}}function aa(t,e,n){var r,a,i=n+"";return function(){var l=this.getAttributeNS(t.space,t.local);return l===i?null:l===r?a:a=e(r=l,n)}}function ia(t,e,n){var r,a,i;return function(){var l,o,s=n(this);if(null!=s)return(l=this.getAttribute(t))===(o=s+"")?null:l===r&&o===a?i:(a=o,i=e(r=l,s));this.removeAttribute(t)}}function la(t,e,n){var r,a,i;return function(){var l,o,s=n(this);if(null!=s)return(l=this.getAttributeNS(t.space,t.local))===(o=s+"")?null:l===r&&o===a?i:(a=o,i=e(r=l,s));this.removeAttributeNS(t.space,t.local)}}function oa(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function sa(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function ca(t,e){var n,r;function a(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&sa(t,a)),n}return a._value=e,a}function ua(t,e){var n,r;function a(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&oa(t,a)),n}return a._value=e,a}function ha(t,e){return function(){Vr(this,t).delay=+e.apply(this,arguments)}}function da(t,e){return e=+e,function(){Vr(this,t).delay=e}}function pa(t,e){return function(){Ur(this,t).duration=+e.apply(this,arguments)}}function fa(t,e){return e=+e,function(){Ur(this,t).duration=e}}function ga(t,e){if("function"!=typeof e)throw new Error;return function(){Ur(this,t).ease=e}}function ya(t,e,n){var r,a,i=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Vr:Ur;return function(){var l=i(this,t),o=l.on;o!==r&&(a=(r=o).copy()).on(e,n),l.on=a}}var ma=Ue.prototype.constructor;function va(t){return function(){this.style.removeProperty(t)}}function wa(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function ka(t,e,n){var r,a;function i(){var i=e.apply(this,arguments);return i!==a&&(r=(a=i)&&wa(t,i,n)),r}return i._value=e,i}function xa(t){return function(e){this.textContent=t.call(this,e)}}function ba(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&xa(r)),e}return r._value=t,r}var _a=0;function $a(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Ma(){return++_a}var Aa=Ue.prototype;function Na(t){return((t*=2)<=1?t*t:--t*(2-t)+1)/2}function Ea(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}$a.prototype=function(t){return Ue().transition(t)}.prototype={constructor:$a,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Ot(t));for(var r=this._groups,a=r.length,i=new Array(a),l=0;l<a;++l)for(var o,s,c=r[l],u=c.length,h=i[l]=new Array(u),d=0;d<u;++d)(o=c[d])&&(s=t.call(o,o.__data__,d,c))&&("__data__"in o&&(s.__data__=o.__data__),h[d]=s,Yr(h[d],e,n,d,h,Gr(o,n)));return new $a(i,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Yt(t));for(var r=this._groups,a=r.length,i=[],l=[],o=0;o<a;++o)for(var s,c=r[o],u=c.length,h=0;h<u;++h)if(s=c[h]){for(var d,p=t.call(s,s.__data__,h,c),f=Gr(s,n),g=0,y=p.length;g<y;++g)(d=p[g])&&Yr(d,e,n,g,p,f);i.push(p),l.push(s)}return new $a(i,l,e,n)},filter:function(t){"function"!=typeof t&&(t=Vt(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i,l=e[a],o=l.length,s=r[a]=[],c=0;c<o;++c)(i=l[c])&&t.call(i,i.__data__,c,l)&&s.push(i);return new $a(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,a=n.length,i=Math.min(r,a),l=new Array(r),o=0;o<i;++o)for(var s,c=e[o],u=n[o],h=c.length,d=l[o]=new Array(h),p=0;p<h;++p)(s=c[p]||u[p])&&(d[p]=s);for(;o<r;++o)l[o]=e[o];return new $a(l,this._parents,this._name,this._id)},selection:function(){return new ma(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Ma(),r=this._groups,a=r.length,i=0;i<a;++i)for(var l,o=r[i],s=o.length,c=0;c<s;++c)if(l=o[c]){var u=Gr(l,e);Yr(l,t,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new $a(r,this._parents,t,n)},call:Aa.call,nodes:Aa.nodes,node:Aa.node,size:Aa.size,empty:Aa.empty,each:Aa.each,on:function(t,e){var n=this._id;return arguments.length<2?Gr(this.node(),n).on.on(t):this.each(ya(n,t,e))},attr:function(t,e){var n=It(t),r="transform"===n?_r:ta;return this.attrTween(t,"function"==typeof e?(n.local?la:ia)(n,r,Jr(this,"attr."+t,e)):null==e?(n.local?na:ea)(n):(n.local?aa:ra)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=It(t);return this.tween(n,(r.local?ca:ua)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?br:ta;return null==e?this.styleTween(t,function(t,e){var n,r,a;return function(){var i=ye(this,t),l=(this.style.removeProperty(t),ye(this,t));return i===l?null:i===n&&l===r?a:a=e(n=i,r=l)}}(t,r)).on("end.style."+t,va(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,a,i;return function(){var l=ye(this,t),o=n(this),s=o+"";return null==o&&(this.style.removeProperty(t),s=o=ye(this,t)),l===s?null:l===r&&s===a?i:(a=s,i=e(r=l,o))}}(t,r,Jr(this,"style."+t,e))).each(function(t,e){var n,r,a,i,l="style."+e,o="end."+l;return function(){var s=Ur(this,t),c=s.on,u=null==s.value[l]?i||(i=va(e)):void 0;c===n&&a===u||(r=(n=c).copy()).on(o,a=u),s.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,a,i=n+"";return function(){var l=ye(this,t);return l===i?null:l===r?a:a=e(r=l,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,ka(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(Jr(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,ba(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,a=Gr(this.node(),n).tween,i=0,l=a.length;i<l;++i)if((r=a[i]).name===t)return r.value;return null}return this.each((null==e?Qr:Zr)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?ha:da)(e,t)):Gr(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?pa:fa)(e,t)):Gr(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(ga(e,t)):Gr(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Ur(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,a=n.size();return new Promise((function(i,l){var o={value:l},s={value:function(){0==--a&&i()}};n.each((function(){var n=Ur(this,r),a=n.on;a!==t&&((e=(t=a).copy())._.cancel.push(o),e._.interrupt.push(o),e._.end.push(s)),n.on=e})),0===a&&i()}))},[Symbol.iterator]:Aa[Symbol.iterator]};var Ta={time:null,delay:0,duration:250,ease:Ea};function Da(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}Ue.prototype.interrupt=function(t){return this.each((function(){Kr(this,t)}))},Ue.prototype.transition=function(t){var e,n;t instanceof $a?(e=t._id,t=t._name):(e=Ma(),(n=Ta).time=jr(),t=null==t?null:t+"");for(var r=this._groups,a=r.length,i=0;i<a;++i)for(var l,o=r[i],s=o.length,c=0;c<s;++c)(l=o[c])&&Yr(l,t,e,c,o,n||Da(l,e));return new $a(r,this._parents,t,e)};const Sa=Math.PI,qa=2*Sa,La=1e-6,za=qa-La;function Ha(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function ja(){return new Ha}function Fa(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}function Ia(t,e){return fetch(t,e).then(Fa)}function Pa(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var a,i,l,o,s,c,u,h,d,p=t._root,f={data:r},g=t._x0,y=t._y0,m=t._x1,v=t._y1;if(!p)return t._root=f,t;for(;p.length;)if((c=e>=(i=(g+m)/2))?g=i:m=i,(u=n>=(l=(y+v)/2))?y=l:v=l,a=p,!(p=p[h=u<<1|c]))return a[h]=f,t;if(o=+t._x.call(null,p.data),s=+t._y.call(null,p.data),e===o&&n===s)return f.next=p,a?a[h]=f:t._root=f,t;do{a=a?a[h]=new Array(4):t._root=new Array(4),(c=e>=(i=(g+m)/2))?g=i:m=i,(u=n>=(l=(y+v)/2))?y=l:v=l}while((h=u<<1|c)==(d=(s>=l)<<1|o>=i));return a[d]=p,a[h]=f,t}function Ca(t,e,n,r,a){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=a}function Ba(t){return t[0]}function Wa(t){return t[1]}function Oa(t,e,n){var r=new Ra(null==e?Ba:e,null==n?Wa:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function Ra(t,e,n,r,a,i){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=a,this._y1=i,this._root=void 0}function Xa(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}Ha.prototype=ja.prototype={constructor:Ha,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,a,i){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+a)+","+(this._y1=+i)},arcTo:function(t,e,n,r,a){t=+t,e=+e,n=+n,r=+r,a=+a;var i=this._x1,l=this._y1,o=n-t,s=r-e,c=i-t,u=l-e,h=c*c+u*u;if(a<0)throw new Error("negative radius: "+a);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(h>La)if(Math.abs(u*o-s*c)>La&&a){var d=n-i,p=r-l,f=o*o+s*s,g=d*d+p*p,y=Math.sqrt(f),m=Math.sqrt(h),v=a*Math.tan((Sa-Math.acos((f+h-g)/(2*y*m)))/2),w=v/m,k=v/y;Math.abs(w-1)>La&&(this._+="L"+(t+w*c)+","+(e+w*u)),this._+="A"+a+","+a+",0,0,"+ +(u*d>c*p)+","+(this._x1=t+k*o)+","+(this._y1=e+k*s)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,r,a,i){t=+t,e=+e,i=!!i;var l=(n=+n)*Math.cos(r),o=n*Math.sin(r),s=t+l,c=e+o,u=1^i,h=i?r-a:a-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+s+","+c:(Math.abs(this._x1-s)>La||Math.abs(this._y1-c)>La)&&(this._+="L"+s+","+c),n&&(h<0&&(h=h%qa+qa),h>za?this._+="A"+n+","+n+",0,1,"+u+","+(t-l)+","+(e-o)+"A"+n+","+n+",0,1,"+u+","+(this._x1=s)+","+(this._y1=c):h>La&&(this._+="A"+n+","+n+",0,"+ +(h>=Sa)+","+u+","+(this._x1=t+n*Math.cos(a))+","+(this._y1=e+n*Math.sin(a))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var Ya=Oa.prototype=Ra.prototype;function Va(t){return function(){return t}}function Ua(t){return 1e-6*(t()-.5)}function Ga(t){return t.x+t.vx}function Ka(t){return t.y+t.vy}function Qa(t){return t.index}function Za(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Ja(t){var e,n,r,a,i,l,o=Qa,s=function(t){return 1/Math.min(a[t.source.index],a[t.target.index])},c=Va(30),u=1;function h(r){for(var a=0,o=t.length;a<u;++a)for(var s,c,h,d,p,f,g,y=0;y<o;++y)c=(s=t[y]).source,d=(h=s.target).x+h.vx-c.x-c.vx||Ua(l),p=h.y+h.vy-c.y-c.vy||Ua(l),d*=f=((f=Math.sqrt(d*d+p*p))-n[y])/f*r*e[y],p*=f,h.vx-=d*(g=i[y]),h.vy-=p*g,c.vx+=d*(g=1-g),c.vy+=p*g}function d(){if(r){var l,s,c=r.length,u=t.length,h=new Map(r.map(((t,e)=>[o(t,e,r),t])));for(l=0,a=new Array(c);l<u;++l)(s=t[l]).index=l,"object"!=typeof s.source&&(s.source=Za(h,s.source)),"object"!=typeof s.target&&(s.target=Za(h,s.target)),a[s.source.index]=(a[s.source.index]||0)+1,a[s.target.index]=(a[s.target.index]||0)+1;for(l=0,i=new Array(u);l<u;++l)s=t[l],i[l]=a[s.source.index]/(a[s.source.index]+a[s.target.index]);e=new Array(u),p(),n=new Array(u),f()}}function p(){if(r)for(var n=0,a=t.length;n<a;++n)e[n]=+s(t[n],n,t)}function f(){if(r)for(var e=0,a=t.length;e<a;++e)n[e]=+c(t[e],e,t)}return null==t&&(t=[]),h.initialize=function(t,e){r=t,l=e,d()},h.links=function(e){return arguments.length?(t=e,d(),h):t},h.id=function(t){return arguments.length?(o=t,h):o},h.iterations=function(t){return arguments.length?(u=+t,h):u},h.strength=function(t){return arguments.length?(s="function"==typeof t?t:Va(+t),p(),h):s},h.distance=function(t){return arguments.length?(c="function"==typeof t?t:Va(+t),f(),h):c},h}Ya.copy=function(){var t,e,n=new Ra(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=Xa(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var a=0;a<4;++a)(e=r.source[a])&&(e.length?t.push({source:e,target:r.target[a]=new Array(4)}):r.target[a]=Xa(e));return n},Ya.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Pa(this.cover(e,n),e,n,t)},Ya.addAll=function(t){var e,n,r,a,i=t.length,l=new Array(i),o=new Array(i),s=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(a=+this._y.call(null,e))||(l[n]=r,o[n]=a,r<s&&(s=r),r>u&&(u=r),a<c&&(c=a),a>h&&(h=a));if(s>u||c>h)return this;for(this.cover(s,c).cover(u,h),n=0;n<i;++n)Pa(this,l[n],o[n],t[n]);return this},Ya.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,a=this._x1,i=this._y1;if(isNaN(n))a=(n=Math.floor(t))+1,i=(r=Math.floor(e))+1;else{for(var l,o,s=a-n||1,c=this._root;n>t||t>=a||r>e||e>=i;)switch(o=(e<r)<<1|t<n,(l=new Array(4))[o]=c,c=l,s*=2,o){case 0:a=n+s,i=r+s;break;case 1:n=a-s,i=r+s;break;case 2:a=n+s,r=i-s;break;case 3:n=a-s,r=i-s}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=r,this._x1=a,this._y1=i,this},Ya.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Ya.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Ya.find=function(t,e,n){var r,a,i,l,o,s,c,u=this._x0,h=this._y0,d=this._x1,p=this._y1,f=[],g=this._root;for(g&&f.push(new Ca(g,u,h,d,p)),null==n?n=1/0:(u=t-n,h=e-n,d=t+n,p=e+n,n*=n);s=f.pop();)if(!(!(g=s.node)||(a=s.x0)>d||(i=s.y0)>p||(l=s.x1)<u||(o=s.y1)<h))if(g.length){var y=(a+l)/2,m=(i+o)/2;f.push(new Ca(g[3],y,m,l,o),new Ca(g[2],a,m,y,o),new Ca(g[1],y,i,l,m),new Ca(g[0],a,i,y,m)),(c=(e>=m)<<1|t>=y)&&(s=f[f.length-1],f[f.length-1]=f[f.length-1-c],f[f.length-1-c]=s)}else{var v=t-+this._x.call(null,g.data),w=e-+this._y.call(null,g.data),k=v*v+w*w;if(k<n){var x=Math.sqrt(n=k);u=t-x,h=e-x,d=t+x,p=e+x,r=g.data}}return r},Ya.remove=function(t){if(isNaN(i=+this._x.call(null,t))||isNaN(l=+this._y.call(null,t)))return this;var e,n,r,a,i,l,o,s,c,u,h,d,p=this._root,f=this._x0,g=this._y0,y=this._x1,m=this._y1;if(!p)return this;if(p.length)for(;;){if((c=i>=(o=(f+y)/2))?f=o:y=o,(u=l>=(s=(g+m)/2))?g=s:m=s,e=p,!(p=p[h=u<<1|c]))return this;if(!p.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,d=h)}for(;p.data!==t;)if(r=p,!(p=p.next))return this;return(a=p.next)&&delete p.next,r?(a?r.next=a:delete r.next,this):e?(a?e[h]=a:delete e[h],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(n?n[d]=p:this._root=p),this):(this._root=a,this)},Ya.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Ya.root=function(){return this._root},Ya.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Ya.visit=function(t){var e,n,r,a,i,l,o=[],s=this._root;for(s&&o.push(new Ca(s,this._x0,this._y0,this._x1,this._y1));e=o.pop();)if(!t(s=e.node,r=e.x0,a=e.y0,i=e.x1,l=e.y1)&&s.length){var c=(r+i)/2,u=(a+l)/2;(n=s[3])&&o.push(new Ca(n,c,u,i,l)),(n=s[2])&&o.push(new Ca(n,r,u,c,l)),(n=s[1])&&o.push(new Ca(n,c,a,i,u)),(n=s[0])&&o.push(new Ca(n,r,a,c,u))}return this},Ya.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new Ca(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var a=e.node;if(a.length){var i,l=e.x0,o=e.y0,s=e.x1,c=e.y1,u=(l+s)/2,h=(o+c)/2;(i=a[0])&&n.push(new Ca(i,l,o,u,h)),(i=a[1])&&n.push(new Ca(i,u,o,s,h)),(i=a[2])&&n.push(new Ca(i,l,h,u,c)),(i=a[3])&&n.push(new Ca(i,u,h,s,c))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},Ya.x=function(t){return arguments.length?(this._x=t,this):this._x},Ya.y=function(t){return arguments.length?(this._y=t,this):this._y};const ti=4294967296;function ei(t){return t.x}function ni(t){return t.y}var ri=Math.PI*(3-Math.sqrt(5));function ai(t){var e,n=1,r=.001,a=1-Math.pow(r,1/300),i=0,l=.6,o=new Map,s=Pr(h),c=St("tick","end"),u=function(){let t=1;return()=>(t=(1664525*t+1013904223)%ti)/ti}();function h(){d(),c.call("tick",e),n<r&&(s.stop(),c.call("end",e))}function d(r){var s,c,u=t.length;void 0===r&&(r=1);for(var h=0;h<r;++h)for(n+=(i-n)*a,o.forEach((function(t){t(n)})),s=0;s<u;++s)null==(c=t[s]).fx?c.x+=c.vx*=l:(c.x=c.fx,c.vx=0),null==c.fy?c.y+=c.vy*=l:(c.y=c.fy,c.vy=0);return e}function p(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var a=10*Math.sqrt(.5+n),i=n*ri;e.x=a*Math.cos(i),e.y=a*Math.sin(i)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function f(e){return e.initialize&&e.initialize(t,u),e}return null==t&&(t=[]),p(),e={tick:d,restart:function(){return s.restart(h),e},stop:function(){return s.stop(),e},nodes:function(n){return arguments.length?(t=n,p(),o.forEach(f),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(a=+t,e):+a},alphaTarget:function(t){return arguments.length?(i=+t,e):i},velocityDecay:function(t){return arguments.length?(l=1-t,e):1-l},randomSource:function(t){return arguments.length?(u=t,o.forEach(f),e):u},force:function(t,n){return arguments.length>1?(null==n?o.delete(t):o.set(t,f(n)),e):o.get(t)},find:function(e,n,r){var a,i,l,o,s,c=0,u=t.length;for(null==r?r=1/0:r*=r,c=0;c<u;++c)(l=(a=e-(o=t[c]).x)*a+(i=n-o.y)*i)<r&&(s=o,r=l);return s},on:function(t,n){return arguments.length>1?(c.on(t,n),e):c.on(t)}}}function ii(t){var e,n,r,a=Va(.1);function i(t){for(var a,i=0,l=e.length;i<l;++i)(a=e[i]).vx+=(r[i]-a.x)*n[i]*t}function l(){if(e){var i,l=e.length;for(n=new Array(l),r=new Array(l),i=0;i<l;++i)n[i]=isNaN(r[i]=+t(e[i],i,e))?0:+a(e[i],i,e)}}return"function"!=typeof t&&(t=Va(null==t?0:+t)),i.initialize=function(t){e=t,l()},i.strength=function(t){return arguments.length?(a="function"==typeof t?t:Va(+t),l(),i):a},i.x=function(e){return arguments.length?(t="function"==typeof e?e:Va(+e),l(),i):t},i}function li(t){var e,n,r,a=Va(.1);function i(t){for(var a,i=0,l=e.length;i<l;++i)(a=e[i]).vy+=(r[i]-a.y)*n[i]*t}function l(){if(e){var i,l=e.length;for(n=new Array(l),r=new Array(l),i=0;i<l;++i)n[i]=isNaN(r[i]=+t(e[i],i,e))?0:+a(e[i],i,e)}}return"function"!=typeof t&&(t=Va(null==t?0:+t)),i.initialize=function(t){e=t,l()},i.strength=function(t){return arguments.length?(a="function"==typeof t?t:Va(+t),l(),i):a},i.y=function(e){return arguments.length?(t="function"==typeof e?e:Va(+e),l(),i):t},i}function oi(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function si(t){return(t=oi(Math.abs(t)))?t[1]:NaN}var ci,ui=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function hi(t){if(!(e=ui.exec(t)))throw new Error("invalid format: "+t);var e;return new di({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function di(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function pi(t,e){var n=oi(t,e);if(!n)return t+"";var r=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}hi.prototype=di.prototype,di.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var fi={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>pi(100*t,e),r:pi,s:function(t,e){var n=oi(t,e);if(!n)return t+"";var r=n[0],a=n[1],i=a-(ci=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,l=r.length;return i===l?r:i>l?r+new Array(i-l+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+oi(t,Math.max(0,e+i-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function gi(t){return t}var yi,mi,vi,wi=Array.prototype.map,ki=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function xi(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?gi:(e=wi.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var a=t.length,i=[],l=0,o=e[0],s=0;a>0&&o>0&&(s+o+1>r&&(o=Math.max(1,r-s)),i.push(t.substring(a-=o,a+o)),!((s+=o+1)>r));)o=e[l=(l+1)%e.length];return i.reverse().join(n)}),a=void 0===t.currency?"":t.currency[0]+"",i=void 0===t.currency?"":t.currency[1]+"",l=void 0===t.decimal?".":t.decimal+"",o=void 0===t.numerals?gi:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(wi.call(t.numerals,String)),s=void 0===t.percent?"%":t.percent+"",c=void 0===t.minus?"":t.minus+"",u=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=hi(t)).fill,n=t.align,h=t.sign,d=t.symbol,p=t.zero,f=t.width,g=t.comma,y=t.precision,m=t.trim,v=t.type;"n"===v?(g=!0,v="g"):fi[v]||(void 0===y&&(y=12),m=!0,v="g"),(p||"0"===e&&"="===n)&&(p=!0,e="0",n="=");var w="$"===d?a:"#"===d&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",k="$"===d?i:/[%p]/.test(v)?s:"",x=fi[v],b=/[defgprs%]/.test(v);function _(t){var a,i,s,d=w,_=k;if("c"===v)_=x(t)+_,t="";else{var $=(t=+t)<0||1/t<0;if(t=isNaN(t)?u:x(Math.abs(t),y),m&&(t=function(t){t:for(var e,n=t.length,r=1,a=-1;r<n;++r)switch(t[r]){case".":a=e=r;break;case"0":0===a&&(a=r),e=r;break;default:if(!+t[r])break t;a>0&&(a=0)}return a>0?t.slice(0,a)+t.slice(e+1):t}(t)),$&&0==+t&&"+"!==h&&($=!1),d=($?"("===h?h:c:"-"===h||"("===h?"":h)+d,_=("s"===v?ki[8+ci/3]:"")+_+($&&"("===h?")":""),b)for(a=-1,i=t.length;++a<i;)if(48>(s=t.charCodeAt(a))||s>57){_=(46===s?l+t.slice(a+1):t.slice(a))+_,t=t.slice(0,a);break}}g&&!p&&(t=r(t,1/0));var M=d.length+t.length+_.length,A=M<f?new Array(f-M+1).join(e):"";switch(g&&p&&(t=r(A+t,A.length?f-_.length:1/0),A=""),n){case"<":t=d+t+_+A;break;case"=":t=d+A+t+_;break;case"^":t=A.slice(0,M=A.length>>1)+d+t+_+A.slice(M);break;default:t=A+d+t+_}return o(t)}return y=void 0===y?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),_.toString=function(){return t+""},_}return{format:h,formatPrefix:function(t,e){var n=h(((t=hi(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(si(e)/3))),a=Math.pow(10,-r),i=ki[8+r/3];return function(t){return n(a*t)+i}}}}function bi(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function _i(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=Mi)):void 0===e&&(e=$i);for(var n,r,a,i,l,o=new Ei(t),s=[o];n=s.pop();)if((a=e(n.data))&&(l=(a=Array.from(a)).length))for(n.children=a,i=l-1;i>=0;--i)s.push(r=a[i]=new Ei(a[i])),r.parent=n,r.depth=n.depth+1;return o.eachBefore(Ni)}function $i(t){return t.children}function Mi(t){return Array.isArray(t)?t[1]:null}function Ai(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function Ni(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function Ei(t){this.data=t,this.depth=this.height=0,this.parent=null}function Ti(t){if("function"!=typeof t)throw new Error;return t}yi=xi({thousands:",",grouping:[3],currency:["$",""]}),mi=yi.format,vi=yi.formatPrefix,Ei.prototype=_i.prototype={constructor:Ei,count:function(){return this.eachAfter(bi)},each:function(t,e){let n=-1;for(const r of this)t.call(e,r,++n,this);return this},eachAfter:function(t,e){for(var n,r,a,i=this,l=[i],o=[],s=-1;i=l.pop();)if(o.push(i),n=i.children)for(r=0,a=n.length;r<a;++r)l.push(n[r]);for(;i=o.pop();)t.call(e,i,++s,this);return this},eachBefore:function(t,e){for(var n,r,a=this,i=[a],l=-1;a=i.pop();)if(t.call(e,a,++l,this),n=a.children)for(r=n.length-1;r>=0;--r)i.push(n[r]);return this},find:function(t,e){let n=-1;for(const r of this)if(t.call(e,r,++n,this))return r},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,a=r&&r.length;--a>=0;)n+=r[a].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),a=null;t=n.pop(),e=r.pop();for(;t===e;)a=t,t=n.pop(),e=r.pop();return a}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var a=r.length;t!==n;)r.splice(a,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return _i(this).eachBefore(Ai)},[Symbol.iterator]:function*(){var t,e,n,r,a=this,i=[a];do{for(t=i.reverse(),i=[];a=t.pop();)if(yield a,e=a.children)for(n=0,r=e.length;n<r;++n)i.push(e[n])}while(i.length)}};var Di={depth:-1},Si={};function qi(t){return t.id}function Li(t){return t.parentId}function zi(t,e){return t.parent===e.parent?1:2}function Hi(t){var e=t.children;return e?e[0]:t.t}function ji(t){var e=t.children;return e?e[e.length-1]:t.t}function Fi(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function Ii(t,e,n){return t.a.parent===e.parent?t.a:n}function Pi(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}function Ci(){var t=zi,e=1,n=1,r=null;function a(a){var s=function(t){for(var e,n,r,a,i,l=new Pi(t,0),o=[l];e=o.pop();)if(r=e._.children)for(e.children=new Array(i=r.length),a=i-1;a>=0;--a)o.push(n=e.children[a]=new Pi(r[a],a)),n.parent=e;return(l.parent=new Pi(null,0)).children=[l],l}(a);if(s.eachAfter(i),s.parent.m=-s.z,s.eachBefore(l),r)a.eachBefore(o);else{var c=a,u=a,h=a;a.eachBefore((function(t){t.x<c.x&&(c=t),t.x>u.x&&(u=t),t.depth>h.depth&&(h=t)}));var d=c===u?1:t(c,u)/2,p=d-c.x,f=e/(u.x+d+p),g=n/(h.depth||1);a.eachBefore((function(t){t.x=(t.x+p)*f,t.y=t.depth*g}))}return a}function i(e){var n=e.children,r=e.parent.children,a=e.i?r[e.i-1]:null;if(n){!function(t){for(var e,n=0,r=0,a=t.children,i=a.length;--i>=0;)(e=a[i]).z+=n,e.m+=n,n+=e.s+(r+=e.c)}(e);var i=(n[0].z+n[n.length-1].z)/2;a?(e.z=a.z+t(e._,a._),e.m=e.z-i):e.z=i}else a&&(e.z=a.z+t(e._,a._));e.parent.A=function(e,n,r){if(n){for(var a,i=e,l=e,o=n,s=i.parent.children[0],c=i.m,u=l.m,h=o.m,d=s.m;o=ji(o),i=Hi(i),o&&i;)s=Hi(s),(l=ji(l)).a=e,(a=o.z+h-i.z-c+t(o._,i._))>0&&(Fi(Ii(o,e,r),e,a),c+=a,u+=a),h+=o.m,c+=i.m,d+=s.m,u+=l.m;o&&!ji(l)&&(l.t=o,l.m+=h-u),i&&!Hi(s)&&(s.t=i,s.m+=c-d,r=e)}return r}(e,a,e.parent.A||r[0])}function l(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function o(t){t.x*=e,t.y=t.depth*n}return a.separation=function(e){return arguments.length?(t=e,a):t},a.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],a):r?null:[e,n]},a.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],a):r?[e,n]:null},a}function Bi(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function Wi(t){return+t}Pi.prototype=Object.create(Ei.prototype);var Oi=[0,1];function Ri(t){return t}function Xi(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:function(t){return function(){return t}}(isNaN(e)?NaN:.5)}function Yi(t,e,n){var r=t[0],a=t[1],i=e[0],l=e[1];return a<r?(r=Xi(a,r),i=n(l,i)):(r=Xi(r,a),i=n(i,l)),function(t){return i(r(t))}}function Vi(t,e,n){var r=Math.min(t.length,e.length)-1,a=new Array(r),i=new Array(r),l=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++l<r;)a[l]=Xi(t[l],t[l+1]),i[l]=n(e[l],e[l+1]);return function(e){var n=pt(t,e,1,r)-1;return i[n](a[n](e))}}function Ui(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Gi(){var t,e,n,r,a,i,l=Oi,o=Oi,s=gr,c=Ri;function u(){var t=Math.min(l.length,o.length);return c!==Ri&&(c=function(t,e){var n;return t>e&&(n=t,t=e,e=n),function(n){return Math.max(t,Math.min(e,n))}}(l[0],l[t-1])),r=t>2?Vi:Yi,a=i=null,h}function h(e){return isNaN(e=+e)?n:(a||(a=r(l.map(t),o,s)))(t(c(e)))}return h.invert=function(n){return c(e((i||(i=r(o,l.map(t),ur)))(n)))},h.domain=function(t){return arguments.length?(l=Array.from(t,Wi),u()):l.slice()},h.range=function(t){return arguments.length?(o=Array.from(t),u()):o.slice()},h.rangeRound=function(t){return o=Array.from(t),s=yr,u()},h.clamp=function(t){return arguments.length?(c=!!t||Ri,u()):c!==Ri},h.interpolate=function(t){return arguments.length?(s=t,u()):s},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,r){return t=n,e=r,u()}}function Ki(){return Gi()(Ri,Ri)}function Qi(t,e,n,r){var a,i=function(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),a=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),i=r/a;return i>=gt?a*=10:i>=yt?a*=5:i>=mt&&(a*=2),e<t?-a:a}(t,e,n);switch((r=hi(null==r?",f":r)).type){case"s":var l=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(a=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(si(e)/3)))-si(Math.abs(t)))}(i,l))||(r.precision=a),vi(r,l);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(a=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,si(e)-si(t))+1}(i,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=a-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(a=function(t){return Math.max(0,-si(Math.abs(t)))}(i))||(r.precision=a-2*("%"===r.type))}return mi(r)}function Zi(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){var r,a,i,l,o=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(a=t,t=e,e=a),0===(l=vt(t,e,n))||!isFinite(l))return[];if(l>0)for(t=Math.ceil(t/l),e=Math.floor(e/l),i=new Array(a=Math.ceil(e-t+1));++o<a;)i[o]=(t+o)*l;else for(l=-l,t=Math.ceil(t*l),e=Math.floor(e*l),i=new Array(a=Math.ceil(e-t+1));++o<a;)i[o]=(t+o)/l;return r&&i.reverse(),i}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return Qi(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,a,i=e(),l=0,o=i.length-1,s=i[l],c=i[o],u=10;for(c<s&&(a=s,s=c,c=a,a=l,l=o,o=a);u-- >0;){if((a=vt(s,c,n))===r)return i[l]=s,i[o]=c,e(i);if(a>0)s=Math.floor(s/a)*a,c=Math.ceil(c/a)*a;else{if(!(a<0))break;s=Math.ceil(s*a)/a,c=Math.floor(c*a)/a}r=a}return t},t}function Ji(){var t=Ki();return t.copy=function(){return Ui(t,Ji())},Bi.apply(t,arguments),Zi(t)}function tl(t){return function(){return t}}var el=Math.abs,nl=Math.atan2,rl=Math.cos,al=Math.max,il=Math.min,ll=Math.sin,ol=Math.sqrt,sl=1e-12,cl=Math.PI,ul=cl/2,hl=2*cl;function dl(t){return t>1?0:t<-1?cl:Math.acos(t)}function pl(t){return t>=1?ul:t<=-1?-ul:Math.asin(t)}function fl(t){return t.innerRadius}function gl(t){return t.outerRadius}function yl(t){return t.startAngle}function ml(t){return t.endAngle}function vl(t){return t&&t.padAngle}function wl(t,e,n,r,a,i,l,o){var s=n-t,c=r-e,u=l-a,h=o-i,d=h*s-u*c;if(!(d*d<sl))return[t+(d=(u*(e-i)-h*(t-a))/d)*s,e+d*c]}function kl(t,e,n,r,a,i,l){var o=t-n,s=e-r,c=(l?i:-i)/ol(o*o+s*s),u=c*s,h=-c*o,d=t+u,p=e+h,f=n+u,g=r+h,y=(d+f)/2,m=(p+g)/2,v=f-d,w=g-p,k=v*v+w*w,x=a-i,b=d*g-f*p,_=(w<0?-1:1)*ol(al(0,x*x*k-b*b)),$=(b*w-v*_)/k,M=(-b*v-w*_)/k,A=(b*w+v*_)/k,N=(-b*v+w*_)/k,E=$-y,T=M-m,D=A-y,S=N-m;return E*E+T*T>D*D+S*S&&($=A,M=N),{cx:$,cy:M,x01:-u,y01:-h,x11:$*(a/x-1),y11:M*(a/x-1)}}function xl(){var t=fl,e=gl,n=tl(0),r=null,a=yl,i=ml,l=vl,o=null;function s(){var s,c,u=+t.apply(this,arguments),h=+e.apply(this,arguments),d=a.apply(this,arguments)-ul,p=i.apply(this,arguments)-ul,f=el(p-d),g=p>d;if(o||(o=s=ja()),h<u&&(c=h,h=u,u=c),h>sl)if(f>hl-sl)o.moveTo(h*rl(d),h*ll(d)),o.arc(0,0,h,d,p,!g),u>sl&&(o.moveTo(u*rl(p),u*ll(p)),o.arc(0,0,u,p,d,g));else{var y,m,v=d,w=p,k=d,x=p,b=f,_=f,$=l.apply(this,arguments)/2,M=$>sl&&(r?+r.apply(this,arguments):ol(u*u+h*h)),A=il(el(h-u)/2,+n.apply(this,arguments)),N=A,E=A;if(M>sl){var T=pl(M/u*ll($)),D=pl(M/h*ll($));(b-=2*T)>sl?(k+=T*=g?1:-1,x-=T):(b=0,k=x=(d+p)/2),(_-=2*D)>sl?(v+=D*=g?1:-1,w-=D):(_=0,v=w=(d+p)/2)}var S=h*rl(v),q=h*ll(v),L=u*rl(x),z=u*ll(x);if(A>sl){var H,j=h*rl(w),F=h*ll(w),I=u*rl(k),P=u*ll(k);if(f<cl&&(H=wl(S,q,I,P,j,F,L,z))){var C=S-H[0],B=q-H[1],W=j-H[0],O=F-H[1],R=1/ll(dl((C*W+B*O)/(ol(C*C+B*B)*ol(W*W+O*O)))/2),X=ol(H[0]*H[0]+H[1]*H[1]);N=il(A,(u-X)/(R-1)),E=il(A,(h-X)/(R+1))}}_>sl?E>sl?(y=kl(I,P,S,q,h,E,g),m=kl(j,F,L,z,h,E,g),o.moveTo(y.cx+y.x01,y.cy+y.y01),E<A?o.arc(y.cx,y.cy,E,nl(y.y01,y.x01),nl(m.y01,m.x01),!g):(o.arc(y.cx,y.cy,E,nl(y.y01,y.x01),nl(y.y11,y.x11),!g),o.arc(0,0,h,nl(y.cy+y.y11,y.cx+y.x11),nl(m.cy+m.y11,m.cx+m.x11),!g),o.arc(m.cx,m.cy,E,nl(m.y11,m.x11),nl(m.y01,m.x01),!g))):(o.moveTo(S,q),o.arc(0,0,h,v,w,!g)):o.moveTo(S,q),u>sl&&b>sl?N>sl?(y=kl(L,z,j,F,u,-N,g),m=kl(S,q,I,P,u,-N,g),o.lineTo(y.cx+y.x01,y.cy+y.y01),N<A?o.arc(y.cx,y.cy,N,nl(y.y01,y.x01),nl(m.y01,m.x01),!g):(o.arc(y.cx,y.cy,N,nl(y.y01,y.x01),nl(y.y11,y.x11),!g),o.arc(0,0,u,nl(y.cy+y.y11,y.cx+y.x11),nl(m.cy+m.y11,m.cx+m.x11),g),o.arc(m.cx,m.cy,N,nl(m.y11,m.x11),nl(m.y01,m.x01),!g))):o.arc(0,0,u,x,k,g):o.lineTo(L,z)}else o.moveTo(0,0);if(o.closePath(),s)return o=null,s+""||null}return s.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,r=(+a.apply(this,arguments)+ +i.apply(this,arguments))/2-cl/2;return[rl(r)*n,ll(r)*n]},s.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:tl(+e),s):t},s.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:tl(+t),s):e},s.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:tl(+t),s):n},s.padRadius=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:tl(+t),s):r},s.startAngle=function(t){return arguments.length?(a="function"==typeof t?t:tl(+t),s):a},s.endAngle=function(t){return arguments.length?(i="function"==typeof t?t:tl(+t),s):i},s.padAngle=function(t){return arguments.length?(l="function"==typeof t?t:tl(+t),s):l},s.context=function(t){return arguments.length?(o=null==t?null:t,s):o},s}var bl=Array.prototype.slice;function _l(t){return t[0]}function $l(t){return t[1]}function Ml(t){return t.source}function Al(t){return t.target}function Nl(t,e,n,r,a){t.moveTo(e,n),t.bezierCurveTo(e,n=(n+a)/2,r,n,r,a)}function El(){return function(t){var e=Ml,n=Al,r=_l,a=$l,i=null;function l(){var l,o=bl.call(arguments),s=e.apply(this,o),c=n.apply(this,o);if(i||(i=l=ja()),t(i,+r.apply(this,(o[0]=s,o)),+a.apply(this,o),+r.apply(this,(o[0]=c,o)),+a.apply(this,o)),l)return i=null,l+""||null}return l.source=function(t){return arguments.length?(e=t,l):e},l.target=function(t){return arguments.length?(n=t,l):n},l.x=function(t){return arguments.length?(r="function"==typeof t?t:tl(+t),l):r},l.y=function(t){return arguments.length?(a="function"==typeof t?t:tl(+t),l):a},l.context=function(t){return arguments.length?(i=null==t?null:t,l):i},l}(Nl)}var Tl=t=>()=>t;function Dl(t,{sourceEvent:e,target:n,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function Sl(t,e,n){this.k=t,this.x=e,this.y=n}Sl.prototype={constructor:Sl,scale:function(t){return 1===t?this:new Sl(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Sl(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ql=new Sl(1,0,0);function Ll(t){t.stopImmediatePropagation()}function zl(t){t.preventDefault(),t.stopImmediatePropagation()}function Hl(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function jl(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function Fl(){return this.__zoom||ql}function Il(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Pl(){return navigator.maxTouchPoints||"ontouchstart"in this}function Cl(t,e,n){var r=t.invertX(e[0][0])-n[0][0],a=t.invertX(e[1][0])-n[1][0],i=t.invertY(e[0][1])-n[0][1],l=t.invertY(e[1][1])-n[1][1];return t.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),l>i?(i+l)/2:Math.min(0,i)||Math.max(0,l))}function Bl(t,e,n){const r=t.slice();return r[65]=e[n],r}function Wl(t,e,n){const r=t.slice();return r[68]=e[n],r}function Ol(t,e,n){const r=t.slice();return r[68]=e[n],r}function Rl(e){let n,r,a,i=e[68]+1+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[68],n.value=n.__value},m(t,e){o(t,n,e),l(n,r)},p:t,d(t){t&&s(n)}}}function Xl(e){let n,r,a,i=e[68]+1+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[68],n.value=n.__value},m(t,e){o(t,n,e),l(n,r)},p:t,d(t){t&&s(n)}}}function Yl(e){let n,r,a,i=e[65].name+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[65].value,n.value=n.__value},m(t,e){o(t,n,e),l(n,r)},p:t,d(t){t&&s(n)}}}function Vl(e){let n,r,a,i,m,w,k,x,b,_,$,M,A,N,E,T,D,S,q,L,z,H,j,F,I,P,C,B,W,O,R,X,Y,V,U,G,K,Q,Z,J,tt,et,nt,rt,at,it,lt,ot,st,ct,ut,ht,dt,pt,ft,gt,yt,mt,vt,wt,kt,xt,bt,_t,$t,Mt,At,Nt,Et,Tt,Dt,St,qt,Lt,zt,Ht,jt,Ft,It,Pt,Ct,Bt,Wt,Ot,Rt,Xt=(e[3].autoAttention?"auto":e[6](e[4].force.attention,2))+"",Yt=e[6](e[4].force.textOrder,2)+"",Vt=e[6](e[4].force.manyBody,2)+"",Ut=e[6](e[4].force.collideRadius,2)+"",Gt=e[6](e[1],2)+"",Kt=[...Array(12).keys()],Qt=[];for(let t=0;t<Kt.length;t+=1)Qt[t]=Rl(Ol(e,Kt,t));let Zt=[...Array(12).keys()],Jt=[];for(let t=0;t<Zt.length;t+=1)Jt[t]=Xl(Wl(e,Zt,t));let te=Object.values(e[5]),ee=[];for(let t=0;t<te.length;t+=1)ee[t]=Yl(Bl(e,te,t));return{c(){n=u("div"),r=u("div"),a=u("div"),a.textContent="Semantic Attention Graph",i=p(),m=u("div"),w=u("div"),k=u("div"),x=d("Layer \n          "),b=u("div"),_=u("select");for(let t=0;t<Qt.length;t+=1)Qt[t].c();$=p(),M=u("div"),A=d("Head\n          "),N=u("div"),E=u("select");for(let t=0;t<Jt.length;t+=1)Jt[t].c();T=p(),D=u("div"),S=p(),q=u("div"),L=u("div"),L.innerHTML='<i class="fas fa-sliders-h"></i>',z=p(),H=u("div"),j=p(),F=u("div"),I=u("select");for(let t=0;t<ee.length;t+=1)ee[t].c();P=p(),C=u("div"),B=u("div"),W=p(),O=u("div"),O.textContent="Edge Force",R=p(),X=u("div"),Y=p(),V=u("div"),U=u("div"),G=u("label"),G.textContent="Attention",K=p(),Q=u("div"),Z=d(Xt),J=p(),tt=u("input"),et=p(),nt=u("div"),rt=u("div"),at=u("label"),at.textContent="Text Order",it=p(),lt=u("div"),ot=d(Yt),st=p(),ct=u("input"),ut=p(),ht=u("div"),dt=u("div"),pt=u("label"),pt.textContent="ManyBody",ft=p(),gt=u("div"),yt=d(Vt),mt=p(),vt=u("input"),wt=p(),kt=u("div"),xt=u("div"),bt=u("label"),bt.textContent="Node Distance",_t=p(),$t=u("div"),Mt=d(Ut),At=p(),Nt=u("input"),Et=p(),Tt=u("div"),Tt.textContent="Edge Threshold",Dt=p(),St=u("div"),qt=p(),Lt=u("div"),zt=u("div"),Ht=u("label"),Ht.textContent="Attention >",jt=p(),Ft=u("div"),It=d(Gt),Pt=p(),Ct=u("input"),Bt=p(),Wt=h("svg"),g(a,"class","graph-label svelte-fod5ym"),g(_,"name","layer"),g(_,"class","select-num svelte-fod5ym"),g(_,"id","select-layer"),g(b,"class","select select-num-div svelte-fod5ym"),g(E,"name","layer"),g(E,"class","select-num svelte-fod5ym"),g(E,"id","select-head"),g(N,"class","select select-num-div svelte-fod5ym"),g(w,"class","name svelte-fod5ym"),g(D,"class","sep-line-horizontal svelte-fod5ym"),g(L,"class","setting-icon svelte-fod5ym"),v(L,"active",e[2]),g(H,"class","sep-line-vertical svelte-fod5ym"),g(I,"name","layout"),g(I,"id","select-layout"),g(I,"class","svelte-fod5ym"),g(F,"class","select svelte-fod5ym"),g(q,"class","select-row svelte-fod5ym"),g(B,"class","sep-line-horizontal longer-line svelte-fod5ym"),g(O,"class","slider-title svelte-fod5ym"),g(X,"class","sep-line-horizontal svelte-fod5ym"),g(G,"for","attention"),g(G,"class","svelte-fod5ym"),g(Q,"class","slider-value svelte-fod5ym"),g(U,"class","slider-text svelte-fod5ym"),g(tt,"type","range"),g(tt,"min","0"),g(tt,"max","1000"),tt.value="500",g(tt,"class","slider svelte-fod5ym"),g(tt,"id","attention"),g(V,"class","slider svelte-fod5ym"),g(at,"for","textOrder"),g(at,"class","svelte-fod5ym"),g(lt,"class","slider-value svelte-fod5ym"),g(rt,"class","slider-text svelte-fod5ym"),g(ct,"type","range"),g(ct,"min","0"),g(ct,"max","1000"),ct.value="500",g(ct,"class","slider svelte-fod5ym"),g(ct,"id","textOrder"),g(nt,"class","slider svelte-fod5ym"),g(pt,"for","manyBody"),g(pt,"class","svelte-fod5ym"),g(gt,"class","slider-value svelte-fod5ym"),g(dt,"class","slider-text svelte-fod5ym"),g(vt,"type","range"),g(vt,"min","0"),g(vt,"max","1000"),vt.value="500",g(vt,"class","slider svelte-fod5ym"),g(vt,"id","manyBody"),g(ht,"class","slider svelte-fod5ym"),g(bt,"for","collide"),g(bt,"class","svelte-fod5ym"),g($t,"class","slider-value svelte-fod5ym"),g(xt,"class","slider-text svelte-fod5ym"),g(Nt,"type","range"),g(Nt,"min","0"),g(Nt,"max","1000"),Nt.value="500",g(Nt,"class","slider svelte-fod5ym"),g(Nt,"id","collideRadius"),g(kt,"class","slider svelte-fod5ym"),g(Tt,"class","slider-title svelte-fod5ym"),g(St,"class","sep-line-horizontal svelte-fod5ym"),g(Ht,"for","threshold"),g(Ht,"class","svelte-fod5ym"),g(Ft,"class","slider-value svelte-fod5ym"),g(zt,"class","slider-text svelte-fod5ym"),g(Ct,"type","range"),g(Ct,"min","0"),g(Ct,"max","1000"),Ct.value="500",g(Ct,"step","200"),g(Ct,"class","slider svelte-fod5ym"),g(Ct,"id","threshold"),g(Lt,"class","slider svelte-fod5ym"),g(C,"class","slider-container svelte-fod5ym"),v(C,"active",e[2]),g(m,"class","svg-control-panel svelte-fod5ym"),g(Wt,"class","graph-svg"),g(r,"class","svg-container svelte-fod5ym"),g(n,"class","graph-view svelte-fod5ym")},m(t,s){o(t,n,s),l(n,r),l(r,a),l(r,i),l(r,m),l(m,w),l(w,k),l(k,x),l(k,b),l(b,_);for(let t=0;t<Qt.length;t+=1)Qt[t].m(_,null);l(w,$),l(w,M),l(M,A),l(M,N),l(N,E);for(let t=0;t<Jt.length;t+=1)Jt[t].m(E,null);l(m,T),l(m,D),l(m,S),l(m,q),l(q,L),l(q,z),l(q,H),l(q,j),l(q,F),l(F,I);for(let t=0;t<ee.length;t+=1)ee[t].m(I,null);l(m,P),l(m,C),l(C,B),l(C,W),l(C,O),l(C,R),l(C,X),l(C,Y),l(C,V),l(V,U),l(U,G),l(U,K),l(U,Q),l(Q,Z),l(V,J),l(V,tt),l(C,et),l(C,nt),l(nt,rt),l(rt,at),l(rt,it),l(rt,lt),l(lt,ot),l(nt,st),l(nt,ct),l(C,ut),l(C,ht),l(ht,dt),l(dt,pt),l(dt,ft),l(dt,gt),l(gt,yt),l(ht,mt),l(ht,vt),l(C,wt),l(C,kt),l(kt,xt),l(xt,bt),l(xt,_t),l(xt,$t),l($t,Mt),l(kt,At),l(kt,Nt),l(C,Et),l(C,Tt),l(C,Dt),l(C,St),l(C,qt),l(C,Lt),l(Lt,zt),l(zt,Ht),l(zt,jt),l(zt,Ft),l(Ft,It),l(Lt,Pt),l(Lt,Ct),l(r,Bt),l(r,Wt),e[10](Wt),Ot||(Rt=f(L,"click",e[7]),Ot=!0)},p(t,e){if(0&e){let n;for(Kt=[...Array(12).keys()],n=0;n<Kt.length;n+=1){const r=Ol(t,Kt,n);Qt[n]?Qt[n].p(r,e):(Qt[n]=Rl(r),Qt[n].c(),Qt[n].m(_,null))}for(;n<Qt.length;n+=1)Qt[n].d(1);Qt.length=Kt.length}if(0&e){let n;for(Zt=[...Array(12).keys()],n=0;n<Zt.length;n+=1){const r=Wl(t,Zt,n);Jt[n]?Jt[n].p(r,e):(Jt[n]=Xl(r),Jt[n].c(),Jt[n].m(E,null))}for(;n<Jt.length;n+=1)Jt[n].d(1);Jt.length=Zt.length}if(4&e[0]&&v(L,"active",t[2]),32&e[0]){let n;for(te=Object.values(t[5]),n=0;n<te.length;n+=1){const r=Bl(t,te,n);ee[n]?ee[n].p(r,e):(ee[n]=Yl(r),ee[n].c(),ee[n].m(I,null))}for(;n<ee.length;n+=1)ee[n].d(1);ee.length=te.length}24&e[0]&&Xt!==(Xt=(t[3].autoAttention?"auto":t[6](t[4].force.attention,2))+"")&&y(Z,Xt),16&e[0]&&Yt!==(Yt=t[6](t[4].force.textOrder,2)+"")&&y(ot,Yt),16&e[0]&&Vt!==(Vt=t[6](t[4].force.manyBody,2)+"")&&y(yt,Vt),16&e[0]&&Ut!==(Ut=t[6](t[4].force.collideRadius,2)+"")&&y(Mt,Ut),2&e[0]&&Gt!==(Gt=t[6](t[1],2)+"")&&y(It,Gt),4&e[0]&&v(C,"active",t[2])},i:t,o:t,d(t){t&&s(n),c(Qt,t),c(Jt,t),c(ee,t),e[10](null),Ot=!1,Rt()}}}const Ul=19,Gl=.3;let Kl=.02,Ql="hsl(0, 0%, 76%)",Zl="hsl(36, 100%, 55%)";function Jl(t,e,n){let{attentionDataDir:r}=e,{saliencyDataFilepath:a}=e,i=void 0,l=1562,o=9,s=8,c={layer:9,head:8},u=null,h=null,d=null,p=null,f=void 0,g=void 0,y=null;const m=3,v=3,w=3,k=3;let x=null,_=null,$=1,A=.016,N=Kl+A*$,E={},T=null,D=new Map,S=null,q=null,L=!1,z=null;const H=Ea,j={force:{value:"force",name:"Force Layout"},radial:{value:"radial",name:"Radial Layout"},grid:{value:"grid",name:"Grid Layout"}};let F={borderConstraint:!0,showHiddenLink:!1,showHiddenNode:!1,autoAttention:!0,defaultLayout:j.radial},I={force:{manyBody:-840,attention:.5,textOrder:1.6,collideRadius:1},radial:{textOrder:.5,radial:1},grid:{collideRadius:7}},P=F.defaultLayout;const C=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e,B=(t,e)=>Array(Math.max(e-String(t).length+1,0)).join(0)+t,W=()=>function(){var t,e,n,r,a=an,i=ln,l=on,o=sn,s={},c=St("start","drag","end"),u=0,h=0;function d(t){t.on("mousedown.drag",p).filter(o).on("touchstart.drag",y).on("touchmove.drag",m).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(l,o){if(!r&&a.call(this,l,o)){var s=w(this,i.call(this,l,o),l,o,"mouse");s&&(Ge(l.view).on("mousemove.drag",f,!0).on("mouseup.drag",g,!0),tn(l.view),Ze(l),n=!1,t=l.clientX,e=l.clientY,s("start",l))}}function f(r){if(Je(r),!n){var a=r.clientX-t,i=r.clientY-e;n=a*a+i*i>h}s.mouse("drag",r)}function g(t){Ge(t.view).on("mousemove.drag mouseup.drag",null),en(t.view,n),Je(t),s.mouse("end",t)}function y(t,e){if(a.call(this,t,e)){var n,r,l=t.changedTouches,o=i.call(this,t,e),s=l.length;for(n=0;n<s;++n)(r=w(this,o,t,e,l[n].identifier,l[n]))&&(Ze(t),r("start",t,l[n]))}}function m(t){var e,n,r=t.changedTouches,a=r.length;for(e=0;e<a;++e)(n=s[r[e].identifier])&&(Je(t),n("drag",t,r[e]))}function v(t){var e,n,a=t.changedTouches,i=a.length;for(r&&clearTimeout(r),r=setTimeout((function(){r=null}),500),e=0;e<i;++e)(n=s[a[e].identifier])&&(Ze(t),n("end",t,a[e]))}function w(t,e,n,r,a,i){var o,h,p,f=c.copy(),g=Ke(i||n,e);if(null!=(p=l.call(t,new rn("beforestart",{sourceEvent:n,target:d,identifier:a,active:u,x:g[0],y:g[1],dx:0,dy:0,dispatch:f}),r)))return o=p.x-g[0]||0,h=p.y-g[1]||0,function n(i,l,c){var y,m=g;switch(i){case"start":s[a]=n,y=u++;break;case"end":delete s[a],--u;case"drag":g=Ke(c||l,e),y=u}f.call(i,t,new rn(i,{sourceEvent:l,subject:p,target:d,identifier:a,active:y,x:g[0]+o,y:g[1]+h,dx:g[0]-m[0],dy:g[1]-m[1],dispatch:f}),r)}}return d.filter=function(t){return arguments.length?(a="function"==typeof t?t:nn(!!t),d):a},d.container=function(t){return arguments.length?(i="function"==typeof t?t:nn(t),d):i},d.subject=function(t){return arguments.length?(l="function"==typeof t?t:nn(t),d):l},d.touchable=function(t){return arguments.length?(o="function"==typeof t?t:nn(!!t),d):o},d.on=function(){var t=c.on.apply(c,arguments);return t===c?d:t},d.clickDistance=function(t){return arguments.length?(h=(t=+t)*t,d):Math.sqrt(h)},d}().on("start",(t=>{t.active||T.alphaTarget(.3).restart(),t.subject.fx=t.subject.x,t.subject.fy=t.subject.y,Ge(t.sourceEvent.originalTarget.parentNode).append("rect").attr("class","fixed-marker").attr("x",-3).attr("y",6).attr("width",6).attr("height",5).style("fill","white")})).on("drag",(t=>{t.subject.fx=t.x,t.subject.fy=t.y})).on("end",(t=>{t.active||T.alphaTarget(0)})),O=(t,e)=>{let n=Ul;t.hidden||(n=e(+t.saliency));let r=f-v-w,a=g-m-k;const i=Math.max(v+n,Math.min(r-n,t.x)),l=Math.max(m+n,Math.min(a-n,t.y));return F.borderConstraint?{top:l,left:i}:{top:t.y,left:t.x}},R=(t,e,r,a,i=null)=>{let l=Ge("#"+t).property("value",(a-e)/(r-e)*1e3);l.on("input",(()=>{let a=+l.property("value"),o=a/1e3*(r-e)+e,s=a/200;switch(n(4,I.force[t]=o,I),t){case"attention":T.force("attentionLink").strength(o),Ge("#checkbox-auto-attention").property("checked",!1),n(3,F.autoAttention=!1,F);break;case"textOrder":T.force("textLink").strength((t=>0===t.target.index?0:o));break;case"manyBody":T.force("charge").strength(o);break;case"collideRadius":T.force("collide").radius((t=>i(t.saliency)+o));break;case"threshold":n(1,N=Kl+s*A),Q(s)}T.restart()})),l.on("mousedown",(t=>{t.active||T.alphaTarget(.2).restart()})),l.on("mouseup",(t=>{t.active||T.alphaTarget(0)}))},X=t=>{P=F.defaultLayout;let e=Ge("#select-layout").property("value",F.defaultLayout.value);e.on("change",(()=>{let n=e.property("value");if(n!==P.value){switch(T.force("collide",null),T.force("attentionLink",null),T.force("charge",null),T.force("center",null),T.force("textLink",null),T.force("hiddenTextLink",null),T.force("posX",null),T.force("posY",null),T.force("grid",null),n){case"force":P=j.force,V(t),T.alpha(1).restart();break;case"radial":P=j.radial,G(),T.alpha(1).restart();break;case"grid":P=j.grid,K(),T.alpha(1).restart()}Y(t)}T.alpha(1).restart()}))};ut.subscribe((t=>{c=t,c.layer===o&&c.head===s||(Ge("#select-layer").property("value",c.layer),Ge("#select-head").property("value",c.head),o=c.layer,s=c.head,lt())}));const Y=t=>{Ge(u).select("g.node-group").selectAll("circle").transition("node-radius").duration(300).ease(H).attr("r",(e=>"force"===P.value?t(+e.saliency):Ul))},V=t=>{T.force("charge",function(){var t,e,n,r,a,i=Va(-30),l=1,o=1/0,s=.81;function c(n){var a,i=t.length,l=Oa(t,ei,ni).visitAfter(h);for(r=n,a=0;a<i;++a)e=t[a],l.visit(d)}function u(){if(t){var e,n,r=t.length;for(a=new Array(r),e=0;e<r;++e)n=t[e],a[n.index]=+i(n,e,t)}}function h(t){var e,n,r,i,l,o=0,s=0;if(t.length){for(r=i=l=0;l<4;++l)(e=t[l])&&(n=Math.abs(e.value))&&(o+=e.value,s+=n,r+=n*e.x,i+=n*e.y);t.x=r/s,t.y=i/s}else{(e=t).x=e.data.x,e.y=e.data.y;do{o+=a[e.data.index]}while(e=e.next)}t.value=o}function d(t,i,c,u){if(!t.value)return!0;var h=t.x-e.x,d=t.y-e.y,p=u-i,f=h*h+d*d;if(p*p/s<f)return f<o&&(0===h&&(f+=(h=Ua(n))*h),0===d&&(f+=(d=Ua(n))*d),f<l&&(f=Math.sqrt(l*f)),e.vx+=h*t.value*r/f,e.vy+=d*t.value*r/f),!0;if(!(t.length||f>=o)){(t.data!==e||t.next)&&(0===h&&(f+=(h=Ua(n))*h),0===d&&(f+=(d=Ua(n))*d),f<l&&(f=Math.sqrt(l*f)));do{t.data!==e&&(p=a[t.data.index]*r/f,e.vx+=h*p,e.vy+=d*p)}while(t=t.next)}}return c.initialize=function(e,r){t=e,n=r,u()},c.strength=function(t){return arguments.length?(i="function"==typeof t?t:Va(+t),u(),c):i},c.distanceMin=function(t){return arguments.length?(l=t*t,c):Math.sqrt(l)},c.distanceMax=function(t){return arguments.length?(o=t*t,c):Math.sqrt(o)},c.theta=function(t){return arguments.length?(s=t*t,c):Math.sqrt(s)},c}().strength(I.force.manyBody)),T.force("center",function(t,e){var n,r=1;function a(){var a,i,l=n.length,o=0,s=0;for(a=0;a<l;++a)o+=(i=n[a]).x,s+=i.y;for(o=(o/l-t)*r,s=(s/l-e)*r,a=0;a<l;++a)(i=n[a]).x-=o,i.y-=s}return null==t&&(t=0),null==e&&(e=0),a.initialize=function(t){n=t},a.x=function(e){return arguments.length?(t=+e,a):t},a.y=function(t){return arguments.length?(e=+t,a):e},a.strength=function(t){return arguments.length?(r=+t,a):r},a}(f/2,g/2)),T.force("attentionLink",Ja(E[$].links).id((t=>t.id))),T.force("textLink",Ja(E[$].hiddenLinks).id((t=>t.id)).strength((t=>0===t.target.index?0:I.force.textOrder))),T.force("collide",function(t){var e,n,r,a=1,i=1;function l(){for(var t,l,s,c,u,h,d,p=e.length,f=0;f<i;++f)for(l=Oa(e,Ga,Ka).visitAfter(o),t=0;t<p;++t)s=e[t],h=n[s.index],d=h*h,c=s.x+s.vx,u=s.y+s.vy,l.visit(g);function g(t,e,n,i,l){var o=t.data,p=t.r,f=h+p;if(!o)return e>c+f||i<c-f||n>u+f||l<u-f;if(o.index>s.index){var g=c-o.x-o.vx,y=u-o.y-o.vy,m=g*g+y*y;m<f*f&&(0===g&&(m+=(g=Ua(r))*g),0===y&&(m+=(y=Ua(r))*y),m=(f-(m=Math.sqrt(m)))/m*a,s.vx+=(g*=m)*(f=(p*=p)/(d+p)),s.vy+=(y*=m)*f,o.vx-=g*(f=1-f),o.vy-=y*f)}}}function o(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function s(){if(e){var r,a,i=e.length;for(n=new Array(i),r=0;r<i;++r)a=e[r],n[a.index]=+t(a,r,e)}}return"function"!=typeof t&&(t=Va(null==t?1:+t)),l.initialize=function(t,n){e=t,r=n,s()},l.iterations=function(t){return arguments.length?(i=+t,l):i},l.strength=function(t){return arguments.length?(a=+t,l):a},l.radius=function(e){return arguments.length?(t="function"==typeof e?e:Va(+e),s(),l):t},l}().radius((e=>t(e.saliency)+I.force.collideRadius)))},G=()=>{T.force("textLink",Ja(E[$].hiddenLinks).id((t=>t.id)).strength(I.radial.textOrder)),T.force("posY",li().y(((t,e)=>{let n=_.filter((t=>!t.hidden)).length,r=-Math.PI/2+e*(2*Math.PI/n);return g/2+225*Math.sin(r)})).strength(I.radial.radial)),T.force("posX",ii().x(((t,e)=>{let n=_.filter((t=>!t.hidden)).length,r=-Math.PI/2+e*(2*Math.PI/n);return f/2+225*Math.cos(r)})).strength(I.radial.radial))},K=()=>{let t=8,e=Math.ceil(x/t),n=549,r=2*e*Ul+35*(e-1);for(;r>g;)if(t=9,n=549,r=2*e*Ul+35*(e-1),n>f){console.log("Failed to initialize grid layout");break}let a=Math.floor((f-n)/2),i=Math.floor((g-r)/2);T.force("grid",Ja(E[$].gridLinks).iterations(80).distance(50).id((t=>t.id))),T.force("posX",ii().x(((t,e)=>a+e%8*73+Ul)).strength((t=>void 0===t.id?0:1))),T.force("posY",li().y(((t,e)=>i+73*Math.floor(e/8)+Ul)).strength((t=>void 0===t.id?0:1)))},Q=t=>{$=t;let e=Ge(u).select("g.attention-link-group").selectAll("path.link").data(E[$].biLinks,(t=>`${t[0].id}-${t[1].id}`));e.enter().append("path").attr("marker-end","url(#arrow)").attr("class","link").attr("id",(t=>`link-${t[0].id}-${t[1].id}`)).style("stroke","hsl(150, 74%, 51%)").style("stroke-width",(t=>S(t.attention))).transition().duration(900).ease(H).style("stroke",Ql),e.exit().style("stroke","hsl(349, 81%, 57%)").transition().duration(900).ease(H).style("opacity",0).on("end",((t,e,n)=>{Ge(n[e]).remove()})),T.nodes(E[$].nodes),T.alpha(1).restart()},Z=(t,e,n)=>{t=t.map((t=>Object.create(t)));let r=_.slice(),a=[];for(let t=0;t<r.length-1;t++){let e={source:+r[t].id,target:+r[t+1].id};a.push(e)}a.push({source:+r[r.length-1].id,target:r[0].id}),a=a.map((t=>Object.create(t)));let i=[];t.forEach((n=>{let a=e.get(n.source),l=e.get(n.target),o=[a,l];if(o.selfLoop=!1,o.attention=+n.weight,a===l){o.selfLoop=!0;let e={hidden:!0};D.has(a)?e=D.get(a):D.set(a,e),o.push(e),r.push(e),t.push({source:e,target:a})}i.push(o)}));let l=[];n.sort(((t,e)=>+t-+e));for(let t=0;t<r.length;t++)t%8!=7&e.has(t+1)&&l.push({source:e.get(t),target:e.get(t+1)}),e.has(t+8)&&l.push({source:e.get(t),target:e.get(t+8)});return{links:t,hiddenLinks:a,biLinks:i,gridLinks:l,nodes:r}},J=(t,e,n,r,a,i,l,o)=>{let s=Ge(t.target).data()[0].id;for(let t=E[$].nodes.length-1;t>=0;t--)E[$].nodes[t].id===s&&E[$].nodes.splice(t,1);e.selectAll("g.node").data(E[$].nodes.filter((t=>void 0!==t.id)),(t=>t.id)).exit().remove();for(let t=E[$].biLinks.length-1;t>=0;t--)E[$].biLinks[t][0].id===s|E[$].biLinks[t][1].id===s&&E[$].biLinks.splice(t,1);for(let t=E[$].links.length-1;t>=0;t--)E[$].links[t].source.id===s|E[$].links[t].target.id===s&&E[$].links.splice(t,1);for(let t=E[$].hiddenLinks.length-1;t>=0;t--)E[$].hiddenLinks[t].source.id===s?E[$].hiddenLinks.splice(t,1):E[$].hiddenLinks[t].target.id===s&&(t+1<E[$].hiddenLinks.length?E[$].hiddenLinks[t].target=E[$].hiddenLinks[t+1].source:E[$].hiddenLinks[t].target=E[$].hiddenLinks[0].source);E[$].gridLinks=[],a=new Set,E[$].nodes.forEach((t=>{void 0!==t.id&&a.add(+t.id)})),(r=Array.from(a)).sort(((t,e)=>+t-+e));for(let t=0;t<r.length-1;t++){let e=r[t];t%8!=7&l.has(r[t+1])&&E[$].gridLinks.push({source:l.get(e),target:l.get(r[t+1])}),l.has(r[t+8])&&E[$].gridLinks.push({source:l.get(e),target:l.get(r[t+8])})}n.selectAll("path.link").data(E[$].biLinks,(t=>`${t[0].id}-${t[1].id}`)).exit().remove(),(t=>{switch(P.value){case"force":V(t);break;case"radial":G();break;case"grid":K()}})(i),o.alpha(.3).restart()},tt=t=>{let e=Ge(u).select("g.attention-link-group").selectAll("path.link");switch(P.value){case"force":e.attr("d",(e=>((t,e)=>{const n=O(t[0],e),r=O(t[1],e);if(t.selfLoop){const a=O(t[2],e);let i=Math.sqrt((r.left-a.left)**2+(r.top-a.top)**2)-e(t[0].saliency);a.left=r.left+(a.left-r.left)/i*80,a.top=r.top+(a.top-r.top)/i*80;const l=[a.left-n.left,a.top-n.top],o=Math.sqrt(l[0]**2+l[1]**2),s=50,c=[-l[1]/o*s,l[0]/o*s],u=[l[1]/o*s,-l[0]/o*s],h=[n.left+l[0]+c[0],n.top+l[1]+c[1]],d=[n.left+l[0]+u[0],n.top+l[1]+u[1]];let p=Math.sqrt((r.left-d[0])**2+(r.top-d[1])**2),f=(e(t[0].saliency)+10)/p,g={left:r.left+(d[0]-r.left)*f,top:r.top+(d[1]-r.top)*f};return"M"+n.left+","+n.top+"C"+h[0]+","+h[1]+" "+d[0]+","+d[1]+" "+g.left+","+g.top}{let a=Math.sqrt((r.left-n.left)**2+(r.top-n.top)**2),i=(e(t[1].saliency)+10)/a,l={left:r.left+(n.left-r.left)*i,top:r.top+(n.top-r.top)*i};return"M"+n.left+","+n.top+"L"+l.left+","+l.top}})(e,t)));break;case"radial":e.attr("d",(e=>((t,e)=>{const n=O(t[0],e),r=O(t[1],e);let a=n.left,i=n.top,l=r.left,o=r.top,s=f/2,c=g/2+40,u=1-29/225,h=s+(l-s)*u,d=c+(o-c)*u,p=s+(a-s)*u,y=c+(i-c)*u;return`M ${p},${y} C${s+(p-s)*Gl}, ${c+(y-s)*Gl},\n      ${s+(h-s)*Gl}, ${c+(d-s)*Gl}, ${h},${d}`})(e,t)));break;case"grid":e.attr("d",(e=>((t,e)=>{const n=O(t[0],e),r=O(t[1],e);let a=29/Math.sqrt((r.left-n.left)**2+(r.top-n.top)**2),i=r.left+(n.left-r.left)*a,l=r.top+(n.top-r.top)*a;return"M"+n.left+","+n.top+"L"+i+","+l})(e,t)));break;default:console.log("Unexpected case.")}Ge(u).select("g.node-group").selectAll("g.node").attr("transform",(e=>((t,e)=>{const n=O(t,e);return`translate(${n.left}, ${n.top})`})(e,t)))},et=()=>{let t=Ge(u),e=h.nodes.map((t=>Object.create(t)));e.sort(((t,e)=>+t.id-+e.id));let n={};e.forEach((t=>{let e=0;void 0===n[t.token]?n[t.token]=e+1:(e=n[t.token],n[t.token]+=1),t.name=`${ot(t.token)}-${e}`})),_=e.slice();let r=new Set;h.nodes.forEach((t=>r.add(+t.id)));let a=Array.from(r),i=new Map(e.map((t=>[t.id,t])));E={};for(let t=0;t<6;t++){let e=C(Kl+t*A,2),n=h.links.filter((t=>t.weight>e)),r=Z(n,i,a);E[t]={links:r.links.slice(),hiddenLinks:r.hiddenLinks.slice(),biLinks:r.biLinks.slice(),gridLinks:r.gridLinks.slice(),nodes:r.nodes.slice()}}let l=e.map((t=>+t.saliency));q=Ji().domain(ft(l)).range([Ul,40]).unknown(0).nice();let o=wt(l.map(Math.abs)),s="#E50035",c="#ffffff",d=Ji().domain([0,o]).range([Sn(c),Sn(s)]).unknown(Sn("white")),p=E[0].links.map((t=>+t.weight));S=Ji().domain(ft(p)).range([.5,3]).nice();let m=t.append("g").attr("class","attention-link-group").attr("stroke",Ql);m.selectAll("path.link").data(E[$].biLinks,(t=>`${t[0].id}-${t[1].id}`)).join("path").attr("class","link").attr("id",(t=>`link-${t[0].name}-${t[1].name}`)).attr("marker-end","url(#arrow)").style("stroke-width",(t=>S(t.attention)));let w=t.append("g").attr("class","node-group"),k=w.selectAll("g.node").data(E[$].nodes.filter((t=>void 0!==t.id)),(t=>t.id)).join("g").attr("class","node").attr("id",(t=>"node-"+t.name)).attr("transform",`translate(${f/2}, ${g/2})`).call(W()).on("mouseover",((t,e)=>{y=e.name,at.set(y),st(y)})).on("mouseleave",(()=>{ct(y),y=null,at.set(y)})).on("click",((t,e)=>{null!==e.fx&&null!==e.fy&&(delete e.fx,delete e.fy,Ge(t.target.parentNode).selectAll("rect.fixed-marker").remove(),T.alpha(.2).restart())})).on("dblclick",(t=>J(t,w,m,a,r,q,i,T)));Ji().domain(ft(r)).range([Sn("#D4E5F4"),Sn("#1E6CB0")]);k.append("circle").attr("class","node-circle").attr("r",(t=>"force"===P.value?q(+t.saliency):Ul)).style("fill",(t=>d(+t.saliency))).style("opacity",1).clone(!0).attr("r",(t=>"force"===P.value?q(+t.saliency):Ul)).style("fill",Zl).attr("class","shadow-circle");switch(((t,e,n,r="#eb2f06",a="#4690C2")=>{let i=t.append("defs").append("linearGradient").attr("x1",0).attr("y1",1).attr("x2",0).attr("y2",0).attr("id","legend-gradient-graph");i.append("stop").attr("stop-color",r).attr("offset",0),i.append("stop").attr("stop-color",a).attr("offset",1),t.append("rect").attr("x",0).attr("y",0).attr("width",e.width).attr("height",e.height).style("fill","url(#legend-gradient-graph)").style("stroke","black");let l=Ji().domain([0,n]).range([e.height,0]).nice();t.append("g").attr("transform",`translate(${e.width}, 0)`).call(Tt(l).ticks(5)),t.append("text").attr("x",0).attr("y",e.height+8).style("font-size","12px").style("fill","hsl(0, 0%, 40%)").style("dominant-baseline","hanging").style("text-anchor","left").text("Semantic Saliency Score")})(t.append("g").attr("class","legend-group").attr("transform",`translate(${v+3}, ${g-130})`),{width:10,height:100},o,c,s),k.append("text").attr("class","node-text").style("font-weight",600).text((t=>t.token)).filter((t=>tr(d(+t.saliency)).l<66)).clone(!0).lower().style("stroke-linejoin","round").attr("stroke-width",4).attr("stroke","white"),k.selectAll("circle").lower(),k.append("title").text((t=>t.token)),null==T?T=ai(E[$].nodes):(T.nodes(E[$].nodes),T.alpha(1).restart()),P.value){case"force":V(q);break;case"radial":G();break;case"grid":K()}return T.on("tick",(()=>tt(q))),q},nt=()=>{let t=Ge(u).attr("width",f).attr("height",g);t.append("rect").attr("class","border-rect").attr("width",f).attr("height",g).style("stroke","black").style("fill","none"),t.append("defs").append("marker").attr("id","arrow").attr("viewBox",[0,0,10,10]).attr("refX",0).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke",Ql).attr("fill",Ql),t.append("defs").append("marker").attr("id","arrow-hover").attr("viewBox",[0,0,10,10]).attr("refX",0).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke",Zl).attr("fill",Zl),q=et(),R("attention",0,10,I.force.attention),R("textOrder",0,10,I.force.textOrder),R("manyBody",-2e3,0,I.force.manyBody),R("collideRadius",0,20,I.force.collideRadius,q),R("threshold",Kl,.1,N,q),X(q),(()=>{let t=Ge("#select-layer").property("value",o),e=Ge("#select-head").property("value",s);t.on("change",(()=>{let e=t.property("value");e!==o&&(o=e,lt(),c.layer=+o,c.head=+s,ut.set(c))})),e.on("change",(()=>{let t=e.property("value");t!==s&&(s=t,lt(),c.layer=+o,c.head=+s,ut.set(c))}))})()},lt=()=>{Ge(u).select("g.node-group").remove(),Ge(u).select("g.attention-link-group").remove(),Ge(u).select("g.legend-group").remove(),h=ht(o,s),et()},ot=t=>null==t?null:t.replace(/\./g,"\\.").replace(/,/g,"\\,").replace(/#/g,"").replace(/\[/g,"\\[").replace(/\]/g,"\\]"),st=t=>{Ge(u).select(".attention-link-group").selectAll("path.link").style("opacity",.2),Ge(u).select(".attention-link-group").selectAll("path.link").filter(((e,n,r)=>Ge(r[n]).attr("id").includes("-"+t))).attr("marker-end","url(#arrow-hover)").classed("highlighted",!0).style("stroke",null).style("stroke-width",2).style("opacity",.8).raise(),Ge(u).select(".node-group").selectAll(".node").filter(((e,n,r)=>Ge(r[n]).attr("id").includes("-"+t))).raise().select(".shadow-circle").attr("r",(t=>"force"===P.value?q(+t.saliency)+5:24)).style("stroke","white").style("stroke-width",1.5)},ct=t=>{Ge(u).select(".attention-link-group").selectAll("path.link").style("opacity",null),Ge(u).select(".attention-link-group").selectAll("path.link").filter(((e,n,r)=>Ge(r[n]).attr("id").includes("-"+t))).classed("highlighted",!1).attr("marker-end","url(#arrow)").style("stroke",Ql).style("stroke-width",(t=>S(t.attention))).style("opacity",null),Ge(u).select(".node-group").selectAll(".node").filter(((e,n,r)=>Ge(r[n]).attr("id").includes("-"+t))).select(".shadow-circle").attr("r",(t=>"force"===P.value?q(+t.saliency):Ul)).style("stroke",null).style("stroke-width",null).lower()},ht=(t,e)=>{let n=z[t][e],r={nodes:[],links:[]},a=d[String(l)].meta.predicted_label;d[String(l)].tokens.forEach(((t,e)=>{r.nodes.push({token:t.token,saliency:t[a],id:e})}));for(let t=0;t<r.nodes.length;t++)for(let e=0;e<r.nodes.length;e++)r.links.push({source:t,target:e,weight:n[t][e]});return r};at.subscribe((t=>{null!=t?(y=t,void 0!==p[y.replace(/(.*)-\d*/,"$1")]?p[y.replace(/(.*)-\d*/,"$1")].forEach((t=>{st(t)})):st(y)):(null!=y&&(void 0!==p[y.replace(/(.*)-\d*/,"$1")]?p[y.replace(/(.*)-\d*/,"$1")].forEach((t=>{ct(t)})):ct(y)),y=t)}));const dt=async()=>{null==z&&(z=await Ia(r+`attention-${B(l,4)}.json`)),null==d&&(d=await Ia(a),x=d[l].tokens.length),h=ht(o,s),nt()};return b((async()=>{null==z&&(z=await Ia(r+`attention-${B(l,4)}.json`)),null==d&&(d=await Ia(a),x=d[l].tokens.length)})),U.subscribe((t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===i||i.compHeight!==t.compHeight&&i.compWidth!==t.compWidth)&&(i=t,g=i.compHeight,f=i.compWidth,dt())})),it.subscribe((t=>{p=t})),rt.subscribe((t=>{t!==l&&(Ge(u).selectAll("*").remove(),z=null,d=null,l=t,dt())})),t.$$set=t=>{"attentionDataDir"in t&&n(8,r=t.attentionDataDir),"saliencyDataFilepath"in t&&n(9,a=t.saliencyDataFilepath)},[u,N,L,F,I,j,C,()=>{n(2,L=!L)},r,a,function(t){M[t?"unshift":"push"]((()=>{u=t,n(0,u)}))}]}class to extends O{constructor(t){super(),W(this,t,Jl,Vl,i,{attentionDataDir:8,saliencyDataFilepath:9},[-1,-1,-1])}}const eo=(t,e,n="1em")=>{let r={},a=null,i=e.append("g").attr("class","hidden-text").style("opacity",0),l=i.selectAll(".text-token").data(t).join("text").attr("class","text-token").style("font-size",n).text((t=>t));return l.each((function(t,e){let n=this.getBBox();r[e]=+Number(n.width).toFixed(2),null==a&&(a=n.height)})),i.remove(),l.remove(),{textTokenWidths:r,textTokenHeight:a}},no=t=>null==t?null:t.replace(/\./g,"\\.").replace(/,/g,"\\,").replace(/#/g,"").replace(/\[/g,"\\[").replace(/\]/g,"\\]"),ro=t=>"[CLS]"===t||"[SEP]"===t||"[PAD]"===t,ao=(t,e)=>{t.attr("width",e).select("rect.border-rect").attr("width",e),Ge(".instance-container").select(".panel-container").style("width",e+"px")},io=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e,lo=(t,e,n,r,a,i,l,o)=>{if(void 0!==t.tokens[0].id){let e={};t.tokens.forEach((t=>{let n=0;void 0===e[t.token]?e[t.token]=n+1:(n=e[t.token],e[t.token]+=1),t.id=`${no(t.token)}-${n}`}))}let s=t.tokens,c=t.meta.predicted_label,u=wt(t.tokens.map((t=>Math.abs(t[c])))),h=Ji().domain([0,u]).range([Sn("#ffffff"),Sn("#E50035")]),d=eo(s.map((t=>t.token)),e),p=d.textTokenWidths,f=d.textTokenHeight,g=.8*n;const y=f+a.top+a.bottom+10;let m=e.append("g").attr("class","token-group-saliency").attr("transform",`translate(${r.left+n*(1-.8)/2},\n      ${r.top+70})`).append("g").attr("class","node-group").selectAll("g").data(s,(t=>t.id)).join("g").attr("class",(t=>{let e="node node-"+t.id;return void 0!==i[t.token]&&i[t.token].forEach((t=>{e+=" node-"+t})),e})).attr("id",(t=>"node-"+t.id)).on("mouseover",l).on("mouseleave",o),v={x:0,y:0},w=Object.keys(p).length;m.each((function(t,e){Ge(this).attr("transform",`translate(${v.x}, ${v.y})`);let n=v.x+p[e]+a.left+a.right+5;e+1<w&&(n+=p[e+1]),n>g?(v.y+=y,v.x=0):v.x=v.x+p[e]+a.left+a.right+5})),m.append("rect").attr("width",((t,e)=>p[e]+a.left+a.right)).attr("height",f+a.top+a.bottom).attr("rx",5).style("fill",(t=>h(+t[c]))).style("stroke","hsl(180, 1%, 80%)"),m.append("text").attr("class","text-token-arc").attr("x",a.left).attr("y",a.top+2).style("pointer-events","none").text((t=>t.token));let k=e.append("g").attr("class","legend-group").attr("transform",`translate(${r.left+10+.9*n},\n      ${r.top+50})`);oo(k,{width:10,height:150},u)},oo=(t,e,n)=>{let r=t.append("defs").append("linearGradient").attr("x1",0).attr("y1",1).attr("x2",0).attr("y2",0).attr("id","legend-gradient");r.append("stop").attr("stop-color","#FFFFFF").attr("offset",0),r.append("stop").attr("stop-color","#E50035").attr("offset",1),t.append("rect").attr("x",0).attr("y",0).attr("width",e.width).attr("height",e.height).style("fill","url(#legend-gradient)").style("stroke","black");let a=Ji().domain([0,n]).range([e.height,0]).nice();t.append("g").attr("transform",`translate(${e.width}, 0)`).call(Tt(a).ticks(10)),t.append("text").attr("x",5).attr("y",-15).style("font-size","12px").style("dominant-baseline","end").style("text-anchor","middle").text("Saliency Score")},so=(t,e,n,r,a,i,l,o,s,c,u)=>{const h=t.list;let d=t.words.map((t=>({token:t})));if(void 0===e.tokens[0].id){let t={};e.tokens.forEach((e=>{let n=0;void 0===t[e.token]?t[e.token]=n+1:(n=t[e.token],t[e.token]+=1),e.id=`${no(e.token)}-${n}`}))}console.log(e,d),null==n&&(n=u(d,e)),console.log(n);let p={};d.forEach((t=>{let e=0;void 0===p[t.token]?p[t.token]=e+1:(e=p[t.token],p[t.token]+=1),t.id=`${no(t.token)}-${e}`}));let f=eo(d.map((t=>t.token)),r),g=f.textTokenWidths,y=f.textTokenHeight;a={};let m=0;d.forEach(((t,e)=>{a[e]=m,m+=g[e]+5+i.left+i.right}));let v=m+l.left+l.right-5;ao(r,v);let w=r.append("g").attr("class","token-group").attr("transform",`translate(${l.left}, ${l.top})`),k=w.append("g").attr("class","node-group").selectAll("g").data(d).join("g").attr("class",(t=>{let e="node node-"+t.id;return void 0!==n[t.token]&&n[t.token].forEach((t=>{e+=" node-"+t})),e})).attr("id",(t=>"node-"+t.id)).attr("data-id",(t=>t.id)).attr("transform",((t,e)=>`translate(${a[e]}, 0)`)).on("mouseover",s).on("mouseleave",c);k.append("rect").attr("width",((t,e)=>g[e]+i.left+i.right)).attr("height",y+i.top+i.bottom).attr("rx",5),k.append("text").attr("class","text-token-arc").attr("x",i.left).attr("y",i.top+2).style("pointer-events","none").text((t=>t.token));let x=[];h.forEach((t=>{let e=Math.abs(t.child-t.parent),n=void 0,r=void 0,l=void 0;t.parent<t.child?(r=a[t.parent]+i.left+i.right+g[t.parent]-5,l=a[t.child]+5,n=r+(l-r)/2):(r=a[t.parent]+5,l=a[t.child]+i.left+i.right+g[t.child]-5,n=l+(r-l)/2),t.sourceX=r,t.targetX=l,t.middleX=Number.isNaN(n)?0:n,t.gap=e,x.push(t)})),x.sort(((t,e)=>t.gap-e.gap));let b=Array(d.length).fill(1),_={};x.forEach((t=>{if("root"!==t.relation){let e=Math.min(t.child,t.parent),n=Math.max(t.child,t.parent),r=b.slice(e,n+1).reduce(((t,e)=>Math.max(t,e)));b[Math.min(t.child,t.parent)]=r+1,void 0===_[r]&&(_[r]=[]),_[r].push(t)}}));let $=w.append("g").attr("class","arc-group").attr("transform",`translate(0, ${y+i.top+i.bottom})`);return console.log(_),Object.keys(_).forEach(((t,e)=>{$.append("g").attr("class","arc-group-path").selectAll("path.arc-path-"+e).data(_[t],(t=>`${t.parent}-${t.child}`)).join("path").attr("class",(t=>{let r=`arc-path arc-path-${e} arc-path-${d[t.parent].id}-${d[t.child].id}`;return void 0!==n[d[t.parent].token]&&n[d[t.parent].token].forEach((e=>{r+=` arc-path-${e}-${d[t.child].id}`})),void 0!==n[d[t.child].token]&&n[d[t.child].token].forEach((e=>{r+=` arc-path-${d[t.parent].id}-${e}`})),r})).classed("arc-path--lr",(t=>t.parent<t.child)).classed("arc-path--rl",(t=>t.parent>t.child)).attr("id",(t=>`arc-path-${d[t.parent].id}-${d[t.child].id}`)).attr("d",(t=>{let n=t.sourceX,r=t.targetX,a=15*(e+1),i=0===e?5:15;return`M${n} 0\n            L${n} ${a-i}\n            Q${n<r?n+0:n-0} ${a}, ${n<r?n+i:n-i} ${a}\n            L${n<r?r-i:r+i} ${a}\n            Q${n<r?r-0:r+0} ${a}, ${r} ${a-i}\n            L${r} 3`})),$.append("g").attr("class","arc-group-text").selectAll("text.arc-path-text-"+e).data(_[t],(t=>`${t.parent}-${t.child}`)).join("text").attr("class",(t=>{let r=`arc-text arc-path-text-${e} arc-path-text-${d[t.parent].id}-${d[t.child].id}`;return void 0!==n[d[t.parent].token]&&n[d[t.parent].token].forEach((e=>{r+=` arc-path-text-${e}-${d[t.child].id}`})),void 0!==n[d[t.child].token]&&n[d[t.child].token].forEach((e=>{r+=` arc-path-text-${d[t.parent].id}-${e}`})),r})).attr("x",(t=>t.middleX)).attr("y",15*(e+1)-1).text((t=>"root"===t.relation?"":t.relation)).clone(!0).lower().attr("class",`arc-text arc-path-text-${e} shadow`).attr("stroke-width",5).attr("stroke","white"),$.selectAll(".arc-group-path").lower()})),{tokenXs:a,textTokenWidths:g}};let co={},uo={};ot.subscribe((t=>{uo=t}));let ho=new Map;lt.subscribe((t=>{ho=t}));const po=(t,e,n,r,a,i=.02)=>{let l=n[t][e],o=new Map,s=new Map,c=r.words.map((t=>({token:t}))),u=0;for(;ro(a.tokens[u].token);)u+=1;for(let t=0;t<c.length;t++){if(c[t].token!==a.tokens[u].token){let e=[],n=t+1<c.length?c[t+1].token:null;for(;a.tokens[u].token!==n;)e.push(u),s.set(u,t),u+=1;o.set(e[0],e)}else s.set(u,t),u+=1}let h=[];for(let t=0;t<a.tokens.length;t++){if(ro(a.tokens[t].token))continue;let e=null,n=-1,r=l[t];if(o.has(t)){let e=o.get(t);for(let t=0;t<r.length;t++){let n=0;for(let r=0;r<e.length;r++)n+=l[r][t];r[t]=n/e.length}t=e[e.length-1]}for(let t=0;t<a.tokens.length;t++){if(ro(a.tokens[t].token))continue;let i=0;o.has(t)?o.get(t).forEach((e=>{t=e,i+=r[t]})):i=r[t],i>n&&(e=s.get(t),n=i)}n>i&&h.push({parent:s.get(t),child:e})}return h},fo=(t,e,n,r)=>{let a=[];t.forEach((t=>{let i=Math.abs(t.child-t.parent),l=void 0,o=void 0,s=void 0;t.parent<t.child?(o=e[t.parent]+n.left+n.right+r[t.parent]-5,s=e[t.child]+5,l=o+(s-o)/2):(o=e[t.parent]+5,s=e[t.child]+n.left+n.right+r[t.child]-5,l=s+(o-s)/2),t.sourceX=io(o,3),t.targetX=io(s,3),t.middleX=Number.isNaN(l)?0:l,t.gap=i,a.push(t)})),a.sort(((t,e)=>t.gap-e.gap));let i=Array(Object.keys(e).length).fill(1),l={};return a.forEach((t=>{let e=Math.min(t.child,t.parent),n=Math.max(t.child,t.parent);if(e!==n){let r=i.slice(e,n).reduce(((t,e)=>Math.max(t,e)));for(let t=e;t<n;t++)i[t]=r+1;void 0===l[r]&&(l[r]=[]),l[r].push(t)}})),l},go=(t,e,n,r,a,i,l)=>{Object.keys(t).forEach(((o,s)=>{e.append("g").attr("class","attention-group-path").selectAll("path.attention-path-"+s).data(t[o],(t=>`${t.parent}-${t.child}`)).join("path").attr("class",(t=>{let e=`attention-path attention-path-${s} attention-path-${l[t.parent].id}-${l[t.child].id}`;return void 0!==i[l[t.parent].token]&&i[l[t.parent].token].forEach((n=>{e+=` attention-path-${n}-${l[t.child].id}`})),void 0!==i[l[t.child].token]&&i[l[t.child].token].forEach((n=>{e+=` attention-path-${l[t.parent].id}-${n}`})),a.has(String([t.parent,t.child]))&&(e+=" matched-attention-path\n            matched-attention-path-"+a.get(String([t.parent,t.child]))),e})).classed("attention-path--lr",(t=>t.parent<t.child)).classed("attention-path--rl",(t=>t.parent>t.child)).style("width",.5).attr("d",(t=>{let e=t.sourceX,a=t.targetX,i=r?0:n,l=5*(s+1),o=0===s?4:7;return`M${e} ${i}\n            L${e} ${i+l-o}\n            Q${e<a?e+0:e-0} ${i+l}, ${e<a?e+o:e-o} ${i+l}\n            L${e<a?a-o:a+o} ${i+l}\n            Q${e<a?a-0:a+0} ${i+l}, ${a} ${i+l-o}\n            L${a} ${i}`}))}))},yo=(t,e,n,r,a,i=.02)=>{let l=n[t][e],o=new Map,s=new Map,c=r.words.map((t=>({token:t}))),u=0;for(;ro(a.tokens[u].token);)u+=1;for(let t=0;t<c.length;t++){if(c[t].token!==a.tokens[u].token){let e=[],n=t+1<c.length?c[t+1].token:null;for(;a.tokens[u].token!==n;)e.push(u),s.set(u,t),u+=1;o.set(e[0],e)}else s.set(u,t),u+=1}let h=[];for(let t=0;t<a.tokens.length;t++){if(ro(a.tokens[t].token))continue;let e=l[t];if(o.has(t)){let n=o.get(t);for(let t=0;t<e.length;t++){let r=0;for(let e=0;e<n.length;e++)r+=l[e][t];e[t]=r/n.length}t=n[n.length-1]}for(let n=0;n<a.tokens.length;n++){if(ro(a.tokens[n].token))continue;let r=0;if(o.has(n)?o.get(n).forEach((t=>{n=t,r+=e[n]})):r=e[n],r>i){let e=s.get(n);h.push({parent:s.get(t),child:e,attention:r})}}}return h},mo=(t,e,n,r)=>{let a=[];return t.forEach((t=>{let i=Math.abs(t.child-t.parent),l=e[t.parent]+n.left+r[t.parent]/2,o=e[t.child]+n.left+r[t.child]/2;t.sourceX=io(l,3),t.targetX=io(o,3),t.gap=i,a.push(t)})),a},vo=(t,e,n,r,a,i=5,l=70)=>{let o=Ji().domain(ft(t.map((t=>Math.abs(t.parent-t.child))))).range([i,l]),s=(Ji().domain(ft(t.map((t=>t.attention)))).range([.1,.6]),Ji().domain(ft(t.map((t=>t.attention)))).range([.2,2]));e.append("g").attr("class","attention-group-arc attention-group-arc-"+n).style("opacity",0).style("display","none").style("pointer-events","none").selectAll("path.attention-arc-"+n).data(t,(t=>`${t.parent}-${t.child}`)).join("path").attr("class","attention-arc attention-arc-"+n).attr("class",(t=>{let e=`attention-arc attention-arc-${a[t.parent].id}-${a[t.child].id}`;return void 0!==r[a[t.parent].token]&&r[a[t.parent].token].forEach((n=>{e+=` attention-arc-${n}-${a[t.child].id}`})),void 0!==r[a[t.child].token]&&r[a[t.child].token].forEach((n=>{e+=` attention-arc-${a[t.parent].id}-${n}`})),e})).classed("attention-arc--lr",(t=>t.parent<=t.child)).classed("attention-arc--rl",(t=>t.parent>t.child)).style("width",(t=>s(t.attention))).style("opacity",.5).attr("d",(t=>{let e=t.sourceX,n=t.targetX,r=Math.abs((n-e)/2),a=o(Math.abs(t.parent-t.child));if(a=Math.min(a,r),t.parent==t.child){let t=5,n=10;return`M ${e} 0\n            C ${e} 0, ${e-t} ${-n}, ${e} ${-n}\n            C ${e+t} ${-n}, ${e} 0, ${e} -1\n            L ${e} 0`}return`M ${e} 0\n            A ${r} ${a}, 0, 0, ${e<n?1:0} ${n}, 0`}))},wo=t=>{let e=Ge(t.target.parentNode.parentNode.parentNode),n=Qe(".attention-group").size(),r=+e.attr("class").replace(/.*name-group-(\d*).*/,"$1");const a=(t,e,n,r)=>{let a=Ge(n[e]);return`translate(${+a.attr("transform").replace(/translate\((.*),\s.*\)/,"$1")}, ${+a.attr("transform").replace(/translate\(.*,\s(.*)\)/,"$1")+r})`};Ge(".blocker").raise(),Ge(".original-node-group").raise(),Ge(".arc-group").raise(),Ge(t.target).classed("symbol-highlight",null==co[r]),null==co[r]?(r<Math.floor(n/2)?(Qe(".attention-group").filter((t=>t>=r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,70))),Qe(".name-group").filter((t=>t>=r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,70))),co[r]="down"):(Qe(".attention-group").filter((t=>t<r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,-70))),Qe(".name-group").filter((t=>t<r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,-70))),co[r]="up"),e.append("text").attr("class","arc-label name").attr("x",-8).attr("y",-15).style("fill","hsl(0, 0%, 60%)").text("Attention Weights"),Ge(".attention-group-arc-"+r).style("display",null).transition("opacity").delay(200).duration(300).ease(Ea).style("opacity",1)):(Ge(".attention-group-arc-"+r).transition("opacity").duration(500).ease(Ea).style("opacity",0).on("end",((t,n,r)=>{Ge(r[n]).style("display","none"),e.select(".arc-label").remove()})),"down"===co[r]?(Qe(".attention-group").filter((t=>t>=r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,-70))),Qe(".name-group").filter((t=>t>=r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,-70))),co[r]=null):"up"===co[r]?(Qe(".attention-group").filter((t=>t<r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,70))),Qe(".name-group").filter((t=>t<r)).transition("moveY").duration(500).ease(Ea).attr("transform",((t,e,n)=>a(0,e,n,70))),co[r]=null):console.error("Unknown case!"))},ko=(t,e,n,r,a)=>{const i=t=>{Ge(t.target).classed("disabled")||Ge(t.target).style("fill","hsla(0, 0%, 0%, 0.2)").style("stroke","hsl(28, 7%, 20%)")},l=t=>{Ge(t.target).classed("symbol-highlight")||Ge(t.target).style("fill","white").style("stroke","hsl(28, 7%, 60%)")};let o=t.append("g").attr("class","symbol-group").attr("transform","translate(16, 19)").append("g").attr("class","radial-symbol").attr("transform","translate(0, 0)");o.append("rect").attr("class","comparison-svg-button").attr("width",20).attr("height",20).attr("rx",3).style("fill","white").style("stroke","hsl(28, 7%, 60%)").style("stroke-width",1).on("mouseover",i).on("mouseleave",l).on("click",(t=>((t,e,n,r,a)=>{uo.show||(uo.show=!0,uo.attention=e[r][a],uo.tokens=n,uo.layer=r,uo.head=a,ot.set(uo),Qe(".radial-symbol").select("rect").classed("disabled",!0),Ge(t.target).classed("disabled",!1).classed("symbol-highlight",!0))})(t,e,n,r,a))),o.append("image").attr("href","/dodrio/figures/radial-symbol.svg").attr("x",2).attr("y",2).attr("height",16).attr("width",16).style("pointer-events","none");let s=o.clone(!0).attr("class","arc-symbol").attr("transform","translate(30, 0)");s.select("rect").on("mouseover",i).on("mouseleave",l).on("click",wo),s.select("image").attr("href","/dodrio/figures/arc-symbol.svg")},xo=(t,e,n,r,a,i,l,o,s,c,u,h,d)=>{let p=i.tokens.map((t=>({token:t.token}))),f=r.words.map((t=>({token:t}))),g=Ge("#head-select"),y=t[g.property("value")];if(void 0===i.tokens[0].id){let t={};i.tokens.forEach((e=>{let n=0;void 0===t[e.token]?t[e.token]=n+1:(n=t[e.token],t[e.token]+=1),e.id=`${no(e.token)}-${n}`}))}null==h&&(h=d(f,i));let m={};f.forEach((t=>{let e=0;void 0===m[t.token]?m[t.token]=e+1:(e=m[t.token],m[t.token]+=1),t.id=`${no(t.token)}-${e}`}));let v=e.select(".token-group").attr("transform"),w=+v.replace(/translate\((.*),\s.*\)/,"$1"),k=+v.replace(/translate\(.*,\s(.*)\)/,"$1"),x=100;ao(e,+e.attr("width")+x);let b=e.append("g").attr("class","comparison-head-name-group").attr("transform",`translate(${n.left},\n      ${n.top+c.top+4})`).style("opacity",0);b.transition("").duration(500).ease(Ea).style("opacity",1);let _=e.select(".token-group").transition("move-x").duration(500).ease(Ea).attr("transform",`translate(${w+x}, ${k})`).on("end",(()=>{_=e.select(".token-group"),_.append("rect").attr("class","blocker").attr("id","top-blocker").attr("x",0).attr("y",0).attr("width",+e.attr("width")).attr("height",N-5).style("fill","url(#top-opacity-gradient)"),e.append("rect").attr("class","blocker").attr("id","top-left-blocker").attr("x",0).attr("y",0).attr("width",x).attr("height",N+5).style("fill","url(#top-opacity-gradient)"),_.append("rect").attr("class","blocker").attr("id","bottom-blocker").attr("x",0).attr("y",l-10).attr("width",+e.attr("width")).attr("height",10).style("fill","url(#bottom-opacity-gradient)"),e.append("rect").attr("class","blocker").attr("id","bottom-left-blocker").attr("x",0).attr("y",l-10).attr("width",x).attr("height",10).style("fill","url(#bottom-opacity-gradient)"),_.select(".node-group").raise(),_.select(".arc-group").raise()})),$=_.select(".node").node().getBBox().height,M=e.select(".node-group").node().getBBox().height,A=e.select(".arc-group").node().getBBox().height,N=+Ge(".graph-view .svg-container").style("top").replace(/(.*)px/,"$1");N+=A+M+n.top+10,Ge(".comparison-panel-container").style("top",N+"px").classed("hide",!1),g.on("change",(()=>{switch(g.property("value")){case"semantic":e.select(".token-group").selectAll(".attention-group").remove(),e.select(".comparison-head-name-group").selectAll(".name-group").remove(),bo(t.semantic,a,r,i,A,M,e,$,10,s,c,u,o,h,f,b,p,n,l);break;case"syntactic":e.select(".token-group").selectAll(".attention-group").remove(),e.select(".comparison-head-name-group").selectAll(".name-group").remove(),bo(t.syntactic,a,r,i,A,M,e,$,10,s,c,u,o,h,f,b,p,n,l);break;case"important":console.log("wow"),e.select(".token-group").selectAll(".attention-group").remove(),e.select(".comparison-head-name-group").selectAll(".name-group").remove(),bo(t.important,a,r,i,A,M,e,$,10,s,c,u,o,h,f,b,p,n,l)}})),bo(y,a,r,i,A,M,e,$,10,s,c,u,o,h,f,b,p,n,l)},bo=(t,e,n,r,a,i,l,o,s,c,u,h,d,p,f,g,y,m,v)=>{let w=0,k=po(t[0].id.layer,t[0].id.head,e,n,r),x=0,b=null;for(;w<t.length;){let _=0,$=0;0===w?x=a+i+50:(_=+l.select("#attention-group-"+(w-1)).attr("transform").replace(/translate\(.*,\s(.*)\)/,"$1"),$=l.select("#attention-group-"+(w-1)).node().getBBox().height,x=_+$+o+s),b=l.select(".token-group").append("g").datum(w).attr("class","attention-group").attr("id","attention-group-"+w).attr("transform",`translate(0, ${x})`).style("visibility","hidden"),co[w]=null;let M=l.select(".token-group").select(".node-group").classed("original-node-group",!0).clone(!0).classed("original-node-group",!1).classed("node-group-attention",!0);M.selectAll("g.node").classed("node",!1).classed("node-clone",!0).on("mouseover",(t=>{let e=t.target.parentNode.dataset.id;at.set(e)})).on("mouseleave",(()=>{at.set(null)})),M.selectAll("rect").style("stroke","none"),b.append((()=>M.node())),k=po(t[w].id.layer,t[w].id.head,e,n,r);let A=fo(k,c,u,h);go(A,b,o,!1,d,p,f);let N=g.append("g").datum(w).attr("class","name-group name-group-"+w).attr("transform",`translate(0, ${x})`).style("visibility","hidden"),E=ho.get([t[w].id.layer,t[w].id.head].toString());N.append("text").attr("class","name").style("fill",E).text(`layer ${t[w].id.layer}\n          head ${t[w].id.head}`),ko(N,e,y,t[w].id.layer,t[w].id.head);let T=x+l.select("#attention-group-"+w).node().getBBox().height,D=yo(t[0].id.layer,t[0].id.head,e,n,r),S=mo(D,c,u,h);if(vo(S,b,w,p,f),T+m.bottom>v){b.remove(),N.remove(),Ge("#comparison-label-top").text(`Dependencies predicted by top-${w} attention heads with the highest `);break}b.style("visibility","visible"),N.style("visibility","visible"),w+=1}};function _o(e){let n,r,a,i,c,h,m,w,k,x,b,_,$,M,A,N,E,T=e[1].layer+"",D=e[1].head+"";return{c(){n=u("div"),r=u("div"),a=u("div"),i=u("header"),c=u("div"),h=d("Layer "),m=d(T),w=d(" Head "),k=d(D),x=d(" Attention Wights"),_=p(),$=u("button"),M=p(),A=u("section"),A.innerHTML='<svg class="modal-svg"></svg>',g(c,"class","modal-card-title svelte-hancuc"),g(c,"style",b="color: "+e[3](e[1].layer,e[1].head)),g($,"class","delete"),g($,"aria-label","close"),g(i,"class","modal-card-head svelte-hancuc"),g(A,"class","modal-card-body svelte-hancuc"),g(a,"class","modal-card svelte-hancuc"),g(r,"class","modal svelte-hancuc"),v(r,"is-active",e[1].show),g(n,"class","modal-component")},m(t,s){o(t,n,s),l(n,r),l(r,a),l(a,i),l(i,c),l(c,h),l(c,m),l(c,w),l(c,k),l(c,x),l(i,_),l(i,$),l(a,M),l(a,A),e[4](n),N||(E=f($,"click",e[2]),N=!0)},p(t,[e]){2&e&&T!==(T=t[1].layer+"")&&y(m,T),2&e&&D!==(D=t[1].head+"")&&y(k,D),2&e&&b!==(b="color: "+t[3](t[1].layer,t[1].head))&&g(c,"style",b),2&e&&v(r,"is-active",t[1].show)},i:t,o:t,d(t){t&&s(n),e[4](null),N=!1,E()}}}let $o=500;function Mo(t,e,n){let r=null,a=null,i=null,l={},o=null,s=new Map;lt.subscribe((t=>{s=t})),ot.set(l),ot.subscribe((t=>{n(1,l=t),null!=l.attention&&c(i)}));const c=t=>{if(void 0!==l.top)Ge(r).select(".modal-card").style("top",l.top+"px").style("left",l.top+"px").style("width",l.width+"px").style("height",l.height+"px");else{let t=+Ge(".dependency-svg").attr("height"),e=window.innerWidth;Ge(r).select(".modal-card").style("top",(t-420)/2+"px").style("left",(e-380)/2+"px")}let e=s.get([l.layer,l.head].toString());a.select("#atlas-arrow").select("path").attr("fill",e).attr("stroke",e);let n=Ge(document.body).append("svg").attr("height",200).attr("width",200).style("visibility","hidden");const i=eo(l.tokens.map((t=>t.token)),n,"0.9em");let o=250-wt(Object.entries(i.textTokenWidths).map((t=>t[1])));n.remove();let c=[];for(let t=0;t<l.tokens.length;t++){let e=-Math.PI/2+t*(2*Math.PI/l.tokens.length);c.push({x:Math.cos(e)*o,y:Math.sin(e)*o,angle:e,token:l.tokens[t].token,id:t})}let u=[];for(let t=0;t<l.tokens.length;t++)for(let e=0;e<l.tokens.length;e++){let n=l.attention[t][e];n>0&&u.push({source:t,target:e,attention:n,id:`${t}-${e}`})}u=u.sort(((t,e)=>e.attention-t.attention)).slice(0,150);let h=Ji().domain(ft(u.map((t=>t.attention)))).range([.2,.7]),d=Ji().domain([0,1]).range([.1,1]),p=t.append("g").attr("class","token-text-group").style("font-size","0.9em").style("cursor","default");p.selectAll("text").data(c,(t=>t.id)).join("text").attr("data-angle",(t=>t.angle)).attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${o}, 0)\n          rotate(${t.angle>=Math.PI/2?180:0})\n        `)).attr("dominant-baseline","middle").attr("x",(t=>t.angle<Math.PI/2?6:-6)).attr("text-anchor",(t=>t.angle<Math.PI/2?"start":"end")).text((t=>t.token));let f=t.select(".token-text-group").clone(!0).remove();n=Ge(document.body).append("svg").attr("viewBox","0 0 500 500").attr("width",480).attr("height",480).style("visibility","hidden"),n.append((()=>f.node()));let g=n.select(".token-text-group").node().getBBox();n.remove();let y=250+g.y,m=$o-y-g.height,v=250+g.x,w=$o-v-g.width,k=Math.min(y,m,v,w);o+=Math.floor(k),c=[];for(let t=0;t<l.tokens.length;t++){let e=-Math.PI/2+t*(2*Math.PI/l.tokens.length);c.push({x:Math.cos(e)*o,y:Math.sin(e)*o,angle:e,token:l.tokens[t].token,id:t})}p.selectAll("rect").data(c,(t=>t.id)).join("rect").attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${o}, 0)\n        `)).attr("x",0).attr("y",-5).attr("width",50).attr("height",15).style("fill","white").style("opacity",0).on("mouseover",((e,n)=>{a.select("#atlas-arrow").select("path").attr("opacity",.1),t.select(".path-group").selectAll("path.donut-link").style("opacity",.5),t.select(".path-group").selectAll("path.donut-link").filter((t=>t.source===n.id||t.target===n.id)).attr("marker-end","url(#atlas-arrow-hover)").style("stroke","hsl(36, 100%, 55%)").style("stroke-width",3).style("opacity",1).raise()})).on("mouseleave",(()=>{a.select("#atlas-arrow").select("path").attr("opacity",null),t.select(".path-group").selectAll("path.donut-link").attr("marker-end","url(#atlas-arrow)").style("stroke",e).style("stroke-width",(t=>h(t.attention))).style("opacity",1)})),p.selectAll("text").data(c,(t=>t.id)).join("text").attr("data-angle",(t=>t.angle)).attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${o}, 0)\n          rotate(${t.angle>=Math.PI/2?180:0})\n        `)).attr("dominant-baseline","middle").attr("x",(t=>t.angle<Math.PI/2?6:-6)).attr("text-anchor",(t=>t.angle<Math.PI/2?"start":"end")).text((t=>t.token)).on("mouseover",((e,n)=>{a.select("#atlas-arrow").select("path").style("opacity",.5),t.select(".path-group").selectAll("path.donut-link").style("opacity",.1),t.select(".path-group").selectAll("path.donut-link").filter((t=>t.source===n.id||t.target===n.id)).attr("marker-end","url(#atlas-arrow-hover)").style("stroke","hsl(24, 95%, 59%)").style("opacity",1).style("stroke-width",3).raise()})).on("mouseleave",(()=>{a.select("#atlas-arrow").select("path").attr("opacity",null),t.select(".path-group").selectAll("path.donut-link").attr("marker-end","url(#atlas-arrow)").style("stroke",e).style("stroke-width",(t=>h(t.attention))).style("opacity",1)})),t.append("g").attr("class","path-group").selectAll("path.donut-link").data(u,(t=>t.id)).join("path").attr("class","donut-link").attr("marker-end","url(#atlas-arrow)").attr("d",(t=>{let e=c[t.source],n=c[t.target];const r=0,a=0,i=.4;let l=r+(e.x-r)*i,o=a+(e.y-r)*i,s=r+(n.x-r)*i,u=a+(n.y-r)*i;return`M ${e.x},${e.y} C${l}, ${o},\n          ${s}, ${u}, ${n.x},${n.y}`})).style("fill","none").style("stroke",e).style("stroke-width",(t=>h(t.attention))).style("opacity",(t=>d(t.attention))),t.append("g").attr("class","token-dot-group").selectAll("circle.token-dot").data(c,(t=>t.id)).join("circle").attr("class","token-dot").attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("r",1)};b((()=>{let t=Ge(r).select(".modal-card");(t=>{let e=0,r=0,a=0,i=0;const o=n=>{e=a-n.clientX,r=i-n.clientY,a=n.clientX,i=n.clientY,t.style.top=t.offsetTop-r+"px",t.style.left=t.offsetLeft-e+"px"},s=()=>{document.onmouseup=null,document.onmousemove=null,n(1,l.top=t.style.top,l),n(1,l.left=t.style.left,l),n(1,l.width=t.style.width,l),n(1,l.height=t.style.height,l)};document.querySelector(".modal-card-head").onmousedown=t=>{a=t.clientX,i=t.clientY,document.onmouseup=s,document.onmousemove=o}})(t.node()),a=t.select("svg.modal-svg").attr("viewBox","0 0 500 500").attr("width","100%").attr("height","100%"),a.append("rect").attr("width",$o).attr("height",$o).style("fill","hsla(0, 0%, 100%, 0)"),i=a.append("g").attr("class","donut").attr("transform","translate(250, 250)"),o=a.append("defs").attr("id","atlas-arrow-def").append("marker").attr("id","atlas-arrow").attr("viewBox",[0,0,10,10]).attr("refX",10).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke","gray").attr("fill","gray"),o=a.append("defs").attr("id","atlas-arrow-def-hover").append("marker").attr("id","atlas-arrow-hover").attr("viewBox",[0,0,10,10]).attr("refX",10).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke","hsl(24, 95%, 59%)").attr("fill","hsl(24, 95%, 59%)")}));return[r,l,()=>{n(1,l.show=!1,l),ot.set(l),a.select(".donut").selectAll("*").remove(),Qe(".radial-symbol").select("rect").classed("disabled",!1).classed("symbol-highlight",!1).style("fill","white").style("stroke","hsl(28, 7%, 60%)")},(t,e)=>null!=s&&void 0!==s.has&&s.has([t,e].toString())?s.get([t,e].toString()):"black",function(t){M[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class Ao extends O{constructor(t){super(),W(this,t,Mo,_o,i,{})}}const No=(t,e,n,r,a,i,l,o,s,c,u)=>{const h=t.list;let d=t.words.map((t=>({token:t})));if(void 0===e.tokens[0].id){let t={};e.tokens.forEach((e=>{let n=0;void 0===t[e.token]?t[e.token]=n+1:(n=t[e.token],t[e.token]+=1),e.id=`${no(e.token)}-${n}`}))}null==c&&u(d,e);let p={};d.forEach((t=>{let e=0;void 0===p[t.token]?p[t.token]=e+1:(e=p[t.token],p[t.token]+=1),t.id=`${no(t.token)}-${e}`}));let f=eo(d.map((t=>t.token)),n),g=f.textTokenWidths,y=f.textTokenHeight,m=function(){var t=qi,e=Li;function n(n){var r,a,i,l,o,s,c,u=Array.from(n),h=u.length,d=new Map;for(a=0;a<h;++a)r=u[a],o=u[a]=new Ei(r),null!=(s=t(r,a,n))&&(s+="")&&(c=o.id=s,d.set(c,d.has(c)?Si:o)),null!=(s=e(r,a,n))&&(s+="")&&(o.parent=s);for(a=0;a<h;++a)if(s=(o=u[a]).parent){if(!(l=d.get(s)))throw new Error("missing: "+s);if(l===Si)throw new Error("ambiguous: "+s);l.children?l.children.push(o):l.children=[o],o.parent=l}else{if(i)throw new Error("multiple roots");i=o}if(!i)throw new Error("no root");if(i.parent=Di,i.eachBefore((function(t){t.depth=t.parent.depth+1,--h})).eachBefore(Ni),i.parent=null,h>0)throw new Error("cycle");return i}return n.id=function(e){return arguments.length?(t=Ti(e),n):t},n.parentId=function(t){return arguments.length?(e=Ti(t),n):e},n}().id((t=>t.child)).parentId((t=>t.parent))(h),v=Ci().separation(((t,e)=>Math.max(g[t.id],g[e.id]))).size([r-i.left-i.right,a-i.top-i.bottom-2*y])(m),w=n.append("g").attr("class","tree-group").attr("transform",`translate(${i.left}, ${i.top+y})`),k=v.links();for(let t=0;t<k.length;t++)k[t].left=+k[t].target.x>+k[t].source.x,k[t].vertical=Math.abs(+k[t].target.x-+k[t].source.x)<5;w.append("g").attr("class","link-group").selectAll("path").data(k,(t=>`${t.source.id}-${t.target.id}`)).join("path").attr("id",(t=>`link-${t.source.id}-${t.target.id}`)).attr("data-left",(t=>`${t.left} ${t.source.x} ${t.target.x}`)).attr("d",El().x((t=>t.x)).y((t=>t.y)));let x=w.append("g").attr("class","link-text-group").selectAll("text.text-link").data(k,(t=>`${t.source.id}-${t.target.id}`)).join("text").attr("class","text-link");x.append("textPath").attr("href",(t=>`#link-${t.source.id}-${t.target.id}`)).attr("startOffset","50%").attr("side",(t=>t.left?"left":"right")).style("text-anchor","middle").style("dominant-baseline","end").text((t=>t.target.data.relation)),x.clone(!0).lower().attr("stroke-width",2).attr("stroke","white");let b=w.append("g").attr("class","node-group").selectAll("g").data(m.descendants()).join("g").attr("class",(t=>{let e=d[Number(t.id)],n="node node-"+e.id;return void 0!==c[e.token]&&c[e.token].forEach((t=>{n+=" node-"+t})),n})).attr("transform",(t=>`translate(${t.x}, ${t.y})`)).on("mouseover",(t=>l(d,t))).on("mouseleave",o);b.append("rect").attr("x",(t=>-(g[t.id]+s.left+s.right)/2)).attr("y",-(y+s.top+s.bottom)/2).attr("width",(t=>g[t.id]+s.left+s.right)).attr("height",y+s.top+s.bottom).attr("rx",5).style("fill","hsl(210, 25%, 98%)").style("stroke","hsl(180, 1%, 80%)"),b.append("text").attr("class","text-token").attr("y",1).text((t=>d[t.id].token))};function Eo(t,e,n){const r=t.slice();return r[56]=e[n],r}function To(t,e,n){const r=t.slice();return r[59]=e[n],r[60]=e,r[61]=n,r}function Do(t,e,n){const r=t.slice();return r[56]=e[n],r}function So(e){let n,r,a,i=e[56].name+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[56].value,n.value=n.__value},m(t,e){o(t,n,e),l(n,r)},p:t,d(t){t&&s(n)}}}function qo(t){let e,n,a,i,c,h,m,v,w,k,x,b,_,$=t[59][0]+"",M=t[59][1]+"";function A(){t[16].call(n,t[59])}return{c(){e=u("label"),n=u("input"),i=p(),c=d($),h=p(),m=u("span"),v=d("("),w=d(M),k=d(")"),x=p(),g(n,"type","checkbox"),g(n,"data-rel",a=t[59][0]),g(n,"class","svelte-dnlqim"),g(m,"class","light-gray svelte-dnlqim"),g(e,"class","checkbox check-box-wrapper svelte-dnlqim")},m(r,a){o(r,e,a),l(e,n),n.checked=t[1][t[59][0]],l(e,i),l(e,c),l(e,h),l(e,m),l(m,v),l(m,w),l(m,k),l(e,x),b||(_=[f(n,"change",t[8]),f(n,"change",A)],b=!0)},p(e,r){t=e,1&r[0]&&a!==(a=t[59][0])&&g(n,"data-rel",a),3&r[0]&&(n.checked=t[1][t[59][0]]),1&r[0]&&$!==($=t[59][0]+"")&&y(c,$),1&r[0]&&M!==(M=t[59][1]+"")&&y(w,M)},d(t){t&&s(e),b=!1,r(_)}}}function Lo(e){let n,r,a,i=e[56].name+"";return{c(){n=u("option"),r=d(i),n.__value=a=e[56].value,n.value=n.__value},m(t,e){o(t,n,e),l(n,r)},p:t,d(t){t&&s(n)}}}function zo(t){let e,n,a,i,h,d,y,m,w,k,x,b,_,$,M,A,N,E,T,D,S,q,L,z,H,B,W,O,R,X,Y,V,U,G,K,Q=Object.values(t[4]),Z=[];for(let e=0;e<Q.length;e+=1)Z[e]=So(Do(t,Q,e));let J=t[0],tt=[];for(let e=0;e<J.length;e+=1)tt[e]=qo(To(t,J,e));let et=Object.values(t[5]),nt=[];for(let e=0;e<et.length;e+=1)nt[e]=Lo(Eo(t,et,e));return V=new Ao({}),{c(){e=u("div"),n=u("div"),a=u("div"),i=u("div"),i.textContent="Current Sentence",h=p(),d=u("div"),y=u("div"),y.innerHTML='<div class="comparison-button svelte-dnlqim"><div class="icon-wrapper svelte-dnlqim"><img src="/dodrio/figures/edit.svg" alt="editing icon" class="svelte-dnlqim"/></div></div>',m=p(),w=u("div"),k=u("div"),x=u("select");for(let t=0;t<Z.length;t+=1)Z[t].c();b=p(),_=u("div"),$=u("div"),$.innerHTML='<div class="comparison-button svelte-dnlqim">Show Comparison</div>',M=p(),A=u("div"),N=u("div"),N.innerHTML='<div class="relation svelte-dnlqim">Syntactic Relations</div>',E=p(),T=u("div"),T.innerHTML='<img src="/dodrio/figures/gradient.png" alt="gradient guide" class="svelte-dnlqim"/>',D=p(),S=u("div");for(let t=0;t<tt.length;t+=1)tt[t].c();q=p(),L=u("div"),z=u("div"),H=u("div"),H.textContent="Dependencies predicted by attention heads with top",B=p(),W=u("div"),O=u("select");for(let t=0;t<nt.length;t+=1)nt[t].c();R=p(),X=u("div"),X.innerHTML='<svg class="dependency-svg"></svg>',Y=p(),I(V.$$.fragment),g(i,"class","dependency-label svelte-dnlqim"),g(y,"class","relation-container svelte-dnlqim"),g(d,"class","select-row select-row--edit svelte-dnlqim"),g(x,"name","instance-layout"),g(x,"id","instance-select"),g(x,"class","svelte-dnlqim"),g(k,"class","select svelte-dnlqim"),g(w,"class","select-row svelte-dnlqim"),g($,"class","relation-container svelte-dnlqim"),g(_,"class","select-row svelte-dnlqim"),v(_,"select-row--highlight",t[2]),g(N,"class","relation-container svelte-dnlqim"),g(A,"class","select-row svelte-dnlqim"),v(A,"select-row--highlight",t[3]),g(T,"class","gradient-guide svelte-dnlqim"),g(S,"class","relation-checkboxes svelte-dnlqim"),v(S,"hide",!t[3]),g(a,"class","svg-control-panel svelte-dnlqim"),g(n,"class","panel-container svelte-dnlqim"),g(H,"class","comparison-label svelte-dnlqim"),g(H,"id","comparison-label-top"),g(O,"name","head-list"),g(O,"id","head-select"),g(O,"class","svelte-dnlqim"),g(W,"class","select comparison-select svelte-dnlqim"),g(z,"class","comparison-control-panel svelte-dnlqim"),g(L,"class","comparison-panel-container hide svelte-dnlqim"),g(X,"class","svg-container svelte-dnlqim"),g(e,"class","graph-view svelte-dnlqim")},m(r,s){o(r,e,s),l(e,n),l(n,a),l(a,i),l(a,h),l(a,d),l(d,y),l(a,m),l(a,w),l(w,k),l(k,x);for(let t=0;t<Z.length;t+=1)Z[t].m(x,null);l(a,b),l(a,_),l(_,$),l(a,M),l(a,A),l(A,N),l(a,E),l(a,T),l(a,D),l(a,S);for(let t=0;t<tt.length;t+=1)tt[t].m(S,null);l(e,q),l(e,L),l(L,z),l(z,H),l(z,B),l(z,W),l(W,O);for(let t=0;t<nt.length;t+=1)nt[t].m(O,null);l(e,R),l(e,X),o(r,Y,s),P(V,r,s),U=!0,G||(K=[f(y,"click",t[7]),f($,"click",t[6]),f(N,"click",t[15])],G=!0)},p(t,e){if(16&e[0]){let n;for(Q=Object.values(t[4]),n=0;n<Q.length;n+=1){const r=Do(t,Q,n);Z[n]?Z[n].p(r,e):(Z[n]=So(r),Z[n].c(),Z[n].m(x,null))}for(;n<Z.length;n+=1)Z[n].d(1);Z.length=Q.length}if(4&e[0]&&v(_,"select-row--highlight",t[2]),8&e[0]&&v(A,"select-row--highlight",t[3]),259&e[0]){let n;for(J=t[0],n=0;n<J.length;n+=1){const r=To(t,J,n);tt[n]?tt[n].p(r,e):(tt[n]=qo(r),tt[n].c(),tt[n].m(S,null))}for(;n<tt.length;n+=1)tt[n].d(1);tt.length=J.length}if(8&e[0]&&v(S,"hide",!t[3]),32&e[0]){let n;for(et=Object.values(t[5]),n=0;n<et.length;n+=1){const r=Eo(t,et,n);nt[n]?nt[n].p(r,e):(nt[n]=Lo(r),nt[n].c(),nt[n].m(O,null))}for(;n<nt.length;n+=1)nt[n].d(1);nt.length=et.length}},i(t){U||(j(V.$$.fragment,t),U=!0)},o(t){F(V.$$.fragment,t),U=!1},d(t){t&&s(e),c(Z,t),c(tt,t),c(nt,t),t&&s(Y),C(V,t),G=!1,r(K)}}}let Ho="hsl(0, 0%, 80%)",jo="hsl(36, 100%, 90%)",Fo="hsl(36, 100%, 80%)",Io="hsl(36, 100%, 55%)";function Po(t,e,n){let{attentionDataDir:r}=e,{saliencyDataFilepath:a}=e,{dependencyDataFilepath:i}=e,{syntacticHeadDataFilepath:l}=e,{semanticHeadDataFilepath:o}=e,{importantHeadDataFilepath:s}=e;const c=_();let u=null,h=null,d=null,p=null,f=null,g={},y=null,m=[],v={},w=1562,k={},x=[],$=800,M=800,A=void 0,N=!1,E=!1,T={};et.subscribe((t=>{T=t,M=T.height-41,(T.inComparison&&!E||!T.inComparison&&E)&&Y()}));let D=null;st.subscribe((t=>{D=t}));const S={top:10,left:15,right:15,bottom:10},q={top:3,left:3,right:3,bottom:3};let L=null;const z={saliency:{value:"saliency",name:"Saliency View"},dependency:{value:"dependency",name:"Dependency List"},tree:{value:"tree",name:"Dependency Tree"}};let H=!1,j=!1,F=!1,I=z.dependency,P="hsl(42, 95%, 58%)";P="hsl(36, 100%, 55%)";let C=!1;const B=()=>{u=Ge("svg.dependency-svg").attr("width",$).attr("height",M),u.append("rect").attr("class","border-rect").attr("width",$).attr("height",M).style("stroke","black").style("fill","none");let t=u.append("defs");t.append("marker").attr("id","dep-arrow").attr("viewBox",[0,0,10,10]).attr("refX",0).attr("refY",5).attr("markerWidth",10).attr("markerHeight",5).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke",Ho).attr("fill",Ho),t.clone(!0).select("marker").attr("id","dep-arrow-hover").select("path").attr("stroke",P).attr("fill",P),t.clone(!0).select("marker").attr("id","dep-attention-arc-arrow").select("path").attr("stroke","none").attr("refX",2).attr("fill","hsl(0, 0%, 10%)"),t.clone(!0).select("marker").attr("id","dep-attention-arrow").select("path").attr("stroke","none").attr("refX",2).attr("fill","hsl(0, 0%, 80%)");let e=u.append("defs").append("linearGradient").attr("id","top-opacity-gradient").attr("x2","0%").attr("y2","100%");e.append("stop").style("stop-opacity",1).style("stop-color","white").attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color","white").attr("offset","0.9"),e.append("stop").style("stop-opacity",0).style("stop-color","white").attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","bottom-opacity-gradient").attr("x2","0%").attr("y2","100%"),e.append("stop").style("stop-opacity",0).style("stop-color","white").attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color","white").attr("offset","0.5"),e.append("stop").style("stop-opacity",1).style("stop-color","white").attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","link-opacity-gradient-rl"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 90%)").attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 70%)").attr("offset","0.6"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 20%)").attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","link-opacity-gradient-lr"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 20%)").attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 70%)").attr("offset","0.4"),e.append("stop").style("stop-opacity",1).style("stop-color","hsl(0, 0%, 90%)").attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","matched-link-opacity-gradient-rl"),e.append("stop").style("stop-opacity",1).style("stop-color",jo).attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color",Fo).attr("offset","0.6"),e.append("stop").style("stop-opacity",1).style("stop-color",Io).attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","matched-link-opacity-gradient-lr"),e.append("stop").style("stop-opacity",1).style("stop-color",Io).attr("offset","0"),e.append("stop").style("stop-opacity",1).style("stop-color",Fo).attr("offset","0.4"),e.append("stop").style("stop-opacity",1).style("stop-color",jo).attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","top-link-opacity-gradient-rl"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 20%)").attr("offset","0"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 70%)").attr("offset","0.3"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 90%)").attr("offset","1"),e=u.append("defs").append("linearGradient").attr("id","top-link-opacity-gradient-lr"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 90%)").attr("offset","0"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 70%)").attr("offset","0.7"),e.append("stop").style("stop-opacity",.8).style("stop-color","hsl(0, 0%, 20%)").attr("offset","1"),N=!0},W=t=>{let e=Ge(t.target).data()[0].id;at.set(e)},O=()=>{at.set(null)},R=(t,e)=>{let n=t[Ge(e.target).data()[0].id].id;at.set(n)},X=(t,e)=>{y={};let n=0;for(;ro(e.tokens[n].token);)n+=1;for(let r=0;r<t.length&&!(n>=e.tokens.length);r++){let a=t[r].token;if(a!==e.tokens[n].token){let i=r+1<t.length?t[r+1].token:null;for(y[a]=[];e.tokens[n].token!==i&&(y[a].push(e.tokens[n].id),n+=1,!(n>=e.tokens.length)););}else n+=1}return it.set(y),y},Y=()=>{u.attr("height",M);let t=V();var e,r;E?(n(2,E=!1),(t=>{let e=t.select(".token-group").attr("transform"),n=+e.replace(/translate\((.*),\s.*\)/,"$1"),r=+e.replace(/translate\(.*,\s(.*)\)/,"$1");ao(t,+t.attr("width")-100),t.selectAll(".blocker").remove(),t.select(".token-group").transition("move-x").duration(500).ease(Ea).attr("transform",`translate(${n-100}, ${r})`),t.select(".comparison-head-name-group").remove(),t.selectAll(".attention-group").remove(),Ge(".comparison-panel-container").classed("hide",!0)})(u)):(n(2,E=!0),null==f?G(`/dodrio/data/sst2-attention-data/attention-${e=w,r=4,Array(Math.max(r-String(e).length+1,0)).join(0)+e}.json`).then((()=>xo(t,u,S,h,f,p,M,d,x,q,k,y,X))):xo(t,u,S,h,f,p,M,d,x,q,k,y,X))},V=()=>{let t={},e=new Map,n=g.syntactic;for(let t in v){if(!v[t]||void 0===n[t])continue;n[t].top_heads.forEach((t=>{e.has(t.head)?e.set(t.head,Math.max(t.acc,e.get(t.head))):e.set(t.head,t.acc)}))}let r=[...e.entries()].sort(((t,e)=>e[1]-t[1])).map((t=>({id:{layer:t[0][0],head:t[0][1]},acc:t[1]})));return t.syntactic=r,n=g.semantic,r=n.map((t=>({id:{layer:t[1][0],head:t[1][1]},score:t[0]}))),t.semantic=r,n=g.important,r=n.map((t=>({id:{layer:t[1][0],head:t[1][1]},score:t[0]}))),t.important=r,t},U=async(t,e,r,a,i)=>{h=await Ia(t),h=h[w];let l=new Map;n(1,v={}),d=new Map,h.list.forEach((t=>{d.set(String([t.parent,t.child]),t.relation),l.has(t.relation)?l.set(t.relation,l.get(t.relation)+1):(l.set(t.relation,1),n(1,v[t.relation]=!0,v))})),l=new Map([...l.entries()].sort(((t,e)=>e[1]-t[1]))),n(0,m=[...l.entries()]),p=await Ia(e),p=p[w],g.syntactic=await Ia(r),g.semantic=await Ia(a),g.semantic=g.semantic[w],g.important=await Ia(i),g.important=g.important[w]},G=async t=>{f=await Ia(t)};b((async()=>{null!=h&&null!=p||U(i,a,l,o,s),(()=>{let t=Ge("#instance-select").property("value",I.value);t.on("change",(()=>{let e=t.property("value");if(e!==I.value)switch(e){case"saliency":"dependency"===I.value&&H&&u.select("g.token-group").style("display","none"),"tree"===I.value&&F&&u.select("g.tree-group").style("display","none"),j?(u.select("g.token-group-saliency").style("display",null),u.select("g.legend-group").style("display",null)):(N||B(),lo(p,u,$,S,q,y,W,O),j=!0),I=z[e];break;case"dependency":if(console.log("change to dependency view"),"tree"===I.value&&F&&u.select("g.tree-group").style("display","none"),"saliency"===I.value&&j&&(u.select("g.token-group-saliency").style("display","none"),u.select("g.legend-group").style("display","none")),H)u.select("g.token-group").style("display",null);else{N||B();let t=so(h,p,y,u,x,q,S,0,W,O,X);x=t.tokenXs,k=t.textTokenWidths,H=!0}I=z[e];break;case"tree":console.log("change to tree view"),"dependency"===I.value&&H&&u.select("g.token-group").style("display","none"),"saliency"===I.value&&j&&(u.select("g.token-group-saliency").style("display","none"),u.select("g.legend-group").style("display","none")),F?u.select("g.tree-group").style("display",null):(N||B(),No(h,p,u,$,M,S,R,O,q,y,X),F=!0),I=z[e]}}))})()}));const K=()=>{let t=null;switch(I.value){case"saliency":N||B(),lo(p,u,$,S,q,y,W,O),j=!0;break;case"dependency":N||B(),t=so(h,p,y,u,x,q,S,0,W,O,X),x=t.tokenXs,k=t.textTokenWidths,H=!0;break;case"tree":N||B(),No(h,p,u,$,M,S,R,O,q,y,X),F=!0}};Q.subscribe((async t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===A||A.compHeight!==t.compHeight&&A.compWidth!==t.compWidth)&&(A=t,$=A.compWidth,M=A.compHeight-41,null==h||null==p?U(i,a,l,o,s).then(K):K())})),rt.subscribe((t=>{t!==w&&(u.selectAll("*").remove(),N=!1,f=null,h=null,d=null,p=null,f=null,g={},y=null,H=!1,j=!1,F=!1,w=t,U(i,a,l,o,s).then(K))})),at.subscribe((t=>{null!=u&&(null!=t?(L=t,u.selectAll(".node").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+L))).select("rect").style("stroke",P).style("stroke-width",2),u.selectAll(".arc-path").style("opacity",.8),u.selectAll(".arc-path").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+L))).classed("highlighted",!0).style("opacity",1).raise(),u.selectAll(".node-clone").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+L))).select("rect").style("stroke",P).style("opacity",1).style("stroke-width",2),u.selectAll(".matched-attention-path").classed("de-highlighted",!0),u.selectAll(".attention-path").style("opacity",.2),u.selectAll(".attention-path").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+L))).classed("highlighted",!0).style("opacity",1).raise(),u.selectAll(".attention-arc").style("opacity",.2),u.selectAll(".attention-arc").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+L))).classed("highlighted",!0).style("opacity",.9).raise()):(u.selectAll(".node").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+L))).select("rect").style("stroke","hsl(180, 1%, 80%)").style("stroke-width",1),u.selectAll(".arc-path").style("opacity",null),u.selectAll(".arc-path").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+L))).classed("highlighted",!1),u.selectAll(".node-clone").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+L))).select("rect").style("opacity",null).style("stroke","none"),u.selectAll(".matched-attention-path").classed("de-highlighted",!1),u.selectAll(".attention-path").style("opacity",null),u.selectAll(".attention-path").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+L))).classed("highlighted",!1).raise(),u.selectAll(".attention-arc").style("opacity",.5),u.selectAll(".attention-arc").filter(((t,e,n)=>Ge(n[e]).attr("class").includes("-"+L))).classed("highlighted",!1).raise(),L=t))}));return t.$$set=t=>{"attentionDataDir"in t&&n(9,r=t.attentionDataDir),"saliencyDataFilepath"in t&&n(10,a=t.saliencyDataFilepath),"dependencyDataFilepath"in t&&n(11,i=t.dependencyDataFilepath),"syntacticHeadDataFilepath"in t&&n(12,l=t.syntacticHeadDataFilepath),"semanticHeadDataFilepath"in t&&n(13,o=t.semanticHeadDataFilepath),"importantHeadDataFilepath"in t&&n(14,s=t.importantHeadDataFilepath)},[m,v,E,C,z,{syntactic:{value:"syntactic",name:"syntactic correlations"},semantic:{value:"semantic",name:"semantic correlations "},importance:{value:"important",name:"importance scores"}},()=>{c(E?"close":"open")},()=>{D.show=!0,st.set(D)},t=>{let e=t.target.dataset.rel;n(1,v[e]=t.target.checked,v),u.selectAll(".arc-path").filter((t=>t.relation===e)).style("visibility",v[e]?"visible":"hidden"),u.selectAll(".matched-attention-path-"+e).classed("matched-attention-path",v[e])},r,a,i,l,o,s,()=>{n(3,C=!C)},function(t){v[t[0]]=this.checked,n(1,v),n(0,m)}]}class Co extends O{constructor(t){super(),W(this,t,Po,zo,i,{attentionDataDir:9,saliencyDataFilepath:10,dependencyDataFilepath:11,syntacticHeadDataFilepath:12,semanticHeadDataFilepath:13,importantHeadDataFilepath:14},[-1,-1,-1])}}function Bo(e){let n,r,a,i,c,h,y,m,w,k,x,b;return{c(){n=u("div"),r=u("div"),a=p(),i=u("div"),c=u("div"),h=u("div"),y=u("div"),y.innerHTML='<div class="expand-button svelte-1kp0yq1"><div class="icon-wrapper svelte-1kp0yq1"><img src="/dodrio/figures/arrow-forward-outline.svg" alt="expanding icon" class="svelte-1kp0yq1"/></div></div>',m=d("\n\n      Attention Head Overview"),w=p(),k=u("div"),k.innerHTML='<div class="atlas-svg-container svelte-1kp0yq1"><svg class="atlas-svg-full svelte-1kp0yq1"></svg></div> \n\n    <div class="legend-container svelte-1kp0yq1"><div class="svelte-1kp0yq1"><img src="/dodrio/figures/click.png" width="180px" alt="click guide" class="svelte-1kp0yq1"/></div> \n      <div class="bottom-images svelte-1kp0yq1"><img src="/dodrio/figures/size-legend.png" width="160px" alt="size legend" class="svelte-1kp0yq1"/> \n        <img src="/dodrio/figures/legend.png" width="200px" alt="color legend" class="svelte-1kp0yq1"/></div></div>',g(r,"class","triangle svelte-1kp0yq1"),v(r,"hidden",!e[0].show),g(y,"class","relation-container"),g(h,"class","select-row svelte-1kp0yq1"),g(c,"class","lower-atlas-label svelte-1kp0yq1"),g(i,"class","control-row svelte-1kp0yq1"),g(k,"class","svg-container svelte-1kp0yq1"),g(n,"class","atlas-view svelte-1kp0yq1")},m(t,s){o(t,n,s),l(n,r),l(n,a),l(n,i),l(i,c),l(c,h),l(h,y),l(c,m),l(n,w),l(n,k),e[6](n),x||(b=f(y,"click",e[2]),x=!0)},p(t,e){1&e[0]&&v(r,"hidden",!t[0].show)},i:t,o:t,d(t){t&&s(n),e[6](null),x=!1,b()}}}function Wo(t,e,n){let{attentionDataDir:r}=e,{saliencyDataFilepath:a}=e,{atlasDataFilepath:i}=e,l=null,o=null,s=null,c=null,u=null,h=null;tt.subscribe((t=>{h=t}));let d=null,p=null,f={layer:9,head:8},g=9,y=8;const m=tr(23,85,56),v=tr(328,85,56),w=tr(274,85,56);let k=1562;const x=_();let $=800,A=800,N=void 0;const E=40,T=10,D=10,S=3,q=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e,L=(t,e)=>Array(Math.max(e-String(t).length+1,0)).join(0)+t,z=()=>{const t=s.length,e=s[0].length,r=47;let a=$-210-r-T-D,i=A-E-S-20,u=Math.min(i,a);const k=Math.floor((i-8*(t-1))/t),x=k/2;let b=Math.floor((a-x-e*k)/(t-1)),_=Math.floor((i-t*k)/(t-1));l=Ge(".atlas-svg-full").attr("viewbox",`0 0 ${a+r} ${i}`).attr("width",a+r).attr("height",i+20),l.append("rect").attr("class","border-rect").attr("width",u).attr("height",u).style("stroke","black").style("fill","none");let M=l.append("g").attr("class","donut-group").attr("transform",`translate(${T+x+r},\n        ${x+20})`),N={hueScale:Ji().domain([-1,0,1]).range([m,v,w]),lightnessScale:Ji().domain([0,1]).range([130,40]),outRadiusScale:Ji().domain([0,1]).range([10,x]),ringRadiusScale:Ji().domain([0,1]).range([4,7])},L=M.selectAll("g.donut").data(o).join("g").attr("class","donut").attr("transform",(e=>`translate(${e.head*(2*x+b)},\n        ${(t-e.layer-1)*(2*x+_)})`)).style("pointer-events","fill").style("cursor","pointer");L.each(((t,e,n)=>H(t,e,n,N))),L.on("mouseover",((t,e)=>{let n=t.currentTarget.getBoundingClientRect(),r=n.right-n.left,a=n.x+r/2,i=n.y-90;h.html=`\n        <div class='tooltip-tb' style='display: flex; flex-direction: column;\n          justify-content: center; font-weight: 600;'>\n          <div> Layer ${e.layer+1} Head ${e.head+1} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Semantic: ${q(e.semantic,2)} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Syntactic ${q(e.syntactic,2)} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Importance: ${q(e.confidence,2)} </div>\n        </div>\n        `,h.width=130,h.maxWidth=130,h.left=a-h.width/2,h.top=i,h.fontSize="0.8em",h.show=!0,tt.set(h);let l=Ge(t.currentTarget);l.classed("selected")||l.select(".donut-rect").style("opacity",1)})).on("mouseleave",(t=>{h.show=!1,tt.set(h);let e=Ge(t.currentTarget);e.classed("selected")||e.select(".donut-rect").style("opacity",0)})).on("click",((t,e)=>{n(0,d.show=!0,d),n(0,d.attention=s[e.layer][e.head],d),n(0,d.tokens=c.tokens.map((t=>({token:t.token}))),d),n(0,d.layer=e.layer,d),n(0,d.head=e.head,d),ct.set(d)})).on("dblclick",(t=>{let e=Ge(t.currentTarget);if(e.classed("selected"));else{let t=Ge(M.select(`#donut-rect-${g}-${y}`).node().parentNode);t.select(".donut-rect").style("fill","hsl(0, 0%, 80%)").style("opacity",0),t.classed("selected",!1),e.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),e.classed("selected",!0),g=+e.data()[0].layer,y=+e.data()[0].head,f.layer=g,f.head=y,ut.set(f)}})),M.selectAll("g.row-line-group").data(Array(t-1).fill(0).map(((t,e)=>e))).join("g").attr("class","row-line-group").append("path").attr("d",(n=>`M${-x}\n        ${(t-n-1-.5)*(2*x+_)}\n        L${e*(2*x+b)-x}\n        ${(t-n-1-.5)*(2*x+_)}`)).style("stroke","hsla(0, 0%, 0%, 0.1)"),l.append("g").attr("class","name-group").attr("transform",`translate(${T}, ${x+20})`).selectAll("g.layer-name-group").data(Array(t).fill(0).map(((t,e)=>e))).join("g").attr("class","layer-name-group").attr("transform",(e=>`translate(37,\n        ${(t-e-1)*(2*x+_)})`)).append("text").text((t=>t>0?t+1:"Layer "+(t+1))),l.append("g").attr("class","name-group").attr("transform",`translate(${T+r+x},\n        9)`).selectAll("g.head-name-group").data(Array(t).fill(0).map(((t,e)=>e))).join("g").attr("class","head-name-group").attr("transform",(t=>`translate(${t*(2*x+b)},\n        0)`)).append("text").text((t=>t>0?t+1:"Head "+(t+1))),Ge(p).select(".head-arrow").style("top","30px").style("left",a-170+"px"),Ge(p).select(".layer-arrow").style("top","70px").style("left",a+10+"px");let z=Ge(M.select(`#donut-rect-${g}-${y}`).node().parentNode);z.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),z.classed("selected",!0)},H=(t,e,n,r)=>{let a=Ge(n[e]),i=r.outRadiusScale(t.confidence),l=r.ringRadiusScale(t.confidence),o=Math.max(0,i-l),c=2*r.outRadiusScale.range()[1];a.append("rect").attr("class","donut-rect").attr("id",`donut-rect-${t.layer}-${t.head}`).attr("x",-c/2).attr("y",-c/2).attr("rx",5).attr("width",c).attr("height",c).style("fill","hsl(0, 0%, 80%)").style("opacity",0),a.append("circle").attr("cx",0).attr("cy",0).attr("r",i).style("fill","#FDFCFC").style("opacity",1);let h=xl().outerRadius(i).innerRadius(o).startAngle(0).endAngle(2*Math.PI),d=tr(r.hueScale(t.syntactic-t.semantic));d.l=r.lightnessScale(Math.max(t.semantic,t.syntactic)),a.append("path").attr("class","donut-chart").attr("d",h).style("fill",d);let p=[];for(let e=0;e<u;e++){let n=-Math.PI/2+e*(2*Math.PI/u);p.push({x:Math.cos(n)*o,y:Math.sin(n)*o,token:t.token,id:e})}let f=[];for(let e=0;e<u;e++)for(let n=0;n<u;n++){let r=s[t.layer][t.head][e][n];r>0&&f.push({source:e,target:n,attention:r,id:`${e}-${n}`})}f=f.sort(((t,e)=>e.attention-t.attention)).slice(0,150);let g=Ji().domain(ft(f.map((t=>t.attention)))).range([.2,.7]),y=Ji().domain([0,1]).range([.1,1]);a.selectAll("path.donut-link").data(f,(t=>t.id)).join("path").attr("class","donut-link").attr("d",(t=>{let e=p[t.source],n=p[t.target];const r=0,a=0,i=.4;let l=r+(e.x-r)*i,o=a+(e.y-r)*i,s=r+(n.x-r)*i,c=a+(n.y-r)*i;return`M ${e.x},${e.y} C${l}, ${o},\n          ${s}, ${c}, ${n.x},${n.y}`})).style("fill","none").style("stroke",d).style("stroke-width",(t=>g(t.attention))).style("opacity",(t=>y(t.attention)))},j=async(t,e,n)=>{s=await Ia(t),o=await Ia(n),c=await Ia(e),c=c[k],u=c.tokens.length};return b((async()=>{null!=s&&null!=o&&null!=c||j(r+`attention-${L(k,4)}.json`,a,i)})),rt.subscribe((async t=>{t!==k&&(k=t,c=await Ia(a),c=c[k],u=c.tokens.length,l.select("*").remove(),z())})),ct.subscribe((t=>{n(0,d=t)})),Z.subscribe((async t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===N||N.compHeight!==t.compHeight&&N.compWidth!==t.compWidth)&&(N=t,$=N.compWidth,A=N.compHeight,null==s||null==o||null==c?j(r+`attention-${L(k,4)}.json`,a,i).then(z):z())})),t.$$set=t=>{"attentionDataDir"in t&&n(3,r=t.attentionDataDir),"saliencyDataFilepath"in t&&n(4,a=t.saliencyDataFilepath),"atlasDataFilepath"in t&&n(5,i=t.atlasDataFilepath)},[d,p,()=>{n(0,d.show=!1,d),ct.set(d),x("close")},r,a,i,function(t){M[t?"unshift":"push"]((()=>{p=t,n(1,p)}))}]}class Oo extends O{constructor(t){super(),W(this,t,Wo,Bo,i,{attentionDataDir:3,saliencyDataFilepath:4,atlasDataFilepath:5},[-1,-1])}}function Ro(e){let n,r,a,i,c,h,f,m,v,w=e[1].layer+1+"",k=e[1].head+1+"";return{c(){n=u("div"),r=u("div"),a=d("Layer "),i=d(w),c=d(" Head "),h=d(k),m=p(),v=u("div"),v.innerHTML='<svg class="side-svg svelte-18n2a3m"></svg>',g(r,"class","side-title svelte-18n2a3m"),g(r,"style",f="color: "+e[2](e[1].layer,e[1].head)),g(v,"class","svg-container"),g(n,"class","atlas-side svelte-18n2a3m")},m(t,s){o(t,n,s),l(n,r),l(r,a),l(r,i),l(r,c),l(r,h),l(n,m),l(n,v),e[3](n)},p(t,[e]){2&e&&w!==(w=t[1].layer+1+"")&&y(i,w),2&e&&k!==(k=t[1].head+1+"")&&y(h,k),2&e&&f!==(f="color: "+t[2](t[1].layer,t[1].head))&&g(r,"style",f)},i:t,o:t,d(t){t&&s(n),e[3](null)}}}let Xo=500;function Yo(t,e,n){let r=null,a=null,i=null,l=null,o=new Map;lt.subscribe((t=>{o=t}));let s={};ct.subscribe((t=>{n(1,s=t),null!=s.attention&&(i.selectAll("*").remove(),c(i))}));const c=t=>{let e=o.get([s.layer,s.head].toString());a.select("#atlas-side-arrow").select("path").attr("fill",e).attr("stroke",e);let n=Ge(document.body).append("svg").attr("height",200).attr("width",200).style("visibility","hidden");const r=eo(s.tokens.map((t=>t.token)),n,"0.9em");let i=250-wt(Object.entries(r.textTokenWidths).map((t=>t[1])));n.remove();let l=[];for(let t=0;t<s.tokens.length;t++){let e=-Math.PI/2+t*(2*Math.PI/s.tokens.length);l.push({x:Math.cos(e)*i,y:Math.sin(e)*i,angle:e,token:s.tokens[t].token,id:t})}let c=[];for(let t=0;t<s.tokens.length;t++)for(let e=0;e<s.tokens.length;e++){let n=s.attention[t][e];n>0&&c.push({source:t,target:e,attention:n,id:`${t}-${e}`})}c=c.sort(((t,e)=>e.attention-t.attention)).slice(0,150);let u=Ji().domain(ft(c.map((t=>t.attention)))).range([.5,2]),h=Ji().domain([0,1]).range([.1,1]),d=t.append("g").attr("class","token-text-group").style("font-size","0.9em").style("cursor","default");d.selectAll("text").data(l,(t=>t.id)).join("text").attr("data-angle",(t=>t.angle)).attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${i}, 0)\n          rotate(${t.angle>=Math.PI/2?180:0})\n        `)).attr("dominant-baseline","middle").attr("x",(t=>t.angle<Math.PI/2?6:-6)).attr("text-anchor",(t=>t.angle<Math.PI/2?"start":"end")).text((t=>t.token));let p=t.select(".token-text-group").clone(!0).remove();n=Ge(document.body).append("svg").attr("viewBox","0 0 500 500").attr("width",480).attr("height",480).style("visibility","hidden"),n.append((()=>p.node()));let f=n.select(".token-text-group").node().getBBox();n.remove();let g=250+f.y,y=Xo-g-f.height,m=250+f.x,v=Xo-m-f.width,w=Math.min(g,y,m,v);i+=Math.floor(w),l=[];for(let t=0;t<s.tokens.length;t++){let e=-Math.PI/2+t*(2*Math.PI/s.tokens.length);l.push({x:Math.cos(e)*i,y:Math.sin(e)*i,angle:e,token:s.tokens[t].token,id:t})}d.selectAll("rect").data(l,(t=>t.id)).join("rect").attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${i}, 0)\n        `)).attr("x",0).attr("y",-5).attr("width",50).attr("height",15).style("fill","white").style("opacity",0).on("mouseover",((e,n)=>{a.select("#atlas-side-arrow").select("path").attr("opacity",.1),t.select(".path-group").selectAll("path.donut-link").style("opacity",.1),t.select(".path-group").selectAll("path.donut-link").filter((t=>t.source===n.id||t.target===n.id)).attr("marker-end","url(#atlas-side-arrow-hover)").style("stroke","hsl(36, 100%, 55%)").style("stroke-width",3).style("opacity",1).raise()})).on("mouseleave",(()=>{a.select("#atlas-side-arrow").select("path").attr("opacity",null),t.select(".path-group").selectAll("path.donut-link").attr("marker-end","url(#atlas-side-arrow)").style("stroke",e).style("stroke-width",(t=>u(t.attention))).style("opacity",1)})),d.selectAll("text").data(l,(t=>t.id)).join("text").attr("data-angle",(t=>t.angle)).attr("transform",(t=>`rotate(${180*t.angle/Math.PI})\n          translate(${i}, 0)\n          rotate(${t.angle>=Math.PI/2?180:0})\n        `)).attr("dominant-baseline","middle").attr("x",(t=>t.angle<Math.PI/2?6:-6)).attr("text-anchor",(t=>t.angle<Math.PI/2?"start":"end")).text((t=>t.token)).on("mouseover",((e,n)=>{a.select("#atlas-side-arrow").select("path").attr("opacity",.1),t.select(".path-group").selectAll("path.donut-link").style("opacity",.1),t.select(".path-group").selectAll("path.donut-link").filter((t=>t.source===n.id||t.target===n.id)).attr("marker-end","url(#atlas-side-arrow-hover)").style("stroke","hsl(36, 100%, 55%)").style("stroke-width",3).style("opacity",1).raise()})).on("mouseleave",(()=>{a.select("#atlas-side-arrow").select("path").attr("opacity",null),t.select(".path-group").selectAll("path.donut-link").attr("marker-end","url(#atlas-side-arrow)").style("stroke",e).style("stroke-width",(t=>u(t.attention))).style("opacity",1)})),t.append("g").attr("class","path-group").selectAll("path.donut-link").data(c,(t=>t.id)).join("path").attr("class","donut-link").attr("marker-end","url(#atlas-side-arrow)").attr("d",(t=>{let e=l[t.source],n=l[t.target];const r=0,a=0,i=.4;let o=r+(e.x-r)*i,s=a+(e.y-r)*i,c=r+(n.x-r)*i,u=a+(n.y-r)*i;return`M ${e.x},${e.y} C${o}, ${s},\n          ${c}, ${u}, ${n.x},${n.y}`})).style("fill","none").style("stroke",e).style("stroke-width",(t=>u(t.attention))).style("opacity",(t=>h(t.attention))),t.append("g").attr("class","token-dot-group").selectAll("circle.token-dot").data(l,(t=>t.id)).join("circle").attr("class","token-dot").attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("r",1)};b((()=>{let t=Ge(r).select(".svg-container");a=t.select("svg.side-svg").attr("viewBox","0 0 500 500").attr("width","100%").attr("height","100%"),a.append("rect").attr("width",Xo).attr("height",Xo).style("fill","hsla(0, 0%, 100%, 0)"),i=a.append("g").attr("class","donut").attr("transform","translate(250, 250)"),l=a.append("defs").attr("id","atlas-side-arrow-def").append("marker").attr("id","atlas-side-arrow").attr("viewBox",[0,0,10,10]).attr("refX",10).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke","gray").attr("fill","gray"),l=a.append("defs").attr("id","atlas-side-arrow-def-hover").append("marker").attr("id","atlas-side-arrow-hover").attr("viewBox",[0,0,10,10]).attr("refX",10).attr("refY",5).attr("markerWidth",12).attr("markerHeight",9).attr("orient","auto").attr("stroke-width",1).attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("stroke","hsl(24, 95%, 59%)").attr("fill","hsl(24, 95%, 59%)")}));return[r,s,(t,e)=>null!=o&&void 0!==o.has&&o.has([t,e].toString())?o.get([t,e].toString()):"black",function(t){M[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class Vo extends O{constructor(t){super(),W(this,t,Yo,Ro,i,{})}}function Uo(e){let n,r=e[0].html+"";return{c(){n=u("div"),g(n,"class","tooltip svelte-b3tml5"),g(n,"style",e[2])},m(t,a){o(t,n,a),n.innerHTML=r,e[3](n)},p(t,[e]){1&e&&r!==(r=t[0].html+"")&&(n.innerHTML=r),4&e&&g(n,"style",t[2])},i:t,o:t,d(t){t&&s(n),e[3](null)}}}function Go(t,e,n){let r,a={show:!1,html:"null",left:0,top:0,width:80,maxWidth:80,fontSize:"1em"},i=null;return tt.subscribe((t=>{let e=Ge(i);t.show?(e.style("visibility","visible"),Ge(i).transition().duration(100).ease(Na).style("opacity",1)):Ge(i).transition().delay(100).duration(200).ease(Na).style("opacity",0).on("end",(function(){Ge(this).style("visibility","hidden")})),n(0,a=t)})),b((()=>{Ge(i).style("visibility","hidden"),tt.set(a)})),t.$$.update=()=>{1&t.$$.dirty&&n(2,r=`left: ${a.left}px; top: ${a.top}px;\n    width: ${a.width}px; max-width: ${a.maxWidth}px;\n    font-size: ${a.fontSize}`)},[a,i,r,function(t){M[t?"unshift":"push"]((()=>{i=t,n(1,i)}))}]}class Ko extends O{constructor(t){super(),W(this,t,Go,Uo,i,{})}}function Qo(e){let n,r,a,i,c,d,y,m,v,w,k,x,b,_;return{c(){n=u("div"),r=u("div"),a=u("div"),a.textContent="Attention Head Overview",i=p(),c=u("div"),d=u("div"),d.innerHTML='<div class="expand-button svelte-1gxmc0v"><div class="icon-wrapper svelte-1gxmc0v"><img src="/dodrio/figures/expand-outline.svg" alt="expanding icon" class="svelte-1gxmc0v"/></div>\n          Show Detail</div>',y=p(),m=u("div"),m.innerHTML='<img src="/dodrio/figures/color-legend.png" alt="expanding icon" class="svelte-1gxmc0v"/>',v=p(),w=u("div"),k=u("div"),x=h("svg"),g(a,"class","lower-atlas-label svelte-1gxmc0v"),g(d,"class","relation-container"),g(c,"class","select-row svelte-1gxmc0v"),g(m,"class","color-legend svelte-1gxmc0v"),g(r,"class","control-row svelte-1gxmc0v"),g(x,"class","atlas-svg"),g(k,"class","atlas-svg-container svelte-1gxmc0v"),g(w,"class","svg-container svelte-1gxmc0v"),g(n,"class","atlas-view svelte-1gxmc0v")},m(t,s){o(t,n,s),l(n,r),l(r,a),l(r,i),l(r,c),l(c,d),l(r,y),l(r,m),l(n,v),l(n,w),l(w,k),l(k,x),e[7](x),e[8](n),b||(_=f(d,"click",e[6]),b=!0)},p:t,i:t,o:t,d(t){t&&s(n),e[7](null),e[8](null),b=!1,_()}}}let Zo=1562;function Jo(t,e,n){let{attentionDataDir:r}=e,{saliencyDataFilepath:a}=e,{atlasDataFilepath:i}=e,l=null,o=null,s=null,c=null,u=null,h=null;tt.subscribe((t=>{h=t}));let d=null,p={layer:9,head:8},f=9,g=8,y=new Map;const m=tr(23,85,56),v=tr(328,85,56),w=tr(274,85,56),k=_();let x=800,$=800,A=void 0;const N=40,E=10,T=10,D=3,S=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e,q=(t,e)=>Array(Math.max(e-String(t).length+1,0)).join(0)+t,L=()=>{const t=s.length,e=s[0].length;let r=x-35-E-T,a=$-N-D-17,i=Math.min(a,r);const c=Math.floor((a-8*(t-1))/t),u=c/2;let k=Math.floor((r-u-e*c)/(t-1)),b=Math.floor((a-t*c)/(t-1));n(0,l=Ge(l).attr("width",r+35).attr("height",a+17)),l.append("rect").attr("class","border-rect").attr("width",i).attr("height",i).style("stroke","black").style("fill","none");let _=l.append("g").attr("class","donut-group").attr("transform",`translate(${E+u+35},\n        ${u+17})`),M={hueScale:Ji().domain([-1,0,1]).range([m,v,w]),lightnessScale:Ji().domain([0,1]).range([130,40]),outRadiusScale:Ji().domain([0,1]).range([3,u]),ringRadiusScale:Ji().domain([0,1]).range([4,7])},A=_.selectAll("g.donut").data(o).join("g").attr("class","donut").style("cursor","pointer").attr("transform",(e=>`translate(${e.head*(2*u+k)},\n        ${(t-e.layer-1)*(2*u+b)})`));A.each(((t,e,n)=>z(t,e,n,M))),lt.set(y),A.on("mouseover",((t,e)=>{let n=t.currentTarget.getBoundingClientRect(),r=n.right-n.left,a=n.x+r/2,i=n.y-90;h.html=`\n        <div class='tooltip-tb' style='display: flex; flex-direction: column;\n          justify-content: center; font-weight: 800;'>\n          <div> Layer ${e.layer+1} Head ${e.head+1} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Semantic: ${S(e.semantic,2)} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Syntactic ${S(e.syntactic,2)} </div>\n          <div style='font-size: 12px; opacity: 0.6;'> Importance: ${S(e.confidence,2)} </div>\n        </div>\n        `,h.width=130,h.maxWidth=130,h.left=a-h.width/2,h.top=i,h.fontSize="0.8em",h.show=!0,tt.set(h);let l=Ge(t.currentTarget);l.classed("selected")||l.select(".donut-rect").style("opacity",1)})).on("mouseleave",(t=>{h.show=!1,tt.set(h);let e=Ge(t.currentTarget);e.classed("selected")||e.select(".donut-rect").style("opacity",0)})).on("click",(t=>{let e=Ge(t.currentTarget);if(e.classed("selected"));else{let t=Ge(_.select(`#donut-rect-${f}-${g}`).node().parentNode);t.select(".donut-rect").style("fill","hsl(0, 0%, 80%)").style("opacity",0),t.classed("selected",!1),e.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),e.classed("selected",!0),f=+e.data()[0].layer,g=+e.data()[0].head,p.layer=f,p.head=g,ut.set(p)}})),_.selectAll("g.row-line-group").data(Array(t-1).fill(0).map(((t,e)=>e))).join("g").attr("class","row-line-group").append("path").attr("d",(n=>`M${-u}\n        ${(t-n-1-.5)*(2*u+b)}\n        L${e*(2*u+k)-u}\n        ${(t-n-1-.5)*(2*u+b)}`)).style("stroke","hsla(0, 0%, 0%, 0.1)"),l.append("g").attr("class","name-group").attr("transform",`translate(${E}, ${u+17})`).selectAll("g.layer-name-group").data(Array(t).fill(0).map(((t,e)=>e))).join("g").attr("class","layer-name-group").attr("transform",(e=>`translate(30,\n        ${(t-e-1)*(2*u+b)})`)).append("text").text((t=>t>0?t+1:"Layer "+(t+1))),l.append("g").attr("class","name-group").attr("transform",`translate(${E+35+u},\n        5)`).selectAll("g.head-name-group").data(Array(t).fill(0).map(((t,e)=>e))).join("g").attr("class","head-name-group").attr("transform",(t=>`translate(${t*(2*u+k)},\n        0)`)).append("text").text((t=>t>0?t+1:"Head "+(t+1))),Ge(d).select(".head-arrow").style("top","30px").style("left",r-170+"px"),Ge(d).select(".layer-arrow").style("top","70px").style("left",r+10+"px");let q=Ge(_.select(`#donut-rect-${f}-${g}`).node().parentNode);q.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),q.classed("selected",!0)};ut.subscribe((t=>{if(p=t,p.layer!==f||p.head!==g){let t=l.select("g.donut-group"),e=Ge(t.select(`#donut-rect-${f}-${g}`).node().parentNode);e.select(".donut-rect").style("fill","hsl(0, 0%, 80%)").style("opacity",0),e.classed("selected",!1),f=p.layer,g=p.head;let n=Ge(t.select(`#donut-rect-${f}-${g}`).node().parentNode);n.select(".donut-rect").style("fill","hsl(27, 47%, 13%)").style("opacity",1),n.classed("selected",!0)}}));const z=(t,e,n,r)=>{let a=Ge(n[e]),i=r.outRadiusScale(t.confidence),l=r.ringRadiusScale(t.confidence),o=Math.max(0,i-l),s=2*r.outRadiusScale.range()[1];a.append("rect").attr("class","donut-rect").attr("id",`donut-rect-${t.layer}-${t.head}`).attr("x",-s/2).attr("y",-s/2).attr("rx",5).attr("width",s).attr("height",s).style("fill","hsl(0, 0%, 80%)").style("opacity",0);let c=xl().outerRadius(i).innerRadius(0).startAngle(0).endAngle(2*Math.PI),h=tr(r.hueScale(t.syntactic-t.semantic));h.l=r.lightnessScale(Math.max(t.semantic,t.syntactic)),y.set([t.layer,t.head].toString(),h.formatHex()),a.append("path").attr("class","donut-chart").attr("d",c).style("fill",h);let d=[];for(let e=0;e<u;e++){let n=-Math.PI/2+e*(2*Math.PI/u);d.push({x:Math.cos(n)*o,y:Math.sin(n)*o,token:t.token,id:e})}},H=async(t,e,n)=>{s=await Ia(t),o=await Ia(n),c=await Ia(e),c=c[1562],u=c.tokens.length};b((async()=>{null!=s&&null!=o&&null!=c||H(r+`attention-${q(Zo,4)}.json`,a,i)})),J.subscribe((async t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===A||A.compHeight!==t.compHeight&&A.compWidth!==t.compWidth)&&(A=t,x=A.compWidth,$=A.compHeight,null==s||null==o||null==c?H(r+`attention-${q(Zo,4)}.json`,a,i).then(L):L())}));return t.$$set=t=>{"attentionDataDir"in t&&n(3,r=t.attentionDataDir),"saliencyDataFilepath"in t&&n(4,a=t.saliencyDataFilepath),"atlasDataFilepath"in t&&n(5,i=t.atlasDataFilepath)},[l,d,k,r,a,i,()=>k("open"),function(t){M[t?"unshift":"push"]((()=>{l=t,n(0,l)}))},function(t){M[t?"unshift":"push"]((()=>{d=t,n(1,d)}))}]}class ts extends O{constructor(t){super(),W(this,t,Jo,Qo,i,{attentionDataDir:3,saliencyDataFilepath:4,atlasDataFilepath:5})}}function es(e){let n;return{c(){n=u("div"),g(n,"class","tooltip svelte-1tyk1ci"),g(n,"style",e[2])},m(t,r){o(t,n,r),n.innerHTML=e[0],e[9](n)},p(t,[e]){1&e&&(n.innerHTML=t[0]),4&e&&g(n,"style",t[2])},i:t,o:t,d(t){t&&s(n),e[9](null)}}}function ns(t,e,n){let r,{tooltipShow:a=!1}=e,{tooltipHtml:i="1.23"}=e,{left:l=0}=e,{top:o=0}=e,{width:s=80}=e,{maxWidth:c=80}=e,{fontSize:u="1em"}=e,h=null;return t.$$set=t=>{"tooltipShow"in t&&n(3,a=t.tooltipShow),"tooltipHtml"in t&&n(0,i=t.tooltipHtml),"left"in t&&n(4,l=t.left),"top"in t&&n(5,o=t.top),"width"in t&&n(6,s=t.width),"maxWidth"in t&&n(7,c=t.maxWidth),"fontSize"in t&&n(8,u=t.fontSize)},t.$$.update=()=>{496&t.$$.dirty&&n(2,r=`left: ${l}px; top: ${o}px; width: ${s}px; max-width: \n              ${c}px; font-size: ${u}`),10&t.$$.dirty&&function(){if(null===h)return;let t=Ge(h);a?(t.style("visibility","visible"),Ge(h).transition().duration(200).ease(Na).style("opacity",1)):Ge(h).transition().duration(200).ease(Na).style("opacity",0).on("end",(function(){Ge(this).style("visibility","hidden")}))}()},[i,h,r,a,l,o,s,c,u,function(t){M[t?"unshift":"push"]((()=>{h=t,n(1,h)}))}]}class rs extends O{constructor(t){super(),W(this,t,ns,es,i,{tooltipShow:3,tooltipHtml:0,left:4,top:5,width:6,maxWidth:7,fontSize:8})}}function as(t){let e,n,r,a,i,c,d={left:t[2],top:t[3],tooltipHtml:t[4],width:is,tooltipShow:t[5],fontSize:os,maxWidth:ls};return r=new rs({props:d}),t[7](r),{c(){e=u("div"),n=u("div"),I(r.$$.fragment),a=p(),i=h("svg"),g(i,"class","embedding-svg"),g(n,"class","svg-container"),g(e,"class","embedding-view")},m(s,u){o(s,e,u),l(e,n),P(r,n,null),l(n,a),l(n,i),t[8](i),c=!0},p(t,[e]){const n={};4&e&&(n.left=t[2]),8&e&&(n.top=t[3]),16&e&&(n.tooltipHtml=t[4]),32&e&&(n.tooltipShow=t[5]),r.$set(n)},i(t){c||(j(r.$$.fragment,t),c=!0)},o(t){F(r.$$.fragment,t),c=!1},d(n){n&&s(e),t[7](null),C(r),t[8](null)}}}let is=150,ls=200,os="0.65em",ss="rgb(100, 149, 237)",cs=.3;function us(t,e,n){let{embeddingDataFilepath:r}=e,a=void 0,i=null,l=null,o=23,s=-1,c=null,u=null,h=null,d=0,p=0,f="tooltip",g=!1,y={0:"red",1:"skyblue"},m=["negative","positive"];const v=()=>{const t=function(){var t,e,n,r=Hl,a=jl,i=Cl,l=Il,o=Pl,s=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,h=Nr,d=St("start","zoom","end"),p=500,f=0,g=10;function y(t){t.property("__zoom",Fl).on("wheel.zoom",_).on("mousedown.zoom",$).on("dblclick.zoom",M).filter(o).on("touchstart.zoom",A).on("touchmove.zoom",N).on("touchend.zoom touchcancel.zoom",E).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(t,e){return(e=Math.max(s[0],Math.min(s[1],e)))===t.k?t:new Sl(e,t.x,t.y)}function v(t,e,n){var r=e[0]-n[0]*t.k,a=e[1]-n[1]*t.k;return r===t.x&&a===t.y?t:new Sl(t.k,r,a)}function w(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function k(t,e,n,r){t.on("start.zoom",(function(){x(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){x(this,arguments).event(r).end()})).tween("zoom",(function(){var t=this,i=arguments,l=x(t,i).event(r),o=a.apply(t,i),s=null==n?w(o):"function"==typeof n?n.apply(t,i):n,c=Math.max(o[1][0]-o[0][0],o[1][1]-o[0][1]),u=t.__zoom,d="function"==typeof e?e.apply(t,i):e,p=h(u.invert(s).concat(c/u.k),d.invert(s).concat(c/d.k));return function(t){if(1===t)t=d;else{var e=p(t),n=c/e[2];t=new Sl(n,s[0]-e[0]*n,s[1]-e[1]*n)}l.zoom(null,t)}}))}function x(t,e,n){return!n&&t.__zooming||new b(t,e)}function b(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=a.apply(t,e),this.taps=0}function _(t,...e){if(r.apply(this,arguments)){var n=x(this,e).event(t),a=this.__zoom,o=Math.max(s[0],Math.min(s[1],a.k*Math.pow(2,l.apply(this,arguments)))),u=Ke(t);if(n.wheel)n.mouse[0][0]===u[0]&&n.mouse[0][1]===u[1]||(n.mouse[1]=a.invert(n.mouse[0]=u)),clearTimeout(n.wheel);else{if(a.k===o)return;n.mouse=[u,a.invert(u)],Kr(this),n.start()}zl(t),n.wheel=setTimeout(h,150),n.zoom("mouse",i(v(m(a,o),n.mouse[0],n.mouse[1]),n.extent,c))}function h(){n.wheel=null,n.end()}}function $(t,...e){if(!n&&r.apply(this,arguments)){var a=x(this,e,!0).event(t),l=Ge(t.view).on("mousemove.zoom",d,!0).on("mouseup.zoom",p,!0),o=Ke(t,s),s=t.currentTarget,u=t.clientX,h=t.clientY;tn(t.view),Ll(t),a.mouse=[o,this.__zoom.invert(o)],Kr(this),a.start()}function d(t){if(zl(t),!a.moved){var e=t.clientX-u,n=t.clientY-h;a.moved=e*e+n*n>f}a.event(t).zoom("mouse",i(v(a.that.__zoom,a.mouse[0]=Ke(t,s),a.mouse[1]),a.extent,c))}function p(t){l.on("mousemove.zoom mouseup.zoom",null),en(t.view,a.moved),zl(t),a.event(t).end()}}function M(t,...e){if(r.apply(this,arguments)){var n=this.__zoom,l=Ke(t.changedTouches?t.changedTouches[0]:t,this),o=n.invert(l),s=n.k*(t.shiftKey?.5:2),h=i(v(m(n,s),l,o),a.apply(this,e),c);zl(t),u>0?Ge(this).transition().duration(u).call(k,h,l,t):Ge(this).call(y.transform,h,l,t)}}function A(n,...a){if(r.apply(this,arguments)){var i,l,o,s,c=n.touches,u=c.length,h=x(this,a,n.changedTouches.length===u).event(n);for(Ll(n),l=0;l<u;++l)s=[s=Ke(o=c[l],this),this.__zoom.invert(s),o.identifier],h.touch0?h.touch1||h.touch0[2]===s[2]||(h.touch1=s,h.taps=0):(h.touch0=s,i=!0,h.taps=1+!!t);t&&(t=clearTimeout(t)),i&&(h.taps<2&&(e=s[0],t=setTimeout((function(){t=null}),p)),Kr(this),h.start())}}function N(t,...e){if(this.__zooming){var n,r,a,l,o=x(this,e).event(t),s=t.changedTouches,u=s.length;for(zl(t),n=0;n<u;++n)a=Ke(r=s[n],this),o.touch0&&o.touch0[2]===r.identifier?o.touch0[0]=a:o.touch1&&o.touch1[2]===r.identifier&&(o.touch1[0]=a);if(r=o.that.__zoom,o.touch1){var h=o.touch0[0],d=o.touch0[1],p=o.touch1[0],f=o.touch1[1],g=(g=p[0]-h[0])*g+(g=p[1]-h[1])*g,y=(y=f[0]-d[0])*y+(y=f[1]-d[1])*y;r=m(r,Math.sqrt(g/y)),a=[(h[0]+p[0])/2,(h[1]+p[1])/2],l=[(d[0]+f[0])/2,(d[1]+f[1])/2]}else{if(!o.touch0)return;a=o.touch0[0],l=o.touch0[1]}o.zoom("touch",i(v(r,a,l),o.extent,c))}}function E(t,...r){if(this.__zooming){var a,i,l=x(this,r).event(t),o=t.changedTouches,s=o.length;for(Ll(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),p),a=0;a<s;++a)i=o[a],l.touch0&&l.touch0[2]===i.identifier?delete l.touch0:l.touch1&&l.touch1[2]===i.identifier&&delete l.touch1;if(l.touch1&&!l.touch0&&(l.touch0=l.touch1,delete l.touch1),l.touch0)l.touch0[1]=this.__zoom.invert(l.touch0[0]);else if(l.end(),2===l.taps&&(i=Ke(i,this),Math.hypot(e[0]-i[0],e[1]-i[1])<g)){var c=Ge(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return y.transform=function(t,e,n,r){var a=t.selection?t.selection():t;a.property("__zoom",Fl),t!==a?k(t,e,n,r):a.interrupt().each((function(){x(this,arguments).event(r).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},y.scaleBy=function(t,e,n,r){y.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}),n,r)},y.scaleTo=function(t,e,n,r){y.transform(t,(function(){var t=a.apply(this,arguments),r=this.__zoom,l=null==n?w(t):"function"==typeof n?n.apply(this,arguments):n,o=r.invert(l),s="function"==typeof e?e.apply(this,arguments):e;return i(v(m(r,s),l,o),t,c)}),n,r)},y.translateBy=function(t,e,n,r){y.transform(t,(function(){return i(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),a.apply(this,arguments),c)}),null,r)},y.translateTo=function(t,e,n,r,l){y.transform(t,(function(){var t=a.apply(this,arguments),l=this.__zoom,o=null==r?w(t):"function"==typeof r?r.apply(this,arguments):r;return i(ql.translate(o[0],o[1]).scale(l.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,c)}),r,l)},b.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=Ge(this.that).datum();d.call(t,this.that,new Dl(t,{sourceEvent:this.sourceEvent,target:y,type:t,transform:this.that.__zoom,dispatch:d}),e)}},y.wheelDelta=function(t){return arguments.length?(l="function"==typeof t?t:Tl(+t),y):l},y.filter=function(t){return arguments.length?(r="function"==typeof t?t:Tl(!!t),y):r},y.touchable=function(t){return arguments.length?(o="function"==typeof t?t:Tl(!!t),y):o},y.extent=function(t){return arguments.length?(a="function"==typeof t?t:Tl([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),y):a},y.scaleExtent=function(t){return arguments.length?(s[0]=+t[0],s[1]=+t[1],y):[s[0],s[1]]},y.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],y):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},y.constrain=function(t){return arguments.length?(i=t,y):i},y.duration=function(t){return arguments.length?(u=+t,y):u},y.interpolate=function(t){return arguments.length?(h=t,y):h},y.on=function(){var t=d.on.apply(d,arguments);return t===d?y:t},y.clickDistance=function(t){return arguments.length?(f=(t=+t)*t,y):Math.sqrt(f)},y.tapDistance=function(t){return arguments.length?(g=+t,y):g},y}().on("zoom",(t=>{e.select("g").attr("transform",t.transform)})).scaleExtent([.5,10]);let e=Ge(i).attr("width",c).attr("height",u).attr("viewBox",[0,0,c,u]).style("fill","#eee").call(t),r=Ji().domain([Math.min(...l.map((({coords:t})=>t[0]))),Math.max(...l.map((({coords:t})=>t[0])))]).range([0,c]),a=Ji().domain([Math.min(...l.map((({coords:t})=>t[1]))),Math.max(...l.map((({coords:t})=>t[1])))]).range([u,0]);e.append("g").selectAll("dot").data(l).enter().append("circle").attr("id",(function(t){return"circle-"+t.id})).attr("cx",(function(t){return r(t.coords[0])})).attr("cy",(function(t){return a(t.coords[1])})).attr("r",(function(t){return t.id==o?7:5})).style("fill",(function(t){return y[t.label]})).style("opacity",(function(t){return t.id==o?1:cs})).style("stroke",(function(t){return t.id==o?ss:"white"})).style("stroke-width","2px").on("click",w).on("mouseover",(function(t,e){!function(t,e){let r=t.currentTarget.getBoundingClientRect(),a=r.right-r.left,i=r.x+a/2,l=r.y-40+window.scrollY;n(5,g=!0),n(4,f=e.sentence.substring(0,40)+"..."),n(2,d=i-is/2),n(3,p=l)}(t,e),function(t){Ge(i).selectAll("circle").filter((function(){return this.id!="circle-"+o&&this.id!="circle-"+t.id})).style("opacity",.2),t.id!=o&&(Ge(i).select("#circle-"+t.id).attr("r",7).style("opacity",1),Ge(i).select("#circle-"+t.id).raise())}(e)})).on("mouseleave",(function(t,e){n(5,g=!1),function(t){Ge(i).selectAll("circle").filter((function(){return this.id!="circle-"+o&&this.id!="circle-"+t.id})).style("opacity",cs),t.id!=o&&Ge(i).select("#circle-"+t.id).attr("r",5).style("opacity",cs)}(e)})),e.select("#circle-"+o).raise();let s=[...l.map((({label:t})=>t))].filter(((t,e,n)=>n.indexOf(t)===e)),h=12,v=e.selectAll(".legend").data(s).enter().append("g").attr("class","legend").attr("transform",(function(t,e){return"translate(0,"+14*e+")"}));v.append("rect").attr("x",c-100).attr("y",u-h*(s.length+1)).attr("width",h).attr("height",h).style("fill",(function(t){return y[t]})),v.append("text").attr("x",c-95+h).attr("y",u-h*s.length).style("text-anchor","start").style("dominant-baseline","text-after-edge").style("fill","black").style("font-size","0.7em").text((function(t){return t+" ("+m[t]+")"}))};function w(t,e){Ge(i).select("#circle-"+o).attr("r",5).style("opacity",cs).style("stroke","white"),nt.set(e.id),Ge(this).attr("r",7).style("opacity",1).style("stroke",ss).raise()}const k=async()=>{l=await Ia(r),v()};return G.subscribe((t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===a||a.compHeight!==t.compHeight&&a.compWidth!==t.compWidth)&&(a=t,c=a.compWidth,u=a.compHeight,c=300,u=300,k())})),b((()=>{c=350,u=300,k()})),nt.subscribe((t=>{n(11,o=t)})),t.$$set=t=>{"embeddingDataFilepath"in t&&n(6,r=t.embeddingDataFilepath)},t.$$.update=()=>{6145&t.$$.dirty&&(Ge(i).select("#circle-"+s).attr("r",5).style("opacity",cs).style("stroke","white"),Ge(i).select("#circle-"+o).attr("r",7).style("opacity",1).style("stroke",ss).raise(),n(12,s=o))},[i,h,d,p,f,g,r,function(t){M[t?"unshift":"push"]((()=>{h=t,n(1,h)}))},function(t){M[t?"unshift":"push"]((()=>{i=t,n(0,i)}))}]}class hs extends O{constructor(t){super(),W(this,t,us,as,i,{embeddingDataFilepath:6})}}function ds(t,e,n){const r=t.slice();return r[11]=e[n],r}function ps(t){let e,n,r,i,c,h,v,w,k,x,b,_,$,M,A,N,E,T,D=t[11].id+"",S=t[11].sentence+"",q=t[11].true_label+"",L=t[11].predicted_label+"",z=Number(t[11].logit_distance.toFixed(2))+"";return{c(){e=u("tr"),n=u("td"),r=d(D),i=p(),c=u("td"),h=d(S),v=p(),w=u("td"),k=d(q),x=p(),b=u("td"),_=d(L),$=p(),M=u("td"),A=d(z),N=p(),m(n,"display","none"),g(n,"class","svelte-os3oqa"),g(c,"class","text-row svelte-os3oqa"),g(w,"class","number-row svelte-os3oqa"),g(b,"class","number-row svelte-os3oqa"),g(M,"class","number-row svelte-os3oqa"),g(e,"class","svelte-os3oqa")},m(s,u){o(s,e,u),l(e,n),l(n,r),l(e,i),l(e,c),l(c,h),l(e,v),l(e,w),l(w,k),l(e,x),l(e,b),l(b,_),l(e,$),l(e,M),l(M,A),l(e,N),E||(T=f(e,"click",(function(){a(t[3](this))&&t[3](this).apply(this,arguments)})),E=!0)},p(e,n){t=e,1&n&&D!==(D=t[11].id+"")&&y(r,D),1&n&&S!==(S=t[11].sentence+"")&&y(h,S),1&n&&q!==(q=t[11].true_label+"")&&y(k,q),1&n&&L!==(L=t[11].predicted_label+"")&&y(_,L),1&n&&z!==(z=Number(t[11].logit_distance.toFixed(2))+"")&&y(A,z)},d(t){t&&s(e),E=!1,T()}}}function fs(e){let n,i,h,y,w,k,x,b,_,$,M,A,N,E,T,D,S,q,L,z,H,j,F,I,P,C,B,W,O,R,X,Y,V,U=e[0],G=[];for(let t=0;t<U.length;t+=1)G[t]=ps(ds(e,U,t));return{c(){n=u("div"),i=u("table"),h=u("thead"),y=u("tr"),w=u("th"),w.textContent="id",k=p(),x=u("th"),b=u("div"),_=d("Sentence\n            "),$=u("img"),A=p(),N=u("th"),E=u("div"),T=d("True\n            "),D=u("img"),q=p(),L=u("th"),z=u("div"),H=d("Predicted\n            "),j=u("img"),I=p(),P=u("th"),C=u("div"),B=d("Error\n            "),W=u("img"),R=p(),X=u("tbody");for(let t=0;t<G.length;t+=1)G[t].c();m(w,"display","none"),g(w,"class","svelte-os3oqa"),$.src!==(M=e[1].sentence.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g($,"src",M),g($,"alt","sort logo"),g($,"class","svelte-os3oqa"),v($,"selected",e[1].sentence.selected),g(b,"class","sentence-div svelte-os3oqa"),g(x,"class","sentence svelte-os3oqa"),D.src!==(S=e[1].true_label.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(D,"src",S),g(D,"alt","sort logo"),g(D,"class","svelte-os3oqa"),v(D,"selected",e[1].true_label.selected),g(E,"class","true-div svelte-os3oqa"),g(N,"class","true svelte-os3oqa"),j.src!==(F=e[1].predicted_label.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(j,"src",F),g(j,"alt","sort logo"),g(j,"class","svelte-os3oqa"),v(j,"selected",e[1].predicted_label.selected),g(z,"class","predicted-div svelte-os3oqa"),g(L,"class","predicted svelte-os3oqa"),W.src!==(O=e[1].logit_distance.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(W,"src",O),g(W,"alt","sort logo"),g(W,"class","svelte-os3oqa"),v(W,"selected",e[1].logit_distance.selected),g(C,"class","error-div svelte-os3oqa"),g(P,"class","error svelte-os3oqa"),g(y,"class","svelte-os3oqa"),g(i,"class","svelte-os3oqa"),g(n,"class","table-view")},m(t,r){o(t,n,r),l(n,i),l(i,h),l(h,y),l(y,w),l(y,k),l(y,x),l(x,b),l(b,_),l(b,$),l(y,A),l(y,N),l(N,E),l(E,T),l(E,D),l(y,q),l(y,L),l(L,z),l(z,H),l(z,j),l(y,I),l(y,P),l(P,C),l(C,B),l(C,W),l(i,R),l(i,X);for(let t=0;t<G.length;t+=1)G[t].m(X,null);Y||(V=[f(w,"click",(function(){a(e[2]("id"))&&e[2]("id").apply(this,arguments)})),f(x,"click",(function(){a(e[2]("sentence"))&&e[2]("sentence").apply(this,arguments)})),f(N,"click",(function(){a(e[2]("true_label"))&&e[2]("true_label").apply(this,arguments)})),f(L,"click",(function(){a(e[2]("predicted_label"))&&e[2]("predicted_label").apply(this,arguments)})),f(P,"click",(function(){a(e[2]("logit_distance"))&&e[2]("logit_distance").apply(this,arguments)}))],Y=!0)},p(t,[n]){if(e=t,2&n&&$.src!==(M=e[1].sentence.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g($,"src",M),2&n&&v($,"selected",e[1].sentence.selected),2&n&&D.src!==(S=e[1].true_label.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(D,"src",S),2&n&&v(D,"selected",e[1].true_label.selected),2&n&&j.src!==(F=e[1].predicted_label.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(j,"src",F),2&n&&v(j,"selected",e[1].predicted_label.selected),2&n&&W.src!==(O=e[1].logit_distance.up?"/dodrio/figures/up.svg":"/dodrio/figures/down.svg")&&g(W,"src",O),2&n&&v(W,"selected",e[1].logit_distance.selected),9&n){let t;for(U=e[0],t=0;t<U.length;t+=1){const r=ds(e,U,t);G[t]?G[t].p(r,n):(G[t]=ps(r),G[t].c(),G[t].m(X,null))}for(;t<G.length;t+=1)G[t].d(1);G.length=U.length}},i:t,o:t,d(t){t&&s(n),c(G,t),Y=!1,r(V)}}}let gs="hsla(0, 0%, 0%, 0.1)";function ys(t,e,n){let r,a,{tableDataFilepath:i}=e,l=void 0,o=[],s=23,c=0,u="true_label",h=!1,d={sentence:{selected:!1,up:!1},true_label:{selected:!1,up:!1},predicted_label:{selected:!1,up:!1},logit_distance:{selected:!1,up:!1}},p={col:"id",ascending:!0};return K.subscribe((t=>{void 0!==t.compHeight&&void 0!==t.compWidth&&(void 0===l||l.compHeight!==t.compHeight&&l.compWidth!==t.compWidth)&&(l=t)})),nt.subscribe((t=>{n(6,s=t)})),b((async()=>{n(0,o=await Ia(i))})),t.$$set=t=>{"tableDataFilepath"in t&&n(4,i=t.tableDataFilepath)},t.$$.update=()=>{1219&t.$$.dirty&&n(2,r=t=>{n(8,u=t),p.col==t?(n(10,p.ascending=!p.ascending,p),n(1,d[t].up=p.ascending,d),n(1,d),n(10,p),n(0,o),n(6,s),n(7,c)):(void 0!==d[p.col]&&n(1,d[p.col].selected=!1,d),n(10,p.col=t,p),n(10,p.ascending=!0,p),n(1,d[t].selected=!0,d),n(1,d[t].up=!0,d),n(1,d),n(10,p),n(0,o),n(6,s),n(7,c));let e=p.ascending?1:-1;n(0,o=o.sort(((n,r)=>n[t]<r[t]?-1*e:n[t]>r[t]?1*e:0))),o.forEach((function(t,e){t.id==s&&(o.splice(e,1),o.unshift(t))})),document.getElementsByTagName("table")[0].children[1].children[c].style="background-color: inherit;",document.getElementsByTagName("table")[0].children[1].children[0].style="background-color: "+gs,n(7,c=0),n(9,h=!1)}),128&t.$$.dirty&&n(3,a=t=>{nt.set(t.cells[0].innerText),n(9,h=!1),document.getElementsByTagName("table")[0].children[1].children[c].style="background-color: inherit;",t.style="background-color: "+gs,n(7,c=t.rowIndex-1)}),964&t.$$.dirty&&(document.getElementsByTagName("table")[0]&&document.getElementsByTagName("table")[0].children[1].children[c]&&h&&r(u),n(9,h=!0))},[o,d,r,a,i]}class ms extends O{constructor(t){super(),W(this,t,ys,fs,i,{tableDataFilepath:4})}}function vs(t){let e,n,a,i,c,h,d,y,m,w,k,x,b,_,$,M,A,N,E,T,D,S,q,L,z,H,B;return b=new ms({props:{tableDataFilepath:t[0]}}),L=new hs({props:{embeddingDataFilepath:t[1]}}),{c(){e=u("div"),n=u("div"),a=u("div"),i=p(),c=u("div"),h=u("div"),d=u("header"),y=u("p"),y.textContent="Select Input Sentence",m=p(),w=u("button"),k=p(),x=u("section"),I(b.$$.fragment),_=p(),$=u("footer"),M=u("div"),A=u("button"),A.textContent="Cancel",N=p(),E=u("button"),E.textContent="Add",T=p(),D=u("div"),S=u("header"),S.innerHTML='<p class="modal-card-title center svelte-14c981o">Instance Embedding</p>',q=p(),I(L.$$.fragment),g(a,"class","modal-background"),g(y,"class","modal-card-title svelte-14c981o"),g(w,"class","delete"),g(w,"aria-label","close"),g(d,"class","modal-card-head svelte-14c981o"),g(x,"class","modal-card-body svelte-14c981o"),g(A,"class","button is-smaller svelte-14c981o"),g(E,"class","button is-success is-smaller svelte-14c981o"),g(M,"class","button-container"),g($,"class","modal-card-foot svelte-14c981o"),g(h,"class","modal-card svelte-14c981o"),g(S,"class","modal-card-head svelte-14c981o"),g(D,"class","embedding-div svelte-14c981o"),g(c,"class","modal-container svelte-14c981o"),g(n,"class","modal"),g(n,"id","input-modal"),v(n,"is-active",t[3].show),g(e,"class","modal-component")},m(r,s){o(r,e,s),l(e,n),l(n,a),l(n,i),l(n,c),l(c,h),l(h,d),l(d,y),l(d,m),l(d,w),l(h,k),l(h,x),P(b,x,null),l(h,_),l(h,$),l($,M),l(M,A),l(M,N),l(M,E),l(c,T),l(c,D),l(D,S),l(D,q),P(L,D,null),t[6](e),z=!0,H||(B=[f(a,"click",t[4]),f(w,"click",t[4]),f(A,"click",t[4]),f(E,"click",t[5])],H=!0)},p(t,[e]){const r={};1&e&&(r.tableDataFilepath=t[0]),b.$set(r);const a={};2&e&&(a.embeddingDataFilepath=t[1]),L.$set(a),8&e&&v(n,"is-active",t[3].show)},i(t){z||(j(b.$$.fragment,t),j(L.$$.fragment,t),z=!0)},o(t){F(b.$$.fragment,t),F(L.$$.fragment,t),z=!1},d(n){n&&s(e),C(b),C(L),t[6](null),H=!1,r(B)}}}function ws(t,e,n){let r,{tableDataFilepath:a}=e,{embeddingDataFilepath:i}=e;const l=_();let o={show:!1},s=null;nt.subscribe((t=>{s=t})),st.set(o),st.subscribe((t=>{n(3,o=t)}));return b((()=>{})),t.$$set=t=>{"tableDataFilepath"in t&&n(0,a=t.tableDataFilepath),"embeddingDataFilepath"in t&&n(1,i=t.embeddingDataFilepath)},[a,i,r,o,()=>{n(3,o.show=!1,o),st.set(o),l("xClicked",{preImage:o.preImage})},()=>{n(3,o.show=!1,o),rt.set(s),l("xClicked",{preImage:o.preImage})},function(t){M[t?"unshift":"push"]((()=>{r=t,n(2,r)}))}]}class ks extends O{constructor(t){super(),W(this,t,ws,vs,i,{tableDataFilepath:0,embeddingDataFilepath:1})}}function xs(e){let n;return{c(){n=u("div"),g(n,"id",e[0])},m(t,e){o(t,n,e)},p(t,[e]){1&e&&g(n,"id",t[0])},i:t,o:t,d(t){t&&s(n)}}}var bs=document.createElement("script");bs.src="https://www.youtube.com/iframe_api";var _s=document.getElementsByTagName("script")[0];function $s(t,e,n){let r,{videoId:a}=e,{playerId:i="player"}=e;_();function l(t){r.mute()}return window.addEventListener("iframeApiReady",(function(t){r=new YT.Player(i,{videoId:a,events:{onReady:l}})})),t.$$set=t=>{"videoId"in t&&n(1,a=t.videoId),"playerId"in t&&n(0,i=t.playerId)},[i,a,function(t=0){r.seekTo(t),r.playVideo()}]}_s.parentNode.insertBefore(bs,_s),window.onYouTubeIframeAPIReady=()=>window.dispatchEvent(new Event("iframeApiReady"));class Ms extends O{constructor(t){super(),W(this,t,$s,xs,i,{videoId:1,playerId:0,play:2})}get play(){return this.$$.ctx[2]}}function As(t){let e,n,i,c,h,d,y,m,v,w,k,x,b,_,$,M,A,N,E,T,D,S,q,L,z,H,B,W,O,R,X,Y,V,U,G,K,Q,Z,J,tt,et,nt,rt,at,it,lt,ot,st;return G=new Ms({props:{videoId:"uboTKqPNU5Y",playerId:"demo_video"}}),t[1](G),{c(){e=u("body"),n=u("div"),i=u("h2"),i.innerHTML='What is <span class="dodrio-text svelte-gkr0le"><img class="icon is-rounded svelte-gkr0le" src="/dodrio/figures/dodrio-logo.svg" height="30px" width="30px" alt="Dodrio logo"/>Dodrio</span>?',c=p(),h=u("p"),h.innerHTML='<a href="https://arxiv.org/pdf/1706.03762.pdf" title="Attention Is All You Need" class="svelte-gkr0le">Transformers</a>\n        are sequence transduction models that excel at modeling long-term dependencies with non-sequential processing.\n        These attributes have made Transformers pervasive in the NLP domain as natural language tasks benefit from the\n        multi-headed attention mechanism to more effectively model longer text, and non-sequential computations no longer\n        inhibit parallelization.\n        Transformers now replace <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.676.4320&amp;rep=rep1&amp;type=pdf" title="Long Short-Term Memory" class="svelte-gkr0le">LSTMs</a> as the state-of-the-art model architecture for <a href="https://www.aclweb.org/anthology/W18-5446.pdf" title="GLUE NLP Benchmarks" class="svelte-gkr0le">NLP tasks</a>.',d=p(),y=u("p"),y.innerHTML='We present <span class="dodrio-text svelte-gkr0le">Dodrio</span>, an interactive visualization tool to help NLP researchers and practitioners analyze and compare attention mechanisms with linguistic knowledge.',m=p(),v=u("h2"),v.innerHTML='Why is <span class="dodrio-text svelte-gkr0le">Dodrio</span> useful?',w=p(),k=u("p"),k.innerHTML='In a large, pre-trained, high-performing model like <a href="https://www.aclweb.org/anthology/N19-1423.pdf" title="BERT" class="svelte-gkr0le">BERT</a>,\n        there are 12 layers each with 12 distinct self-attention heads.\n        Attention heads in Transformers are comprised of weights incurred from tokens when calculating the next representation of the current token.\n        These attention weights then make up an attention map at every attention head (a detailed explanation of this matrix calculation is available <a href="http://jalammar.github.io/illustrated-transformer/" title="Self-attention Calculation" class="svelte-gkr0le">here</a>).\n        As every token in a sentence attends to every other token, we have 12  12  number of tokens  number of tokens attention weights in BERT per text instance!\n        In addition, researchers find some attention heads are correlated to linguistic knowledge such as word semantics and text syntactic dependencies.\n        Therefore, to more easily analyze attention weights, researchers need (1) <em>abstractions</em> and (2) <em>linguistic knowledge contexts</em>.',x=p(),b=u("p"),b.innerHTML='<span class="dodrio-text svelte-gkr0le">Dodrio</span> addresses the challenges of interpreting attention weights through an\n        interactive visualization system that provides <em>attention head summarization</em> and <em>semantic and syntractic knowledge contexts</em>.\n        By identifying the linguistic properties that an attention head attends to in the <em>Attention Head Overview</em> (bottom right),\n        you can click the attention head to explore the semantic and syntactic significance of the sentence at the selected attention head.\n        If you are interested in the lexical dependencies in a sentence, you can explore a syntactically important\n        head in the <em>Dependency View</em> and accompanying <em>Comparison View</em> (top),\n        while semantically important heads can be investigated in the <em>Semantic Attention Graph</em> view (bottom left).\n        We encourage you to further investigate the multi-headed attention mechanism across various text instances with interesting\n        linguistic features (eg. coreferences, word sense, etc.) in the <em>Instance Selection View</em> by clicking the\n        <img class="icon is-rounded svelte-gkr0le" src="/dodrio/figures/edit.svg" alt="edit icon"/> icon in the toolbar at the top of the interface.',_=p(),$=u("h2"),$.textContent="Interactive features",M=p(),A=u("ol"),A.innerHTML='<li class="svelte-gkr0le"><strong>Explore sentences with interesting lexical features</strong> by changing the active instance being visualized <img class="icon is-rounded svelte-gkr0le" src="/dodrio/figures/edit.svg" alt="edit sentence icon"/> to understand how a Transformer attends to tokens in a sentence when solving language tasks.</li> \n      <li class="svelte-gkr0le"><strong>Open the expanded <em>Attention Head Overview</em></strong> by clicking the <img class="is-rounded svelte-gkr0le" style="height: 26px;" src="/dodrio/figures/article-overview-detail.png" alt="detail icon"/> button to see an detailed overview of attention heads.</li> \n    \t<li class="svelte-gkr0le"><strong>Edit the <em>Semantic Attention Graph</em> visualization parameters</strong> to more easily identify strong attention weights and customize the graph representation by adjusting the parameters in <i class="fas fa-sliders-h"></i>.</li> \n    \t<li class="svelte-gkr0le"><strong>Filter dependency relations</strong> visualized by selecting the <img class="is-rounded svelte-gkr0le" style="height: 26px;" src="/dodrio/figures/article-syntactic-rel-selection.png" alt="filter relations icon"/> icon in the upper toolbar.</li>',N=p(),E=u("h2"),E.textContent="Video Tutorial",T=p(),D=u("ul"),S=u("li"),S.innerHTML='Dodrio Introduction\n        <small class="svelte-gkr0le">(0:00-0:08)</small>',q=p(),L=u("li"),L.innerHTML='<em>Attention Head Overview</em> \n        <small class="svelte-gkr0le">(0:08-0:36)</small>',z=p(),H=u("li"),H.innerHTML='<em>Semantic Attention Graph</em> \n        <small class="svelte-gkr0le">(0:36-1:19)</small>',B=p(),W=u("li"),W.innerHTML='<em>Dependency View</em> and <em>Dependency Comparison View</em> \n        <small class="svelte-gkr0le">(1:19-1:49)</small>',O=p(),R=u("li"),R.innerHTML='<em>Instance Selection View</em> \n        <small class="svelte-gkr0le">(1:49-1:53)</small>',X=p(),Y=u("li"),Y.innerHTML='Credits\n        <small class="svelte-gkr0le">(1:57-1:59)</small>',V=p(),U=u("div"),I(G.$$.fragment),K=p(),Q=u("h2"),Q.innerHTML='How is <span class="dodrio-text svelte-gkr0le">Dodrio</span> implemented?',Z=p(),J=u("p"),J.innerHTML='<span class="dodrio-text svelte-gkr0le">Dodrio</span> visualizes Transformer data generated offline as detailed <a href="https://github.com/poloclub/dodrio/tree/master/data-generation" class="svelte-gkr0le">here</a>.\n      Try visualizing your own model/dataset! The entire interactive system is written in\n      Javascript using <a href="https://svelte.dev/" class="svelte-gkr0le"><em>Svelte</em></a> framework and <a href="https://d3js.org/" class="svelte-gkr0le"><em>D3.js</em></a> for visualizations.\n      You only need a web browser to start exploring the attention mechanism in complex Transformers today!\n      \n      <span class="dodrio-text svelte-gkr0le">Dodrio</span> is an <a href="https://github.com/poloclub/dodrio" class="svelte-gkr0le">open-source project</a>;\n      if you have any questions, feel free to open an issue <a href="https://github.com/poloclub/dodrio/issues" class="svelte-gkr0le">here</a>.\n\n      To learn more about <span class="dodrio-text svelte-gkr0le">Dodrio</span>, please check out our pre-print paper <a href="https://arxiv.org/abs/2103.14625" class="svelte-gkr0le">&quot;Dodrio: Exploring Transformer Models with Interactive Visualization.&quot;</a>',tt=p(),et=u("div"),et.innerHTML='<div class="paper-image svelte-gkr0le"><a href="https://arxiv.org/abs/2103.14625" class="svelte-gkr0le"><img src="https://i.imgur.com/PE4GN50.png" alt="paper" class="svelte-gkr0le"/></a></div> \n\n      <div class="paper-info svelte-gkr0le"><div class="paper-info__title svelte-gkr0le"><a href="https://arxiv.org/abs/2103.14625" class="svelte-gkr0le">Dodrio: Exploring Transformer Models with Interactive Visualization</a></div> \n        <div class="paper-info__author svelte-gkr0le"><a href="https://zijie.wang/" class="svelte-gkr0le">Zijie J. Wang</a>,\n          <a href="https://www.linkedin.com/in/robert-turko/" class="svelte-gkr0le">Robert Turko</a>, and\n          <a href="https://www.cc.gatech.edu/~dchau/" class="svelte-gkr0le">Duen Horng (Polo) Chau</a>.</div> \n        <div class="paper-info__venue svelte-gkr0le"><em>arXiv preprint arXiv:2103.14625. 2021.</em></div></div>',nt=p(),rt=u("h2"),rt.innerHTML='Who developed <span class="dodrio-text svelte-gkr0le">Dodrio</span>?',at=p(),it=u("p"),it.innerHTML='<span class="dodrio-text svelte-gkr0le">Dodrio</span> was created by \n      <a href="https://zijie.wang/" class="svelte-gkr0le">Jay Wang</a>,\n      <a href="https://www.linkedin.com/in/robert-turko/" class="svelte-gkr0le">Robert Turko</a>, and\n      <a href="https://www.cc.gatech.edu/~dchau/" class="svelte-gkr0le">Polo Chau</a> in the College of Computing at Georgia Tech.\n      This work was supported in part by NSF grants IIS-1563816, CNS-1704701, NASA NSTRF, DARPA GARD, gifts from Bosch, Intel, NVIDIA, Google, Amazon.',g(i,"class","svelte-gkr0le"),g(h,"class","svelte-gkr0le"),g(y,"class","svelte-gkr0le"),g(v,"class","svelte-gkr0le"),g(k,"class","svelte-gkr0le"),g(b,"class","svelte-gkr0le"),g($,"class","svelte-gkr0le"),g(A,"class","svelte-gkr0le"),g(E,"class","svelte-gkr0le"),g(S,"class","video-link svelte-gkr0le"),g(L,"class","video-link svelte-gkr0le"),g(H,"class","video-link svelte-gkr0le"),g(W,"class","video-link svelte-gkr0le"),g(R,"class","video-link svelte-gkr0le"),g(Y,"class","video-link svelte-gkr0le"),g(D,"class","svelte-gkr0le"),g(U,"class","video svelte-gkr0le"),g(Q,"class","svelte-gkr0le"),g(J,"class","svelte-gkr0le"),g(et,"class","paper svelte-gkr0le"),g(rt,"class","svelte-gkr0le"),g(it,"class","svelte-gkr0le"),g(n,"id","description"),g(n,"class","svelte-gkr0le")},m(r,s){o(r,e,s),l(e,n),l(n,i),l(n,c),l(n,h),l(n,d),l(n,y),l(n,m),l(n,v),l(n,w),l(n,k),l(n,x),l(n,b),l(n,_),l(n,$),l(n,M),l(n,A),l(n,N),l(n,E),l(n,T),l(n,D),l(D,S),l(D,q),l(D,L),l(D,z),l(D,H),l(D,B),l(D,W),l(D,O),l(D,R),l(D,X),l(D,Y),l(n,V),l(n,U),P(G,U,null),l(n,K),l(n,Q),l(n,Z),l(n,J),l(n,tt),l(n,et),l(n,nt),l(n,rt),l(n,at),l(n,it),lt=!0,ot||(st=[f(S,"click",(function(){a(t[0].play(0))&&t[0].play(0).apply(this,arguments)})),f(L,"click",(function(){a(t[0].play(8))&&t[0].play(8).apply(this,arguments)})),f(H,"click",(function(){a(t[0].play(36))&&t[0].play(36).apply(this,arguments)})),f(W,"click",(function(){a(t[0].play(79))&&t[0].play(79).apply(this,arguments)})),f(R,"click",(function(){a(t[0].play(109))&&t[0].play(109).apply(this,arguments)})),f(Y,"click",(function(){a(t[0].play(117))&&t[0].play(117).apply(this,arguments)}))],ot=!0)},p(e,[n]){t=e;G.$set({})},i(t){lt||(j(G.$$.fragment,t),lt=!0)},o(t){F(G.$$.fragment,t),lt=!1},d(n){n&&s(e),t[1](null),C(G),ot=!1,r(st)}}}function Ns(t,e,n){let r;return[r,function(t){M[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class Es extends O{constructor(t){super(),W(this,t,Ns,As,i,{})}}function Ts(t){let e,n,r,a,i,c,d,y,m,w,k,x,b,_,$,M,A,N,E,T,D,S,q,L,z,H,B,W,O,R,Y,V,U,G,K,Q,Z;r=new X({});return i=new Ko({props:{}}),t[14](i),x=new Co({props:{dependencyDataFilepath:Ss,saliencyDataFilepath:Hs,attentionDataDir:Ds,syntacticHeadDataFilepath:qs,semanticHeadDataFilepath:Ls,importantHeadDataFilepath:zs}}),x.$on("close",t[13]),x.$on("open",t[12]),M=new to({props:{attentionDataDir:Ds,saliencyDataFilepath:Hs}}),E=new ts({props:{attentionDataDir:Ds,saliencyDataFilepath:Hs,atlasDataFilepath:js}}),E.$on("open",t[9]),S=new Oo({props:{attentionDataDir:Ds,saliencyDataFilepath:Hs,atlasDataFilepath:js}}),S.$on("close",t[10]),z=new Vo({}),B=new ks({props:{tableDataFilepath:Is,embeddingDataFilepath:Fs}}),B.$on("xClicked",Ps),B.$on("urlTyped",Cs),G=new Es({}),{c(){e=u("div"),n=u("div"),I(r.$$.fragment),a=p(),I(i.$$.fragment),c=p(),d=u("div"),y=u("div"),m=p(),w=u("div"),k=u("div"),I(x.$$.fragment),b=p(),_=u("div"),$=u("div"),I(M.$$.fragment),A=p(),N=u("div"),I(E.$$.fragment),T=p(),D=u("div"),I(S.$$.fragment),q=p(),L=u("div"),I(z.$$.fragment),H=p(),I(B.$$.fragment),W=p(),O=u("div"),R=u("div"),Y=h("svg"),V=h("path"),U=p(),I(G.$$.fragment),g(y,"class","select-container svelte-gjd059"),g(k,"class","instance-container svelte-gjd059"),g($,"class","graph-container svelte-gjd059"),g(N,"class","lower-atlas-container svelte-gjd059"),g(_,"class","lower-container svelte-gjd059"),g(D,"class","atlas-container svelte-gjd059"),g(D,"style","visibility=hidden"),g(L,"class","atlas-sidebar svelte-gjd059"),v(L,"hidden",!t[3].show),g(w,"class","attention-container svelte-gjd059"),g(V,"fill","none"),g(V,"stroke","currentColor"),g(V,"stroke-linecap","round"),g(V,"stroke-linejoin","round"),g(V,"stroke-width","80"),g(V,"d","M112 184l144 144 144-144"),g(Y,"class","icon-down svelte-gjd059"),g(Y,"viewBox","0 0 512 512"),v(Y,"up-down",!t[2]),g(R,"class","icon-wrapper svelte-gjd059"),g(O,"class","down-button svelte-gjd059"),g(d,"class","main-content svelte-gjd059"),g(n,"class","dodrio-vis svelte-gjd059"),g(e,"class","main")},m(s,u){o(s,e,u),l(e,n),P(r,n,null),l(n,a),P(i,n,null),l(n,c),l(n,d),l(d,y),l(d,m),l(d,w),l(w,k),P(x,k,null),t[15](k),l(w,b),l(w,_),l(_,$),P(M,$,null),t[16]($),l(_,A),l(_,N),P(E,N,null),t[17](N),t[18](_),l(w,T),l(w,D),P(S,D,null),t[19](D),l(w,q),l(w,L),P(z,L,null),l(d,H),P(B,d,null),l(d,W),l(d,O),l(O,R),l(R,Y),l(Y,V),t[20](O),l(e,U),P(G,e,null),K=!0,Q||(Z=f(R,"click",t[11]),Q=!0)},p(t,[e]){i.$set({}),8&e&&v(L,"hidden",!t[3].show),4&e&&v(Y,"up-down",!t[2])},i(t){K||(j(r.$$.fragment,t),j(i.$$.fragment,t),j(x.$$.fragment,t),j(M.$$.fragment,t),j(E.$$.fragment,t),j(S.$$.fragment,t),j(z.$$.fragment,t),j(B.$$.fragment,t),j(G.$$.fragment,t),K=!0)},o(t){F(r.$$.fragment,t),F(i.$$.fragment,t),F(x.$$.fragment,t),F(M.$$.fragment,t),F(E.$$.fragment,t),F(S.$$.fragment,t),F(z.$$.fragment,t),F(B.$$.fragment,t),F(G.$$.fragment,t),K=!1},d(n){n&&s(e),C(r),t[14](null),C(i),C(x),t[15](null),C(M),t[16](null),C(E),t[17](null),t[18](null),C(S),t[19](null),C(z),C(B),t[20](null),C(G),Q=!1,Z()}}}const Ds="/dodrio/data/sst2-attention-data/",Ss="/dodrio/data/sst2-dependencies.json",qs="/dodrio/data/sst2-sorted-syntactic-heads.json",Ls="/dodrio/data/sst2-sorted-saliency-heads.json",zs="/dodrio/data/sst2-sorted-confidence-heads.json",Hs="/dodrio/data/sst2-saliency-list-grad-l1.json",js="/dodrio/data/sst2-atlas.json",Fs="/dodrio/data/embedding-list-sst2.json",Is="/dodrio/data/table-list-sst2.json",Ps=()=>{},Cs=()=>{};function Bs(t,e,n){let r,a=null,i=null,l=null,o=!0,s=50,c=20;tt.subscribe((t=>{}));let u={};ct.subscribe((t=>{n(3,u=t)}));let h=null,d=null,p={compWidth:null,compHeight:null},f=null,g=null,y={compWidth:null,compHeight:null},m={};et.subscribe((t=>{m=t}));let v=null,w={compWidth:null,compHeight:null},k=null,x={compWidth:null,compHeight:null};const _=()=>{Ge(v).select(".legend-container").style("display","none");let t=Ge(v).select(".atlas-svg-container").style("width","100%").style("height","100%").select(".atlas-svg-full");i=t.attr("width"),l=t.attr("height"),t.attr("width",null).attr("height",null).style("padding-top","36px").style("padding-left","8px").style("width","100%").style("height","100%"),n(7,v.style.width=x.compWidth+"px",v),n(7,v.style.height=x.compHeight+"px",v),n(7,v.style.opacity=0,v);const e=()=>{n(7,v.style.display="none",v),n(7,v.style.visibility="",v),n(7,v.style.width="1000px",v),n(7,v.style.height="100%",v),Ge(v).select(".legend-container").style("display",null),Ge(v).select(".atlas-svg-container").style("width",null).style("height",null).select(".atlas-svg-full").style("padding-top",null).style("padding-left",null).style("width",null).style("height",null).attr("width",i).attr("height",l),v.removeEventListener("transitionend",e)};v.addEventListener("transitionend",e)};return b((()=>{p.compWidth=Math.floor(d.clientWidth),p.compHeight=Math.floor(d.clientHeight),U.set(p),y.compWidth=Math.floor(g.clientWidth),y.compHeight=Math.floor(g.clientHeight)-5,Q.set(y),f=Math.floor(g.clientHeight),x.compWidth=Math.floor(k.clientWidth),x.compHeight=Math.floor(k.clientHeight),J.set(x),w.compWidth=Math.floor(v.clientWidth-10),w.compHeight=Math.floor(v.clientHeight-10),Z.set(w),n(7,v.style.opacity="0",v),n(7,v.style.visibility="hidden",v),_(),n(1,r.style.top=Math.floor(g.clientHeight)+50-c/2+"px",r),n(1,r.style.left=p.compWidth-s/2+"px",r),n(1,r.style.width=s+"px",r),n(1,r.style.height=c+"px",r),n(1,r.style.visibility="visible",r)})),[a,r,o,u,h,d,g,v,k,()=>{n(7,v.style.display="",v),n(7,v.style.opacity="1",v)},_,()=>{o?(n(6,g.style.height="100%",g),n(4,h.style.bottom=`-${p.compHeight-10}px`,h),n(1,r.style.top=f+50-c/2+p.compHeight-10+"px",r),m.height=Math.floor(g.clientHeight)-5,m.inComparison=!0,et.set(m)):(n(6,g.style.height="34%",g),n(4,h.style.bottom="0px",h),n(1,r.style.top=f+50-c/2+"px",r),m.height=f-5,m.inComparison=!1,et.set(m)),n(2,o=!o)},()=>{n(6,g.style.height="100%",g),n(4,h.style.bottom=`-${p.compHeight-10}px`,h),n(1,r.style.top=f+50-c/2+p.compHeight-10+"px",r),n(2,o=!1),m.height=Math.floor(g.clientHeight)-5,m.inComparison=!0,et.set(m)},()=>{n(6,g.style.height="34%",g),n(4,h.style.bottom="0px",h),n(1,r.style.top=f+50-c/2+"px",r),n(2,o=!0),m.height=f-5,m.inComparison=!1,et.set(m)},function(t){M[t?"unshift":"push"]((()=>{a=t,n(0,a)}))},function(t){M[t?"unshift":"push"]((()=>{g=t,n(6,g)}))},function(t){M[t?"unshift":"push"]((()=>{d=t,n(5,d)}))},function(t){M[t?"unshift":"push"]((()=>{k=t,n(8,k)}))},function(t){M[t?"unshift":"push"]((()=>{h=t,n(4,h)}))},function(t){M[t?"unshift":"push"]((()=>{v=t,n(7,v)}))},function(t){M[t?"unshift":"push"]((()=>{r=t,n(1,r)}))}]}class Ws extends O{constructor(t){super(),W(this,t,Bs,Ts,i,{})}}function Os(e){let n,r,a;return r=new Ws({}),{c(){n=u("div"),I(r.$$.fragment),g(n,"class","app-page")},m(t,e){o(t,n,e),P(r,n,null),a=!0},p:t,i(t){a||(j(r.$$.fragment,t),a=!0)},o(t){F(r.$$.fragment,t),a=!1},d(t){t&&s(n),C(r)}}}return new class extends O{constructor(t){super(),W(this,t,null,Os,i,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
